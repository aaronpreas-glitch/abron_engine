#!/usr/bin/env python3
import base64, ast, sys

FILES = {
    '/root/memecoin_engine/utils/format.py': 'ZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGh0bWwKCgpkZWYgX2VzYyh2YWx1ZSk6CiAgICByZXR1cm4gaHRtbC5lc2NhcGUoc3RyKHZhbHVlKSkKCgpkZWYgX3JlbmRlcl9wcmUocm93cyk6CiAgICBsaW5lcyA9IFtzdHIocm93IG9yICIiKSBmb3Igcm93IGluIHJvd3NdCiAgICBpZiBub3QgbGluZXM6CiAgICAgICAgcmV0dXJuICIiCiAgICBwYW5lbF93aWR0aCA9IF9QQU5FTF9XSURUSAogICAgd3JhcHBlZCA9IFtdCiAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICB3cmFwcGVkLmV4dGVuZChfd3JhcF90ZXh0KGxpbmUsIHBhbmVsX3dpZHRoKSkKICAgIHJldHVybiAiXG4iLmpvaW4oZiI8Y29kZT57X2VzYyhsaW5lKX08L2NvZGU+IiBmb3IgbGluZSBpbiB3cmFwcGVkKQoKCl9QQU5FTF9XSURUSCA9IDQyCgoKZGVmIF90cmltX3RleHQodmFsdWUsIG1heF9sZW4pOgogICAgdGV4dCA9IHN0cih2YWx1ZSBvciAiIikKICAgIGlmIG1heF9sZW4gPD0gMDoKICAgICAgICByZXR1cm4gdGV4dAogICAgcmV0dXJuIHRleHQKCgpkZWYgX3dyYXBfdGV4dCh2YWx1ZSwgbWF4X2xlbik6CiAgICB0ZXh0ID0gc3RyKHZhbHVlIG9yICIiKQogICAgaWYgbWF4X2xlbiA8PSAwIG9yIGxlbih0ZXh0KSA8PSBtYXhfbGVuOgogICAgICAgIHJldHVybiBbdGV4dF0KICAgIG91dCA9IFtdCiAgICByZW1haW5pbmcgPSB0ZXh0CiAgICB3aGlsZSBsZW4ocmVtYWluaW5nKSA+IG1heF9sZW46CiAgICAgICAgY3V0ID0gcmVtYWluaW5nLnJmaW5kKCIgIiwgMCwgbWF4X2xlbiArIDEpCiAgICAgICAgaWYgY3V0IDw9IDA6CiAgICAgICAgICAgIGN1dCA9IG1heF9sZW4KICAgICAgICBvdXQuYXBwZW5kKHJlbWFpbmluZ1s6Y3V0XS5yc3RyaXAoKSkKICAgICAgICByZW1haW5pbmcgPSByZW1haW5pbmdbY3V0Ol0ubHN0cmlwKCkKICAgIG91dC5hcHBlbmQocmVtYWluaW5nKQogICAgcmV0dXJuIG91dAoKCmRlZiBfa3YobGFiZWwsIHZhbHVlLCB3aWR0aDogaW50ID0gX1BBTkVMX1dJRFRIKToKICAgIGtleSA9IHN0cihsYWJlbCBvciAiIikudXBwZXIoKVs6OV0KICAgIGxpbmUgPSBmIntrZXk6PDl9IHwge3ZhbHVlfSIKICAgIHJldHVybiBfdHJpbV90ZXh0KGxpbmUsIHdpZHRoKQoKCmRlZiBfaGVhZGVyX2Jsb2NrKHRhZzogc3RyLCBoZWFkZXJfcm93cz1Ob25lLCB3aWR0aDogaW50ID0gX1BBTkVMX1dJRFRIKToKICAgIHJvd3MgPSBbCiAgICAgICAgZiI8Yj57X2VzYyh0YWcpfTwvYj4iLAogICAgICAgIGYiPGNvZGU+eyctJyAqIG1pbigzMCwgd2lkdGgpfTwvY29kZT4iLAogICAgXQogICAgZm9yIHJvdyBpbiAoaGVhZGVyX3Jvd3Mgb3IgW10pOgogICAgICAgIHJvd3MuYXBwZW5kKGYiPGNvZGU+e19lc2MoX3RyaW1fdGV4dChzdHIocm93IG9yICcnKSwgd2lkdGgpKX08L2NvZGU+IikKICAgIHJldHVybiAiXG4iLmpvaW4ocm93cykKCgpkZWYgX3Njb3JlX2JhcihzY29yZSk6CiAgICBzY29yZSA9IG1heCgwLCBtaW4oMTAwLCBmbG9hdChzY29yZSBvciAwKSkpCiAgICBibG9ja3MgPSBpbnQocm91bmQoc2NvcmUgLyAxMC4wKSkKICAgIHJldHVybiAoIiMiICogYmxvY2tzKSArICgiLSIgKiAoMTAgLSBibG9ja3MpKQoKCmRlZiBfZm10X3BjdCh2YWx1ZSk6CiAgICBpZiB2YWx1ZSBpcyBOb25lOgogICAgICAgIHJldHVybiAiTi9BIgogICAgdHJ5OgogICAgICAgIG51bWJlciA9IGZsb2F0KHZhbHVlKQogICAgICAgIHNpZ24gPSAiKyIgaWYgbnVtYmVyID4gMCBlbHNlICIiCiAgICAgICAgcmV0dXJuIGYie3NpZ259e251bWJlcjouMmZ9JSIKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKCgpkZWYgX2ZtdF9udW0odmFsdWUsIGRpZ2l0cz0wKToKICAgIHRyeToKICAgICAgICByZXR1cm4gZiJ7ZmxvYXQodmFsdWUpOiwue2RpZ2l0c31mfSIKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKCgpkZWYgX2ZtdF91c2RfY29tcGFjdCh2YWx1ZSk6CiAgICB0cnk6CiAgICAgICAgbiA9IGZsb2F0KHZhbHVlKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiAiTi9BIgogICAgYWJzX24gPSBhYnMobikKICAgIGlmIGFic19uID49IDFfMDAwXzAwMF8wMDA6CiAgICAgICAgcmV0dXJuIGYiJHtuLzFfMDAwXzAwMF8wMDA6LjJmfUIiCiAgICBpZiBhYnNfbiA+PSAxXzAwMF8wMDA6CiAgICAgICAgcmV0dXJuIGYiJHtuLzFfMDAwXzAwMDouMmZ9TSIKICAgIGlmIGFic19uID49IDFfMDAwOgogICAgICAgIHJldHVybiBmIiR7bi8xXzAwMDouMWZ9SyIKICAgIHJldHVybiBmIiR7bjouMGZ9IgoKCmRlZiBfZm10X3ByaWNlX3ByZWNpc2UodmFsdWUpOgogICAgdHJ5OgogICAgICAgIHAgPSBmbG9hdCh2YWx1ZSkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKICAgIGlmIHAgPD0gMDoKICAgICAgICByZXR1cm4gIk4vQSIKICAgIGlmIHAgPCAwLjAxOgogICAgICAgIHJldHVybiBmIiR7cDouOGZ9Ii5yc3RyaXAoIjAiKS5yc3RyaXAoIi4iKQogICAgaWYgcCA8IDE6CiAgICAgICAgcmV0dXJuIGYiJHtwOi42Zn0iLnJzdHJpcCgiMCIpLnJzdHJpcCgiLiIpCiAgICBpZiBwIDwgMTAwMDoKICAgICAgICByZXR1cm4gZiIke3A6LjRmfSIucnN0cmlwKCIwIikucnN0cmlwKCIuIikKICAgIHJldHVybiBfZm10X3VzZF9jb21wYWN0KHApCgoKZGVmIF9mbXRfaG9sZGVycyh2YWx1ZSk6CiAgICBpZiB2YWx1ZSBpbiAoTm9uZSwgIiIsICJOL0EiKToKICAgICAgICByZXR1cm4gIk4vQSIKICAgIHRyeToKICAgICAgICByZXR1cm4gZiJ7aW50KGZsb2F0KHZhbHVlKSk6LH0iCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuICJOL0EiCgoKZGVmIF9jb25maWRlbmNlX2xhYmVsKGNvbmZpZGVuY2UpOgogICAgY29uZiA9IHN0cihjb25maWRlbmNlIG9yICJDIikudXBwZXIoKQogICAgaWYgY29uZiA9PSAiQSI6CiAgICAgICAgcmV0dXJuICJBIgogICAgaWYgY29uZiA9PSAiQiI6CiAgICAgICAgcmV0dXJuICJCIgogICAgcmV0dXJuICJDIgoKCmRlZiBfY29tcGFjdF9lbnRyeShlbnRyeV90eXBlKToKICAgIHRleHQgPSBzdHIoZW50cnlfdHlwZSBvciAiIikuc3RyaXAoKS5sb3dlcigpCiAgICBpZiB0ZXh0ID09ICJtb21lbnR1bSBjb250aW51YXRpb24iOgogICAgICAgIHJldHVybiAiTW9tZW50dW0gY29udGludWF0aW9uIgogICAgaWYgdGV4dCA9PSAiZGlwIHJlY292ZXJ5IHNldHVwIjoKICAgICAgICByZXR1cm4gIkRpcCByZWNvdmVyeSIKICAgIHJldHVybiBzdHIoZW50cnlfdHlwZSBvciAiTi9BIikKCgpkZWYgX3JzaV9tZWFuaW5nKHJzaV92YWx1ZSk6CiAgICBpZiByc2lfdmFsdWUgaXMgTm9uZToKICAgICAgICByZXR1cm4gTm9uZQogICAgdHJ5OgogICAgICAgIHIgPSBmbG9hdChyc2lfdmFsdWUpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIHIgPCAzNToKICAgICAgICByZXR1cm4gIlJTSSBvdmVyc29sZCIKICAgIGlmIHIgPCA1MDoKICAgICAgICByZXR1cm4gIlJTSSB3ZWFrIgogICAgaWYgciA8IDY1OgogICAgICAgIHJldHVybiAiUlNJIGhlYWx0aHkiCiAgICBpZiByIDwgNzU6CiAgICAgICAgcmV0dXJuICJSU0kgc3Ryb25nIgogICAgcmV0dXJuICJSU0kgb3ZlcmJvdWdodCIKCgpkZWYgX21hY2RfbWVhbmluZyhtYWNkX2hpc3RfdmFsdWUpOgogICAgaWYgbWFjZF9oaXN0X3ZhbHVlIGlzIE5vbmU6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHRyeToKICAgICAgICBoID0gZmxvYXQobWFjZF9oaXN0X3ZhbHVlKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiBOb25lCiAgICBpZiBoID4gMC4wMToKICAgICAgICByZXR1cm4gIk1BQ0QgYnVsbGlzaCBzdHJvbmciCiAgICBpZiBoID4gMDoKICAgICAgICByZXR1cm4gIk1BQ0QgYnVsbGlzaCIKICAgIGlmIGggPiAtMC4wMToKICAgICAgICByZXR1cm4gIk1BQ0QgbmV1dHJhbCIKICAgIHJldHVybiAiTUFDRCBiZWFyaXNoIgoKCmRlZiBfcHJpb3JpdHlfZnJvbV9zY29yZShzY29yZSk6CiAgICB0cnk6CiAgICAgICAgcyA9IGZsb2F0KHNjb3JlIG9yIDApCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuICJQMyIKICAgIGlmIHMgPj0gOTA6CiAgICAgICAgcmV0dXJuICJQMSIKICAgIGlmIHMgPj0gODA6CiAgICAgICAgcmV0dXJuICJQMiIKICAgIHJldHVybiAiUDMiCgoKZGVmIF9kYXRhX2FnZV90ZXh0KGxhc3RfdHJhZGVfdW5peCk6CiAgICB0cnk6CiAgICAgICAgdHMgPSBpbnQoZmxvYXQobGFzdF90cmFkZV91bml4KSkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKICAgIGlmIHRzIDw9IDA6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICBub3dfdHMgPSBpbnQoZGF0ZXRpbWUudXRjbm93KCkudGltZXN0YW1wKCkpCiAgICBhZ2Vfc2VjID0gbWF4KDAsIG5vd190cyAtIHRzKQogICAgaWYgYWdlX3NlYyA8IDYwOgogICAgICAgIHJldHVybiBmInthZ2Vfc2VjfXMiCiAgICBpZiBhZ2Vfc2VjIDwgMzYwMDoKICAgICAgICByZXR1cm4gZiJ7YWdlX3NlYyAvLyA2MH1tIgogICAgcmV0dXJuIGYie2FnZV9zZWMgLy8gMzYwMH1oIgoKCmRlZiBfaW52YWxpZGF0aW9uX2Zyb21fcmlza19wbGFuKHJpc2tfcGxhbik6CiAgICByYXcgPSBzdHIocmlza19wbGFuIG9yICIiKS5zdHJpcCgpCiAgICBpZiBub3QgcmF3OgogICAgICAgIHJldHVybiAiVGhlc2lzIGJyZWFrIgogICAgcmV0dXJuIHJhdy5zcGxpdCgifCIsIDEpWzBdLnN0cmlwKCkKCgpkZWYgZm9ybWF0X3NpZ25hbCh0b2tlbl9kYXRhLCBjb21wYWN0OiBib29sID0gVHJ1ZSk6CiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgc3ltYm9sID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpKS51cHBlcigpCiAgICBzY29yZSA9IGZsb2F0KHRva2VuX2RhdGEuZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICBob2xkZXJzID0gX2ZtdF9ob2xkZXJzKHRva2VuX2RhdGEuZ2V0KCJob2xkZXJzIiwgIk4vQSIpKQogICAgdHJlbmQgPSB0b2tlbl9kYXRhLmdldCgidHJlbmQiLCAiVW5rbm93biIpCiAgICBlbnRyeV90eXBlID0gX2NvbXBhY3RfZW50cnkodG9rZW5fZGF0YS5nZXQoImVudHJ5X3R5cGUiLCAiTi9BIikpCiAgICBjb25maWRlbmNlID0gdG9rZW5fZGF0YS5nZXQoImNvbmZpZGVuY2UiLCAiQyIpCiAgICByZWdpbWVfbGFiZWwgPSBzdHIodG9rZW5fZGF0YS5nZXQoInJlZ2ltZV9sYWJlbCIsICJVTktOT1dOIikpCiAgICBwcm9maWxlID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJwcm9maWxlIiwgIlNUUkFURUdJQyIpKS51cHBlcigpCiAgICBjaGFuZ2VfMjRoID0gdG9rZW5fZGF0YS5nZXQoImNoYW5nZV8yNGgiKQogICAgcnNpID0gdG9rZW5fZGF0YS5nZXQoInJzaSIpCiAgICBtYWNkX2hpc3QgPSB0b2tlbl9kYXRhLmdldCgibWFjZF9oaXN0IikKICAgIG1hcmtldF9jYXAgPSB0b2tlbl9kYXRhLmdldCgibWFya2V0X2NhcCIpCiAgICBmZHYgPSB0b2tlbl9kYXRhLmdldCgiZmR2IikKICAgIHdhbGxldF9maXQgPSBzdHIodG9rZW5fZGF0YS5nZXQoIndhbGxldF9maXQiKSBvciAiVzIiKQogICAgcmlza19wbGFuID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJyaXNrX3BsYW4iKSBvciAiU0wgLTEwJSB8IFRQICsxMi8rMjUgfCBUcmFpbCAxMCUiKQogICAgcm90YXRpb25fcGxhbiA9IHN0cih0b2tlbl9kYXRhLmdldCgicm90YXRpb25fcGxhbiIpIG9yICJSb3RhdGUgcHJvZml0cyB0byBXMS9VU0RDIHBlciBwbGFuIikKICAgIGxhc3RfdHJhZGVfdW5peCA9IHRva2VuX2RhdGEuZ2V0KCJsYXN0X3RyYWRlX3VuaXgiKQoKICAgIHNjb3JlX2xpbmUgPSBmIntzY29yZTouMWZ9LzEwMCB7X3Njb3JlX2JhcihzY29yZSl9IgogICAgY29uZmlkZW5jZV9saW5lID0gX2NvbmZpZGVuY2VfbGFiZWwoY29uZmlkZW5jZSkKICAgIGNoYW5nZV9saW5lID0gX2ZtdF9wY3QoY2hhbmdlXzI0aCkKICAgIHByaW9yaXR5ID0gX3ByaW9yaXR5X2Zyb21fc2NvcmUoc2NvcmUpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIGFjdGlvbiA9ICJFTlRFUiBOT1ciIGlmIHNjb3JlID49IDc1IGVsc2UgIldBVENIIgogICAgYWN0aW9uX2Vtb2ppID0gIvCfn6IiIGlmIHNjb3JlID49IDc1IGVsc2UgIvCfn6EiCiAgICByZWdpbWVfZW1vamkgPSAi8J+foiIgaWYgIk9OIiBpbiByZWdpbWVfbGFiZWwgZWxzZSAoIvCflLQiIGlmICJPRkYiIGluIHJlZ2ltZV9sYWJlbCBlbHNlICLwn5+hIikKICAgIGludmFsaWRhdGlvbiA9IF9pbnZhbGlkYXRpb25fZnJvbV9yaXNrX3BsYW4ocmlza19wbGFuKQoKICAgICMgRW50cnkgcHJpY2UgYW5kIHRhcmdldHMKICAgIHByaWNlID0gZmxvYXQodG9rZW5fZGF0YS5nZXQoInByaWNlIikgb3IgMCkKICAgIGVudHJ5X2Rpc3BsYXkgPSBfZm10X3ByaWNlX3ByZWNpc2UocHJpY2UpIGlmIHByaWNlID4gMCBlbHNlICJOL0EiCiAgICBpZiBwcmljZSA+IDA6CiAgICAgICAgdGFyZ2V0MSA9IF9mbXRfcHJpY2VfcHJlY2lzZShwcmljZSAqIDEuMTIpCiAgICAgICAgdGFyZ2V0MiA9IF9mbXRfcHJpY2VfcHJlY2lzZShwcmljZSAqIDEuMjUpCiAgICAgICAgc3RvcCA9IF9mbXRfcHJpY2VfcHJlY2lzZShwcmljZSAqIDAuOTApCiAgICBlbHNlOgogICAgICAgIHRhcmdldDEgPSB0YXJnZXQyID0gc3RvcCA9ICJOL0EiCgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5OLIFtTSUdOQUxdOiBNRU1FQ09JTiBTRVRVUDwvYj4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfjq8gQ09JTjogJHtfZXNjKHN5bWJvbCl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OKIFBST0ZJTEU6IHtfZXNjKHByb2ZpbGUpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+4q2QIFNDT1JFOiB7X2VzYyhzY29yZV9saW5lKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkrAgTUFSS0VUQ0FQOiB7X2VzYyhfZm10X3VzZF9jb21wYWN0KGNhcF92YWx1ZSkpfSB8IDI0SCB7X2VzYyhjaGFuZ2VfbGluZSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KnIExJUVVJRElUWToge19lc2MoX2ZtdF91c2RfY29tcGFjdChsaXF1aWRpdHkpKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntyZWdpbWVfZW1vaml9IFJFR0lNRToge19lc2MocmVnaW1lX2xhYmVsKX0gfCBHUkFERSB7X2VzYyhjb25maWRlbmNlX2xpbmUpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPnthY3Rpb25fZW1vaml9IFNJR05BTDoge19lc2MoYWN0aW9uKX08L2NvZGU+IiwKICAgIF0KCiAgICBpZiBub3QgY29tcGFjdDoKICAgICAgICB0ZWNoX3BhcnRzID0gW3ggZm9yIHggaW4gW19yc2lfbWVhbmluZyhyc2kpLCBfbWFjZF9tZWFuaW5nKG1hY2RfaGlzdCldIGlmIHhdCiAgICAgICAgaWYgdGVjaF9wYXJ0czoKICAgICAgICAgICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+8J+TiCBNT01FTlRVTToge19lc2MoJyB8ICcuam9pbih0ZWNoX3BhcnRzKSl9PC9jb2RlPiIpCiAgICAgICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+8J+RmyBXQUxMRVQgRklUOiB7X2VzYyh3YWxsZXRfZml0KX08L2NvZGU+IikKICAgICAgICBpZiBob2xkZXJzICE9ICJOL0EiOgogICAgICAgICAgICBsaW5lcy5hcHBlbmQoZiI8Y29kZT7wn5GlIEhPTERFUlM6IHtfZXNjKGhvbGRlcnMpfTwvY29kZT4iKQogICAgICAgIGxpbmVzLmFwcGVuZChmIjxjb2RlPvCfmqsgSU5WQUxJRDoge19lc2MoaW52YWxpZGF0aW9uKX08L2NvZGU+IikKCiAgICBsaW5lcyArPSBbCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TjSBFbnRyeToge19lc2MoZW50cnlfZGlzcGxheSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIFRhcmdldCAxOiB7X2VzYyh0YXJnZXQxKX0gKCsxMiUpPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIFRhcmdldCAyOiB7X2VzYyh0YXJnZXQyKX0gKCsyNSUpPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5uRIFN0b3A6IHtfZXNjKHN0b3ApfSAoLTEwJSk8L2NvZGU+IiwKICAgIF0KCiAgICBpZiBub3QgY29tcGFjdDoKICAgICAgICBsaW5lcyArPSBbCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OLIFJJU0s6IHtfZXNjKHJpc2tfcGxhbil9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+UhCBST1RBVElPTjoge19lc2Mocm90YXRpb25fcGxhbil9PC9jb2RlPiIsCiAgICAgICAgXQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIGZvcm1hdF9ydW5uZXJfd2F0Y2godG9rZW5fZGF0YSwgY29tcGFjdDogYm9vbCA9IFRydWUpOgogICAgc3ltYm9sID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIpLnVwcGVyKCkKICAgIG5hbWUgPSBzdHIodG9rZW5fZGF0YS5nZXQoIm5hbWUiKSBvciBzeW1ib2wpCiAgICBhZ2VfaG91cnMgPSB0b2tlbl9kYXRhLmdldCgiYWdlX2hvdXJzIikKICAgIG1hcmtldF9jYXAgPSB0b2tlbl9kYXRhLmdldCgibWFya2V0X2NhcCIpCiAgICBmZHYgPSB0b2tlbl9kYXRhLmdldCgiZmR2IikKICAgIGxpcXVpZGl0eSA9IHRva2VuX2RhdGEuZ2V0KCJsaXF1aWRpdHkiKQogICAgdm9sdW1lXzI0aCA9IHRva2VuX2RhdGEuZ2V0KCJ2b2x1bWVfMjRoIikKICAgIGNoYW5nZV8yNGggPSB0b2tlbl9kYXRhLmdldCgiY2hhbmdlXzI0aCIpCiAgICB0eG5zX2gxID0gdG9rZW5fZGF0YS5nZXQoInR4bnNfaDEiKQogICAgd2F0Y2hfc2NvcmUgPSB0b2tlbl9kYXRhLmdldCgid2F0Y2hfc2NvcmUiKQogICAgeF9wcm94eSA9IHRva2VuX2RhdGEuZ2V0KCJ4X3Byb3h5X2xhYmVsIiwgIk4vQSIpCiAgICBuYXJyYXRpdmUgPSB0b2tlbl9kYXRhLmdldCgibmFycmF0aXZlX2xhYmVsIiwgIk4vQSIpCiAgICBub3RlID0gdG9rZW5fZGF0YS5nZXQoIm5vdGUiLCAiIikKICAgIHdhbGxldF9maXQgPSBzdHIodG9rZW5fZGF0YS5nZXQoIndhbGxldF9maXQiKSBvciAiVzMiKQogICAgcmlza19wbGFuID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJyaXNrX3BsYW4iKSBvciAiU21hbGwgc2l6ZSBvbmx5IHwgaGFyZCBzdG9wIHwgcXVpY2sgc2NhbGUtb3V0cyIpCiAgICByb3RhdGlvbl9wbGFuID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJyb3RhdGlvbl9wbGFuIikgb3IgIlJvdGF0ZSB3aW5zIGludG8gVzEvVzIgb3IgVVNEQyIpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIGNhcF9rZXkgPSAiTUtUX0NBUCIgaWYgaXNpbnN0YW5jZShtYXJrZXRfY2FwLCAoaW50LCBmbG9hdCkpIGFuZCBtYXJrZXRfY2FwID4gMCBlbHNlICJGRFYiCiAgICBhZ2VfdGV4dCA9IGYie2Zsb2F0KGFnZV9ob3Vycyk6LjFmfWgiIGlmIGlzaW5zdGFuY2UoYWdlX2hvdXJzLCAoaW50LCBmbG9hdCkpIGVsc2UgIk4vQSIKICAgIHNjb3JlX3RleHQgPSBmIntmbG9hdCh3YXRjaF9zY29yZSk6LjFmfS8xMDAiIGlmIGlzaW5zdGFuY2Uod2F0Y2hfc2NvcmUsIChpbnQsIGZsb2F0KSkgZWxzZSAiTi9BIgogICAgcm93cyA9IFsKICAgICAgICBfa3YoIlBSSU9SSVRZIiwgIlAyIiksCiAgICAgICAgX2t2KCJTQ09SRSIsIHNjb3JlX3RleHQpLAogICAgICAgIF9rdigiQUdFIiwgYWdlX3RleHQpLAogICAgICAgIF9rdigiUFJJQ0UiLCBmIntfZm10X3VzZF9jb21wYWN0KHRva2VuX2RhdGEuZ2V0KCdwcmljZScpKX0gfCAyNEgge19mbXRfcGN0KGNoYW5nZV8yNGgpfSIpLAogICAgICAgIF9rdihjYXBfa2V5LCBfZm10X3VzZF9jb21wYWN0KGNhcF92YWx1ZSkpLAogICAgICAgIF9rdigiTElRVUlESVRZIiwgX2ZtdF91c2RfY29tcGFjdChsaXF1aWRpdHkpKSwKICAgICAgICBfa3YoIkFDVElPTiIsICJNT05JVE9SIiksCiAgICAgICAgX2t2KCJSRUFTT04iLCAiRnJlc2ggbGlzdGluZyB3aXRoIGFjdGl2ZSBmbG93IiksCiAgICBdCiAgICBpZiBub3QgY29tcGFjdDoKICAgICAgICByb3dzLmV4dGVuZCgKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgX2t2KCJXQUxMRVQiLCB3YWxsZXRfZml0KSwKICAgICAgICAgICAgICAgIF9rdigiWF9QUk9YWSIsIHhfcHJveHkpLAogICAgICAgICAgICAgICAgX2t2KCJOQVJSQVRJVkUiLCBuYXJyYXRpdmUpLAogICAgICAgICAgICAgICAgX2t2KCJJTlZBTElEIiwgIkZsb3cgY29sbGFwc2UgLyBsaXF1aWRpdHkgZmFkZSIpLAogICAgICAgICAgICAgICAgX2t2KCJSSVNLIiwgcmlza19wbGFuKSwKICAgICAgICAgICAgICAgIF9rdigiUk9UQVRJT04iLCByb3RhdGlvbl9wbGFuKSwKICAgICAgICAgICAgICAgIF9rdigiTk9URSIsIG5vdGUgb3IgIldhdGNobGlzdC1vbmx5IGFsZXJ0LiBOb3QgYSBidXkgc2lnbmFsLiIpLAogICAgICAgICAgICBdCiAgICAgICAgKQogICAgaGVhZGVyID0gX2hlYWRlcl9ibG9jaygKICAgICAgICAiW1NJR05BTF06UlVOTkVSIiwKICAgICAgICBoZWFkZXJfcm93cz1bCiAgICAgICAgICAgIF9rdigiU1lNQk9MIiwgZiIke3N5bWJvbH0iKSwKICAgICAgICAgICAgX2t2KCJUT0tFTiIsIG5hbWUpLAogICAgICAgIF0sCiAgICApCiAgICByZXR1cm4gaGVhZGVyICsgIlxuIiArIF9yZW5kZXJfcHJlKHJvd3MpCgoKZGVmIF93YXRjaGxpc3Rfc3RhdHVzX2xhYmVsKHN0YXR1cyk6CiAgICByYXcgPSBzdHIoc3RhdHVzIG9yICIiKS5zdHJpcCgpCiAgICBpZiBub3QgcmF3OgogICAgICAgIHJldHVybiAiVW5rbm93biIKICAgIHVwcGVyID0gcmF3LnVwcGVyKCkKICAgIGlmIHVwcGVyID09ICJOT0RBVEEiOgogICAgICAgIHJldHVybiAiTm9EYXRhIgogICAgcmV0dXJuIHJhdy50aXRsZSgpCgoKZGVmIF93YXRjaGxpc3Rfc3RhdHVzX2NvZGUoc3RhdHVzKToKICAgIHN0YXR1c19ub3JtID0gX3dhdGNobGlzdF9zdGF0dXNfbGFiZWwoc3RhdHVzKQogICAgbWFwcGluZyA9IHsKICAgICAgICAiTW9tZW50dW0iOiAiTU9NIiwKICAgICAgICAiUmVjbGFpbSI6ICJSRUMiLAogICAgICAgICJCcmVha2Rvd24iOiAiQlJLIiwKICAgICAgICAiUmFuZ2UiOiAiUk5HIiwKICAgICAgICAiVm9sYXRpbGUiOiAiVk9MIiwKICAgICAgICAiSWxsaXF1aWQiOiAiSUxMIiwKICAgICAgICAiTm9EYXRhIjogIk5PRCIsCiAgICAgICAgIlVua25vd24iOiAiVU5LIiwKICAgIH0KICAgIHJldHVybiBtYXBwaW5nLmdldChzdGF0dXNfbm9ybSwgIlVOSyIpLCBzdGF0dXNfbm9ybQoKCmRlZiBmb3JtYXRfd2F0Y2hsaXN0X3NpZ25hbCh0b2tlbl9kYXRhLCBjb21wYWN0OiBib29sID0gVHJ1ZSk6CiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgc3ltYm9sID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIpLnVwcGVyKCkKICAgIHN0YXR1c19jb2RlLCBzdGF0dXNfbGFiZWwgPSBfd2F0Y2hsaXN0X3N0YXR1c19jb2RlKHRva2VuX2RhdGEuZ2V0KCJzdGF0dXMiKSkKICAgIHJlYXNvbiA9IHN0cih0b2tlbl9kYXRhLmdldCgicmVhc29uIikgb3IgIlN0YXR1cyBjb25kaXRpb24gdHJpZ2dlcmVkLiIpCiAgICBtYXJrZXRfY2FwID0gdG9rZW5fZGF0YS5nZXQoIm1hcmtldF9jYXAiKQogICAgZmR2ID0gdG9rZW5fZGF0YS5nZXQoImZkdiIpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIHVwc2lkZSA9IHN0cih0b2tlbl9kYXRhLmdldCgidXBzaWRlX3BvdGVudGlhbCIpIG9yICJNZWRpdW0iKS50aXRsZSgpCiAgICBmYWlsdXJlID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJmYWlsdXJlX3Jpc2siKSBvciAiTWVkaXVtIikudGl0bGUoKQogICAgd2FsbGV0X2ZpdCA9IHN0cih0b2tlbl9kYXRhLmdldCgid2FsbGV0X2ZpdCIpIG9yICJXMyIpCiAgICByaXNrX3BsYW4gPSBzdHIodG9rZW5fZGF0YS5nZXQoInJpc2tfcGxhbiIpIG9yICJTbWFsbCBzaXplIG9ubHkgfCBoYXJkIHN0b3AgfCBxdWljayBzY2FsZS1vdXRzIikKICAgIHJvdGF0aW9uX3BsYW4gPSBzdHIodG9rZW5fZGF0YS5nZXQoInJvdGF0aW9uX3BsYW4iKSBvciAiUm90YXRlIHdpbnMgaW50byBXMS9XMiBvciBVU0RDIikKICAgIGNoYW5nZV8yNGggPSB0b2tlbl9kYXRhLmdldCgiY2hhbmdlXzI0aCIpCiAgICBjaGFuZ2VfbGluZSA9IF9mbXRfcGN0KGNoYW5nZV8yNGgpCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgibGlxdWlkaXR5Iikgb3IgMCkKICAgIHByaWNlID0gZmxvYXQodG9rZW5fZGF0YS5nZXQoInByaWNlIikgb3IgMCkKICAgIGVudHJ5X2Rpc3BsYXkgPSBfZm10X3ByaWNlX3ByZWNpc2UocHJpY2UpIGlmIHByaWNlID4gMCBlbHNlICJOL0EiCgogICAgaWYgc3RhdHVzX2xhYmVsID09ICJCcmVha2Rvd24iOgogICAgICAgIGFjdGlvbiA9ICJBVk9JRCAvIEVYSVQiCiAgICAgICAgYWN0aW9uX2Vtb2ppID0gIvCflLQiCiAgICBlbGlmIHN0YXR1c19sYWJlbCBpbiB7Ik1vbWVudHVtIiwgIlJlY2xhaW0ifToKICAgICAgICBhY3Rpb24gPSAiV0FUQ0ggRk9SIEVOVFJZIgogICAgICAgIGFjdGlvbl9lbW9qaSA9ICLwn5+hIgogICAgZWxzZToKICAgICAgICBhY3Rpb24gPSAiTU9OSVRPUiIKICAgICAgICBhY3Rpb25fZW1vamkgPSAi4pqqIgoKICAgIGxpbmVzID0gWwogICAgICAgIGYiPGI+8J+RgSBbU0lHTkFMXTogV0FUQ0hMSVNUPC9iPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+OryBDT0lOOiAke19lc2Moc3ltYm9sKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk4ogU1RBVFVTOiB7X2VzYyhzdGF0dXNfbGFiZWwpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SsCBNQVJLRVRDQVA6IHtfZXNjKF9mbXRfdXNkX2NvbXBhY3QoY2FwX3ZhbHVlKSl9IHwgMjRIIHtfZXNjKGNoYW5nZV9saW5lKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkqcgTElRVUlESVRZOiB7X2VzYyhfZm10X3VzZF9jb21wYWN0KGxpcXVpZGl0eSkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPnthY3Rpb25fZW1vaml9IFNJR05BTDoge19lc2MoYWN0aW9uKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk40gRU5UUlk6IHtfZXNjKGVudHJ5X2Rpc3BsYXkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TnSBSRUFTT046IHtfZXNjKHJlYXNvbil9PC9jb2RlPiIsCiAgICBdCgogICAgaWYgbm90IGNvbXBhY3Q6CiAgICAgICAgbGluZXMgKz0gWwogICAgICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+TiCBVUFNJREU6IHtfZXNjKHVwc2lkZSl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+4pqg77iPIFJJU0s6IHtfZXNjKGZhaWx1cmUpfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfkZsgV0FMTEVUIEZJVDoge19lc2Mod2FsbGV0X2ZpdCl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+aqyBJTlZBTElEOiBCcmVha2Rvd24gLyBsaXF1aWRpdHkgY3JhY2s8L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfk4sgUklTSyBQTEFOOiB7X2VzYyhyaXNrX3BsYW4pfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCflIQgUk9UQVRJT046IHtfZXNjKHJvdGF0aW9uX3BsYW4pfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPuKEue+4jyBOT1RFOiBXYXRjaGxpc3Qtb25seSBhbGVydCAobm90IGFuIGF1dG8tYnV5IHNpZ25hbCkuPC9jb2RlPiIsCiAgICAgICAgXQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIGZvcm1hdF9sZWdhY3lfcmVjb3ZlcnkodG9rZW5fZGF0YSk6CiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgc3ltYm9sID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpKS51cHBlcigpCiAgICBwcmljZSA9IGZsb2F0KHRva2VuX2RhdGEuZ2V0KCJwcmljZSIsIDApIG9yIDApCiAgICBjaGFuZ2VfMjRoID0gdG9rZW5fZGF0YS5nZXQoImNoYW5nZV8yNGgiKQogICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW5fZGF0YS5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICBtYXJrZXRfY2FwID0gdG9rZW5fZGF0YS5nZXQoIm1hcmtldF9jYXAiKQogICAgZmR2ID0gdG9rZW5fZGF0YS5nZXQoImZkdiIpCiAgICBwYXR0ZXJuX2xhYmVsID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJwYXR0ZXJuX2xhYmVsIikgb3IgIlJldmVyc2FsIikKICAgIHBhdHRlcm5fc3RhdHVzID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJwYXR0ZXJuX3N0YXR1cyIpIG9yICJGb3JtaW5nIikKICAgIHNvbF9zdGF0dXMgPSBzdHIodG9rZW5fZGF0YS5nZXQoInNvbF9zdGF0dXMiKSBvciAiTkVVVFJBTCIpCiAgICBhZ2VfZGF5cyA9IHRva2VuX2RhdGEuZ2V0KCJhZ2VfZGF5cyIpCgogICAgIyBNYXJrZXRjYXAgZGlzcGxheSAocHJlZmVyIG1hcmtldF9jYXAsIGZhbGwgYmFjayB0byBmZHYpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIGNhcF9kaXNwbGF5ID0gX2ZtdF91c2RfY29tcGFjdChjYXBfdmFsdWUpIGlmIGNhcF92YWx1ZSBlbHNlICJOL0EiCgogICAgIyBGb3JtYXQgZW50cnkgcHJpY2UgZm9yIHRhcmdldHMvc3RvcHMKICAgIGlmIHByaWNlID49IDEuMDoKICAgICAgICBkaXNwbGF5X3ByaWNlID0gZiIke3ByaWNlOi40Zn0iCiAgICBlbGlmIHByaWNlID49IDAuMDE6CiAgICAgICAgZGlzcGxheV9wcmljZSA9IGYiJHtwcmljZTouNmZ9IgogICAgZWxpZiBwcmljZSA+IDA6CiAgICAgICAgZGlzcGxheV9wcmljZSA9IGYiJHtwcmljZTouOGZ9IgogICAgZWxzZToKICAgICAgICBkaXNwbGF5X3ByaWNlID0gIk4vQSIKCiAgICBjaGFuZ2VfbGluZSA9IF9mbXRfcGN0KGNoYW5nZV8yNGgpCiAgICBpZiBwcmljZSA+PSAwLjAxOgogICAgICAgIHRhcmdldDEgPSBmIiR7cHJpY2UgKiAxLjU6LjZmfSIgaWYgcHJpY2UgPiAwIGVsc2UgIk4vQSIKICAgICAgICB0YXJnZXQyID0gZiIke3ByaWNlICogMi4wOi42Zn0iIGlmIHByaWNlID4gMCBlbHNlICJOL0EiCiAgICAgICAgc3RvcCA9IGYiJHtwcmljZSAqIDAuNTouNmZ9IiBpZiBwcmljZSA+IDAgZWxzZSAiTi9BIgogICAgZWxzZToKICAgICAgICB0YXJnZXQxID0gZiIke3ByaWNlICogMS41Oi44Zn0iLnJzdHJpcCgiMCIpLnJzdHJpcCgiLiIpIGlmIHByaWNlID4gMCBlbHNlICJOL0EiCiAgICAgICAgdGFyZ2V0MiA9IGYiJHtwcmljZSAqIDIuMDouOGZ9Ii5yc3RyaXAoIjAiKS5yc3RyaXAoIi4iKSBpZiBwcmljZSA+IDAgZWxzZSAiTi9BIgogICAgICAgIHN0b3AgPSBmIiR7cHJpY2UgKiAwLjU6LjhmfSIucnN0cmlwKCIwIikucnN0cmlwKCIuIikgaWYgcHJpY2UgPiAwIGVsc2UgIk4vQSIKCiAgICBhZ2VfdGV4dCA9IGYie2ludChhZ2VfZGF5cyl9ZCIgaWYgaXNpbnN0YW5jZShhZ2VfZGF5cywgKGludCwgZmxvYXQpKSBhbmQgYWdlX2RheXMgPiAwIGVsc2UgIj45MGQiCiAgICBzb2xfZW1vamkgPSAi8J+foiIgaWYgc29sX3N0YXR1cyA9PSAiUklTS19PTiIgZWxzZSAoIvCflLQiIGlmICJPRkYiIGluIHNvbF9zdGF0dXMgZWxzZSAi8J+foSIpCgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5OLIFtTSUdOQUxdOiBMRUdBQ1kgUkVDT1ZFUlk8L2I+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIENPSU46ICR7X2VzYyhzeW1ib2wpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SsCBNQVJLRVRDQVA6IHtfZXNjKGNhcF9kaXNwbGF5KX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk4ggMjRIIENIRzoge19lc2MoY2hhbmdlX2xpbmUpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SpyBMSVFVSURJVFk6IHtfZXNjKF9mbXRfdXNkX2NvbXBhY3QobGlxdWlkaXR5KSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5SlIFBBVFRFUk46IHtfZXNjKHBhdHRlcm5fbGFiZWwpfSAoe19lc2MocGF0dGVybl9zdGF0dXMpfSk8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflZAgQUdFOiB7X2VzYyhhZ2VfdGV4dCl9IChlc3RhYmxpc2hlZCBjb2luKTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKchSBCVVkgU0lHTkFMIChMRUdBQ1kgUkVDT1ZFUlkpPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KhIEVzdGFibGlzaGVkIGNvaW4gd2l0aCBmcmVzaCByZXZlcnNhbCBwYXR0ZXJuICsgdm9sdW1lIHNwaWtlPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OKIENvbW11bml0eSBzdGlsbCBhY3RpdmUsID45MCBkYXlzIHByb3ZlbiBuYXJyYXRpdmU8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzb2xfZW1vaml9IFNPTCBTdGF0dXM6IHtfZXNjKHNvbF9zdGF0dXMpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk40gRW50cnk6IHtfZXNjKGRpc3BsYXlfcHJpY2UpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+OryBUYXJnZXQgMToge19lc2ModGFyZ2V0MSl9ICgrNTAlKTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+OryBUYXJnZXQgMjoge19lc2ModGFyZ2V0Mil9ICgrMTAwJSk8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfm5EgU3RvcDoge19lc2Moc3RvcCl9ICgtNTAlKTwvY29kZT4iLAogICAgXQogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCgpkZWYgZm9ybWF0X3dhdGNobGlzdF9zdW1tYXJ5KHJvd3MpOgogICAgaWYgbm90IHJvd3M6CiAgICAgICAgcmV0dXJuIF9oZWFkZXJfYmxvY2soIltTSUdOQUxdOldBVENITElTVC1TVU1NQVJZIikgKyAiXG4iICsgX3JlbmRlcl9wcmUoWyJObyB3YXRjaGxpc3QgdG9rZW5zIGNvbmZpZ3VyZWQuIl0pCgogICAgb3JkZXIgPSB7Ik1vbWVudHVtIjogMCwgIlJlY2xhaW0iOiAxLCAiQnJlYWtkb3duIjogMiwgIlJhbmdlIjogMywgIlZvbGF0aWxlIjogNCwgIklsbGlxdWlkIjogNSwgIk5vRGF0YSI6IDZ9CiAgICBzb3J0ZWRfcm93cyA9IHNvcnRlZCgKICAgICAgICByb3dzLAogICAgICAgIGtleT1sYW1iZGEgcjogKAogICAgICAgICAgICBvcmRlci5nZXQoc3RyKHIuZ2V0KCJzdGF0dXMiKSBvciAiIiksIDkpLAogICAgICAgICAgICAtKGZsb2F0KHIuZ2V0KCJ2b2x1bWVfMjRoIikgb3IgMCkpLAogICAgICAgICksCiAgICApCgogICAgdG90YWwgPSBsZW4oc29ydGVkX3Jvd3MpCiAgICBsaXZlID0gc3VtKDEgZm9yIHIgaW4gc29ydGVkX3Jvd3MgaWYgYm9vbChyLmdldCgiaGFzX2xpdmVfZGF0YSIsIFRydWUpKSkKICAgIG5vX2RhdGEgPSB0b3RhbCAtIGxpdmUKICAgIGxpbmVzID0gW2YiQ09WRVJBR0UgICB7bGl2ZX0ve3RvdGFsfSBsaXZlICh7bm9fZGF0YX0gbm8tZGF0YSkiXQogICAgZm9yIGlkeCwgcm93IGluIGVudW1lcmF0ZShzb3J0ZWRfcm93cywgc3RhcnQ9MSk6CiAgICAgICAgc3RhdHVzX2NvZGUsIHN0YXR1c19sYWJlbCA9IF93YXRjaGxpc3Rfc3RhdHVzX2NvZGUocm93LmdldCgic3RhdHVzIikpCiAgICAgICAgc3ltYm9sID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgIGNoMjQgPSBfZm10X3BjdChyb3cuZ2V0KCJjaGFuZ2VfMjRoIikpCiAgICAgICAgbGlxID0gX2ZtdF91c2RfY29tcGFjdChyb3cuZ2V0KCJsaXF1aWRpdHkiKSkKICAgICAgICB2b2wgPSBfZm10X3VzZF9jb21wYWN0KHJvdy5nZXQoInZvbHVtZV8yNGgiKSkKICAgICAgICBsaW5lcy5hcHBlbmQoZiJ7aWR4OjAyZH0ge3N5bWJvbDo8MTB9IHtzdGF0dXNfY29kZTo8M30gKHtzdGF0dXNfbGFiZWw6PDl9KSAyNEgge2NoMjQ6Pjh9IExJUSB7bGlxOj44fSBWT0wge3ZvbDo+OH0iKQoKICAgIHJldHVybiBfaGVhZGVyX2Jsb2NrKCJbU0lHTkFMXTpXQVRDSExJU1QtU1VNTUFSWSIpICsgIlxuIiArIF9yZW5kZXJfcHJlKGxpbmVzKQo=',
    '/root/memecoin_engine/main.py': 'aW1wb3J0IGxvZ2dpbmcKaW1wb3J0IGpzb24KaW1wb3J0IGh0bWwKaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUgYXMgdGltZV9tb2R1bGUKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lLCB0aW1lZGVsdGEsIHRpbWV6b25lCmZyb20gbG9nZ2luZy5oYW5kbGVycyBpbXBvcnQgUm90YXRpbmdGaWxlSGFuZGxlcgoKZnJvbSB0ZWxlZ3JhbSBpbXBvcnQgQ29weVRleHRCdXR0b24sIElubGluZUtleWJvYXJkQnV0dG9uLCBJbmxpbmVLZXlib2FyZE1hcmt1cCwgVXBkYXRlCmZyb20gdGVsZWdyYW0uZXh0IGltcG9ydCAoCiAgICBBcHBsaWNhdGlvbkJ1aWxkZXIsCiAgICBDYWxsYmFja1F1ZXJ5SGFuZGxlciwKICAgIENvbW1hbmRIYW5kbGVyLAogICAgQ29udGV4dFR5cGVzLAopCgpmcm9tIGNvbmZpZyBpbXBvcnQgKAogICAgRU5HSU5FX1BST0ZJTEUsCiAgICBBTEVSVF9USFJFU0hPTEQsCiAgICBBTEVSVF9UT1BfTiwKICAgIEFMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgQUxFUlRfREFUQV9EUklGVF9XQVJOX1BDVCwKICAgIEFMRVJUX0RBVEFfUkVGUkVTSF9FTkFCTEVELAogICAgQUxFUlRfSElERV9VTlZFUklGSUVEX0hPTERFUlMsCiAgICBBTEVSVF9SRVFVSVJFX1JFRlJFU0hfU1VDQ0VTUywKICAgIEJFQVJJU0hfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICBCRUFSSVNIX0FMRVJUX1RIUkVTSE9MRCwKICAgIEJFQVJJU0hfTUFYX0FMRVJUU19QRVJfQ1lDTEUsCiAgICBCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0RBWSwKICAgIEJFQVJJU0hfTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICBCRUFSSVNIX1JFR0lNRV9NSU5fU0NPUkUsCiAgICBDT05GSURFTkNFX01JTl9BLAogICAgQ09ORklERU5DRV9NSU5fQiwKICAgIERBSUxZX1NVTU1BUllfRU5BQkxFRCwKICAgIERBSUxZX1NVTU1BUllfSE9VUl9VVEMsCiAgICBEUllfUlVOLAogICAgRU5BQkxFX1JFR0lNRV9HQVRFLAogICAgRU5BQkxFX0VYRUNVVElPTl9RVUFMSVRZX0ZJTFRFUlMsCiAgICBFTkFCTEVfRVhUUkVNRV9SSVNLX0hBUkRfQkxPQ0ssCiAgICBFTkFCTEVfUklTS19HT1ZFUk5PUiwKICAgIEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSLAogICAgR0xPQkFMX1RSQURJTkdfUEFVU0UsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9CT09UX1NFQ09ORFMsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9FTkFCTEVELAogICAgR09PRF9CVVlfQlVMTEVUSU5fSU5URVJWQUxfU0VDT05EUywKICAgIEdPT0RfQlVZX0JVTExFVElOX1BFUl9USUVSX01BWF9UT0tFTlMsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9USUVSLAogICAgTE9HX0JBQ0tVUF9DT1VOVCwKICAgIExPR19KU09OX0VOQUJMRUQsCiAgICBMT0dfSlNPTl9QQVRILAogICAgTE9HX01BWF9CWVRFUywKICAgIExPU1NfU1RSRUFLX1BBVVNFX0hPVVJTLAogICAgTE9TU19TVFJFQUtfTE9PS0JBQ0tfSE9VUlMsCiAgICBNQVhfQUJTX0NIQU5HRV8yNEgsCiAgICBNQVhfQUxFUlRTX1BFUl9EQVksCiAgICBNQVhfQUxFUlRTX1BFUl9TWU1CT0xfUEVSX0RBWSwKICAgIE1BWF9BTExPV0VEX0RSQVdET1dOXzI0SCwKICAgIE1BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgTUFYX0NPTlNFQ1VUSVZFXzRIX0xPU1NFUywKICAgIE1BWF9WT0xfVE9fTElRX1JBVElPLAogICAgTUlOX0xJUVVJRElUWV9QRVJfSE9MREVSLAogICAgTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICBNSU5fSE9MREVSUywKICAgIE1JTl9MSVFVSURJVFksCiAgICBNSU5fUFJJQ0VfVVNELAogICAgTUlOX1ZPTF9UT19MSVFfUkFUSU8sCiAgICBNSU5fVk9MVU1FXzI0SCwKICAgIE5FV19SVU5ORVJfQ09PTERPV05fSE9VUlMsCiAgICBORVdfUlVOTkVSX01BWF9BR0VfSE9VUlMsCiAgICBORVdfUlVOTkVSX01BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgTkVXX1JVTk5FUl9NQVhfUkVTVUxUUywKICAgIE5FV19SVU5ORVJfTUlOX0FMRVJUX1NDT1JFLAogICAgTkVXX1JVTk5FUl9NSU5fQ0hBTkdFXzI0SCwKICAgIE5FV19SVU5ORVJfTUlOX0xJUVVJRElUWSwKICAgIE5FV19SVU5ORVJfTUlOX01BUktFVF9DQVAsCiAgICBORVdfUlVOTkVSX01JTl9UWE5TX0gxLAogICAgTkVXX1JVTk5FUl9NSU5fVk9MVU1FXzI0SCwKICAgIE5FV19SVU5ORVJfTkFSUkFUSVZFX0tFWVdPUkRTLAogICAgTkVXX1JVTk5FUl9QQUlSU19QRVJfUVVFUlksCiAgICBORVdfUlVOTkVSX1JFUVVJUkVfU09DSUFMX0xJTktTLAogICAgTkVXX1JVTk5FUl9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICBORVdfUlVOTkVSX1NFQVJDSF9RVUVSSUVTLAogICAgTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVELAogICAgT1VUQ09NRV9FVkFMX0JBVENIX1NJWkUsCiAgICBPVVRDT01FX0VWQUxfSU5URVJWQUxfU0VDT05EUywKICAgIE9VVENPTUVfVFJBQ0tJTkdfRU5BQkxFRCwKICAgIFBST0NFU1NfTE9DS19GSUxFLAogICAgUkVHSU1FX01JTl9TQ09SRSwKICAgIFJJU0tfU1RZTEUsCiAgICBTQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICBTRUxMX0FMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgU0VMTF9BTEVSVF9NQVhfUEVSX0NZQ0xFLAogICAgU0VMTF9BTEVSVFNfRU5BQkxFRCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfQUJTX0NIQU5HRV8xSCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfQUJTX0NIQU5HRV82SCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfVFhOU19IMSwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfVk9MX1RPX0xJUSwKICAgIFNFTExfQ09OU09MSURBVElPTl9NSU5fQ0hBTkdFXzI0SCwKICAgIFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfMUgsCiAgICBTRUxMX0hZUEVfRkFERV9NQVhfQ0hBTkdFXzI0SCwKICAgIFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfNkgsCiAgICBTRUxMX0hZUEVfRkFERV9NQVhfVk9MX1RPX0xJUSwKICAgIFNJR05BTF9ESUdFU1RfRU5BQkxFRCwKICAgIFNJR05BTF9ESUdFU1RfSU5URVJWQUxfU0VDT05EUywKICAgIFNJR05BTF9ESUdFU1RfTE9PS0JBQ0tfSE9VUlMsCiAgICBTSUdOQUxfRElHRVNUX01BWF9JVEVNUywKICAgIFNPTF9CUkVBRFRIX01JTl9GT1JfUklTS19PTiwKICAgIFNPTF9FWFRSRU1FX09GRl9DSEFOR0VfMUgsCiAgICBTT0xfRVhUUkVNRV9PRkZfQ0hBTkdFXzI0SCwKICAgIFNPTF9SRUdJTUVfUVVFUlksCiAgICBTT0xfUklTS19PRkZfQ0hBTkdFXzI0SCwKICAgIFNPTF9SSVNLX09OX0NIQU5HRV8yNEgsCiAgICBURUxFR1JBTV9DSEFUX0lELAogICAgVEVMRUdSQU1fQUNUSU9OX0JVVFRPTlNfRU5BQkxFRCwKICAgIFRFTEVHUkFNX1RPS0VOLAogICAgVEVMRUdSQU1fUVVJRVRfTU9ERSwKICAgIFRFTEVHUkFNX1BVU0hfTUlOX0NPTkZJREVOQ0UsCiAgICBURUxFR1JBTV9QVVNIX01JTl9TQ09SRV9ERUxUQSwKICAgIFRFTEVHUkFNX1BVU0hfU1RST05HX09OTFksCiAgICBXQVRDSExJU1RfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICBXQVRDSExJU1RfQUxFUlRfT05fU1RBVFVTX0NIQU5HRSwKICAgIFdBVENITElTVF9BTEVSVF9TVEFUVVNFUywKICAgIFdBVENITElTVF9FTlRSSUVTLAogICAgV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRCwKICAgIFdBVENITElTVF9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgIFdBVENITElTVF9NSU5fTElRVUlESVRZLAogICAgV0FUQ0hMSVNUX01JTl9WT0xVTUVfMjRILAogICAgV0FUQ0hMSVNUX1NDQU5fSU5URVJWQUxfU0VDT05EUywKICAgIFdBVENITElTVF9TVU1NQVJZX0VOQUJMRUQsCiAgICBXQVRDSExJU1RfU1VNTUFSWV9IT1VSX1VUQywKICAgIFdFRUtMWV9UVU5JTkdfREFZX1VUQywKICAgIFdFRUtMWV9UVU5JTkdfRU5BQkxFRCwKICAgIFdFRUtMWV9UVU5JTkdfSE9VUl9VVEMsCiAgICBXRUVLTFlfVFVOSU5HX0xPT0tCQUNLX0RBWVMsCiAgICBXRUVLTFlfVFVOSU5HX01JTl9PVVRDT01FU180SCwKICAgIFNZTUJPTF9CTEFDS0xJU1RfQVZHXzI0SF9QQ1QsCiAgICBTWU1CT0xfQkxBQ0tMSVNUX0hPVVJTLAogICAgU1lNQk9MX0JMQUNLTElTVF9NSU5fU0FNUExFUywKICAgIFNZTUJPTF9DT05UUk9MX0VOQUJMRUQsCiAgICBTWU1CT0xfQ09PTERPV05fSE9VUlMsCiAgICBTWU1CT0xfTE9TU19TVFJFQUtfVFJJR0dFUiwKICAgIFRBQ1RJQ0FMX01BWF9MQVNUX1RSQURFX0FHRV9NSU5VVEVTLAogICAgVEFDVElDQUxfRU5BQkxFX1JFQUxfVEVDSE5JQ0FMUywKICAgIFRBQ1RJQ0FMX01BQ0RfSElTVF9NSU4sCiAgICBUQUNUSUNBTF9PSExDVl9MT09LQkFDS19IT1VSUywKICAgIFRBQ1RJQ0FMX09ITENWX1RZUEUsCiAgICBUQUNUSUNBTF9SRVFVSVJFX1RFQ0hOSUNBTF9DT05GSVJNQVRJT04sCiAgICBUQUNUSUNBTF9SU0lfTUFYLAogICAgVEFDVElDQUxfUlNJX01JTiwKICAgIFRBQ1RJQ0FMX1JTSV9QRVJJT0QsCiAgICBUQUNUSUNBTF9URUNIX0NBQ0hFX1NFQ09ORFMsCiAgICBUQUNUSUNBTF9NSU5fTU9NRU5UVU1fQ0hBTkdFXzFILAogICAgVEFDVElDQUxfTUlOX1ZPTF9UT19MSVFfUkFUSU8sCiAgICBUQUNUSUNBTF9QVUxMQkFDS19NQVhfUENULAogICAgVEFDVElDQUxfUFVMTEJBQ0tfTUlOX1BDVCwKICAgIFRBQ1RJQ0FMX1RSRU5EX01JTl9DSEFOR0VfMjRILAogICAgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQsCiAgICBMRUdBQ1lfUkVDT1ZFUllfU0NBTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgTEVHQUNZX1JFQ09WRVJZX1NFQVJDSF9RVUVSSUVTLAogICAgTEVHQUNZX1JFQ09WRVJZX1BBSVJTX1BFUl9RVUVSWSwKICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVMsCiAgICBMRUdBQ1lfUkVDT1ZFUllfTUlOX0xJUVVJRElUWSwKICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SCwKICAgIExFR0FDWV9SRUNPVkVSWV9WT0xVTUVfU1BJS0VfTVVMVElQTElFUiwKICAgIExFR0FDWV9SRUNPVkVSWV9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgIExFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9IT1VSUywKKQpmcm9tIGRhdGEuYmlyZGV5ZSBpbXBvcnQgKAogICAgZmV0Y2hfYmlyZGV5ZV9vaGxjdiwKICAgIGZldGNoX2JpcmRleWVfcHJpY2UsCiAgICBmZXRjaF9iaXJkZXllX3Rva2VuX292ZXJ2aWV3LAopCmZyb20gZGF0YS5kZXhzY3JlZW5lciBpbXBvcnQgKAogICAgZmV0Y2hfbGVnYWN5X3JlY292ZXJ5X2NhbmRpZGF0ZXMsCiAgICBmZXRjaF9ydW5uZXJfd2F0Y2hfY2FuZGlkYXRlcywKICAgIGZldGNoX3NvbF9tYXJrZXRfcHJveHksCiAgICBmZXRjaF90b2tlbl9zbmFwc2hvdCBhcyBmZXRjaF9kZXhzY3JlZW5lcl90b2tlbl9zbmFwc2hvdCwKKQpmcm9tIGRhdGEubWFya2V0X2RhdGEgaW1wb3J0IGZldGNoX21hcmtldF9kYXRhCmZyb20gc2NvcmluZyBpbXBvcnQgY2FsY3VsYXRlX3Rva2VuX3Njb3JlCmZyb20gdXRpbHMubWV0cmljcyBpbXBvcnQgY2xvc2VzLCBtYWNkLCByc2kKZnJvbSB1dGlscy5kYiBpbXBvcnQgKAogICAgY2xvc2VfbWFudWFsX3Bvc2l0aW9uLAogICAgY2xlYXJfcmlza19wYXVzZSwKICAgIGNvdW50X2FsZXJ0c19zaW5jZSwKICAgIGdldF9hY3RpdmVfc3ltYm9sX2NvbnRyb2wsCiAgICBnZXRfYWxlcnRfb3V0Y29tZV9yZWNhcCwKICAgIGdldF9jb25zZWN1dGl2ZV9sb3Npbmdfb3V0Y29tZXNfNGgsCiAgICBnZXRfZW5naW5lX2hlYWx0aF9zbmFwc2hvdCwKICAgIGdldF9sYXN0X2FsZXJ0X3RpbWVzdGFtcCwKICAgIGdldF9sYXRlc3RfNGhfb3V0Y29tZV90aW1lc3RhbXAsCiAgICBnZXRfbGF0ZXN0X2VuZ2luZV9ldmVudCwKICAgIGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sLAogICAgZ2V0X291dGNvbWVfcXVldWVfc3RhdHMsCiAgICBnZXRfb3Blbl9wb3NpdGlvbnMsCiAgICBnZXRfcGVuZGluZ19hbGVydF9vdXRjb21lcywKICAgIGdldF9wZXJmb3JtYW5jZV9zdW1tYXJ5LAogICAgZ2V0X3BvcnRmb2xpb19zaW11bGF0aW9uX21ldHJpY3MsCiAgICBnZXRfcmVjZW50X3NjYW5fYmVzdHMsCiAgICBnZXRfcmlza19wYXVzZV9zdGF0ZSwKICAgIGdldF9zeW1ib2xfb3V0Y29tZV9zdGF0cywKICAgIGdldF93ZWVrbHlfdHVuaW5nX3JlcG9ydCwKICAgIGluaXRfZGIsCiAgICBsb2dfc2lnbmFsLAogICAgbWFya19hbGVydF9vdXRjb21lX2NvbXBsZXRlLAogICAgbWFya19hbGVydF9vdXRjb21lX2Vycm9yLAogICAgb3Blbl9tYW51YWxfcG9zaXRpb24sCiAgICBxdWV1ZV9hbGVydF9vdXRjb21lLAogICAgc2V0X3Jpc2tfcGF1c2UsCiAgICBzZXRfc3ltYm9sX2NvbnRyb2wsCiAgICB1cGRhdGVfYWxlcnRfb3V0Y29tZV9ob3Jpem9uLAopCmZyb20gdXRpbHMuZm9ybWF0IGltcG9ydCAoCiAgICBmb3JtYXRfbGVnYWN5X3JlY292ZXJ5LAogICAgZm9ybWF0X3J1bm5lcl93YXRjaCwKICAgIGZvcm1hdF9zaWduYWwsCiAgICBmb3JtYXRfd2F0Y2hsaXN0X3NpZ25hbCwKICAgIGZvcm1hdF93YXRjaGxpc3Rfc3VtbWFyeSwKKQpmcm9tIHV0aWxzLnNpbmdsZXRvbiBpbXBvcnQgU2luZ2xldG9uUHJvY2Vzc0xvY2sKCmNsYXNzIF9NYXhMZXZlbEZpbHRlcihsb2dnaW5nLkZpbHRlcik6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbWF4X2xldmVsKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm1heF9sZXZlbCA9IG1heF9sZXZlbAoKICAgIGRlZiBmaWx0ZXIoc2VsZiwgcmVjb3JkKToKICAgICAgICByZXR1cm4gcmVjb3JkLmxldmVsbm8gPD0gc2VsZi5tYXhfbGV2ZWwKCgpjbGFzcyBfSnNvbkZvcm1hdHRlcihsb2dnaW5nLkZvcm1hdHRlcik6CiAgICBkZWYgZm9ybWF0KHNlbGYsIHJlY29yZCk6CiAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgInRzIjogZGF0ZXRpbWUudXRjbm93KCkuaXNvZm9ybWF0KCkgKyAiWiIsCiAgICAgICAgICAgICJsZXZlbCI6IHJlY29yZC5sZXZlbG5hbWUsCiAgICAgICAgICAgICJsb2dnZXIiOiByZWNvcmQubmFtZSwKICAgICAgICAgICAgIm1zZyI6IHJlY29yZC5nZXRNZXNzYWdlKCksCiAgICAgICAgfQogICAgICAgIGlmIHJlY29yZC5leGNfaW5mbzoKICAgICAgICAgICAgcGF5bG9hZFsiZXhjIl0gPSBzZWxmLmZvcm1hdEV4Y2VwdGlvbihyZWNvcmQuZXhjX2luZm8pCiAgICAgICAgcmV0dXJuIGpzb24uZHVtcHMocGF5bG9hZCwgc2VwYXJhdG9ycz0oIiwiLCAiOiIpKQoKCl9yb290X2xvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKCkKX3Jvb3RfbG9nZ2VyLnNldExldmVsKGxvZ2dpbmcuSU5GTykKX3Jvb3RfbG9nZ2VyLmhhbmRsZXJzLmNsZWFyKCkKCl9zdGRvdXRfaGFuZGxlciA9IGxvZ2dpbmcuU3RyZWFtSGFuZGxlcihzeXMuc3Rkb3V0KQpfc3Rkb3V0X2hhbmRsZXIuc2V0TGV2ZWwobG9nZ2luZy5ERUJVRykKX3N0ZG91dF9oYW5kbGVyLmFkZEZpbHRlcihfTWF4TGV2ZWxGaWx0ZXIobG9nZ2luZy5JTkZPKSkKCl9zdGRlcnJfaGFuZGxlciA9IGxvZ2dpbmcuU3RyZWFtSGFuZGxlcihzeXMuc3RkZXJyKQpfc3RkZXJyX2hhbmRsZXIuc2V0TGV2ZWwobG9nZ2luZy5XQVJOSU5HKQoKX2Zvcm1hdHRlciA9IGxvZ2dpbmcuRm9ybWF0dGVyKCIlKGxldmVsbmFtZSlzOiUobmFtZSlzOiUobWVzc2FnZSlzIikKX3N0ZG91dF9oYW5kbGVyLnNldEZvcm1hdHRlcihfZm9ybWF0dGVyKQpfc3RkZXJyX2hhbmRsZXIuc2V0Rm9ybWF0dGVyKF9mb3JtYXR0ZXIpCgpfcm9vdF9sb2dnZXIuYWRkSGFuZGxlcihfc3Rkb3V0X2hhbmRsZXIpCl9yb290X2xvZ2dlci5hZGRIYW5kbGVyKF9zdGRlcnJfaGFuZGxlcikKCmlmIExPR19KU09OX0VOQUJMRUQ6CiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmRpcm5hbWUoTE9HX0pTT05fUEFUSCkgb3IgIi4iLCBleGlzdF9vaz1UcnVlKQogICAgX2pzb25faGFuZGxlciA9IFJvdGF0aW5nRmlsZUhhbmRsZXIoCiAgICAgICAgTE9HX0pTT05fUEFUSCwKICAgICAgICBtYXhCeXRlcz1MT0dfTUFYX0JZVEVTLAogICAgICAgIGJhY2t1cENvdW50PUxPR19CQUNLVVBfQ09VTlQsCiAgICApCiAgICBfanNvbl9oYW5kbGVyLnNldExldmVsKGxvZ2dpbmcuSU5GTykKICAgIF9qc29uX2hhbmRsZXIuc2V0Rm9ybWF0dGVyKF9Kc29uRm9ybWF0dGVyKCkpCiAgICBfcm9vdF9sb2dnZXIuYWRkSGFuZGxlcihfanNvbl9oYW5kbGVyKQoKbG9nZ2luZy5nZXRMb2dnZXIoImh0dHB4Iikuc2V0TGV2ZWwobG9nZ2luZy5XQVJOSU5HKQpsb2dnaW5nLmdldExvZ2dlcigiaHR0cGNvcmUiKS5zZXRMZXZlbChsb2dnaW5nLldBUk5JTkcpCmxvZ2dpbmcuZ2V0TG9nZ2VyKCJ0ZWxlZ3JhbS52ZW5kb3IucHRiX3VybGxpYjMudXJsbGliMyIpLnNldExldmVsKGxvZ2dpbmcuV0FSTklORykKCl90YWN0aWNhbF90ZWNoX2NhY2hlID0ge30KX2JpcmRleWVfZW5yaWNobWVudF9jYWNoZSA9IHt9CgpfQ09ORklERU5DRV9PUkRFUiA9IHsiQyI6IDEsICJCIjogMiwgIkEiOiAzfQoKCmRlZiBfZW5yaWNoX3Rva2VuX2Zvcl9zY29yaW5nKHRva2VuKToKICAgICIiIgogICAgRW5yaWNoIHRva2VuIHdpdGggQmlyZEV5ZSB0b2tlbl9vdmVydmlldyBkYXRhIGJlZm9yZSBzY29yaW5nLgogICAgVGhlIG5ldyBzY29yaW5nIG1vZGVsIG5lZWRzIHVuaXF1ZSB3YWxsZXQgbWV0cmljcyBhbmQgc29jaWFsIGRhdGEuCiAgICBSZXR1cm5zIGVucmljaGVkIHRva2VuIGRpY3QuCiAgICAiIiIKICAgIGFkZHJlc3MgPSB0b2tlbi5nZXQoImFkZHJlc3MiKQogICAgaWYgbm90IGFkZHJlc3M6CiAgICAgICAgcmV0dXJuIHRva2VuCgogICAgIyBDaGVjayBjYWNoZSBmaXJzdCAoNW1pbiBUVEwgPSBzY2FuIGludGVydmFsLCBhdm9pZHMgQVBJIHNwYW0pCiAgICAjIFVuaXF1ZSB3YWxsZXQgZGF0YSBkb2Vzbid0IGNoYW5nZSBkcmFzdGljYWxseSBzZWNvbmQtdG8tc2Vjb25kCiAgICBjYWNoZV9rZXkgPSBhZGRyZXNzCiAgICBub3cgPSB0aW1lX21vZHVsZS50aW1lKCkKICAgIGNhY2hlX3R0bCA9IDMwMCAgIyA1IG1pbnV0ZXMKCiAgICBpZiBjYWNoZV9rZXkgaW4gX2JpcmRleWVfZW5yaWNobWVudF9jYWNoZToKICAgICAgICBjYWNoZWRfZGF0YSwgY2FjaGVkX3RzID0gX2JpcmRleWVfZW5yaWNobWVudF9jYWNoZVtjYWNoZV9rZXldCiAgICAgICAgaWYgbm93IC0gY2FjaGVkX3RzIDwgY2FjaGVfdHRsOgogICAgICAgICAgICBlbnJpY2hlZCA9IGRpY3QodG9rZW4pCiAgICAgICAgICAgIGVucmljaGVkLnVwZGF0ZShjYWNoZWRfZGF0YSkKICAgICAgICAgICAgcmV0dXJuIGVucmljaGVkCgogICAgIyBGZXRjaCBmcmVzaCBkYXRhIGZyb20gQmlyZEV5ZQogICAgb3ZlcnZpZXdfZGF0YSA9IGZldGNoX2JpcmRleWVfdG9rZW5fb3ZlcnZpZXcoYWRkcmVzcykKICAgIGlmIG92ZXJ2aWV3X2RhdGE6CiAgICAgICAgX2JpcmRleWVfZW5yaWNobWVudF9jYWNoZVtjYWNoZV9rZXldID0gKG92ZXJ2aWV3X2RhdGEsIG5vdykKICAgICAgICBlbnJpY2hlZCA9IGRpY3QodG9rZW4pCiAgICAgICAgZW5yaWNoZWQudXBkYXRlKG92ZXJ2aWV3X2RhdGEpCiAgICAgICAgcmV0dXJuIGVucmljaGVkCgogICAgcmV0dXJuIHRva2VuCl9EQVlfVE9fV0VFS0RBWSA9IHsiTU9OIjogMCwgIlRVRSI6IDEsICJXRUQiOiAyLCAiVEhVIjogMywgIkZSSSI6IDQsICJTQVQiOiA1LCAiU1VOIjogNn0KX1BST0pFQ1RfUk9PVCA9IFBhdGgoX19maWxlX18pLnJlc29sdmUoKS5wYXJlbnQKX0VOVl9QQVRIID0gX1BST0pFQ1RfUk9PVCAvICIuZW52IgpfV0FUQ0hMSVNUX1NUQVRFX1BBVEggPSBfUFJPSkVDVF9ST09UIC8gImRhdGFfc3RvcmFnZSIgLyAid2F0Y2hsaXN0X3N0YXRlLmpzb24iCl9BTExPV0VEX0NIQVRfSUQgPSBpbnQoVEVMRUdSQU1fQ0hBVF9JRCkKX2FwcF9yZWYgPSBOb25lCl9kaWdlc3Rfc3RhdGUgPSB7Imxhc3Rfc2VudF90cyI6IE5vbmV9Cl93YXRjaGxpc3Rfc3RhdGUgPSB7InN0YXR1c2VzIjoge319Cl9TRUxMX0FMRVJUX0VYQ0xVREVEX1NZTUJPTFMgPSB7IlVTREMiLCAiVVNEVCIsICJVU0RTIiwgIlVTRDEiLCAiREFJIiwgIlNPTCIsICJXU09MIn0KCl9NT0RFX1BSRVNFVFMgPSB7CiAgICAic3RyYXRlZ2ljIjogewogICAgICAgICJwcm9maWxlIjogInN0cmF0ZWdpYyIsCiAgICAgICAgInNjYW5faW50ZXJ2YWxfc2Vjb25kcyI6IDM2MDAsCiAgICAgICAgIm1pbl9saXF1aWRpdHkiOiAxXzAwMF8wMDAuMCwKICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiAzMDBfMDAwLjAsCiAgICAgICAgImFsZXJ0X2Nvb2xkb3duX2hvdXJzIjogMTIsCiAgICAgICAgImFsZXJ0X3RocmVzaG9sZCI6IDgwLAogICAgICAgICJtaW5fY29uZmlkZW5jZV90b19hbGVydCI6ICJBIiwKICAgICAgICAicmVnaW1lX21pbl9zY29yZSI6IDQ1LAogICAgfSwKICAgICJ0YWN0aWNhbCI6IHsKICAgICAgICAicHJvZmlsZSI6ICJ0YWN0aWNhbCIsCiAgICAgICAgInNjYW5faW50ZXJ2YWxfc2Vjb25kcyI6IDE4MDAsCiAgICAgICAgIm1pbl9saXF1aWRpdHkiOiA1MDBfMDAwLjAsCiAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogMjAwXzAwMC4wLAogICAgICAgICJhbGVydF9jb29sZG93bl9ob3VycyI6IDYsCiAgICAgICAgImFsZXJ0X3RocmVzaG9sZCI6IDcwLAogICAgICAgICJtaW5fY29uZmlkZW5jZV90b19hbGVydCI6ICJCIiwKICAgICAgICAicmVnaW1lX21pbl9zY29yZSI6IDE1LAogICAgfSwKfQoKX1JJU0tfU1RZTEVfQUxJQVNFUyA9IHsKICAgICJjYXBpdGFsIjogImNhcGl0YWwiLAogICAgImNhcGl0YWwtcHJlc2VydmF0aW9uIjogImNhcGl0YWwiLAogICAgInByZXNlcnZhdGlvbiI6ICJjYXBpdGFsIiwKICAgICJzYWZlIjogImNhcGl0YWwiLAogICAgImJhbGFuY2VkIjogImJhbGFuY2VkIiwKICAgICJiYWxhbmNlIjogImJhbGFuY2VkIiwKICAgICJzbmlwZXIiOiAic25pcGVyIiwKICAgICJoaWdoLWJldGEiOiAic25pcGVyIiwKICAgICJhZ2dyZXNzaXZlIjogInNuaXBlciIsCn0KCl9SSVNLX1NUWUxFX0xBQkVMUyA9IHsKICAgICJjYXBpdGFsIjogIkNhcGl0YWwgUHJlc2VydmF0aW9uIiwKICAgICJiYWxhbmNlZCI6ICJCYWxhbmNlZCIsCiAgICAic25pcGVyIjogIlNuaXBlciIsCn0KCl9SSVNLX1NUWUxFX0RFU0NSSVBUSU9OUyA9IHsKICAgICJjYXBpdGFsIjogIkRlZmVuc2l2ZTogc3RyaWN0ZXIgbGlxdWlkaXR5L3ZvbHVtZSBhbmQgdGlnaHRlciB2b2xhdGlsaXR5IGxpbWl0cy4iLAogICAgImJhbGFuY2VkIjogIkRlZmF1bHQ6IG1vZGVyYXRlIGZpbHRlcnMgZm9yIHN0ZWFkeSBvcHBvcnR1bml0eSBmbG93LiIsCiAgICAic25pcGVyIjogIkhpZ2gtYmV0YTogd2lkZXIgZ2F0ZXMgZm9yIGZhc3Rlciwgcmlza2llciBzZXR1cHMuIiwKfQoKX01BUktFVF9USUVSX1JVTEVTID0gewogICAgImNvbnNlcnZhdGl2ZSI6IHsKICAgICAgICAibGFiZWwiOiAiTG9uZy1UZXJtIiwKICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQSIsCiAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IDYuMCwKICAgICAgICAibWluX2xpcXVpZGl0eSI6IDFfNTAwXzAwMC4wLAogICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDYwMF8wMDAuMCwKICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAxLjUsCiAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDMwLjAsCiAgICAgICAgIm1heF92b2xfdG9fbGlxIjogMS4yLAogICAgICAgICJhbGxvd19yaXNrX29mZiI6IEZhbHNlLAogICAgfSwKICAgICJiYWxhbmNlZCI6IHsKICAgICAgICAibGFiZWwiOiAiTWlkLVRlcm0iLAogICAgICAgICJtaW5fY29uZmlkZW5jZSI6ICJCIiwKICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogMC4wLAogICAgICAgICJtaW5fbGlxdWlkaXR5IjogNzAwXzAwMC4wLAogICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDI1MF8wMDAuMCwKICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAwLjUsCiAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDQ1LjAsCiAgICAgICAgIm1heF92b2xfdG9fbGlxIjogMS44LAogICAgICAgICJhbGxvd19yaXNrX29mZiI6IFRydWUsCiAgICB9LAogICAgImFnZ3Jlc3NpdmUiOiB7CiAgICAgICAgImxhYmVsIjogIlNob3J0LVRlcm0iLAogICAgICAgICJtaW5fY29uZmlkZW5jZSI6ICJCIiwKICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogLTYuMCwKICAgICAgICAibWluX2xpcXVpZGl0eSI6IDI1MF8wMDAuMCwKICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiAxMjBfMDAwLjAsCiAgICAgICAgIm1pbl9jaGFuZ2VfMjRoIjogLTIuMCwKICAgICAgICAibWF4X2Fic19jaGFuZ2VfMjRoIjogNzAuMCwKICAgICAgICAibWF4X3ZvbF90b19saXEiOiAyLjgsCiAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogVHJ1ZSwKICAgIH0sCn0KCl9SSVNLX1NUWUxFX1RJRVJfT1ZFUlJJREVTID0gewogICAgImNhcGl0YWwiOiB7CiAgICAgICAgImNvbnNlcnZhdGl2ZSI6IHsKICAgICAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IDguMCwKICAgICAgICAgICAgIm1pbl9saXF1aWRpdHkiOiAyXzAwMF8wMDAuMCwKICAgICAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogODAwXzAwMC4wLAogICAgICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAyLjUsCiAgICAgICAgICAgICJtYXhfYWJzX2NoYW5nZV8yNGgiOiAyNC4wLAogICAgICAgICAgICAibWF4X3ZvbF90b19saXEiOiAxLjAsCiAgICAgICAgICAgICJhbGxvd19yaXNrX29mZiI6IEZhbHNlLAogICAgICAgIH0sCiAgICAgICAgImJhbGFuY2VkIjogewogICAgICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQSIsCiAgICAgICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiA0LjAsCiAgICAgICAgICAgICJtaW5fbGlxdWlkaXR5IjogMV8xMDBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDQ1MF8wMDAuMCwKICAgICAgICAgICAgIm1pbl9jaGFuZ2VfMjRoIjogMS4wLAogICAgICAgICAgICAibWF4X2Fic19jaGFuZ2VfMjRoIjogMzUuMCwKICAgICAgICAgICAgIm1heF92b2xfdG9fbGlxIjogMS40LAogICAgICAgICAgICAiYWxsb3dfcmlza19vZmYiOiBGYWxzZSwKICAgICAgICB9LAogICAgICAgICJhZ2dyZXNzaXZlIjogewogICAgICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQiIsCiAgICAgICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiAwLjAsCiAgICAgICAgICAgICJtaW5fbGlxdWlkaXR5IjogNjAwXzAwMC4wLAogICAgICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiAyNDBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fY2hhbmdlXzI0aCI6IDAuMCwKICAgICAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDUwLjAsCiAgICAgICAgICAgICJtYXhfdm9sX3RvX2xpcSI6IDEuOCwKICAgICAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogRmFsc2UsCiAgICAgICAgfSwKICAgIH0sCiAgICAiYmFsYW5jZWQiOiB7fSwKICAgICJzbmlwZXIiOiB7CiAgICAgICAgImNvbnNlcnZhdGl2ZSI6IHsKICAgICAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IDQuMCwKICAgICAgICAgICAgIm1pbl9saXF1aWRpdHkiOiAxXzEwMF8wMDAuMCwKICAgICAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogNDIwXzAwMC4wLAogICAgICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAxLjAsCiAgICAgICAgICAgICJtYXhfYWJzX2NoYW5nZV8yNGgiOiAzNi4wLAogICAgICAgICAgICAibWF4X3ZvbF90b19saXEiOiAxLjUsCiAgICAgICAgICAgICJhbGxvd19yaXNrX29mZiI6IEZhbHNlLAogICAgICAgIH0sCiAgICAgICAgImJhbGFuY2VkIjogewogICAgICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQiIsCiAgICAgICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiAtMi4wLAogICAgICAgICAgICAibWluX2xpcXVpZGl0eSI6IDUwMF8wMDAuMCwKICAgICAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogMTgwXzAwMC4wLAogICAgICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAwLjAsCiAgICAgICAgICAgICJtYXhfYWJzX2NoYW5nZV8yNGgiOiA1NS4wLAogICAgICAgICAgICAibWF4X3ZvbF90b19saXEiOiAyLjIsCiAgICAgICAgICAgICJhbGxvd19yaXNrX29mZiI6IFRydWUsCiAgICAgICAgfSwKICAgICAgICAiYWdncmVzc2l2ZSI6IHsKICAgICAgICAgICAgIm1pbl9jb25maWRlbmNlIjogIkIiLAogICAgICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogLTEwLjAsCiAgICAgICAgICAgICJtaW5fbGlxdWlkaXR5IjogMTgwXzAwMC4wLAogICAgICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiA5MF8wMDAuMCwKICAgICAgICAgICAgIm1pbl9jaGFuZ2VfMjRoIjogLTQuMCwKICAgICAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDgwLjAsCiAgICAgICAgICAgICJtYXhfdm9sX3RvX2xpcSI6IDMuMiwKICAgICAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogVHJ1ZSwKICAgICAgICB9LAogICAgfSwKfQoKX1dBTExFVF9QTEFZQk9PSyA9IHsKICAgICJXMSI6IHsKICAgICAgICAibmFtZSI6ICJDb3JlIExvbmctVGVybSIsCiAgICAgICAgInBvc2l0aW9uX2hpbnQiOiAic2l6ZSA4LTE1JSBtYXgsIHNjYWxlLWluIG9ubHkiLAogICAgICAgICJyaXNrX3BsYW4iOiAiU29mdCBzdG9wIG9uIHRoZXNpcyBicmVhazsgYXZvaWQgaW1wdWxzZSBleGl0cyIsCiAgICAgICAgInJvdGF0aW9uX3BsYW4iOiAiUHJpbWFyeSBkZXN0aW5hdGlvbiBmb3IgaGFydmVzdGVkIHByb2ZpdHMiLAogICAgfSwKICAgICJXMiI6IHsKICAgICAgICAibmFtZSI6ICJRdWFsaXR5IFN3aW5nIiwKICAgICAgICAicG9zaXRpb25faGludCI6ICJzaXplIDQtOCUgbWF4IiwKICAgICAgICAicmlza19wbGFuIjogIkhhcmQgU0wgLTglIHwgVFAgKzEyLysyNSB8IHRyYWlsIDEwJSIsCiAgICAgICAgInJvdGF0aW9uX3BsYW4iOiAiUm90YXRlIDQwLTYwJSB3aW5zIHRvIFcxL3N0YWtpbmcvVVNEQyIsCiAgICB9LAogICAgIlczIjogewogICAgICAgICJuYW1lIjogIlRhY3RpY2FsL0RlZ2VuIiwKICAgICAgICAicG9zaXRpb25faGludCI6ICJzaXplIDEtMyUgbWF4IiwKICAgICAgICAicmlza19wbGFuIjogIkhhcmQgU0wgLTEyJSB8IHNjYWxlIGF0ICsxNS8rMzAvKzUwIiwKICAgICAgICAicm90YXRpb25fcGxhbiI6ICJSb3RhdGUgNjAtODAlIHdpbnMgdG8gVzEvVzIgb3IgVVNEQyIsCiAgICB9LAp9CgpfcnVudGltZSA9IHsKICAgICJwcm9maWxlIjogRU5HSU5FX1BST0ZJTEUgaWYgRU5HSU5FX1BST0ZJTEUgaW4gX01PREVfUFJFU0VUUyBlbHNlICJzdHJhdGVnaWMiLAogICAgInJpc2tfc3R5bGUiOiBfUklTS19TVFlMRV9BTElBU0VTLmdldChzdHIoUklTS19TVFlMRSBvciAiIikubG93ZXIoKSwgImJhbGFuY2VkIiksCiAgICAic2Nhbl9pbnRlcnZhbF9zZWNvbmRzIjogU0NBTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgIm1pbl9saXF1aWRpdHkiOiBmbG9hdChNSU5fTElRVUlESVRZKSwKICAgICJtaW5fdm9sdW1lXzI0aCI6IGZsb2F0KE1JTl9WT0xVTUVfMjRIKSwKICAgICJhbGVydF9jb29sZG93bl9ob3VycyI6IEFMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgImFsZXJ0X3RocmVzaG9sZCI6IEFMRVJUX1RIUkVTSE9MRCwKICAgICJtaW5fY29uZmlkZW5jZV90b19hbGVydCI6IE1JTl9DT05GSURFTkNFX1RPX0FMRVJULAogICAgInJlZ2ltZV9taW5fc2NvcmUiOiBSRUdJTUVfTUlOX1NDT1JFLAp9CgoKZGVmIF9tb2RlKCkgLT4gc3RyOgogICAgcmV0dXJuIHN0cihfcnVudGltZVsicHJvZmlsZSJdKS5sb3dlcigpCgoKZGVmIF9ub3JtYWxpemVfcmlza19zdHlsZShyYXc6IHN0ciB8IE5vbmUpIC0+IHN0cjoKICAgIHJldHVybiBfUklTS19TVFlMRV9BTElBU0VTLmdldChzdHIocmF3IG9yICIiKS5zdHJpcCgpLmxvd2VyKCksICJiYWxhbmNlZCIpCgoKZGVmIF9yaXNrX3N0eWxlX2xhYmVsKHN0eWxlOiBzdHIgfCBOb25lID0gTm9uZSkgLT4gc3RyOgogICAgbm9ybWFsaXplZCA9IF9ub3JtYWxpemVfcmlza19zdHlsZShzdHlsZSBvciBfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSkKICAgIHJldHVybiBfUklTS19TVFlMRV9MQUJFTFMuZ2V0KG5vcm1hbGl6ZWQsICJCYWxhbmNlZCIpCgoKZGVmIF9yaXNrX3N0eWxlX2Rlc2NyaXB0aW9uKHN0eWxlOiBzdHIgfCBOb25lID0gTm9uZSkgLT4gc3RyOgogICAgbm9ybWFsaXplZCA9IF9ub3JtYWxpemVfcmlza19zdHlsZShzdHlsZSBvciBfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSkKICAgIHJldHVybiBfUklTS19TVFlMRV9ERVNDUklQVElPTlMuZ2V0KAogICAgICAgIG5vcm1hbGl6ZWQsCiAgICAgICAgIkRlZmF1bHQ6IG1vZGVyYXRlIGZpbHRlcnMgZm9yIHN0ZWFkeSBvcHBvcnR1bml0eSBmbG93LiIsCiAgICApCgoKZGVmIF9tYXJrZXRfdGllcl9ydWxlKHRpZXJfa2V5OiBzdHIpIC0+IGRpY3Q6CiAgICB0aWVyID0gX25vcm1hbGl6ZV9tYXJrZXRfdGllcih0aWVyX2tleSkKICAgIGJhc2UgPSBkaWN0KF9NQVJLRVRfVElFUl9SVUxFU1t0aWVyXSkKICAgIHN0eWxlID0gX25vcm1hbGl6ZV9yaXNrX3N0eWxlKF9ydW50aW1lLmdldCgicmlza19zdHlsZSIpKQogICAgb3ZlcnJpZGVzID0gX1JJU0tfU1RZTEVfVElFUl9PVkVSUklERVMuZ2V0KHN0eWxlLCB7fSkuZ2V0KHRpZXIsIHt9KQogICAgaWYgb3ZlcnJpZGVzOgogICAgICAgIGJhc2UudXBkYXRlKG92ZXJyaWRlcykKICAgIHJldHVybiBiYXNlCgoKZGVmIF9pc19hdXRob3JpemVkKHVwZGF0ZTogVXBkYXRlKSAtPiBib29sOgogICAgY2hhdCA9IHVwZGF0ZS5lZmZlY3RpdmVfY2hhdAogICAgcmV0dXJuIGJvb2woY2hhdCBhbmQgY2hhdC5pZCA9PSBfQUxMT1dFRF9DSEFUX0lEKQoKCmRlZiBfc2V0X2Vudl92YWx1ZXModmFsdWVzOiBkaWN0W3N0ciwgc3RyXSk6CiAgICBleGlzdGluZyA9IF9FTlZfUEFUSC5yZWFkX3RleHQoKS5zcGxpdGxpbmVzKCkgaWYgX0VOVl9QQVRILmV4aXN0cygpIGVsc2UgW10KICAgIG91dHB1dCA9IFtdCiAgICBzZWVuID0gc2V0KCkKCiAgICBmb3IgbGluZSBpbiBleGlzdGluZzoKICAgICAgICBzdHJpcHBlZCA9IGxpbmUuc3RyaXAoKQogICAgICAgIHJlcGxhY2VkID0gRmFsc2UKICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiB2YWx1ZXMuaXRlbXMoKToKICAgICAgICAgICAgaWYgc3RyaXBwZWQuc3RhcnRzd2l0aChmIntrZXl9PSIpOgogICAgICAgICAgICAgICAgaWYga2V5IG5vdCBpbiBzZWVuOgogICAgICAgICAgICAgICAgICAgIG91dHB1dC5hcHBlbmQoZiJ7a2V5fT17dmFsdWV9IikKICAgICAgICAgICAgICAgICAgICBzZWVuLmFkZChrZXkpCiAgICAgICAgICAgICAgICByZXBsYWNlZCA9IFRydWUKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgbm90IHJlcGxhY2VkOgogICAgICAgICAgICBvdXRwdXQuYXBwZW5kKGxpbmUpCgogICAgZm9yIGtleSwgdmFsdWUgaW4gdmFsdWVzLml0ZW1zKCk6CiAgICAgICAgaWYga2V5IG5vdCBpbiBzZWVuOgogICAgICAgICAgICBvdXRwdXQuYXBwZW5kKGYie2tleX09e3ZhbHVlfSIpCgogICAgX0VOVl9QQVRILndyaXRlX3RleHQoIlxuIi5qb2luKG91dHB1dCkucnN0cmlwKCkgKyAiXG4iKQoKCmRlZiBfYXBwbHlfbW9kZShtb2RlOiBzdHIpOgogICAgbW9kZSA9IG1vZGUubG93ZXIoKQogICAgaWYgbW9kZSBub3QgaW4gX01PREVfUFJFU0VUUzoKICAgICAgICByZXR1cm4KICAgIF9ydW50aW1lLnVwZGF0ZShfTU9ERV9QUkVTRVRTW21vZGVdKQoKCmRlZiBfcGVyc2lzdF9tb2RlKG1vZGU6IHN0cik6CiAgICBwcmVzZXQgPSBfTU9ERV9QUkVTRVRTW21vZGVdCiAgICBfc2V0X2Vudl92YWx1ZXMoCiAgICAgICAgewogICAgICAgICAgICAiRU5HSU5FX1BST0ZJTEUiOiBwcmVzZXRbInByb2ZpbGUiXSwKICAgICAgICAgICAgIlNDQU5fSU5URVJWQUxfU0VDT05EUyI6IHN0cihwcmVzZXRbInNjYW5faW50ZXJ2YWxfc2Vjb25kcyJdKSwKICAgICAgICAgICAgIk1JTl9MSVFVSURJVFkiOiBzdHIoaW50KHByZXNldFsibWluX2xpcXVpZGl0eSJdKSksCiAgICAgICAgICAgICJNSU5fVk9MVU1FXzI0SCI6IHN0cihpbnQocHJlc2V0WyJtaW5fdm9sdW1lXzI0aCJdKSksCiAgICAgICAgICAgICJBTEVSVF9DT09MRE9XTl9IT1VSUyI6IHN0cihwcmVzZXRbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0pLAogICAgICAgICAgICAiQUxFUlRfVEhSRVNIT0xEIjogc3RyKHByZXNldFsiYWxlcnRfdGhyZXNob2xkIl0pLAogICAgICAgICAgICAiTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQiOiBzdHIocHJlc2V0WyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdKSwKICAgICAgICAgICAgIlJFR0lNRV9NSU5fU0NPUkUiOiBzdHIocHJlc2V0WyJyZWdpbWVfbWluX3Njb3JlIl0pLAogICAgICAgIH0KICAgICkKCgpkZWYgX2ZtdF9kdChkdCk6CiAgICBpZiBub3QgZHQ6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICByZXR1cm4gZHQuc3RyZnRpbWUoIiVZLSVtLSVkICVIOiVNOiVTIFVUQyIpCgoKZGVmIF90cnlfZmxvYXQodmFsdWUpOgogICAgdHJ5OgogICAgICAgIHJldHVybiBmbG9hdCh2YWx1ZSkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gTm9uZQoKCmRlZiBfcGFyc2Vfc3ltYm9sX29yX21pbnQocmF3OiBzdHIpOgogICAgdG9rZW4gPSBzdHIocmF3IG9yICIiKS5zdHJpcCgpCiAgICBpZiBub3QgdG9rZW46CiAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUKICAgIHRva2VuID0gdG9rZW4ubHN0cmlwKCIkIikKICAgIGlmIGxlbih0b2tlbikgPj0gMzI6CiAgICAgICAgcmV0dXJuIE5vbmUsIHRva2VuCiAgICBzeW1ib2wgPSAiIi5qb2luKGNoIGZvciBjaCBpbiB0b2tlbi51cHBlcigpIGlmIGNoLmlzYWxudW0oKSlbOjE2XQogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gTm9uZSwgTm9uZQogICAgcmV0dXJuIHN5bWJvbCwgTm9uZQoKCmRlZiBfcmVzb2x2ZV90b2tlbl9mb3JfdHJhY2tpbmcoc3ltYm9sOiBzdHIgfCBOb25lLCBtaW50OiBzdHIgfCBOb25lKToKICAgIGlmIG1pbnQ6CiAgICAgICAgc25hcCA9IGZldGNoX2RleHNjcmVlbmVyX3Rva2VuX3NuYXBzaG90KG1pbnQpCiAgICAgICAgaWYgc25hcDoKICAgICAgICAgICAgcmV0dXJuIHNuYXAKICAgIGlmIHN5bWJvbDoKICAgICAgICBjYW5kaWRhdGVzID0gZmV0Y2hfcnVubmVyX3dhdGNoX2NhbmRpZGF0ZXMoCiAgICAgICAgICAgIHF1ZXJpZXM9W3N5bWJvbF0sCiAgICAgICAgICAgIHBhaXJzX3Blcl9xdWVyeT0xNiwKICAgICAgICAgICAgbGltaXQ9NTAsCiAgICAgICAgKQogICAgICAgIGlmIGNhbmRpZGF0ZXM6CiAgICAgICAgICAgIGV4YWN0ID0gW3QgZm9yIHQgaW4gY2FuZGlkYXRlcyBpZiBzdHIodC5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpID09IHN5bWJvbF0KICAgICAgICAgICAgcG9vbCA9IGV4YWN0IG9yIGNhbmRpZGF0ZXMKICAgICAgICAgICAgcG9vbC5zb3J0KGtleT1sYW1iZGEgdDogKGZsb2F0KHQuZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKSwgZmxvYXQodC5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKSksIHJldmVyc2U9VHJ1ZSkKICAgICAgICAgICAgcmV0dXJuIHBvb2xbMF0KICAgIHJldHVybiBOb25lCgoKZGVmIF9idWlsZF9hbGVydF9rZXlib2FyZChzeW1ib2w6IHN0ciwgbWludDogc3RyIHwgTm9uZSwgcGFpcl9hZGRyZXNzOiBzdHIgfCBOb25lID0gTm9uZSk6CiAgICBpZiBub3QgVEVMRUdSQU1fQUNUSU9OX0JVVFRPTlNfRU5BQkxFRDoKICAgICAgICByZXR1cm4gTm9uZQogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICBzeW1ib2wgPSAiVU5LTk9XTiIKICAgIHJvd3MgPSBbXQogICAgbWludF90ZXh0ID0gc3RyKG1pbnQgb3IgIiIpLnN0cmlwKCkKICAgIGRleHNjcmVlbmVyX3RhcmdldCA9IHBhaXJfYWRkcmVzcyBvciBtaW50CiAgICBpZiBkZXhzY3JlZW5lcl90YXJnZXQ6CiAgICAgICAgZmlyc3Rfcm93ID0gWwogICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigiRGV4U2NyZWVuZXIiLCB1cmw9ZiJodHRwczovL2RleHNjcmVlbmVyLmNvbS9zb2xhbmEve2RleHNjcmVlbmVyX3RhcmdldH0iKSwKICAgICAgICBdCiAgICAgICAgaWYgbWludF90ZXh0OgogICAgICAgICAgICBmaXJzdF9yb3cuYXBwZW5kKAogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oCiAgICAgICAgICAgICAgICAgICAgIkNvcHkgQ0EiLAogICAgICAgICAgICAgICAgICAgIGNvcHlfdGV4dD1Db3B5VGV4dEJ1dHRvbih0ZXh0PW1pbnRfdGV4dCksCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICByb3dzLmFwcGVuZChmaXJzdF9yb3cpCiAgICBpZiBtaW50X3RleHQ6CiAgICAgICAgcm93cy5hcHBlbmQoCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCJTb2xzY2FuIiwgdXJsPWYiaHR0cHM6Ly9zb2xzY2FuLmlvL3Rva2VuL3ttaW50X3RleHR9IiksCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigiUnVnQ2hlY2siLCB1cmw9ZiJodHRwczovL3J1Z2NoZWNrLnh5ei90b2tlbnMve21pbnRfdGV4dH0iKSwKICAgICAgICAgICAgXQogICAgICAgICkKICAgIGlmIG5vdCByb3dzOgogICAgICAgIHJldHVybiBOb25lCiAgICByZXR1cm4gSW5saW5lS2V5Ym9hcmRNYXJrdXAocm93cykKCgpkZWYgX3Jlc2NoZWR1bGVfcnVuX2VuZ2luZV9qb2JzKGFwcGxpY2F0aW9uKToKICAgIGludGVydmFsID0gaW50KF9ydW50aW1lWyJzY2FuX2ludGVydmFsX3NlY29uZHMiXSkKICAgIGZvciBqb2IgaW4gYXBwbGljYXRpb24uam9iX3F1ZXVlLmdldF9qb2JzX2J5X25hbWUoInJ1bl9lbmdpbmVfY3ljbGUiKToKICAgICAgICBqb2Iuc2NoZWR1bGVfcmVtb3ZhbCgpCiAgICBmb3Igam9iIGluIGFwcGxpY2F0aW9uLmpvYl9xdWV1ZS5nZXRfam9ic19ieV9uYW1lKCJydW5fZW5naW5lX2Jvb3QiKToKICAgICAgICBqb2Iuc2NoZWR1bGVfcmVtb3ZhbCgpCgogICAgYXBwbGljYXRpb24uam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgIHJ1bl9lbmdpbmUsCiAgICAgICAgd2hlbj0yLAogICAgICAgIG5hbWU9InJ1bl9lbmdpbmVfYm9vdCIsCiAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDMwfSwKICAgICkKICAgIGFwcGxpY2F0aW9uLmpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKAogICAgICAgIHJ1bl9lbmdpbmUsCiAgICAgICAgaW50ZXJ2YWw9aW50ZXJ2YWwsCiAgICAgICAgZmlyc3Q9aW50ZXJ2YWwsCiAgICAgICAgbmFtZT0icnVuX2VuZ2luZV9jeWNsZSIsCiAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDMwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICkKCgpkZWYgX3JlcXVpcmVfZW52KCk6CiAgICBpZiBub3QgVEVMRUdSQU1fVE9LRU46CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigi4p2MIFRFTEVHUkFNX1RPS0VOIG1pc3NpbmcgaW4gLmVudiIpCiAgICBpZiBub3QgVEVMRUdSQU1fQ0hBVF9JRDoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCLinYwgVEVMRUdSQU1fQ0hBVF9JRCBtaXNzaW5nIGluIC5lbnYiKQogICAgaWYgbm90IHN0cihURUxFR1JBTV9DSEFUX0lEKS5pc2RpZ2l0KCk6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigi4p2MIFRFTEVHUkFNX0NIQVRfSUQgbXVzdCBiZSBudW1lcmljIChleGFtcGxlOiAxODg3Njc4MDIzKSIpCgoKZGVmIF90b19pbnRfb3Jfbm9uZSh2YWx1ZSk6CiAgICBpZiB2YWx1ZSBpbiAoTm9uZSwgIiIsICJOL0EiKToKICAgICAgICByZXR1cm4gTm9uZQogICAgdHJ5OgogICAgICAgIHJldHVybiBpbnQoZmxvYXQodmFsdWUpKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiBOb25lCgoKZGVmIF9wYXNzZXNfcXVhbGl0eV9maWx0ZXJzKHRva2VuKToKICAgICIiIgogICAgQmFzaWMgcXVhbGl0eSBmaWx0ZXJzIHRvIGV4Y2x1ZGUganVuay9pbGxpcXVpZCB0b2tlbnMuCiAgICBGb2N1czogbWluaW11bSBzdGFuZGFyZHMsIG5vdCBlbnRyeSB0aW1pbmcuCiAgICAiIiIKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBob2xkZXJzID0gX3RvX2ludF9vcl9ub25lKHRva2VuLmdldCgiaG9sZGVycyIpKQoKICAgICMgTWluaW11bSBsaXF1aWRpdHkvdm9sdW1lIHN0YW5kYXJkcwogICAgaWYgbGlxdWlkaXR5IDwgZmxvYXQoX3J1bnRpbWVbIm1pbl9saXF1aWRpdHkiXSk6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBpZiB2b2x1bWVfMjRoIDwgZmxvYXQoX3J1bnRpbWVbIm1pbl92b2x1bWVfMjRoIl0pOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgTm90IGFscmVhZHkgZHVtcGluZyBoYXJkCiAgICBpZiBjaGFuZ2VfMjRoIDw9IE1BWF9BTExPV0VEX0RSQVdET1dOXzI0SDoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIE1pbmltdW0gaG9sZGVyIGJhc2UKICAgIGlmIGhvbGRlcnMgaXMgbm90IE5vbmUgYW5kIGhvbGRlcnMgPCBNSU5fSE9MREVSUzoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIEVBUkxZIEVOVFJZIExPR0lDOiBBdm9pZCBsYXRlIHB1bXBzCiAgICAjIElmIDI0aCBjaGFuZ2UgaXMgdG9vIGV4dHJlbWUsIHdlJ3JlIGxhdGUgdG8gdGhlIHBhcnR5CiAgICBpZiBjaGFuZ2VfMjRoID4gMTAwOiAgIyBBbHJlYWR5IDJ4KyBpbiAyNGggPSB0b28gbGF0ZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgSWYgaG9sZGVycyBhcmUgcHJlc2VudCwgY2hlY2sgZm9yIGhlYWx0aHkgZ3Jvd3RoIHZzIHB1bXAgJiBkdW1wCiAgICB1d18xaCA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0MWgiKQogICAgdXdfMWhfY2hhbmdlID0gdG9rZW4uZ2V0KCJ1bmlxdWVXYWxsZXQxaENoYW5nZVBlcmNlbnQiKQoKICAgICMgSWYgaG9sZGVycyBhcmUgcmFwaWRseSBleGl0aW5nIChuZWdhdGl2ZSBncm93dGgpLCBza2lwCiAgICBpZiB1d18xaF9jaGFuZ2UgaXMgbm90IE5vbmUgYW5kIHV3XzFoX2NoYW5nZSA8IC0xNToKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIElmIHdlIGhhdmUgdmVyeSBsb3cgaG9sZGVyIGNvdW50IHdpdGggbWFzc2l2ZSBwcmljZSBwdW1wID0gbGlrZWx5IGJvdCBmYXJtCiAgICBpZiB1d18xaCBpcyBub3QgTm9uZSBhbmQgdXdfMWggPCAzMCBhbmQgY2hhbmdlXzI0aCA+IDUwOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIHJldHVybiBUcnVlCgoKZGVmIF9wYXNzZXNfZXhlY3V0aW9uX3F1YWxpdHlfZmlsdGVycyh0b2tlbik6CiAgICAiIiIKICAgIEFkdmFuY2VkIGZpbHRlcnMgZm9jdXNlZCBvbiBleGVjdXRpb24gcXVhbGl0eSBhbmQgZWFybHktc3RhZ2UgZGV0ZWN0aW9uLgogICAgR29hbDogY2F0Y2ggbW9tZW50dW0gRUFSTFksIG5vdCBhZnRlciBwYXJhYm9saWMgbW92ZXMuCiAgICAiIiIKICAgIGlmIG5vdCBFTkFCTEVfRVhFQ1VUSU9OX1FVQUxJVFlfRklMVEVSUzoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgcHJpY2UgPSBmbG9hdCh0b2tlbi5nZXQoInByaWNlIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzFoID0gdG9rZW4uZ2V0KCJjaGFuZ2VfMWgiKSBvciB0b2tlbi5nZXQoInByaWNlQ2hhbmdlMWhQZXJjZW50IikKICAgIGNoYW5nZV80aCA9IHRva2VuLmdldCgiY2hhbmdlXzRoIikgb3IgdG9rZW4uZ2V0KCJwcmljZUNoYW5nZTRoUGVyY2VudCIpCiAgICBob2xkZXJzID0gX3RvX2ludF9vcl9ub25lKHRva2VuLmdldCgiaG9sZGVycyIpKQoKICAgICMgUHJpY2UgbXVzdCBiZSB0cmFkZWFibGUKICAgIGlmIHByaWNlIDwgTUlOX1BSSUNFX1VTRDoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIEF2b2lkIHBhcmFib2xpYyBsYXRlIHB1bXBzCiAgICBpZiBhYnMoY2hhbmdlXzI0aCkgPiBNQVhfQUJTX0NIQU5HRV8yNEg6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgIyBWb2x1bWUvbGlxdWlkaXR5IHJhdGlvIG11c3QgYmUgaGVhbHRoeSAobm90IG92ZXJoZWF0ZWQsIG5vdCBkZWFkKQogICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMAogICAgaWYgdm9sX3RvX2xpcSA8IE1JTl9WT0xfVE9fTElRX1JBVElPIG9yIHZvbF90b19saXEgPiBNQVhfVk9MX1RPX0xJUV9SQVRJTzoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIExpcXVpZGl0eSBwZXIgaG9sZGVyIGNvbmNlbnRyYXRpb24gY2hlY2sKICAgIGlmIGhvbGRlcnMgYW5kIGhvbGRlcnMgPiAwOgogICAgICAgIGxpcV9wZXJfaG9sZGVyID0gbGlxdWlkaXR5IC8gaG9sZGVycwogICAgICAgIGlmIGxpcV9wZXJfaG9sZGVyIDwgTUlOX0xJUVVJRElUWV9QRVJfSE9MREVSOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIEVBUkxZIEVOVFJZIEVOSEFOQ0VNRU5UOiBMb29rIGZvciBhY2NlbGVyYXRpb24gcGF0dGVybnMKICAgICMgQmVzdCBzaWduYWw6IDRoIHRyZW5kICsgMWggYWNjZWxlcmF0aW9uIChub3QgbGF0ZSBwdW1wKQogICAgaWYgY2hhbmdlXzRoIGlzIG5vdCBOb25lIGFuZCBjaGFuZ2VfMWggaXMgbm90IE5vbmU6CiAgICAgICAgIyBJZiA0aCBpcyBzdHJvbmdseSBwb3NpdGl2ZSBidXQgMWggaXMgZHVtcGluZyA9IHRvcCBzaWduYWwsIHNraXAKICAgICAgICBpZiBjaGFuZ2VfNGggPiAxMCBhbmQgY2hhbmdlXzFoIDwgLTU6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAjIElmIDI0aCBpcyBwYXJhYm9saWMgYnV0IHNob3J0LXRlcm0gaXMgZmFkaW5nID0gbGF0ZSwgc2tpcAogICAgICAgIGlmIGNoYW5nZV8yNGggPiA1MCBhbmQgY2hhbmdlXzRoIDwgNToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgIyBDaGVjayBob2xkZXIgbW9tZW50dW0gZm9yIHF1YWxpdHkKICAgIHV3XzFoX2NoYW5nZSA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0MWhDaGFuZ2VQZXJjZW50IikKICAgIHV3XzRoX2NoYW5nZSA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0NGhDaGFuZ2VQZXJjZW50IikKCiAgICAjIElmIGhvbGRlcnMgYXJlIGFjY2VsZXJhdGluZyBvdXQgKG5lZ2F0aXZlIGdyb3d0aCksIHNraXAKICAgIGlmIHV3XzFoX2NoYW5nZSBpcyBub3QgTm9uZSBhbmQgdXdfMWhfY2hhbmdlIDwgLTIwOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgSWYgNGggaG9sZGVyIHRyZW5kIGlzIG5lZ2F0aXZlIHdoaWxlIHByaWNlIGlzIHB1bXBpbmcgPSBkaXN0cmlidXRpb24KICAgIGlmIHV3XzRoX2NoYW5nZSBpcyBub3QgTm9uZSBhbmQgY2hhbmdlXzI0aCA+IDIwIGFuZCB1d180aF9jaGFuZ2UgPCAtMTA6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgcmV0dXJuIFRydWUKCgpkZWYgX3Bhc3Nlc190YWN0aWNhbF9maWx0ZXJzKHRva2VuKToKICAgIGlmIF9tb2RlKCkgIT0gInRhY3RpY2FsIjoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBjaGFuZ2VfMWhfcmF3ID0gdG9rZW4uZ2V0KCJjaGFuZ2VfMWgiKQogICAgY2hhbmdlXzZoX3JhdyA9IHRva2VuLmdldCgiY2hhbmdlXzZoIikKICAgIGNoYW5nZV8xaCA9IGZsb2F0KGNoYW5nZV8xaF9yYXcpIGlmIGlzaW5zdGFuY2UoY2hhbmdlXzFoX3JhdywgKGludCwgZmxvYXQpKSBlbHNlIE5vbmUKICAgIGNoYW5nZV82aCA9IGZsb2F0KGNoYW5nZV82aF9yYXcpIGlmIGlzaW5zdGFuY2UoY2hhbmdlXzZoX3JhdywgKGludCwgZmxvYXQpKSBlbHNlIE5vbmUKCiAgICBpZiBsaXF1aWRpdHkgPD0gMCBvciB2b2x1bWVfMjRoIDw9IDA6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgdm9sX3RvX2xpcSA9IHZvbHVtZV8yNGggLyBsaXF1aWRpdHkKICAgIGlmIHZvbF90b19saXEgPCBUQUNUSUNBTF9NSU5fVk9MX1RPX0xJUV9SQVRJTzoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBwdWxsYmFja19wY3QgPSBhYnMoY2hhbmdlXzI0aCkgaWYgY2hhbmdlXzI0aCA8IDAgZWxzZSAwLjAKICAgIGluX3B1bGxiYWNrX3pvbmUgPSBUQUNUSUNBTF9QVUxMQkFDS19NSU5fUENUIDw9IHB1bGxiYWNrX3BjdCA8PSBUQUNUSUNBTF9QVUxMQkFDS19NQVhfUENUCgogICAgbW9tZW50dW1fb2sgPSBjaGFuZ2VfMjRoID49IFRBQ1RJQ0FMX1RSRU5EX01JTl9DSEFOR0VfMjRICiAgICBpZiBjaGFuZ2VfMWggaXMgbm90IE5vbmU6CiAgICAgICAgbW9tZW50dW1fb2sgPSBtb21lbnR1bV9vayBhbmQgY2hhbmdlXzFoID49IFRBQ1RJQ0FMX01JTl9NT01FTlRVTV9DSEFOR0VfMUgKICAgIGVsaWYgY2hhbmdlXzZoIGlzIG5vdCBOb25lOgogICAgICAgIG1vbWVudHVtX29rID0gbW9tZW50dW1fb2sgYW5kIGNoYW5nZV82aCA+IDAKCiAgICBzdXBwb3J0X2JvdW5jZV9vayA9IGluX3B1bGxiYWNrX3pvbmUgYW5kICgKICAgICAgICAoY2hhbmdlXzFoIGlzIG5vdCBOb25lIGFuZCBjaGFuZ2VfMWggPj0gMCkKICAgICAgICBvciAoY2hhbmdlXzZoIGlzIG5vdCBOb25lIGFuZCBjaGFuZ2VfNmggPj0gMCkKICAgICAgICBvciAoY2hhbmdlXzFoIGlzIE5vbmUgYW5kIGNoYW5nZV82aCBpcyBOb25lKQogICAgKQoKICAgIGlmIG5vdCAobW9tZW50dW1fb2sgb3Igc3VwcG9ydF9ib3VuY2Vfb2spOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGxhc3RfdHJhZGVfdW5peCA9IF90b19pbnRfb3Jfbm9uZSh0b2tlbi5nZXQoImxhc3RfdHJhZGVfdW5peCIpKQogICAgaWYgbGFzdF90cmFkZV91bml4OgogICAgICAgIGFnZV9taW51dGVzID0gKGRhdGV0aW1lLnV0Y25vdygpIC0gZGF0ZXRpbWUudXRjZnJvbXRpbWVzdGFtcChsYXN0X3RyYWRlX3VuaXgpKS50b3RhbF9zZWNvbmRzKCkgLyA2MC4wCiAgICAgICAgaWYgYWdlX21pbnV0ZXMgPiBUQUNUSUNBTF9NQVhfTEFTVF9UUkFERV9BR0VfTUlOVVRFUzoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgdGVjaCA9IF9nZXRfdGFjdGljYWxfdGVjaG5pY2Fscyh0b2tlbikKICAgIGlmIHRlY2g6CiAgICAgICAgdG9rZW4udXBkYXRlKHRlY2gpCiAgICAgICAgcnNpX29rID0gVEFDVElDQUxfUlNJX01JTiA8PSB0ZWNoWyJyc2kiXSA8PSBUQUNUSUNBTF9SU0lfTUFYCiAgICAgICAgbWFjZF9vayA9ICgKICAgICAgICAgICAgdGVjaFsibWFjZF9oaXN0Il0gPj0gVEFDVElDQUxfTUFDRF9ISVNUX01JTgogICAgICAgICAgICBhbmQgdGVjaFsibWFjZF9saW5lIl0gPj0gdGVjaFsibWFjZF9zaWduYWwiXQogICAgICAgICkKICAgICAgICBpZiBub3QgKHJzaV9vayBhbmQgbWFjZF9vayk6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgZWxpZiBUQUNUSUNBTF9FTkFCTEVfUkVBTF9URUNITklDQUxTIGFuZCBUQUNUSUNBTF9SRVFVSVJFX1RFQ0hOSUNBTF9DT05GSVJNQVRJT046CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgcmV0dXJuIFRydWUKCgpkZWYgX3BjdF9kcmlmdChvbGRfdmFsdWUsIG5ld192YWx1ZSk6CiAgICB0cnk6CiAgICAgICAgb2xkX24gPSBmbG9hdChvbGRfdmFsdWUpCiAgICAgICAgbmV3X24gPSBmbG9hdChuZXdfdmFsdWUpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIG9sZF9uIDw9IDAgb3IgbmV3X24gPD0gMDoKICAgICAgICByZXR1cm4gTm9uZQogICAgcmV0dXJuIGFicyhuZXdfbiAtIG9sZF9uKSAvIG9sZF9uICogMTAwLjAKCgpkZWYgX3JlZnJlc2hfYWxlcnRfbWFya2V0X3NuYXBzaG90KHRva2VuOiBkaWN0KToKICAgIGlmIG5vdCBBTEVSVF9EQVRBX1JFRlJFU0hfRU5BQkxFRDoKICAgICAgICByZXR1cm4gdG9rZW4KCiAgICBhZGRyZXNzID0gdG9rZW4uZ2V0KCJhZGRyZXNzIikKICAgIGlmIG5vdCBhZGRyZXNzOgogICAgICAgIHJldHVybiB0b2tlbgoKICAgIHNuYXBzaG90ID0gZmV0Y2hfZGV4c2NyZWVuZXJfdG9rZW5fc25hcHNob3QoYWRkcmVzcykKICAgIGlmIG5vdCBzbmFwc2hvdDoKICAgICAgICBpZiBBTEVSVF9SRVFVSVJFX1JFRlJFU0hfU1VDQ0VTUzoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICByZXR1cm4gdG9rZW4KCiAgICBtZXJnZWQgPSBkaWN0KHRva2VuKQogICAgZm9yIGZpZWxkIGluICgibGlxdWlkaXR5IiwgInZvbHVtZV8yNGgiLCAicHJpY2UiLCAiY2hhbmdlXzI0aCIsICJjaGFuZ2VfNmgiLCAiY2hhbmdlXzFoIiwgIm1hcmtldF9jYXAiLCAiZmR2Iik6CiAgICAgICAgc25hcF92YWx1ZSA9IHNuYXBzaG90LmdldChmaWVsZCkKICAgICAgICBpZiBzbmFwX3ZhbHVlIGlzIE5vbmU6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZHJpZnQgPSBfcGN0X2RyaWZ0KHRva2VuLmdldChmaWVsZCksIHNuYXBfdmFsdWUpCiAgICAgICAgaWYgZHJpZnQgaXMgbm90IE5vbmUgYW5kIGRyaWZ0ID49IEFMRVJUX0RBVEFfRFJJRlRfV0FSTl9QQ1Q6CiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygKICAgICAgICAgICAgICAgICJBbGVydCBkYXRhIGRyaWZ0IGFkanVzdGVkIGZvciAlcyBmaWVsZD0lcyBvbGQ9JS40ZiBuZXc9JS40ZiBkcmlmdD0lLjFmJSUiLAogICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpLAogICAgICAgICAgICAgICAgZmllbGQsCiAgICAgICAgICAgICAgICBmbG9hdCh0b2tlbi5nZXQoZmllbGQpIG9yIDApLAogICAgICAgICAgICAgICAgZmxvYXQoc25hcF92YWx1ZSBvciAwKSwKICAgICAgICAgICAgICAgIGRyaWZ0LAogICAgICAgICAgICApCiAgICAgICAgbWVyZ2VkW2ZpZWxkXSA9IHNuYXBfdmFsdWUKCiAgICBpZiBzbmFwc2hvdC5nZXQoInBhaXJfYWRkcmVzcyIpOgogICAgICAgIG1lcmdlZFsicGFpcl9hZGRyZXNzIl0gPSBzbmFwc2hvdFsicGFpcl9hZGRyZXNzIl0KCiAgICAjIERleCBsaXZlIHNuYXBzaG90IGN1cnJlbnRseSBkb2VzIG5vdCBwcm92aWRlIGhvbGRlciBjb3VudDsgbWFyayBhcyB1bnZlcmlmaWVkLgogICAgbWVyZ2VkWyJob2xkZXJzX3ZlcmlmaWVkIl0gPSBib29sKHNuYXBzaG90LmdldCgiaG9sZGVycyIpKQogICAgaWYgbWVyZ2VkWyJob2xkZXJzX3ZlcmlmaWVkIl06CiAgICAgICAgbWVyZ2VkWyJob2xkZXJzIl0gPSBzbmFwc2hvdC5nZXQoImhvbGRlcnMiKQoKICAgIG1lcmdlZFsic291cmNlIl0gPSAiZGV4c2NyZWVuZXJfbGl2ZSIKICAgIHJldHVybiBtZXJnZWQKCgpkZWYgX2hvbGRlcnNfZm9yX2FsZXJ0KHRva2VuOiBkaWN0KToKICAgIGhvbGRlcnMgPSB0b2tlbi5nZXQoImhvbGRlcnMiKQogICAgaWYgbm90IEFMRVJUX0hJREVfVU5WRVJJRklFRF9IT0xERVJTOgogICAgICAgIHJldHVybiBob2xkZXJzCiAgICBpZiB0b2tlbi5nZXQoImhvbGRlcnNfdmVyaWZpZWQiKToKICAgICAgICByZXR1cm4gaG9sZGVycwogICAgcmV0dXJuICJOL0EiCgoKZGVmIF9nZXRfdGFjdGljYWxfdGVjaG5pY2Fscyh0b2tlbik6CiAgICBpZiBfbW9kZSgpICE9ICJ0YWN0aWNhbCIgb3Igbm90IFRBQ1RJQ0FMX0VOQUJMRV9SRUFMX1RFQ0hOSUNBTFM6CiAgICAgICAgcmV0dXJuIHt9CiAgICBhZGRyZXNzID0gdG9rZW4uZ2V0KCJhZGRyZXNzIikKICAgIGlmIG5vdCBhZGRyZXNzOgogICAgICAgIHJldHVybiB7fQoKICAgIG5vd190cyA9IGludCh0aW1lX21vZHVsZS50aW1lKCkpCiAgICBjYWNoZWQgPSBfdGFjdGljYWxfdGVjaF9jYWNoZS5nZXQoYWRkcmVzcykKICAgIGlmIGNhY2hlZCBhbmQgbm93X3RzIC0gY2FjaGVkWyJ0cyJdIDw9IFRBQ1RJQ0FMX1RFQ0hfQ0FDSEVfU0VDT05EUzoKICAgICAgICByZXR1cm4gY2FjaGVkWyJkYXRhIl0KCiAgICBjYW5kbGVzID0gZmV0Y2hfYmlyZGV5ZV9vaGxjdigKICAgICAgICBhZGRyZXNzPWFkZHJlc3MsCiAgICAgICAgY2FuZGxlX3R5cGU9VEFDVElDQUxfT0hMQ1ZfVFlQRSwKICAgICAgICBsb29rYmFja19ob3Vycz1UQUNUSUNBTF9PSExDVl9MT09LQkFDS19IT1VSUywKICAgICkKICAgIGNsb3NlX3ZhbHVlcyA9IGNsb3NlcyhjYW5kbGVzKQogICAgaWYgbGVuKGNsb3NlX3ZhbHVlcykgPCBtYXgoMzUsIFRBQ1RJQ0FMX1JTSV9QRVJJT0QgKyAyKToKICAgICAgICByZXR1cm4ge30KCiAgICByc2lfdmFsdWUgPSByc2koY2xvc2VfdmFsdWVzLCBwZXJpb2Q9VEFDVElDQUxfUlNJX1BFUklPRCkKICAgIG1hY2RfdmFsdWUgPSBtYWNkKGNsb3NlX3ZhbHVlcykKICAgIGlmIHJzaV92YWx1ZSBpcyBOb25lIG9yIG5vdCBtYWNkX3ZhbHVlOgogICAgICAgIHJldHVybiB7fQoKICAgIHNuYXBzaG90ID0gewogICAgICAgICJyc2kiOiBmbG9hdChyc2lfdmFsdWUpLAogICAgICAgICJtYWNkX2xpbmUiOiBmbG9hdChtYWNkX3ZhbHVlWyJtYWNkX2xpbmUiXSksCiAgICAgICAgIm1hY2Rfc2lnbmFsIjogZmxvYXQobWFjZF92YWx1ZVsibWFjZF9zaWduYWwiXSksCiAgICAgICAgIm1hY2RfaGlzdCI6IGZsb2F0KG1hY2RfdmFsdWVbIm1hY2RfaGlzdCJdKSwKICAgIH0KICAgIF90YWN0aWNhbF90ZWNoX2NhY2hlW2FkZHJlc3NdID0geyJ0cyI6IG5vd190cywgImRhdGEiOiBzbmFwc2hvdH0KICAgIHJldHVybiBzbmFwc2hvdAoKCmRlZiBfY29uZmlkZW5jZV9mcm9tX3Njb3JlKHNjb3JlKToKICAgIGlmIHNjb3JlID49IENPTkZJREVOQ0VfTUlOX0E6CiAgICAgICAgcmV0dXJuICJBIgogICAgaWYgc2NvcmUgPj0gQ09ORklERU5DRV9NSU5fQjoKICAgICAgICByZXR1cm4gIkIiCiAgICByZXR1cm4gIkMiCgoKZGVmIF9jb25maWRlbmNlX21lZXRzX3J1bGUoY29uZmlkZW5jZSwgbWluaW11bSk6CiAgICBtaW5pbXVtX3JhdyA9IHN0cihtaW5pbXVtIG9yICJCIikudXBwZXIoKQogICAgbWluaW11bV9ub3JtID0gbWluaW11bV9yYXcgaWYgbWluaW11bV9yYXcgaW4gX0NPTkZJREVOQ0VfT1JERVIgZWxzZSAiQiIKICAgIHJldHVybiBfQ09ORklERU5DRV9PUkRFUi5nZXQoY29uZmlkZW5jZSwgMCkgPj0gX0NPTkZJREVOQ0VfT1JERVJbbWluaW11bV9ub3JtXQoKCmRlZiBfY29uZmlkZW5jZV9tZWV0c19hbGVydF9ydWxlKGNvbmZpZGVuY2UpOgogICAgcmV0dXJuIF9jb25maWRlbmNlX21lZXRzX3J1bGUoY29uZmlkZW5jZSwgX3J1bnRpbWVbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0pCgoKZGVmIF9pc19zeW1ib2xfb25fY29vbGRvd24oc3ltYm9sOiBzdHIsIGNvb2xkb3duX2hvdXJzOiBpbnQgfCBmbG9hdCB8IE5vbmUgPSBOb25lKSAtPiBib29sOgogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGxhc3RfYWxlcnRfdHMgPSBnZXRfbGFzdF9hbGVydF90aW1lc3RhbXAoc3ltYm9sKQogICAgaWYgbm90IGxhc3RfYWxlcnRfdHM6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBlZmZlY3RpdmVfaG91cnMgPSBpbnQoY29vbGRvd25faG91cnMgaWYgY29vbGRvd25faG91cnMgaXMgbm90IE5vbmUgZWxzZSBfcnVudGltZVsiYWxlcnRfY29vbGRvd25faG91cnMiXSkKICAgIHJldHVybiAoZGF0ZXRpbWUudXRjbm93KCkgLSBsYXN0X2FsZXJ0X3RzKSA8IHRpbWVkZWx0YShob3Vycz1lZmZlY3RpdmVfaG91cnMpCgoKZGVmIF9hcHBseV9zeW1ib2xfY29udHJvbHMoc3ltYm9sOiBzdHIpOgogICAgaWYgbm90IFNZTUJPTF9DT05UUk9MX0VOQUJMRUQgb3Igbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gTm9uZQogICAgcmV0dXJuIGdldF9hY3RpdmVfc3ltYm9sX2NvbnRyb2woc3ltYm9sKQoKCmRlZiBfcmlza19nb3Zlcm5vcl9zdGF0dXMoKSAtPiB0dXBsZVtib29sLCBzdHJdOgogICAgaWYgR0xPQkFMX1RSQURJTkdfUEFVU0U6CiAgICAgICAgcmV0dXJuIEZhbHNlLCAiR0xPQkFMX1RSQURJTkdfUEFVU0UgZW5hYmxlZCIKICAgIGlmIG5vdCBFTkFCTEVfUklTS19HT1ZFUk5PUjoKICAgICAgICByZXR1cm4gVHJ1ZSwgIiIKCiAgICBub3cgPSBkYXRldGltZS51dGNub3coKQogICAgcGF1c2Vfc3RhdGUgPSBnZXRfcmlza19wYXVzZV9zdGF0ZSgpCiAgICBwYXVzZV91bnRpbCA9IHBhdXNlX3N0YXRlLmdldCgicGF1c2VfdW50aWwiKQogICAgaWYgcGF1c2VfdW50aWwgYW5kIHBhdXNlX3VudGlsID4gbm93OgogICAgICAgIHJldHVybiBGYWxzZSwgZiJSaXNrIHBhdXNlIGFjdGl2ZSB1bnRpbCB7cGF1c2VfdW50aWwuaXNvZm9ybWF0KCl9IgogICAgaWYgcGF1c2VfdW50aWwgYW5kIHBhdXNlX3VudGlsIDw9IG5vdzoKICAgICAgICBjbGVhcl9yaXNrX3BhdXNlKCkKCiAgICBzdHJlYWsgPSBnZXRfY29uc2VjdXRpdmVfbG9zaW5nX291dGNvbWVzXzRoKGxpbWl0PTEwMCkKICAgIGxhdGVzdF80aF9vdXRjb21lID0gZ2V0X2xhdGVzdF80aF9vdXRjb21lX3RpbWVzdGFtcCgpCiAgICByZWNlbnRfb3V0Y29tZV93aW5kb3cgPSBub3cgLSB0aW1lZGVsdGEoaG91cnM9TE9TU19TVFJFQUtfTE9PS0JBQ0tfSE9VUlMpCiAgICBpZiAoCiAgICAgICAgc3RyZWFrID49IE1BWF9DT05TRUNVVElWRV80SF9MT1NTRVMKICAgICAgICBhbmQgbGF0ZXN0XzRoX291dGNvbWUKICAgICAgICBhbmQgbGF0ZXN0XzRoX291dGNvbWUgPj0gcmVjZW50X291dGNvbWVfd2luZG93CiAgICApOgogICAgICAgIHJlYXNvbiA9IGYiTG9zcyBzdHJlYWsge3N0cmVha30gPj0ge01BWF9DT05TRUNVVElWRV80SF9MT1NTRVN9IgogICAgICAgIHNldF9yaXNrX3BhdXNlKExPU1NfU1RSRUFLX1BBVVNFX0hPVVJTLCByZWFzb24pCiAgICAgICAgcmV0dXJuIEZhbHNlLCByZWFzb24KCiAgICBhbGVydHNfMjRoID0gY291bnRfYWxlcnRzX3NpbmNlKGRhdGV0aW1lLnV0Y25vdygpIC0gdGltZWRlbHRhKGhvdXJzPTI0KSkKICAgIGlmIE1BWF9BTEVSVFNfUEVSX0RBWSA+IDAgYW5kIGFsZXJ0c18yNGggPj0gTUFYX0FMRVJUU19QRVJfREFZOgogICAgICAgIHJldHVybiBGYWxzZSwgZiJEYWlseSBhbGVydCBjYXAgcmVhY2hlZCAoe2FsZXJ0c18yNGh9L3tNQVhfQUxFUlRTX1BFUl9EQVl9KSIKCiAgICByZXR1cm4gVHJ1ZSwgIiIKCgpkZWYgX2NvbXB1dGVfcmVnaW1lKHRva2Vucyk6CiAgICBpZiBub3QgdG9rZW5zOgogICAgICAgIHJldHVybiB7InNjb3JlIjogMC4wLCAibGFiZWwiOiAiUklTS19PRkYiLCAiYnJlYWR0aF9wY3QiOiAwLjAsICJhdmdfY2hhbmdlXzI0aCI6IDAuMH0KCiAgICBjaGFuZ2VzID0gW2Zsb2F0KHQuZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkgZm9yIHQgaW4gdG9rZW5zXQogICAgcG9zaXRpdmVzID0gc3VtKDEgZm9yIHggaW4gY2hhbmdlcyBpZiB4ID4gMCkKICAgIGJyZWFkdGhfcGN0ID0gcG9zaXRpdmVzIC8gbGVuKGNoYW5nZXMpCiAgICBhdmdfY2hhbmdlID0gc3VtKGNoYW5nZXMpIC8gbGVuKGNoYW5nZXMpCgogICAgIyBCbGVuZCBkaXJlY3Rpb25hbCBicmVhZHRoIGFuZCBtZWFuIGNoYW5nZSBpbnRvIGEgMC0xMDAgcmVnaW1lIHNjb3JlLgogICAgcmVnaW1lX3Njb3JlID0gNTAuMCArIChhdmdfY2hhbmdlICogMi4wKSArICgoYnJlYWR0aF9wY3QgLSAwLjUpICogNDAuMCkKICAgIHJlZ2ltZV9zY29yZSA9IG1heCgwLjAsIG1pbigxMDAuMCwgcmVnaW1lX3Njb3JlKSkKCiAgICBpZiByZWdpbWVfc2NvcmUgPj0gNjU6CiAgICAgICAgbGFiZWwgPSAiUklTS19PTiIKICAgIGVsaWYgcmVnaW1lX3Njb3JlID49IDQ1OgogICAgICAgIGxhYmVsID0gIk5FVVRSQUwiCiAgICBlbHNlOgogICAgICAgIGxhYmVsID0gIlJJU0tfT0ZGIgoKICAgIHJldHVybiB7CiAgICAgICAgInNjb3JlIjogcmVnaW1lX3Njb3JlLAogICAgICAgICJsYWJlbCI6IGxhYmVsLAogICAgICAgICJicmVhZHRoX3BjdCI6IGJyZWFkdGhfcGN0LAogICAgICAgICJhdmdfY2hhbmdlXzI0aCI6IGF2Z19jaGFuZ2UsCiAgICB9CgoKZGVmIF9jb21wdXRlX3NvbF9yZWdpbWVfcHJveHkoKToKICAgIGlmIG5vdCBFTkFCTEVfU09MX1JFR0lNRV9MQVlFUjoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiZW5hYmxlZCI6IEZhbHNlLAogICAgICAgICAgICAiYXZhaWxhYmxlIjogRmFsc2UsCiAgICAgICAgICAgICJzeW1ib2wiOiAiU09MIiwKICAgICAgICAgICAgImNoYW5nZV8yNGgiOiAwLjAsCiAgICAgICAgICAgICJjaGFuZ2VfMWgiOiAwLjAsCiAgICAgICAgICAgICJwYWlyX2FkZHJlc3MiOiBOb25lLAogICAgICAgICAgICAibGlxdWlkaXR5IjogMC4wLAogICAgICAgIH0KCiAgICBzbmFwc2hvdCA9IGZldGNoX3NvbF9tYXJrZXRfcHJveHkoU09MX1JFR0lNRV9RVUVSWSkKICAgIGlmIG5vdCBzbmFwc2hvdDoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiZW5hYmxlZCI6IFRydWUsCiAgICAgICAgICAgICJhdmFpbGFibGUiOiBGYWxzZSwKICAgICAgICAgICAgInN5bWJvbCI6ICJTT0wiLAogICAgICAgICAgICAiY2hhbmdlXzI0aCI6IDAuMCwKICAgICAgICAgICAgImNoYW5nZV8xaCI6IDAuMCwKICAgICAgICAgICAgInBhaXJfYWRkcmVzcyI6IE5vbmUsCiAgICAgICAgICAgICJsaXF1aWRpdHkiOiAwLjAsCiAgICAgICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgImVuYWJsZWQiOiBUcnVlLAogICAgICAgICJhdmFpbGFibGUiOiBUcnVlLAogICAgICAgICJzeW1ib2wiOiBzbmFwc2hvdC5nZXQoInN5bWJvbCIpIG9yICJTT0wiLAogICAgICAgICJjaGFuZ2VfMjRoIjogZmxvYXQoc25hcHNob3QuZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCksCiAgICAgICAgImNoYW5nZV8xaCI6IGZsb2F0KHNuYXBzaG90LmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCksCiAgICAgICAgInBhaXJfYWRkcmVzcyI6IHNuYXBzaG90LmdldCgicGFpcl9hZGRyZXNzIiksCiAgICAgICAgImxpcXVpZGl0eSI6IGZsb2F0KHNuYXBzaG90LmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCksCiAgICB9CgoKZGVmIF9idWlsZF9tYXJrZXRfcG9saWN5KHJlZ2ltZSwgc29sX3Byb3h5KToKICAgIHBvbGljeSA9IHsKICAgICAgICAic3RhdGUiOiByZWdpbWUuZ2V0KCJsYWJlbCIsICJORVVUUkFMIiksCiAgICAgICAgImFsZXJ0X3RocmVzaG9sZCI6IGZsb2F0KF9ydW50aW1lWyJhbGVydF90aHJlc2hvbGQiXSksCiAgICAgICAgIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Ijogc3RyKF9ydW50aW1lWyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdKS51cHBlcigpLAogICAgICAgICJyZWdpbWVfbWluX3Njb3JlIjogZmxvYXQoX3J1bnRpbWVbInJlZ2ltZV9taW5fc2NvcmUiXSksCiAgICAgICAgIm1heF9hbGVydHNfcGVyX2N5Y2xlIjogbWF4KDEsIGludChNQVhfQUxFUlRTX1BFUl9DWUNMRSkpLAogICAgICAgICJtYXhfYWxlcnRzX3Blcl9kYXkiOiBpbnQoTUFYX0FMRVJUU19QRVJfREFZKSwKICAgICAgICAiYWxlcnRfY29vbGRvd25faG91cnMiOiBpbnQoX3J1bnRpbWVbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0pLAogICAgICAgICJoYXJkX2Jsb2NrIjogRmFsc2UsCiAgICAgICAgImhhcmRfYmxvY2tfcmVhc29uIjogIiIsCiAgICB9CgogICAgaWYgbm90IEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSOgogICAgICAgIHBvbGljeVsic3RhdGUiXSA9IHJlZ2ltZS5nZXQoImxhYmVsIiwgIk5FVVRSQUwiKQogICAgICAgIHJldHVybiBwb2xpY3kKCiAgICBzb2xfY2hhbmdlXzI0aCA9IGZsb2F0KHNvbF9wcm94eS5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgc29sX2NoYW5nZV8xaCA9IGZsb2F0KHNvbF9wcm94eS5nZXQoImNoYW5nZV8xaCIsIDApIG9yIDApCiAgICBicmVhZHRoID0gZmxvYXQocmVnaW1lLmdldCgiYnJlYWR0aF9wY3QiLCAwKSBvciAwKQogICAgcmVnaW1lX3Njb3JlID0gZmxvYXQocmVnaW1lLmdldCgic2NvcmUiLCAwKSBvciAwKQoKICAgIGlmICgKICAgICAgICBzb2xfY2hhbmdlXzI0aCA8PSBTT0xfRVhUUkVNRV9PRkZfQ0hBTkdFXzI0SAogICAgICAgIG9yIHNvbF9jaGFuZ2VfMWggPD0gU09MX0VYVFJFTUVfT0ZGX0NIQU5HRV8xSAogICAgKToKICAgICAgICBzdGF0ZSA9ICJFWFRSRU1FX1JJU0tfT0ZGIgogICAgZWxpZiBzb2xfY2hhbmdlXzI0aCA8PSBTT0xfUklTS19PRkZfQ0hBTkdFXzI0SCBvciByZWdpbWUuZ2V0KCJsYWJlbCIpID09ICJSSVNLX09GRiI6CiAgICAgICAgc3RhdGUgPSAiUklTS19PRkYiCiAgICBlbGlmICgKICAgICAgICBzb2xfY2hhbmdlXzI0aCA+PSBTT0xfUklTS19PTl9DSEFOR0VfMjRICiAgICAgICAgYW5kIGJyZWFkdGggPj0gU09MX0JSRUFEVEhfTUlOX0ZPUl9SSVNLX09OCiAgICAgICAgYW5kIHJlZ2ltZV9zY29yZSA+PSA0NQogICAgKToKICAgICAgICBzdGF0ZSA9ICJSSVNLX09OIgogICAgZWxzZToKICAgICAgICBzdGF0ZSA9ICJORVVUUkFMIgoKICAgIHBvbGljeVsic3RhdGUiXSA9IHN0YXRlCgogICAgaWYgc3RhdGUgaW4geyJSSVNLX09GRiIsICJFWFRSRU1FX1JJU0tfT0ZGIn06CiAgICAgICAgcG9saWN5WyJhbGVydF90aHJlc2hvbGQiXSA9IG1heChwb2xpY3lbImFsZXJ0X3RocmVzaG9sZCJdLCBmbG9hdChCRUFSSVNIX0FMRVJUX1RIUkVTSE9MRCkpCiAgICAgICAgcG9saWN5WyJyZWdpbWVfbWluX3Njb3JlIl0gPSBtYXgocG9saWN5WyJyZWdpbWVfbWluX3Njb3JlIl0sIGZsb2F0KEJFQVJJU0hfUkVHSU1FX01JTl9TQ09SRSkpCgogICAgICAgIGJlYXJpc2hfY29uZiA9IHN0cihCRUFSSVNIX01JTl9DT05GSURFTkNFX1RPX0FMRVJUKS51cHBlcigpCiAgICAgICAgaWYgYmVhcmlzaF9jb25mIG5vdCBpbiBfQ09ORklERU5DRV9PUkRFUjoKICAgICAgICAgICAgYmVhcmlzaF9jb25mID0gIkEiCiAgICAgICAgcG9saWN5WyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdID0gYmVhcmlzaF9jb25mCgogICAgICAgIGJlYXJpc2hfY3ljbGVfY2FwID0gbWF4KDEsIGludChCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0NZQ0xFKSkKICAgICAgICBwb2xpY3lbIm1heF9hbGVydHNfcGVyX2N5Y2xlIl0gPSBtaW4ocG9saWN5WyJtYXhfYWxlcnRzX3Blcl9jeWNsZSJdLCBiZWFyaXNoX2N5Y2xlX2NhcCkKCiAgICAgICAgYmVhcmlzaF9kYWlseV9jYXAgPSBpbnQoQkVBUklTSF9NQVhfQUxFUlRTX1BFUl9EQVkpCiAgICAgICAgaWYgYmVhcmlzaF9kYWlseV9jYXAgPiAwOgogICAgICAgICAgICBpZiBwb2xpY3lbIm1heF9hbGVydHNfcGVyX2RheSJdID4gMDoKICAgICAgICAgICAgICAgIHBvbGljeVsibWF4X2FsZXJ0c19wZXJfZGF5Il0gPSBtaW4ocG9saWN5WyJtYXhfYWxlcnRzX3Blcl9kYXkiXSwgYmVhcmlzaF9kYWlseV9jYXApCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwb2xpY3lbIm1heF9hbGVydHNfcGVyX2RheSJdID0gYmVhcmlzaF9kYWlseV9jYXAKCiAgICAgICAgcG9saWN5WyJhbGVydF9jb29sZG93bl9ob3VycyJdID0gbWF4KHBvbGljeVsiYWxlcnRfY29vbGRvd25faG91cnMiXSwgaW50KEJFQVJJU0hfQUxFUlRfQ09PTERPV05fSE9VUlMpKQoKICAgIGlmIHN0YXRlID09ICJFWFRSRU1FX1JJU0tfT0ZGIiBhbmQgRU5BQkxFX0VYVFJFTUVfUklTS19IQVJEX0JMT0NLOgogICAgICAgIHBvbGljeVsiaGFyZF9ibG9jayJdID0gVHJ1ZQogICAgICAgIHBvbGljeVsiaGFyZF9ibG9ja19yZWFzb24iXSA9ICgKICAgICAgICAgICAgZiJFWFRSRU1FX1JJU0tfT0ZGIHNvbDI0aD17c29sX2NoYW5nZV8yNGg6LjJmfSUgc29sMWg9e3NvbF9jaGFuZ2VfMWg6LjJmfSUiCiAgICAgICAgKQoKICAgIHJldHVybiBwb2xpY3kKCgpkZWYgX3Bhc3Nlc19saXZlX3B1c2hfZ2F0ZSh0b2tlbjogZGljdCwgcG9saWN5OiBkaWN0KSAtPiBib29sOgogICAgaWYgbm90IFRFTEVHUkFNX1BVU0hfU1RST05HX09OTFk6CiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBjb25mID0gc3RyKHRva2VuLmdldCgiY29uZmlkZW5jZSIpIG9yICJDIikudXBwZXIoKQogICAgbWluX2NvbmYgPSBzdHIoVEVMRUdSQU1fUFVTSF9NSU5fQ09ORklERU5DRSBvciAiQSIpLnVwcGVyKCkKICAgIGlmIG1pbl9jb25mIG5vdCBpbiBfQ09ORklERU5DRV9PUkRFUjoKICAgICAgICBtaW5fY29uZiA9ICJBIgogICAgaWYgX0NPTkZJREVOQ0VfT1JERVIuZ2V0KGNvbmYsIDEpIDwgX0NPTkZJREVOQ0VfT1JERVJbbWluX2NvbmZdOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIHNjb3JlID0gZmxvYXQodG9rZW4uZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICBiYXNlX3RocmVzaG9sZCA9IGZsb2F0KHBvbGljeS5nZXQoImFsZXJ0X3RocmVzaG9sZCIsIF9ydW50aW1lWyJhbGVydF90aHJlc2hvbGQiXSkgb3IgMCkKICAgIHJlcXVpcmVkX3Njb3JlID0gYmFzZV90aHJlc2hvbGQgKyBtYXgoMCwgaW50KFRFTEVHUkFNX1BVU0hfTUlOX1NDT1JFX0RFTFRBKSkKICAgIHJldHVybiBzY29yZSA+PSByZXF1aXJlZF9zY29yZQoKCmRlZiBfcGFpcl9hZ2VfaG91cnMocGFpcl9jcmVhdGVkX2F0KToKICAgIGlmIHBhaXJfY3JlYXRlZF9hdCBpcyBOb25lOgogICAgICAgIHJldHVybiBOb25lCiAgICB0cnk6CiAgICAgICAgdHMgPSBmbG9hdChwYWlyX2NyZWF0ZWRfYXQpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIHRzIDw9IDA6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgICMgRGV4U2NyZWVuZXIgbWF5IHByb3ZpZGUgbWlsbGlzZWNvbmRzLgogICAgaWYgdHMgPiAxXzAwMF8wMDBfMDAwXzAwMDoKICAgICAgICB0cyA9IHRzIC8gMTAwMC4wCiAgICB0cnk6CiAgICAgICAgY3JlYXRlZCA9IGRhdGV0aW1lLnV0Y2Zyb210aW1lc3RhbXAodHMpCiAgICBleGNlcHQgKE92ZXJmbG93RXJyb3IsIE9TRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiBOb25lCiAgICBhZ2UgPSAoZGF0ZXRpbWUudXRjbm93KCkgLSBjcmVhdGVkKS50b3RhbF9zZWNvbmRzKCkgLyAzNjAwLjAKICAgIGlmIGFnZSA8IDA6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHJldHVybiBhZ2UKCgpkZWYgX3J1bm5lcl9uYXJyYXRpdmVfbGFiZWwodG9rZW4pOgogICAgdGV4dCA9IGYie3Rva2VuLmdldCgnc3ltYm9sJywgJycpfSB7dG9rZW4uZ2V0KCduYW1lJywgJycpfSB7dG9rZW4uZ2V0KCdkZXNjcmlwdGlvbicsICcnKX0iLmxvd2VyKCkKICAgIGhpdHMgPSBba3cgZm9yIGt3IGluIE5FV19SVU5ORVJfTkFSUkFUSVZFX0tFWVdPUkRTIGlmIGt3IGFuZCBrdyBpbiB0ZXh0XQogICAgc29jaWFsX2xpbmtzID0gaW50KHRva2VuLmdldCgic29jaWFsX2xpbmtzIikgb3IgMCkKICAgIGlmIGxlbihoaXRzKSA+PSAyIGFuZCBzb2NpYWxfbGlua3MgPiAwOgogICAgICAgIHJldHVybiAiU3Ryb25nIiwgbGVuKGhpdHMpCiAgICBpZiBsZW4oaGl0cykgPj0gMSBvciBzb2NpYWxfbGlua3MgPiAwOgogICAgICAgIHJldHVybiAiRGV2ZWxvcGluZyIsIGxlbihoaXRzKQogICAgcmV0dXJuICJXZWFrIiwgbGVuKGhpdHMpCgoKZGVmIF9ydW5uZXJfeF9wcm94eV9sYWJlbCh0b2tlbik6CiAgICB0eG5zX2gxID0gaW50KHRva2VuLmdldCgidHhuc19oMSIpIG9yIDApCiAgICBzb2NpYWxfbGlua3MgPSBpbnQodG9rZW4uZ2V0KCJzb2NpYWxfbGlua3MiKSBvciAwKQogICAgYm9vc3RzX2FjdGl2ZSA9IGludCh0b2tlbi5nZXQoImJvb3N0c19hY3RpdmUiKSBvciAwKQogICAgaWYgdHhuc19oMSA+PSBtYXgoMjUwLCBORVdfUlVOTkVSX01JTl9UWE5TX0gxICogMikgb3IgKHNvY2lhbF9saW5rcyA+IDEgYW5kIGJvb3N0c19hY3RpdmUgPiAwKToKICAgICAgICByZXR1cm4gIkhpZ2giCiAgICBpZiB0eG5zX2gxID49IE5FV19SVU5ORVJfTUlOX1RYTlNfSDE6CiAgICAgICAgcmV0dXJuICJNZWRpdW0iCiAgICByZXR1cm4gIkxvdyIKCgpkZWYgX3J1bm5lcl93YXRjaF9lbnJpY2godG9rZW4pOgogICAgYWdlX2hvdXJzID0gX3BhaXJfYWdlX2hvdXJzKHRva2VuLmdldCgicGFpcl9jcmVhdGVkX2F0IikpCiAgICBpZiBhZ2VfaG91cnMgaXMgTm9uZSBvciBhZ2VfaG91cnMgPiBORVdfUlVOTkVSX01BWF9BR0VfSE9VUlM6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBtYXJrZXRfY2FwID0gdG9rZW4uZ2V0KCJtYXJrZXRfY2FwIikKICAgIGZkdiA9IHRva2VuLmdldCgiZmR2IikKICAgIGNhcF92YWx1ZSA9IG1hcmtldF9jYXAgaWYgaXNpbnN0YW5jZShtYXJrZXRfY2FwLCAoaW50LCBmbG9hdCkpIGFuZCBtYXJrZXRfY2FwID4gMCBlbHNlIGZkdgogICAgaWYgbm90IGlzaW5zdGFuY2UoY2FwX3ZhbHVlLCAoaW50LCBmbG9hdCkpIG9yIGNhcF92YWx1ZSA8IE5FV19SVU5ORVJfTUlOX01BUktFVF9DQVA6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgdHhuc19oMSA9IGludCh0b2tlbi5nZXQoInR4bnNfaDEiKSBvciAwKQogICAgc29jaWFsX2xpbmtzID0gaW50KHRva2VuLmdldCgic29jaWFsX2xpbmtzIikgb3IgMCkKICAgIGJvb3N0c19hY3RpdmUgPSBpbnQodG9rZW4uZ2V0KCJib29zdHNfYWN0aXZlIikgb3IgMCkKCiAgICBpZiBsaXF1aWRpdHkgPCBORVdfUlVOTkVSX01JTl9MSVFVSURJVFk6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIHZvbHVtZV8yNGggPCBORVdfUlVOTkVSX01JTl9WT0xVTUVfMjRIOgogICAgICAgIHJldHVybiBOb25lCiAgICBpZiBjaGFuZ2VfMjRoIDwgTkVXX1JVTk5FUl9NSU5fQ0hBTkdFXzI0SDoKICAgICAgICByZXR1cm4gTm9uZQogICAgaWYgdHhuc19oMSA8IE5FV19SVU5ORVJfTUlOX1RYTlNfSDE6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIE5FV19SVU5ORVJfUkVRVUlSRV9TT0NJQUxfTElOS1MgYW5kIHNvY2lhbF9saW5rcyA8PSAwOgogICAgICAgIHJldHVybiBOb25lCgogICAgbmFycmF0aXZlX2xhYmVsLCBrZXl3b3JkX2hpdHMgPSBfcnVubmVyX25hcnJhdGl2ZV9sYWJlbCh0b2tlbikKICAgIHhfcHJveHlfbGFiZWwgPSBfcnVubmVyX3hfcHJveHlfbGFiZWwodG9rZW4pCgogICAgd2F0Y2hfc2NvcmUgPSAwLjAKICAgIHdhdGNoX3Njb3JlICs9IDIwLjAgICMgZmlyc3QtZGF5IGFnZSBjb25kaXRpb24gcGFzc2VkCiAgICB3YXRjaF9zY29yZSArPSAyMC4wIGlmIGNhcF92YWx1ZSA+PSBORVdfUlVOTkVSX01JTl9NQVJLRVRfQ0FQIGVsc2UgMC4wCiAgICB3YXRjaF9zY29yZSArPSAyMC4wIGlmIHZvbHVtZV8yNGggPj0gTkVXX1JVTk5FUl9NSU5fVk9MVU1FXzI0SCBlbHNlIDAuMAogICAgd2F0Y2hfc2NvcmUgKz0gMTUuMCBpZiBsaXF1aWRpdHkgPj0gTkVXX1JVTk5FUl9NSU5fTElRVUlESVRZIGVsc2UgMC4wCiAgICB3YXRjaF9zY29yZSArPSBtaW4oMTUuMCwgKHR4bnNfaDEgLyBtYXgoMSwgTkVXX1JVTk5FUl9NSU5fVFhOU19IMSkpICogMTUuMCkKICAgIHdhdGNoX3Njb3JlICs9IG1pbig1LjAsIGtleXdvcmRfaGl0cyAqIDIuNSkKICAgIHdhdGNoX3Njb3JlICs9IDUuMCBpZiBzb2NpYWxfbGlua3MgPiAwIGVsc2UgMC4wCiAgICB3YXRjaF9zY29yZSArPSAzLjAgaWYgYm9vc3RzX2FjdGl2ZSA+IDAgZWxzZSAwLjAKICAgIHdhdGNoX3Njb3JlID0gbWluKDEwMC4wLCB3YXRjaF9zY29yZSkKICAgIGlmIHdhdGNoX3Njb3JlIDwgTkVXX1JVTk5FUl9NSU5fQUxFUlRfU0NPUkU6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBlbnJpY2hlZCA9IGRpY3QodG9rZW4pCiAgICByaXNrX3BsYW4sIHJvdGF0aW9uX3BsYW4gPSBfd2FsbGV0X2d1aWRhbmNlKCJXMyIpCiAgICBlbnJpY2hlZC51cGRhdGUoCiAgICAgICAgewogICAgICAgICAgICAiYWdlX2hvdXJzIjogYWdlX2hvdXJzLAogICAgICAgICAgICAid2F0Y2hfc2NvcmUiOiB3YXRjaF9zY29yZSwKICAgICAgICAgICAgInhfcHJveHlfbGFiZWwiOiB4X3Byb3h5X2xhYmVsLAogICAgICAgICAgICAibmFycmF0aXZlX2xhYmVsIjogbmFycmF0aXZlX2xhYmVsLAogICAgICAgICAgICAid2FsbGV0X2ZpdCI6ICJXMyIsCiAgICAgICAgICAgICJyaXNrX3BsYW4iOiByaXNrX3BsYW4sCiAgICAgICAgICAgICJyb3RhdGlvbl9wbGFuIjogcm90YXRpb25fcGxhbiwKICAgICAgICAgICAgIm5vdGUiOiAiV2F0Y2hsaXN0LW9ubHkgYWxlcnQuIEVhcmx5IHJ1bm5lciB0byBtb25pdG9yLCBub3QgYSBidXkgc2lnbmFsLiIsCiAgICAgICAgfQogICAgKQogICAgcmV0dXJuIGVucmljaGVkCgoKZGVmIF9ydW5uZXJfd2F0Y2hfb25fY29vbGRvd24oc3ltYm9sOiBzdHIpIC0+IGJvb2w6CiAgICBpZiBub3Qgc3ltYm9sOgogICAgICAgIHJldHVybiBUcnVlCiAgICBsYXN0X3NlbnQgPSBnZXRfbGFzdF9kZWNpc2lvbl90aW1lc3RhbXBfZm9yX3N5bWJvbCgKICAgICAgICBzeW1ib2wsCiAgICAgICAgWyJSVU5ORVJfV0FUQ0hfQUxFUlQiLCAiUlVOTkVSX1dBVENIX0RSWV9SVU4iXSwKICAgICkKICAgIGlmIG5vdCBsYXN0X3NlbnQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gKGRhdGV0aW1lLnV0Y25vdygpIC0gbGFzdF9zZW50KSA8IHRpbWVkZWx0YShob3Vycz1ORVdfUlVOTkVSX0NPT0xET1dOX0hPVVJTKQoKCiMg4pSA4pSAIExFR0FDWSBSRUNPVkVSWSBoZWxwZXJzIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAoKX1JFVkVSU0FMX1BBVFRFUk5TID0geyJmYWxsaW5nX3dlZGdlIiwgImRvdWJsZV9ib3R0b20iLCAiY3VwX2hhbmRsZSIsICJjdXBfYW5kX2hhbmRsZSIsICJyZXZlcnNhbCJ9CgoKZGVmIF9kZXRlY3RfbGVnYWN5X3JlY292ZXJ5KHRva2VuOiBkaWN0KSAtPiBkaWN0IHwgTm9uZToKICAgICIiIgogICAgUmV0dXJucyBhbiBlbnJpY2hlZCB0b2tlbiBkaWN0IGlmIGl0IHBhc3NlcyBhbGwgTEVHQUNZIFJFQ09WRVJZIGNyaXRlcmlhLAogICAgb3IgTm9uZSBpZiBpdCBmYWlscyBhbnkgZmlsdGVyLgoKICAgIENyaXRlcmlhOgogICAgICAtIGFnZSA+PSBMRUdBQ1lfUkVDT1ZFUllfTUlOX0FHRV9EQVlTIChkZWZhdWx0IDkwIGRheXMpCiAgICAgIC0gbGlxdWlkaXR5ID49IExFR0FDWV9SRUNPVkVSWV9NSU5fTElRVUlESVRZIChkZWZhdWx0ICQxTSkKICAgICAgLSB2b2x1bWVfMjRoID49IExFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SCAoZGVmYXVsdCAkNTAwSykKICAgICAgLSB2b2x1bWUgc3Bpa2U6IHR4bnNfaDEgPj0gTEVHQUNZX1JFQ09WRVJZX1ZPTFVNRV9TUElLRV9NVUxUSVBMSUVSIMOXICh0eG5zX2gyNC8yNCkKICAgICAgLSByZXZlcnNhbC10eXBlIHBhdHRlcm4gKGZhbGxpbmcgd2VkZ2UgLyBkb3VibGUgYm90dG9tIC8gY3VwICYgaGFuZGxlKQogICAgICAgIGluZmVycmVkIGZyb20gcHJpY2UgYWN0aW9uIHdoZW4gbm8gZXhwbGljaXQgcGF0dGVybiBmaWVsZCBwcmVzZW50CiAgICAiIiIKICAgIGFnZV9ob3VycyA9IF9wYWlyX2FnZV9ob3Vycyh0b2tlbi5nZXQoInBhaXJfY3JlYXRlZF9hdCIpKQogICAgbWluX2FnZV9ob3VycyA9IExFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVMgKiAyNC4wCiAgICBpZiBhZ2VfaG91cnMgaXMgTm9uZSBvciBhZ2VfaG91cnMgPCBtaW5fYWdlX2hvdXJzOgogICAgICAgIHJldHVybiBOb25lCgogICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW4uZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKQogICAgaWYgbGlxdWlkaXR5IDwgTEVHQUNZX1JFQ09WRVJZX01JTl9MSVFVSURJVFk6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGlmIHZvbHVtZV8yNGggPCBMRUdBQ1lfUkVDT1ZFUllfTUlOX1ZPTFVNRV8yNEg6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAjIFZvbHVtZSBzcGlrZTogY29tcGFyZSBsYXN0LWhvdXIgdHhuIHJhdGUgdnMgMjRoIGF2ZXJhZ2UgcmF0ZQogICAgdHhuc19oMSA9IGZsb2F0KHRva2VuLmdldCgidHhuc19oMSIsIDApIG9yIDApCiAgICB0eG5zX2gyNCA9IGZsb2F0KHRva2VuLmdldCgidHhuc19oMjQiLCAwKSBvciAwKQogICAgYXZnX2hvdXJseSA9IHR4bnNfaDI0IC8gMjQuMCBpZiB0eG5zX2gyNCA+IDAgZWxzZSAwLjAKICAgIGhhc192b2x1bWVfc3Bpa2UgPSBhdmdfaG91cmx5ID4gMCBhbmQgdHhuc19oMSA+PSBMRUdBQ1lfUkVDT1ZFUllfVk9MVU1FX1NQSUtFX01VTFRJUExJRVIgKiBhdmdfaG91cmx5CgogICAgIyBSZXZlcnNhbCBwYXR0ZXJuIGRldGVjdGlvbgogICAgcGF0dGVybl9zZXR1cCA9IHRva2VuLmdldCgicGF0dGVybl9zZXR1cCIpCiAgICBleHBsaWNpdF9wYXR0ZXJuID0gIiIKICAgIGlmIGlzaW5zdGFuY2UocGF0dGVybl9zZXR1cCwgZGljdCk6CiAgICAgICAgZXhwbGljaXRfcGF0dGVybiA9IHN0cihwYXR0ZXJuX3NldHVwLmdldCgicGF0dGVybiIsICIiKSBvciAiIikubG93ZXIoKS5yZXBsYWNlKCIgIiwgIl8iKQogICAgZWxpZiBpc2luc3RhbmNlKHBhdHRlcm5fc2V0dXAsIHN0cik6CiAgICAgICAgZXhwbGljaXRfcGF0dGVybiA9IHBhdHRlcm5fc2V0dXAubG93ZXIoKS5yZXBsYWNlKCIgIiwgIl8iKQoKICAgIGhhc19yZXZlcnNhbF9wYXR0ZXJuID0gZXhwbGljaXRfcGF0dGVybiBpbiBfUkVWRVJTQUxfUEFUVEVSTlMKCiAgICAjIEluZmVyIHJldmVyc2FsIGZyb20gcHJpY2UgYWN0aW9uIHdoZW4gbm8gZXhwbGljaXQgcGF0dGVybjoKICAgICMgQSBkZWNsaW5pbmcgMjRoIGJ1dCBwb3NpdGl2ZSBvciByZWNvdmVyaW5nIDFoIHN1Z2dlc3RzIHBvdGVudGlhbCByZXZlcnNhbCBiYXNlCiAgICBpZiBub3QgaGFzX3JldmVyc2FsX3BhdHRlcm46CiAgICAgICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICAgICAgY2hhbmdlXzFoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMWgiLCAwKSBvciAwKQogICAgICAgIGNoYW5nZV82aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzZoIiwgMCkgb3IgMCkKICAgICAgICAjIERvdWJsZS1ib3R0b20gLyBmYWxsaW5nLXdlZGdlIHByb3h5OiBjb2luIHdhcyBkb3duIDI0aCBidXQgMWggaXMgcmVjb3ZlcmluZwogICAgICAgIGlmIC00MC4wIDwgY2hhbmdlXzI0aCA8IC01LjAgYW5kIGNoYW5nZV8xaCA+IDEuNToKICAgICAgICAgICAgaGFzX3JldmVyc2FsX3BhdHRlcm4gPSBUcnVlCiAgICAgICAgICAgIGV4cGxpY2l0X3BhdHRlcm4gPSAiZG91YmxlX2JvdHRvbSIKICAgICAgICAjIEN1cC1hbmQtaGFuZGxlIHByb3h5OiBtb2Rlc3QgMjRoIGRlY2xpbmUgYnV0IDZoIGFuZCAxaCBib3RoIHJlY292ZXJpbmcKICAgICAgICBlbGlmIC0yMC4wIDwgY2hhbmdlXzI0aCA8IDAgYW5kIGNoYW5nZV82aCA+IDAgYW5kIGNoYW5nZV8xaCA+IDAuNToKICAgICAgICAgICAgaGFzX3JldmVyc2FsX3BhdHRlcm4gPSBUcnVlCiAgICAgICAgICAgIGV4cGxpY2l0X3BhdHRlcm4gPSAiY3VwX2hhbmRsZSIKCiAgICBpZiBub3QgaGFzX3JldmVyc2FsX3BhdHRlcm46CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBpZiBub3QgaGFzX3ZvbHVtZV9zcGlrZToKICAgICAgICByZXR1cm4gTm9uZQoKICAgICMgTWFwIGludGVybmFsIHBhdHRlcm4ga2V5IHRvIGh1bWFuIGxhYmVsCiAgICBfcGF0dGVybl9sYWJlbHMgPSB7CiAgICAgICAgImZhbGxpbmdfd2VkZ2UiOiAiRmFsbGluZyBXZWRnZSIsCiAgICAgICAgImRvdWJsZV9ib3R0b20iOiAiRG91YmxlIEJvdHRvbSIsCiAgICAgICAgImN1cF9oYW5kbGUiOiAiQ3VwICYgSGFuZGxlIiwKICAgICAgICAiY3VwX2FuZF9oYW5kbGUiOiAiQ3VwICYgSGFuZGxlIiwKICAgICAgICAicmV2ZXJzYWwiOiAiUmV2ZXJzYWwiLAogICAgfQogICAgcGF0dGVybl9sYWJlbCA9IF9wYXR0ZXJuX2xhYmVscy5nZXQoZXhwbGljaXRfcGF0dGVybiwgIlJldmVyc2FsIikKICAgIHBhdHRlcm5fc3RhdHVzID0gIkNvbmZpcm1lZCIgaWYgdHhuc19oMSA+PSBhdmdfaG91cmx5ICogMyBlbHNlICJGb3JtaW5nIgogICAgYWdlX2RheXMgPSBhZ2VfaG91cnMgLyAyNC4wCgogICAgcmV0dXJuIHsKICAgICAgICAqKnRva2VuLAogICAgICAgICJhZ2VfZGF5cyI6IGFnZV9kYXlzLAogICAgICAgICJwYXR0ZXJuX2xhYmVsIjogcGF0dGVybl9sYWJlbCwKICAgICAgICAicGF0dGVybl9zdGF0dXMiOiBwYXR0ZXJuX3N0YXR1cywKICAgIH0KCgpkZWYgX2xlZ2FjeV9yZWNvdmVyeV9vbl9jb29sZG93bihzeW1ib2w6IHN0cikgLT4gYm9vbDoKICAgIGlmIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuIFRydWUKICAgIGxhc3Rfc2VudCA9IGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sKAogICAgICAgIHN5bWJvbCwKICAgICAgICBbIkxFR0FDWV9SRUNPVkVSWV9BTEVSVCIsICJMRUdBQ1lfUkVDT1ZFUllfRFJZX1JVTiJdLAogICAgKQogICAgaWYgbm90IGxhc3Rfc2VudDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiAoZGF0ZXRpbWUudXRjbm93KCkgLSBsYXN0X3NlbnQpIDwgdGltZWRlbHRhKGhvdXJzPUxFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9IT1VSUykKCgpkZWYgX2xvYWRfd2F0Y2hsaXN0X3N0YXRlKCk6CiAgICBnbG9iYWwgX3dhdGNobGlzdF9zdGF0ZQogICAgaWYgbm90IF9XQVRDSExJU1RfU1RBVEVfUEFUSC5leGlzdHMoKToKICAgICAgICBfd2F0Y2hsaXN0X3N0YXRlID0geyJzdGF0dXNlcyI6IHt9fQogICAgICAgIHJldHVybgogICAgdHJ5OgogICAgICAgIHJhdyA9IGpzb24ubG9hZHMoX1dBVENITElTVF9TVEFURV9QQVRILnJlYWRfdGV4dCgpKQogICAgICAgIHN0YXR1c2VzID0gcmF3LmdldCgic3RhdHVzZXMiKQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHN0YXR1c2VzLCBkaWN0KToKICAgICAgICAgICAgc3RhdHVzZXMgPSB7fQogICAgICAgIF93YXRjaGxpc3Rfc3RhdGUgPSB7InN0YXR1c2VzIjoge3N0cihrKS51cHBlcigpOiBzdHIodikgZm9yIGssIHYgaW4gc3RhdHVzZXMuaXRlbXMoKX19CiAgICBleGNlcHQgKFZhbHVlRXJyb3IsIE9TRXJyb3IpOgogICAgICAgIF93YXRjaGxpc3Rfc3RhdGUgPSB7InN0YXR1c2VzIjoge319CgoKZGVmIF9zYXZlX3dhdGNobGlzdF9zdGF0ZSgpOgogICAgdHJ5OgogICAgICAgIF9XQVRDSExJU1RfU1RBVEVfUEFUSC5wYXJlbnQubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgIF9XQVRDSExJU1RfU1RBVEVfUEFUSC53cml0ZV90ZXh0KGpzb24uZHVtcHMoX3dhdGNobGlzdF9zdGF0ZSwgaW5kZW50PTIpKQogICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgbG9nZ2luZy53YXJuaW5nKCJGYWlsZWQgdG8gcGVyc2lzdCB3YXRjaGxpc3Qgc3RhdGUgYXQgJXMiLCBfV0FUQ0hMSVNUX1NUQVRFX1BBVEgpCgoKZGVmIF93YXRjaGxpc3Rfc3RhdHVzX2Zvcl90b2tlbih0b2tlbjogZGljdCk6CiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8xaCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV82aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzZoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMC4wCgogICAgaWYgbGlxdWlkaXR5IDwgV0FUQ0hMSVNUX01JTl9MSVFVSURJVFkgb3Igdm9sdW1lXzI0aCA8IFdBVENITElTVF9NSU5fVk9MVU1FXzI0SDoKICAgICAgICByZXR1cm4gIklsbGlxdWlkIiwgKAogICAgICAgICAgICBmIkxpcXVpZGl0eS92b2x1bWUgYmVsb3cgd2F0Y2ggZmxvb3IgIgogICAgICAgICAgICBmIigke1dBVENITElTVF9NSU5fTElRVUlESVRZOiwuMGZ9LyR7V0FUQ0hMSVNUX01JTl9WT0xVTUVfMjRIOiwuMGZ9KS4iCiAgICAgICAgKQoKICAgIGlmIGNoYW5nZV8yNGggPj0gMTIgYW5kIGNoYW5nZV82aCA+PSA0IGFuZCBjaGFuZ2VfMWggPj0gMSBhbmQgdm9sX3RvX2xpcSA+PSAwLjM1OgogICAgICAgIHJldHVybiAiTW9tZW50dW0iLCAiTXVsdGktdGltZWZyYW1lIHN0cmVuZ3RoIHdpdGggc3VzdGFpbmVkIHR1cm5vdmVyLiIKICAgIGlmIGNoYW5nZV8yNGggPj0gMiBhbmQgY2hhbmdlXzZoIDw9IC0yIGFuZCBjaGFuZ2VfMWggPj0gMC44IGFuZCB2b2xfdG9fbGlxID49IDAuMjA6CiAgICAgICAgcmV0dXJuICJSZWNsYWltIiwgIlNob3J0LXRlcm0gcmVjbGFpbSBhZnRlciBwdWxsYmFjazsgYnV5ZXJzIHN0ZXBwaW5nIGJhY2sgaW4uIgogICAgaWYgY2hhbmdlXzFoIDw9IC0yLjUgYW5kIGNoYW5nZV82aCA8PSAtNjoKICAgICAgICByZXR1cm4gIkJyZWFrZG93biIsICJEb3duc2lkZSBwcmVzc3VyZSBhY2NlbGVyYXRpbmc7IHN0cnVjdHVyZSBsaWtlbHkgd2Vha2VuaW5nLiIKICAgIGlmIGFicyhjaGFuZ2VfMWgpIDw9IDEuMiBhbmQgYWJzKGNoYW5nZV82aCkgPD0gNCBhbmQgYWJzKGNoYW5nZV8yNGgpIDw9IDEyOgogICAgICAgIHJldHVybiAiUmFuZ2UiLCAiUmFuZ2UtYm91bmQgY29uZGl0aW9ucyB3aXRoIG5vIGNvbmZpcm1lZCBicmVhay4iCiAgICByZXR1cm4gIlZvbGF0aWxlIiwgIk1peGVkIHRhcGU7IG1vbWVudHVtIGFuZCBtZWFuLXJldmVyc2lvbiBzaWduYWxzIGNvbmZsaWN0LiIKCgpkZWYgX3dhdGNobGlzdF9vcHBvcnR1bml0eV90YWdzKHRva2VuOiBkaWN0LCBzdGF0dXM6IHN0cik6CiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8xaCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgdHhuc19oMSA9IGludCh0b2tlbi5nZXQoInR4bnNfaDEiKSBvciAwKQogICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMC4wCgogICAgdXBzaWRlX3BvaW50cyA9IDAuMAogICAgcmlza19wb2ludHMgPSAwLjAKICAgIHMgPSBzdHIoc3RhdHVzIG9yICIiKS50aXRsZSgpCgogICAgaWYgcyA9PSAiTW9tZW50dW0iOgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMi4wCiAgICBlbGlmIHMgPT0gIlJlY2xhaW0iOgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMS41CiAgICBlbGlmIHMgPT0gIkJyZWFrZG93biI6CiAgICAgICAgcmlza19wb2ludHMgKz0gMi41CiAgICBlbGlmIHMgPT0gIklsbGlxdWlkIjoKICAgICAgICByaXNrX3BvaW50cyArPSAzLjAKICAgIGVsaWYgcyA9PSAiVm9sYXRpbGUiOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuNQoKICAgIGlmIGNoYW5nZV8yNGggPj0gMTI6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAyLjAKICAgIGVsaWYgY2hhbmdlXzI0aCA+PSA1OgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMS4wCiAgICBlbGlmIGNoYW5nZV8yNGggPD0gLTEwOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuNQoKICAgIGlmIGNoYW5nZV8xaCA+PSAxLjA6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAxLjAKICAgIGVsaWYgY2hhbmdlXzFoIDw9IC0yLjA6CiAgICAgICAgcmlza19wb2ludHMgKz0gMS4yCgogICAgaWYgdHhuc19oMSA+PSAzMDA6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAxLjAKICAgIGVsaWYgdHhuc19oMSA+PSAxNTA6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAwLjUKCiAgICBpZiBsaXF1aWRpdHkgPj0gNzUwXzAwMDoKICAgICAgICB1cHNpZGVfcG9pbnRzICs9IDEuMAogICAgZWxpZiBsaXF1aWRpdHkgPCAyNTBfMDAwOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuMgoKICAgIGlmIHZvbHVtZV8yNGggPj0gMV81MDBfMDAwOgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMS4wCgogICAgaWYgdm9sX3RvX2xpcSA+IDIuMDoKICAgICAgICByaXNrX3BvaW50cyArPSAxLjUKICAgIGVsaWYgdm9sX3RvX2xpcSA+IDEuMDoKICAgICAgICByaXNrX3BvaW50cyArPSAxLjAKCiAgICBpZiBhYnMoY2hhbmdlXzI0aCkgPiAzNToKICAgICAgICByaXNrX3BvaW50cyArPSAxLjAKCiAgICBpZiB1cHNpZGVfcG9pbnRzID49IDUuMDoKICAgICAgICB1cHNpZGVfbGFiZWwgPSAiSGlnaCIKICAgIGVsaWYgdXBzaWRlX3BvaW50cyA+PSAzLjA6CiAgICAgICAgdXBzaWRlX2xhYmVsID0gIk1lZGl1bSIKICAgIGVsc2U6CiAgICAgICAgdXBzaWRlX2xhYmVsID0gIkxvdyIKCiAgICBpZiByaXNrX3BvaW50cyA+PSA0LjU6CiAgICAgICAgcmlza19sYWJlbCA9ICJIaWdoIgogICAgZWxpZiByaXNrX3BvaW50cyA+PSAyLjU6CiAgICAgICAgcmlza19sYWJlbCA9ICJNZWRpdW0iCiAgICBlbHNlOgogICAgICAgIHJpc2tfbGFiZWwgPSAiTG93IgoKICAgIHJldHVybiB1cHNpZGVfbGFiZWwsIHJpc2tfbGFiZWwKCgpkZWYgX3dhbGxldF9maXRfZm9yX21haW5fdG9rZW4odG9rZW46IGRpY3QsIHJlZ2ltZTogZGljdCwgcG9saWN5OiBkaWN0KSAtPiBzdHI6CiAgICBzY29yZSA9IGZsb2F0KHRva2VuLmdldCgic2NvcmUiLCAwKSBvciAwKQogICAgY29uZmlkZW5jZSA9IHN0cih0b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpKS51cHBlcigpCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBhYnMoZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkpCiAgICByZWdpbWVfc2NvcmUgPSBmbG9hdChyZWdpbWUuZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICBzdGF0ZSA9IHN0cihwb2xpY3kuZ2V0KCJzdGF0ZSIpIG9yICIiKQoKICAgIGlmICgKICAgICAgICBjb25maWRlbmNlID09ICJBIgogICAgICAgIGFuZCBzY29yZSA+PSBtYXgoODguMCwgZmxvYXQocG9saWN5LmdldCgiYWxlcnRfdGhyZXNob2xkIiwgNzApKSArIDYuMCkKICAgICAgICBhbmQgbGlxdWlkaXR5ID49IDJfMDAwXzAwMAogICAgICAgIGFuZCB2b2x1bWVfMjRoID49IDFfMjAwXzAwMAogICAgICAgIGFuZCBjaGFuZ2VfMjRoIDw9IDI1CiAgICAgICAgYW5kIHJlZ2ltZV9zY29yZSA+PSA1NQogICAgICAgIGFuZCBzdGF0ZSBpbiB7IlJJU0tfT04iLCAiTkVVVFJBTCJ9CiAgICApOgogICAgICAgIHJldHVybiAiVzEvVzIiCgogICAgaWYgKAogICAgICAgIF9jb25maWRlbmNlX21lZXRzX3J1bGUoY29uZmlkZW5jZSwgIkEiKQogICAgICAgIGFuZCBzY29yZSA+PSBmbG9hdChwb2xpY3kuZ2V0KCJhbGVydF90aHJlc2hvbGQiLCA3MCkpCiAgICAgICAgYW5kIGxpcXVpZGl0eSA+PSA3MDBfMDAwCiAgICAgICAgYW5kIHZvbHVtZV8yNGggPj0gMjUwXzAwMAogICAgKToKICAgICAgICByZXR1cm4gIlcyIgoKICAgIHJldHVybiAiVzMiCgoKZGVmIF93YWxsZXRfZ3VpZGFuY2Uod2FsbGV0X2ZpdDogc3RyKToKICAgIGZpdCA9IHN0cih3YWxsZXRfZml0IG9yICJXMiIpLnVwcGVyKCkKICAgIGlmIGZpdCA9PSAiVzEvVzIiOgogICAgICAgIHJpc2sgPSAiVGllcmVkIGVudHJpZXMgfCBhdm9pZCBjaGFzaW5nID4xNSUgY2FuZGxlcyB8IHRoZXNpcyBzdG9wIG9ubHkiCiAgICAgICAgcm90YXRpb24gPSAiVGFrZSBwYXJ0aWFscyBpbnRvIFcxIHN0YWtpbmcvVVNEQyB3aGlsZSBwcmVzZXJ2aW5nIGNvcmUiCiAgICAgICAgcmV0dXJuIHJpc2ssIHJvdGF0aW9uCiAgICBpZiBmaXQgPT0gIlcyIjoKICAgICAgICBwYiA9IF9XQUxMRVRfUExBWUJPT0tbIlcyIl0KICAgICAgICByZXR1cm4gcGJbInJpc2tfcGxhbiJdLCBwYlsicm90YXRpb25fcGxhbiJdCiAgICBwYiA9IF9XQUxMRVRfUExBWUJPT0tbIlczIl0KICAgIHJldHVybiBwYlsicmlza19wbGFuIl0sIHBiWyJyb3RhdGlvbl9wbGFuIl0KCgpkZWYgX3dhbGxldF9oZWFkZXIod2FsbGV0X2lkOiBzdHIpIC0+IHN0cjoKICAgIHBiID0gX1dBTExFVF9QTEFZQk9PSy5nZXQod2FsbGV0X2lkLCBfV0FMTEVUX1BMQVlCT09LWyJXMiJdKQogICAgcmV0dXJuICgKICAgICAgICBmInt3YWxsZXRfaWR9IHwge3BiWyduYW1lJ119XG4iCiAgICAgICAgZiJQb3NpdGlvbjoge3BiWydwb3NpdGlvbl9oaW50J119XG4iCiAgICAgICAgZiJSaXNrOiB7cGJbJ3Jpc2tfcGxhbiddfVxuIgogICAgICAgIGYiUm90YXRpb246IHtwYlsncm90YXRpb25fcGxhbiddfSIKICAgICkKCgpkZWYgX3dhdGNobGlzdF9vbl9jb29sZG93bihzeW1ib2w6IHN0cikgLT4gYm9vbDoKICAgIGlmIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBsYXN0X3NlbnQgPSBnZXRfbGFzdF9kZWNpc2lvbl90aW1lc3RhbXBfZm9yX3N5bWJvbCgKICAgICAgICBzeW1ib2wsCiAgICAgICAgWyJXQVRDSExJU1RfQUxFUlQiLCAiV0FUQ0hMSVNUX0FMRVJUX0RSWV9SVU4iXSwKICAgICkKICAgIGlmIG5vdCBsYXN0X3NlbnQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gKGRhdGV0aW1lLnV0Y25vdygpIC0gbGFzdF9zZW50KSA8IHRpbWVkZWx0YShob3Vycz1XQVRDSExJU1RfQUxFUlRfQ09PTERPV05fSE9VUlMpCgoKZGVmIF9idWlsZF93YXRjaGxpc3Rfcm93cygpOgogICAgcm93cyA9IFtdCiAgICBpZiBub3QgV0FUQ0hMSVNUX0VOVFJJRVM6CiAgICAgICAgcmV0dXJuIHJvd3MKCiAgICBmb3IgZW50cnkgaW4gV0FUQ0hMSVNUX0VOVFJJRVM6CiAgICAgICAgY29uZmlndXJlZF9zeW1ib2wgPSBzdHIoZW50cnkuZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgICAgIGFkZHJlc3MgPSBzdHIoZW50cnkuZ2V0KCJhZGRyZXNzIikgb3IgIiIpLnN0cmlwKCkKICAgICAgICBpZiBub3QgYWRkcmVzczoKICAgICAgICAgICAgY29udGludWUKICAgICAgICBzeW1ib2wgPSBjb25maWd1cmVkX3N5bWJvbCBvciAiVU5LTk9XTiIKICAgICAgICBwcmV2aW91c19zdGF0dXMgPSBzdHIoX3dhdGNobGlzdF9zdGF0ZS5nZXQoInN0YXR1c2VzIiwge30pLmdldChzeW1ib2wpIG9yICIiKQoKICAgICAgICBzbmFwc2hvdCA9IGZldGNoX2RleHNjcmVlbmVyX3Rva2VuX3NuYXBzaG90KGFkZHJlc3MpCiAgICAgICAgaWYgbm90IHNuYXBzaG90OgogICAgICAgICAgICByaXNrX3BsYW4sIHJvdGF0aW9uX3BsYW4gPSBfd2FsbGV0X2d1aWRhbmNlKCJXMyIpCiAgICAgICAgICAgIHJvd3MuYXBwZW5kKAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgImFkZHJlc3MiOiBhZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiBwcmV2aW91c19zdGF0dXMgb3IgIk5vRGF0YSIsCiAgICAgICAgICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgICAgICAgICAgIkxpdmUgZGF0YSB1bmF2YWlsYWJsZTsgc2hvd2luZyBsYXN0IGtub3duIHN0YXR1cy4iCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHByZXZpb3VzX3N0YXR1cwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlICJObyBsaXZlIERleFNjcmVlbmVyIHBhaXIgZm91bmQuIgogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgImVsaWdpYmxlIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImhhc19saXZlX2RhdGEiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAid2FsbGV0X2ZpdCI6ICJXMyIsCiAgICAgICAgICAgICAgICAgICAgInJpc2tfcGxhbiI6IHJpc2tfcGxhbiwKICAgICAgICAgICAgICAgICAgICAicm90YXRpb25fcGxhbiI6IHJvdGF0aW9uX3BsYW4sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgcm93ID0gZGljdChzbmFwc2hvdCkKICAgICAgICBpZiBjb25maWd1cmVkX3N5bWJvbCBhbmQgY29uZmlndXJlZF9zeW1ib2wgIT0gIldBVENIIjoKICAgICAgICAgICAgcm93WyJzeW1ib2wiXSA9IGNvbmZpZ3VyZWRfc3ltYm9sCiAgICAgICAgc3RhdHVzLCByZWFzb24gPSBfd2F0Y2hsaXN0X3N0YXR1c19mb3JfdG9rZW4ocm93KQogICAgICAgIHVwc2lkZSwgcmlzayA9IF93YXRjaGxpc3Rfb3Bwb3J0dW5pdHlfdGFncyhyb3csIHN0YXR1cykKICAgICAgICByb3dbInN0YXR1cyJdID0gc3RhdHVzCiAgICAgICAgcm93WyJyZWFzb24iXSA9IHJlYXNvbgogICAgICAgIHJvd1sidXBzaWRlX3BvdGVudGlhbCJdID0gdXBzaWRlCiAgICAgICAgcm93WyJmYWlsdXJlX3Jpc2siXSA9IHJpc2sKICAgICAgICByb3dbImVsaWdpYmxlIl0gPSBzdGF0dXMgIT0gIklsbGlxdWlkIgogICAgICAgIHJvd1siaGFzX2xpdmVfZGF0YSJdID0gVHJ1ZQogICAgICAgIHJvd1sid2FsbGV0X2ZpdCJdID0gIlczIgogICAgICAgIHJpc2tfcGxhbiwgcm90YXRpb25fcGxhbiA9IF93YWxsZXRfZ3VpZGFuY2UoIlczIikKICAgICAgICByb3dbInJpc2tfcGxhbiJdID0gcmlza19wbGFuCiAgICAgICAgcm93WyJyb3RhdGlvbl9wbGFuIl0gPSByb3RhdGlvbl9wbGFuCiAgICAgICAgcm93cy5hcHBlbmQocm93KQoKICAgIHJldHVybiByb3dzCgoKYXN5bmMgZGVmIHNlbmRfd2F0Y2hsaXN0X3N1bW1hcnkoY29udGV4dCk6CiAgICByb3dzID0gX2J1aWxkX3dhdGNobGlzdF9yb3dzKCkKICAgIGlmIG5vdCByb3dzOgogICAgICAgIHJldHVybgogICAgbWVzc2FnZSA9IGZvcm1hdF93YXRjaGxpc3Rfc3VtbWFyeShyb3dzKQogICAgaWYgRFJZX1JVTjoKICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gV2F0Y2hsaXN0IHN1bW1hcnkgbm90IHNlbnQuXG4lcyIsIG1lc3NhZ2UpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgdGV4dD1tZXNzYWdlLAogICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgKQogICAgbG9nX3NpZ25hbCgKICAgICAgICB7CiAgICAgICAgICAgICJzeW1ib2wiOiAiV0FUQ0hMSVNUIiwKICAgICAgICAgICAgImRlY2lzaW9uIjogIldBVENITElTVF9TVU1NQVJZIiwKICAgICAgICAgICAgIm5vdGVzIjogZiJyb3dzPXtsZW4ocm93cyl9IiwKICAgICAgICB9CiAgICApCgoKYXN5bmMgZGVmIHJ1bl93YXRjaGxpc3RfbGFuZShjb250ZXh0KToKICAgIGlmIG5vdCBXQVRDSExJU1RfTEFORV9FTkFCTEVEIG9yIG5vdCBXQVRDSExJU1RfRU5UUklFUzoKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBwcmludCgiUnVubmluZyB3YXRjaGxpc3QgbGFuZSBzY2FuLi4uIikKICAgICAgICByb3dzID0gX2J1aWxkX3dhdGNobGlzdF9yb3dzKCkKICAgICAgICBpZiBub3Qgcm93czoKICAgICAgICAgICAgcHJpbnQoIldhdGNobGlzdCBsYW5lOiBubyByb3dzLiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICByb3dzLnNvcnQoCiAgICAgICAgICAgIGtleT1sYW1iZGEgcjogKAogICAgICAgICAgICAgICAgc3RyKHIuZ2V0KCJzdGF0dXMiLCAiIikpIG5vdCBpbiBzZXQoV0FUQ0hMSVNUX0FMRVJUX1NUQVRVU0VTKSwKICAgICAgICAgICAgICAgIC0oZmxvYXQoci5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKSksCiAgICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIGFsZXJ0c19zZW50ID0gMAogICAgICAgIG1heF9wZXJfY3ljbGUgPSBtYXgoMSwgV0FUQ0hMSVNUX01BWF9BTEVSVFNfUEVSX0NZQ0xFKQogICAgICAgIG5vX2RhdGFfY291bnQgPSAwCgogICAgICAgIGZvciByb3cgaW4gcm93czoKICAgICAgICAgICAgc3ltYm9sID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgICAgICBzdGF0dXMgPSBzdHIocm93LmdldCgic3RhdHVzIikgb3IgIlVua25vd24iKS50aXRsZSgpCiAgICAgICAgICAgIGhhc19saXZlX2RhdGEgPSBib29sKHJvdy5nZXQoImhhc19saXZlX2RhdGEiLCBUcnVlKSkKICAgICAgICAgICAgaWYgbm90IGhhc19saXZlX2RhdGE6CiAgICAgICAgICAgICAgICBub19kYXRhX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHByZXZpb3VzX3N0YXR1cyA9IHN0cihfd2F0Y2hsaXN0X3N0YXRlLmdldCgic3RhdHVzZXMiLCB7fSkuZ2V0KHN5bWJvbCkgb3IgIiIpCiAgICAgICAgICAgIGNoYW5nZWQgPSBwcmV2aW91c19zdGF0dXMgIT0gc3RhdHVzCiAgICAgICAgICAgIF93YXRjaGxpc3Rfc3RhdGUuc2V0ZGVmYXVsdCgic3RhdHVzZXMiLCB7fSlbc3ltYm9sXSA9IHN0YXR1cwoKICAgICAgICAgICAgaWYgc3RhdHVzIG5vdCBpbiBXQVRDSExJU1RfQUxFUlRfU1RBVFVTRVM6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBub3Qgcm93LmdldCgiZWxpZ2libGUiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBXQVRDSExJU1RfQUxFUlRfT05fU1RBVFVTX0NIQU5HRSBhbmQgbm90IGNoYW5nZWQ6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBfd2F0Y2hsaXN0X29uX2Nvb2xkb3duKHN5bWJvbCk6CiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiByb3cuZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJXQVRDSExJU1RfQ09PTERPV05fU0tJUCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJub3RlcyI6IGYic3RhdHVzPXtzdGF0dXN9IGNvb2xkb3duX2g9e1dBVENITElTVF9BTEVSVF9DT09MRE9XTl9IT1VSU30iLAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIGFsZXJ0c19zZW50ID49IG1heF9wZXJfY3ljbGU6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgbXNnID0gZm9ybWF0X3dhdGNobGlzdF9zaWduYWwocm93LCBjb21wYWN0PVRydWUpCiAgICAgICAgICAgIGRlY2lzaW9uID0gIldBVENITElTVF9BTEVSVCIKICAgICAgICAgICAgaWYgRFJZX1JVTjoKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIldBVENITElTVF9BTEVSVF9EUllfUlVOIgogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIFdhdGNobGlzdCBhbGVydCBzdXBwcmVzc2VkIGZvciAlcyIsIHN5bWJvbCkKICAgICAgICAgICAgZWxpZiBURUxFR1JBTV9RVUlFVF9NT0RFIGFuZCBjb250ZXh0LmpvYiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIldBVENITElTVF9BTEVSVF9RVUlFVF9NT0RFIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICAgICAgICAgIHRleHQ9bXNnLAogICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1fYnVpbGRfYWxlcnRfa2V5Ym9hcmQoCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgcm93LmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICAgICByb3cuZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgbG9nX3NpZ25hbCgKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICJtaW50Ijogcm93LmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJwYWlyX2FkZHJlc3MiOiByb3cuZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAibGlxdWlkaXR5Ijogcm93LmdldCgibGlxdWlkaXR5IiksCiAgICAgICAgICAgICAgICAgICAgInZvbHVtZV8yNGgiOiByb3cuZ2V0KCJ2b2x1bWVfMjRoIiksCiAgICAgICAgICAgICAgICAgICAgInByaWNlIjogcm93LmdldCgicHJpY2UiKSwKICAgICAgICAgICAgICAgICAgICAiY2hhbmdlXzI0aCI6IHJvdy5nZXQoImNoYW5nZV8yNGgiKSwKICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiBkZWNpc2lvbiwKICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiBmInN0YXR1cz17c3RhdHVzfSByZWFzb249e3Jvdy5nZXQoJ3JlYXNvbicsICcnKX0iLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIGFsZXJ0c19zZW50ICs9IDEKCiAgICAgICAgX3NhdmVfd2F0Y2hsaXN0X3N0YXRlKCkKICAgICAgICBpZiBub19kYXRhX2NvdW50OgogICAgICAgICAgICBsb2dnaW5nLmluZm8oIldhdGNobGlzdCBsYW5lOiBsaXZlIGRhdGEgdW5hdmFpbGFibGUgZm9yICVkIHRva2VuKHMpIHRoaXMgY3ljbGUuIiwgbm9fZGF0YV9jb3VudCkKICAgICAgICBpZiBhbGVydHNfc2VudCA9PSAwOgogICAgICAgICAgICBwcmludCgiV2F0Y2hsaXN0IGxhbmU6IG5vIHN0YXR1cy1jaGFuZ2UgYWxlcnRzIHRoaXMgY3ljbGUuIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjOgogICAgICAgIHByaW50KCJXQVRDSExJU1QgTEFORSBFUlJPUjoiLCByZXByKGV4YykpCgoKZGVmIF9mb3JtYXRfZGFpbHlfc3VtbWFyeShzdW1tYXJ5LCBvdXRjb21lX3JlY2FwPU5vbmUpOgogICAgdG9wX3N5bWJvbHMgPSBzdW1tYXJ5LmdldCgidG9wX2FsZXJ0X3N5bWJvbHMiLCBbXSkKICAgIHRvcF9saW5lID0gIiwgIi5qb2luKGYie3Jvd1snc3ltYm9sJ119KHtyb3dbJ2FsZXJ0cyddfSkiIGZvciByb3cgaW4gdG9wX3N5bWJvbHMpIGlmIHRvcF9zeW1ib2xzIGVsc2UgIk5vbmUiCiAgICByb3dzID0gWwogICAgICAgIF9rdl9tYWluKCJXSU5ET1ciLCAiMjRIIiksCiAgICAgICAgX2t2X21haW4oIlNDQU5TIiwgc3VtbWFyeVsic2NhbnMiXSksCiAgICAgICAgX2t2X21haW4oIkFMRVJUUyIsIHN1bW1hcnlbImFsZXJ0cyJdKSwKICAgICAgICBfa3ZfbWFpbigiQUxFUlRfUlQiLCBmIntzdW1tYXJ5WydhbGVydF9yYXRlJ106LjFmfSUiKSwKICAgICAgICBfa3ZfbWFpbigiQVZHX1NDT1JFIiwgZiJ7c3VtbWFyeVsnYXZnX3Njb3JlJ106LjJmfSIpLAogICAgICAgIF9rdl9tYWluKCJNQVhfU0NPUkUiLCBmIntzdW1tYXJ5WydtYXhfc2NvcmUnXTouMmZ9IiksCiAgICAgICAgX2t2X21haW4oIlRPUCIsIHRvcF9saW5lKSwKICAgIF0KICAgIHJlY2FwX3Jvd3MgPSBvdXRjb21lX3JlY2FwIG9yIFtdCiAgICBpZiByZWNhcF9yb3dzOgogICAgICAgIHJvd3MuYXBwZW5kKCItIiAqIDMwKQogICAgICAgIHJvd3MuYXBwZW5kKF9rdl9tYWluKCJSRUNBUCIsICIyNEgiKSkKICAgICAgICBmb3IgaWR4LCByb3cgaW4gZW51bWVyYXRlKHJlY2FwX3Jvd3NbOjZdLCBzdGFydD0xKToKICAgICAgICAgICAgc3ltYm9sID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgICAgICBhbGVydHMgPSBpbnQocm93LmdldCgiYWxlcnRzIikgb3IgMCkKICAgICAgICAgICAgYXZnXzRoID0gcm93LmdldCgiYXZnXzRoIikKICAgICAgICAgICAgbl80aCA9IGludChyb3cuZ2V0KCJuXzRoIikgb3IgMCkKICAgICAgICAgICAgd2luc180aCA9IGludChyb3cuZ2V0KCJ3aW5zXzRoIikgb3IgMCkKICAgICAgICAgICAgYXZnXzRoX3RleHQgPSBmIntmbG9hdChhdmdfNGgpOisuMmZ9JSIgaWYgYXZnXzRoIGlzIG5vdCBOb25lIGVsc2UgIk4vQSIKICAgICAgICAgICAgd2luX3JhdGVfdGV4dCA9IGYieyh3aW5zXzRoIC8gbl80aCAqIDEwMC4wKTouMGZ9JSIgaWYgbl80aCA+IDAgZWxzZSAiTi9BIgogICAgICAgICAgICByb3dzLmFwcGVuZCgKICAgICAgICAgICAgICAgIF90cmltX3RleHRfbWFpbigKICAgICAgICAgICAgICAgICAgICBmIntpZHh9LiAke3N5bWJvbH0gfCBhbGVydHMge2FsZXJ0c30gfCA0aCB7YXZnXzRoX3RleHR9IHwgd2luIHt3aW5fcmF0ZV90ZXh0fSAoe3dpbnNfNGh9L3tuXzRofSkiLAogICAgICAgICAgICAgICAgICAgIF9QQU5FTF9XSURUSF9NQUlOLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICBlbHNlOgogICAgICAgIHJvd3MuYXBwZW5kKCItIiAqIDMwKQogICAgICAgIHJvd3MuYXBwZW5kKF9rdl9tYWluKCJSRUNBUCIsICIyNEgiKSkKICAgICAgICByb3dzLmFwcGVuZCgiTm8gZXZhbHVhdGVkIG91dGNvbWVzIHlldC4iKQogICAgcmV0dXJuIF9oZWFkZXJfYmxvY2tfbWFpbigiW1NJR05BTF06REFJTFlfU1VNTUFSWSIpICsgIlxuIiArIF9yZW5kZXJfcHJlX21haW4ocm93cykKCgpkZWYgX2Zvcm1hdF93ZWVrbHlfdHVuaW5nX3JlcG9ydChyZXBvcnQpOgogICAgY3VycmVudCA9IHJlcG9ydFsiY3VycmVudCJdCiAgICByZWNvbW1lbmRlZCA9IHJlcG9ydFsicmVjb21tZW5kZWQiXQogICAgcmVhc29ucyA9IFtzdHIocikgZm9yIHIgaW4gcmVwb3J0WyJyZWFzb25zIl1dCiAgICBwZiA9IHJlcG9ydC5nZXQoInBvcnRmb2xpb180aCIsIHt9KQogICAgb3B0aW1pemVyID0gcmVwb3J0LmdldCgib3B0aW1pemVyIikKICAgIHJvd3MgPSBbCiAgICAgICAgX2t2X21haW4oIldJTkRPVyIsICI3RCIpLAogICAgICAgIF9rdl9tYWluKCJTQ0FOUyIsIHJlcG9ydFsic2Nhbl9ydW5zIl0pLAogICAgICAgIF9rdl9tYWluKCJCRVNUU0NBTiIsIHJlcG9ydFsic2Nhbl9iZXN0Il0pLAogICAgICAgIF9rdl9tYWluKCJBTEVSVFMiLCByZXBvcnRbImFsZXJ0cyJdKSwKICAgICAgICBfa3ZfbWFpbigiQUxFUlRfUlQiLCBmIntyZXBvcnRbJ2FsZXJ0X3JhdGUnXTouMWZ9JSIpLAogICAgICAgIF9rdl9tYWluKCJCTE9DS19SVCIsIGYie3JlcG9ydFsnYmxvY2tfcmF0ZSddOi4xZn0lIiksCiAgICAgICAgX2t2X21haW4oIlA1MC83NS85MCIsIGYie3JlcG9ydFsncDUwX3Njb3JlJ106LjBmfS97cmVwb3J0WydwNzVfc2NvcmUnXTouMGZ9L3tyZXBvcnRbJ3A5MF9zY29yZSddOi4wZn0iKSwKICAgICAgICAiLSIgKiAzMCwKICAgICAgICBfa3ZfbWFpbigiRURHRV8xSCIsIGYie3JlcG9ydFsnYXZnX3JldHVybl8xaCddOi4yZn0lL3tyZXBvcnRbJ3dpbnJhdGVfMWgnXTouMGZ9JS97cmVwb3J0WydvdXRjb21lc18xaF9jb3VudCddfSIpLAogICAgICAgIF9rdl9tYWluKCJFREdFXzRIIiwgZiJ7cmVwb3J0WydhdmdfcmV0dXJuXzRoJ106LjJmfSUve3JlcG9ydFsnd2lucmF0ZV80aCddOi4wZn0lL3tyZXBvcnRbJ291dGNvbWVzXzRoX2NvdW50J119IiksCiAgICAgICAgX2t2X21haW4oIkVER0VfMjRIIiwgZiJ7cmVwb3J0WydhdmdfcmV0dXJuXzI0aCddOi4yZn0lL3tyZXBvcnRbJ3dpbnJhdGVfMjRoJ106LjBmfSUve3JlcG9ydFsnb3V0Y29tZXNfMjRoX2NvdW50J119IiksCiAgICAgICAgX2t2X21haW4oIlNJTV80SCIsIGYidHJkIHtwZi5nZXQoJ3RyYWRlcycsIDApfSBleHAge3BmLmdldCgnZXhwZWN0YW5jeV9wY3QnLCAwKTouMmZ9JSIpLAogICAgICAgIF9rdl9tYWluKCJTSU1fREQiLCBmIntwZi5nZXQoJ21heF9kcmF3ZG93bl9wY3QnLCAwKTouMmZ9JSBlcSB7cGYuZ2V0KCdlcXVpdHlfZW5kJywgMSk6LjNmfSIpLAogICAgICAgICItIiAqIDMwLAogICAgICAgIF9rdl9tYWluKCJDVVJfVEhSIiwgY3VycmVudFsiYWxlcnRfdGhyZXNob2xkIl0pLAogICAgICAgIF9rdl9tYWluKCJDVVJfUkVHIiwgY3VycmVudFsicmVnaW1lX21pbl9zY29yZSJdKSwKICAgICAgICBfa3ZfbWFpbigiQ1VSX0NPTkYiLCBjdXJyZW50WyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdKSwKICAgICAgICBfa3ZfbWFpbigiTkVXX1RIUiIsIHJlY29tbWVuZGVkWyJhbGVydF90aHJlc2hvbGQiXSksCiAgICAgICAgX2t2X21haW4oIk5FV19SRUciLCByZWNvbW1lbmRlZFsicmVnaW1lX21pbl9zY29yZSJdKSwKICAgICAgICBfa3ZfbWFpbigiTkVXX0NPTkYiLCByZWNvbW1lbmRlZFsibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiXSksCiAgICBdCiAgICBpZiBvcHRpbWl6ZXI6CiAgICAgICAgcm93cy5hcHBlbmQoCiAgICAgICAgICAgIF9rdl9tYWluKAogICAgICAgICAgICAgICAgIk9QVCIsCiAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgZiJ0aHIge29wdGltaXplclsnYWxlcnRfdGhyZXNob2xkJ119IHJlZyB7b3B0aW1pemVyWydyZWdpbWVfbWluX3Njb3JlJ119ICIKICAgICAgICAgICAgICAgICAgICBmImNvbmYge29wdGltaXplclsnbWluX2NvbmZpZGVuY2VfdG9fYWxlcnQnXX0gbiB7b3B0aW1pemVyWydzYW1wbGVzJ119IgogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKQogICAgICAgICkKICAgIHJvd3MuYXBwZW5kKCItIiAqIDMwKQogICAgcm93cy5hcHBlbmQoX2t2X21haW4oIlJBVElPTkFMRSIsIHJlYXNvbnNbMF0gaWYgcmVhc29ucyBlbHNlICJObyByYXRpb25hbGUgYXZhaWxhYmxlIikpCiAgICBmb3IgcmVhc29uIGluIHJlYXNvbnNbMTo0XToKICAgICAgICByb3dzLmFwcGVuZChfdHJpbV90ZXh0X21haW4oZiItIHtyZWFzb259IiwgX1BBTkVMX1dJRFRIX01BSU4pKQogICAgcmV0dXJuIF9oZWFkZXJfYmxvY2tfbWFpbigiW1NJR05BTF06V0VFS0xZX1RVTklORyIpICsgIlxuIiArIF9yZW5kZXJfcHJlX21haW4ocm93cykKCgphc3luYyBkZWYgc2VuZF9kYWlseV9zdW1tYXJ5KGNvbnRleHQpOgogICAgc3VtbWFyeSA9IGdldF9wZXJmb3JtYW5jZV9zdW1tYXJ5KGxvb2tiYWNrX2hvdXJzPTI0KQogICAgcmVjYXAgPSBnZXRfYWxlcnRfb3V0Y29tZV9yZWNhcChsb29rYmFja19ob3Vycz0yNCwgbGltaXQ9OCkKICAgIG1lc3NhZ2UgPSBfZm9ybWF0X2RhaWx5X3N1bW1hcnkoc3VtbWFyeSwgb3V0Y29tZV9yZWNhcD1yZWNhcCkKICAgIGlmIERSWV9SVU46CiAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIERhaWx5IHN1bW1hcnkgbm90IHNlbnQuXG4lcyIsIG1lc3NhZ2UpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgdGV4dD1tZXNzYWdlLAogICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgKQoKCmFzeW5jIGRlZiBzZW5kX3dlZWtseV90dW5pbmdfcmVwb3J0KGNvbnRleHQpOgogICAgcmVwb3J0ID0gZ2V0X3dlZWtseV90dW5pbmdfcmVwb3J0KAogICAgICAgIGxvb2tiYWNrX2RheXM9V0VFS0xZX1RVTklOR19MT09LQkFDS19EQVlTLAogICAgICAgIGN1cnJlbnRfYWxlcnRfdGhyZXNob2xkPUFMRVJUX1RIUkVTSE9MRCwKICAgICAgICBjdXJyZW50X3JlZ2ltZV9taW5fc2NvcmU9UkVHSU1FX01JTl9TQ09SRSwKICAgICAgICBjdXJyZW50X21pbl9jb25maWRlbmNlX3RvX2FsZXJ0PU1JTl9DT05GSURFTkNFX1RPX0FMRVJULAogICAgICAgIG1pbl9vdXRjb21lc180aD1XRUVLTFlfVFVOSU5HX01JTl9PVVRDT01FU180SCwKICAgICkKICAgIG1lc3NhZ2UgPSBfZm9ybWF0X3dlZWtseV90dW5pbmdfcmVwb3J0KHJlcG9ydCkKICAgIGlmIERSWV9SVU46CiAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIFdlZWtseSB0dW5pbmcgcmVwb3J0IG5vdCBzZW50LlxuJXMiLCBtZXNzYWdlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgIHRleHQ9bWVzc2FnZSwKICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICkKCgpkZWYgX3VwZGF0ZV9zeW1ib2xfY29udHJvbF9mcm9tX291dGNvbWVzKHN5bWJvbDogc3RyKToKICAgIGlmIG5vdCBTWU1CT0xfQ09OVFJPTF9FTkFCTEVEIG9yIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuCiAgICBzdGF0cyA9IGdldF9zeW1ib2xfb3V0Y29tZV9zdGF0cyhzeW1ib2wsIGxvb2tiYWNrX2RheXM9MzApCiAgICByZXR1cm5zXzRoID0gc3RhdHMuZ2V0KCJyZXR1cm5zXzRoIiwgW10pCiAgICByZXR1cm5zXzI0aCA9IHN0YXRzLmdldCgicmV0dXJuc18yNGgiLCBbXSkKICAgIGF2Z18yNGggPSBmbG9hdChzdGF0cy5nZXQoImF2Z18yNGgiLCAwKSBvciAwKQoKICAgIGlmIGxlbihyZXR1cm5zXzI0aCkgPj0gU1lNQk9MX0JMQUNLTElTVF9NSU5fU0FNUExFUyBhbmQgYXZnXzI0aCA8PSBTWU1CT0xfQkxBQ0tMSVNUX0FWR18yNEhfUENUOgogICAgICAgIHNldF9zeW1ib2xfY29udHJvbCgKICAgICAgICAgICAgc3ltYm9sPXN5bWJvbCwKICAgICAgICAgICAgY29udHJvbF90eXBlPSJCTEFDS0xJU1QiLAogICAgICAgICAgICBob3Vycz1TWU1CT0xfQkxBQ0tMSVNUX0hPVVJTLAogICAgICAgICAgICByZWFzb249ZiIyNGggYXZnIHthdmdfMjRoOi4yZn0lIDw9IHtTWU1CT0xfQkxBQ0tMSVNUX0FWR18yNEhfUENUOi4yZn0lIiwKICAgICAgICApCiAgICAgICAgcmV0dXJuCgogICAgdHJpZ2dlciA9IG1heCgxLCBTWU1CT0xfTE9TU19TVFJFQUtfVFJJR0dFUikKICAgIGlmIGxlbihyZXR1cm5zXzRoKSA+PSB0cmlnZ2VyIGFuZCBhbGwocmV0IDwgMCBmb3IgcmV0IGluIHJldHVybnNfNGhbOnRyaWdnZXJdKToKICAgICAgICBzZXRfc3ltYm9sX2NvbnRyb2woCiAgICAgICAgICAgIHN5bWJvbD1zeW1ib2wsCiAgICAgICAgICAgIGNvbnRyb2xfdHlwZT0iQ09PTERPV04iLAogICAgICAgICAgICBob3Vycz1TWU1CT0xfQ09PTERPV05fSE9VUlMsCiAgICAgICAgICAgIHJlYXNvbj1mInt0cmlnZ2VyfSBjb25zZWN1dGl2ZSBuZWdhdGl2ZSA0aCBvdXRjb21lcyIsCiAgICAgICAgKQoKCmFzeW5jIGRlZiBydW5fb3V0Y29tZV9ldmFsdWF0b3IoY29udGV4dCk6CiAgICBpZiBub3QgT1VUQ09NRV9UUkFDS0lOR19FTkFCTEVEOgogICAgICAgIHJldHVybgoKICAgIHJvd3MgPSBnZXRfcGVuZGluZ19hbGVydF9vdXRjb21lcyhsaW1pdD1PVVRDT01FX0VWQUxfQkFUQ0hfU0laRSkKICAgIGlmIG5vdCByb3dzOgogICAgICAgIHJldHVybgoKICAgICMgT1BUSU1JWkFUSU9OOiBGZXRjaCBtYXJrZXQgZGF0YSBvbmNlIGluc3RlYWQgb2YgcGVyLXRva2VuIEFQSSBjYWxscwogICAgIyBUaGlzIGRyYW1hdGljYWxseSByZWR1Y2VzIEJpcmRFeWUgQVBJIHByZXNzdXJlCiAgICBtYXJrZXRfdG9rZW5zID0gZmV0Y2hfbWFya2V0X2RhdGEoKSBvciBbXQogICAgcHJpY2VfYnlfbWludCA9IHsKICAgICAgICBzdHIodC5nZXQoImFkZHJlc3MiKSBvciAiIik6IGZsb2F0KHQuZ2V0KCJwcmljZSIsIDApIG9yIDApCiAgICAgICAgZm9yIHQgaW4gbWFya2V0X3Rva2VucwogICAgICAgIGlmIHQuZ2V0KCJhZGRyZXNzIikgYW5kIHQuZ2V0KCJwcmljZSIpCiAgICB9CgogICAgbm93ID0gZGF0ZXRpbWUudXRjbm93KCkKICAgIHVwZGF0ZWQgPSAwCiAgICB0b3VjaGVkX3N5bWJvbHMgPSBzZXQoKQogICAgZm9yIHJvdyBpbiByb3dzOgogICAgICAgIG91dGNvbWVfaWQgPSBpbnQocm93WyJpZCJdKQogICAgICAgIG1pbnQgPSByb3cuZ2V0KCJtaW50IikKICAgICAgICBlbnRyeV9wcmljZSA9IGZsb2F0KHJvdy5nZXQoImVudHJ5X3ByaWNlIikgb3IgMCkKICAgICAgICBpZiBub3QgbWludCBvciBlbnRyeV9wcmljZSA8PSAwOgogICAgICAgICAgICBtYXJrX2FsZXJ0X291dGNvbWVfY29tcGxldGUob3V0Y29tZV9pZCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjcmVhdGVkID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChyb3dbImNyZWF0ZWRfdHNfdXRjIl0pCiAgICAgICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgICAgICBtYXJrX2FsZXJ0X291dGNvbWVfZXJyb3Iob3V0Y29tZV9pZCwgImludmFsaWRfY3JlYXRlZF90cyIpCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGFnZSA9IG5vdyAtIGNyZWF0ZWQKICAgICAgICBkdWVfaG9yaXpvbnMgPSBbXQogICAgICAgIGlmIHJvdy5nZXQoInJldHVybl8xaF9wY3QiKSBpcyBOb25lIGFuZCBhZ2UgPj0gdGltZWRlbHRhKGhvdXJzPTEpOgogICAgICAgICAgICBkdWVfaG9yaXpvbnMuYXBwZW5kKDEpCiAgICAgICAgaWYgcm93LmdldCgicmV0dXJuXzRoX3BjdCIpIGlzIE5vbmUgYW5kIGFnZSA+PSB0aW1lZGVsdGEoaG91cnM9NCk6CiAgICAgICAgICAgIGR1ZV9ob3Jpem9ucy5hcHBlbmQoNCkKICAgICAgICBpZiByb3cuZ2V0KCJyZXR1cm5fMjRoX3BjdCIpIGlzIE5vbmUgYW5kIGFnZSA+PSB0aW1lZGVsdGEoaG91cnM9MjQpOgogICAgICAgICAgICBkdWVfaG9yaXpvbnMuYXBwZW5kKDI0KQogICAgICAgIGlmIG5vdCBkdWVfaG9yaXpvbnM6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICMgVHJ5IHRvIGdldCBwcmljZSBmcm9tIG1hcmtldCBkYXRhIGZpcnN0IChiYXRjaGVkLCBlZmZpY2llbnQpCiAgICAgICAgY3VycmVudF9wcmljZSA9IHByaWNlX2J5X21pbnQuZ2V0KG1pbnQpCgogICAgICAgICMgRmFsbGJhY2sgdG8gaW5kaXZpZHVhbCBmZXRjaCBvbmx5IGlmIG5vdCBpbiBtYXJrZXQgZGF0YQogICAgICAgIGlmIGN1cnJlbnRfcHJpY2UgaXMgTm9uZSBvciBjdXJyZW50X3ByaWNlIDw9IDA6CiAgICAgICAgICAgIGN1cnJlbnRfcHJpY2UgPSBmZXRjaF9iaXJkZXllX3ByaWNlKG1pbnQpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcHJpY2UgaXMgTm9uZSBvciBmbG9hdChjdXJyZW50X3ByaWNlKSA8PSAwOgogICAgICAgICAgICAgICAgbWFya19hbGVydF9vdXRjb21lX2Vycm9yKG91dGNvbWVfaWQsICJwcmljZV91bmF2YWlsYWJsZSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICByZXRfcGN0ID0gKChmbG9hdChjdXJyZW50X3ByaWNlKSAtIGVudHJ5X3ByaWNlKSAvIGVudHJ5X3ByaWNlKSAqIDEwMC4wCiAgICAgICAgZm9yIGhvcml6b24gaW4gZHVlX2hvcml6b25zOgogICAgICAgICAgICB1cGRhdGVfYWxlcnRfb3V0Y29tZV9ob3Jpem9uKG91dGNvbWVfaWQsIGhvcml6b24sIHJldF9wY3QpCiAgICAgICAgICAgIHVwZGF0ZWQgKz0gMQogICAgICAgICAgICBpZiByb3cuZ2V0KCJzeW1ib2wiKToKICAgICAgICAgICAgICAgIHRvdWNoZWRfc3ltYm9scy5hZGQoc3RyKHJvdy5nZXQoInN5bWJvbCIpKSkKCiAgICBmb3Igc3ltYm9sIGluIHRvdWNoZWRfc3ltYm9sczoKICAgICAgICBfdXBkYXRlX3N5bWJvbF9jb250cm9sX2Zyb21fb3V0Y29tZXMoc3ltYm9sKQoKICAgIGlmIHVwZGF0ZWQ6CiAgICAgICAgbG9nZ2luZy5pbmZvKCJPdXRjb21lIGV2YWx1YXRvciB1cGRhdGVkICVkIGhvcml6b24gcmVzdWx0KHMpIiwgdXBkYXRlZCkKCgphc3luYyBkZWYgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlOiBVcGRhdGUpOgogICAgbXNnID0gdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlCiAgICBpZiBtc2c6CiAgICAgICAgYXdhaXQgbXNnLnJlcGx5X3RleHQoIlVuYXV0aG9yaXplZCBjaGF0LiIpCgoKZGVmIF9jdXJyZW50X21vZGVfdGV4dCgpOgogICAgc2VsbF9ydWxlcyA9IF9zZWxsX3N0eWxlX3J1bGVzKCkKICAgIHJldHVybiAoCiAgICAgICAgZiJNb2RlOiB7X21vZGUoKX1cbiIKICAgICAgICBmIlJpc2sgcHJvZmlsZToge19yaXNrX3N0eWxlX2xhYmVsKCl9ICh7X25vcm1hbGl6ZV9yaXNrX3N0eWxlKF9ydW50aW1lLmdldCgncmlza19zdHlsZScpKX0pXG4iCiAgICAgICAgZiJTY2FuIGludGVydmFsOiB7X3J1bnRpbWVbJ3NjYW5faW50ZXJ2YWxfc2Vjb25kcyddfXNcbiIKICAgICAgICBmIlRocmVzaG9sZDoge19ydW50aW1lWydhbGVydF90aHJlc2hvbGQnXX0gfCBDb25maWRlbmNlOiB7X3J1bnRpbWVbJ21pbl9jb25maWRlbmNlX3RvX2FsZXJ0J119XG4iCiAgICAgICAgZiJSZWdpbWUgbWluOiB7X3J1bnRpbWVbJ3JlZ2ltZV9taW5fc2NvcmUnXX1cbiIKICAgICAgICBmIk1pbiBsaXEvdm9sMjRoOiAke2ludChfcnVudGltZVsnbWluX2xpcXVpZGl0eSddKTosfSAvICR7aW50KF9ydW50aW1lWydtaW5fdm9sdW1lXzI0aCddKTosfVxuIgogICAgICAgIGYiQ29vbGRvd246IHtfcnVudGltZVsnYWxlcnRfY29vbGRvd25faG91cnMnXX1oXG4iCiAgICAgICAgZiJTT0wgcmVnaW1lIGxheWVyOiB7J09OJyBpZiBFTkFCTEVfU09MX1JFR0lNRV9MQVlFUiBlbHNlICdPRkYnfVxuIgogICAgICAgIGYiTmV3IHJ1bm5lciB3YXRjaDogeydPTicgaWYgTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVEIGVsc2UgJ09GRid9XG4iCiAgICAgICAgZiJMZWdhY3kgcmVjb3Zlcnkgc2NhbjogeydPTicgaWYgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQgZWxzZSAnT0ZGJ30gIgogICAgICAgIGYiKGFnZT49e0xFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVM6LjBmfWQsIGxpcT4ke0xFR0FDWV9SRUNPVkVSWV9NSU5fTElRVUlESVRZLzFlNjouMWZ9TSwgdm9sPiR7TEVHQUNZX1JFQ09WRVJZX01JTl9WT0xVTUVfMjRILzFlMzouMGZ9SylcbiIKICAgICAgICBmIk1hbnVhbCB3YXRjaGxpc3QgbGFuZTogeydPTicgaWYgV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRCBhbmQgYm9vbChXQVRDSExJU1RfRU5UUklFUykgZWxzZSAnT0ZGJ31cbiIKICAgICAgICBmIkFuYWx5c2lzIGJ1bGxldGluOiB7J09OJyBpZiBHT09EX0JVWV9CVUxMRVRJTl9FTkFCTEVEIGVsc2UgJ09GRid9ICh7R09PRF9CVVlfQlVMTEVUSU5fSU5URVJWQUxfU0VDT05EU31zKVxuIgogICAgICAgIGYiUXVpZXQgbW9kZTogeydPTicgaWYgVEVMRUdSQU1fUVVJRVRfTU9ERSBlbHNlICdPRkYnfVxuIgogICAgICAgIGYiTGl2ZSBwdXNoIGdhdGU6IHsnU1RST05HLU9OTFknIGlmIFRFTEVHUkFNX1BVU0hfU1RST05HX09OTFkgZWxzZSAnT0ZGJ30gIgogICAgICAgIGYiKCt7VEVMRUdSQU1fUFVTSF9NSU5fU0NPUkVfREVMVEF9LCBjb25mPj17VEVMRUdSQU1fUFVTSF9NSU5fQ09ORklERU5DRX0pXG4iCiAgICAgICAgZiJTZWxsL2V4aXQgc2Nhbm5lcjogeydPTicgaWYgU0VMTF9BTEVSVFNfRU5BQkxFRCBlbHNlICdPRkYnfSAiCiAgICAgICAgZiIobWF4L2N5Y2xlPXtzZWxsX3J1bGVzWydtYXhfcGVyX2N5Y2xlJ119LCBjb29sZG93bj17c2VsbF9ydWxlc1snY29vbGRvd25faG91cnMnXX1oKSIKICAgICkKCgpkZWYgX2ZtdF91c2RfY29tcGFjdF9tYWluKHZhbHVlKToKICAgIHRyeToKICAgICAgICBuID0gZmxvYXQodmFsdWUpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICBhYnNfbiA9IGFicyhuKQogICAgaWYgYWJzX24gPj0gMV8wMDBfMDAwXzAwMDoKICAgICAgICByZXR1cm4gZiIke24vMV8wMDBfMDAwXzAwMDouMmZ9QiIKICAgIGlmIGFic19uID49IDFfMDAwXzAwMDoKICAgICAgICByZXR1cm4gZiIke24vMV8wMDBfMDAwOi4yZn1NIgogICAgaWYgYWJzX24gPj0gMV8wMDA6CiAgICAgICAgcmV0dXJuIGYiJHtuLzFfMDAwOi4xZn1LIgogICAgcmV0dXJuIGYiJHtuOi4wZn0iCgoKZGVmIF9mbXRfcGN0X21haW4odmFsdWUpOgogICAgdHJ5OgogICAgICAgIG51bWJlciA9IGZsb2F0KHZhbHVlKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiAiTi9BIgogICAgc2lnbiA9ICIrIiBpZiBudW1iZXIgPiAwIGVsc2UgIiIKICAgIHJldHVybiBmIntzaWdufXtudW1iZXI6LjFmfSUiCgoKZGVmIF9mbXRfaW50X21haW4odmFsdWUpOgogICAgdHJ5OgogICAgICAgIHJldHVybiBmIntpbnQoZmxvYXQodmFsdWUpKTosfSIKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKCgpkZWYgX2VzY19odG1sX21haW4odmFsdWUpOgogICAgcmV0dXJuIGh0bWwuZXNjYXBlKHN0cih2YWx1ZSkpCgoKZGVmIF9yZW5kZXJfcHJlX21haW4ocm93cyk6CiAgICBsaW5lcyA9IFtzdHIocm93IG9yICIiKSBmb3Igcm93IGluIHJvd3NdCiAgICBpZiBub3QgbGluZXM6CiAgICAgICAgcmV0dXJuICIiCiAgICBwYW5lbF93aWR0aCA9IF9QQU5FTF9XSURUSF9NQUlOCiAgICB3cmFwcGVkID0gW10KICAgIGZvciBsaW5lIGluIGxpbmVzOgogICAgICAgIHdyYXBwZWQuZXh0ZW5kKF93cmFwX3RleHRfbWFpbihsaW5lLCBwYW5lbF93aWR0aCkpCiAgICByZXR1cm4gIlxuIi5qb2luKGYiPGNvZGU+e19lc2NfaHRtbF9tYWluKGxpbmUpfTwvY29kZT4iIGZvciBsaW5lIGluIHdyYXBwZWQpCgoKX1BBTkVMX1dJRFRIX01BSU4gPSA0MgoKCmRlZiBfdHJpbV90ZXh0X21haW4odmFsdWUsIG1heF9sZW4pOgogICAgdGV4dCA9IHN0cih2YWx1ZSBvciAiIikKICAgIGlmIG1heF9sZW4gPD0gMDoKICAgICAgICByZXR1cm4gdGV4dAogICAgcmV0dXJuIHRleHQKCgpkZWYgX3dyYXBfdGV4dF9tYWluKHZhbHVlLCBtYXhfbGVuKToKICAgIHRleHQgPSBzdHIodmFsdWUgb3IgIiIpCiAgICBpZiBtYXhfbGVuIDw9IDAgb3IgbGVuKHRleHQpIDw9IG1heF9sZW46CiAgICAgICAgcmV0dXJuIFt0ZXh0XQogICAgb3V0ID0gW10KICAgIHJlbWFpbmluZyA9IHRleHQKICAgIHdoaWxlIGxlbihyZW1haW5pbmcpID4gbWF4X2xlbjoKICAgICAgICBjdXQgPSByZW1haW5pbmcucmZpbmQoIiAiLCAwLCBtYXhfbGVuICsgMSkKICAgICAgICBpZiBjdXQgPD0gMDoKICAgICAgICAgICAgY3V0ID0gbWF4X2xlbgogICAgICAgIG91dC5hcHBlbmQocmVtYWluaW5nWzpjdXRdLnJzdHJpcCgpKQogICAgICAgIHJlbWFpbmluZyA9IHJlbWFpbmluZ1tjdXQ6XS5sc3RyaXAoKQogICAgb3V0LmFwcGVuZChyZW1haW5pbmcpCiAgICByZXR1cm4gb3V0CgoKZGVmIF9rdl9tYWluKGxhYmVsLCB2YWx1ZSwgd2lkdGg6IGludCA9IF9QQU5FTF9XSURUSF9NQUlOKToKICAgIGtleSA9IHN0cihsYWJlbCBvciAiIikudXBwZXIoKVs6OV0KICAgIGxpbmUgPSBmIntrZXk6PDl9IHwge3ZhbHVlfSIKICAgIHJldHVybiBfdHJpbV90ZXh0X21haW4obGluZSwgd2lkdGgpCgoKZGVmIF9oZWFkZXJfYmxvY2tfbWFpbih0YWc6IHN0ciwgcm93cz1Ob25lLCB3aWR0aDogaW50ID0gX1BBTkVMX1dJRFRIX01BSU4pIC0+IHN0cjoKICAgIGhlYWRlcl9yb3dzID0gWwogICAgICAgIGYiPGI+e19lc2NfaHRtbF9tYWluKHRhZyl9PC9iPiIsCiAgICAgICAgZiI8Y29kZT57Jy0nICogbWluKDMwLCB3aWR0aCl9PC9jb2RlPiIsCiAgICBdCiAgICBmb3Igcm93IGluIChyb3dzIG9yIFtdKToKICAgICAgICB0ZXh0ID0gX3RyaW1fdGV4dF9tYWluKHN0cihyb3cgb3IgIiIpLCB3aWR0aCkKICAgICAgICBoZWFkZXJfcm93cy5hcHBlbmQoZiI8Y29kZT57X2VzY19odG1sX21haW4odGV4dCl9PC9jb2RlPiIpCiAgICByZXR1cm4gIlxuIi5qb2luKGhlYWRlcl9yb3dzKQoKCmRlZiBfcHJpb3JpdHlfZnJvbV9zY29yZV9tYWluKHNjb3JlKToKICAgIHRyeToKICAgICAgICBzID0gZmxvYXQoc2NvcmUgb3IgMCkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIlAzIgogICAgaWYgcyA+PSA5MDoKICAgICAgICByZXR1cm4gIlAxIgogICAgaWYgcyA+PSA4MDoKICAgICAgICByZXR1cm4gIlAyIgogICAgcmV0dXJuICJQMyIKCgpkZWYgX2dvb2RfYnV5X3JlYXNvbih0b2tlbjogZGljdCkgLT4gc3RyOgogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIHZvbF90b19saXEgPSAodm9sdW1lXzI0aCAvIGxpcXVpZGl0eSkgaWYgbGlxdWlkaXR5ID4gMCBlbHNlIDAuMAogICAgaWYgY2hhbmdlXzI0aCA+PSAxMiBhbmQgdm9sX3RvX2xpcSA+PSAwLjY6CiAgICAgICAgcmV0dXJuICJTdHJvbmcgdHJlbmQgKyBzdHJvbmcgcGFydGljaXBhdGlvbiIKICAgIGlmIGNoYW5nZV8yNGggPj0gNSBhbmQgdm9sX3RvX2xpcSA+PSAwLjM1OgogICAgICAgIHJldHVybiAiTW9tZW50dW0gY29uZmlybWVkICsgaGVhbHRoeSB0dXJub3ZlciIKICAgIGlmIGNoYW5nZV8yNGggPj0gMDoKICAgICAgICByZXR1cm4gIkNvbnN0cnVjdGl2ZSBzdHJ1Y3R1cmUgKyBhY2NlcHRhYmxlIGxpcXVpZGl0eSIKICAgIHJldHVybiAiUHVsbGJhY2sgc2V0dXAgd2l0aCBzdGlsbC12YWxpZCBsaXF1aWRpdHkiCgoKZGVmIF9zZWxsX3N0eWxlX3J1bGVzKHN0eWxlOiBzdHIgfCBOb25lID0gTm9uZSkgLT4gZGljdDoKICAgIHJpc2tfc3R5bGUgPSBfbm9ybWFsaXplX3Jpc2tfc3R5bGUoc3R5bGUgb3IgX3J1bnRpbWUuZ2V0KCJyaXNrX3N0eWxlIikpCiAgICBiYXNlID0gewogICAgICAgICJzdHlsZSI6IHJpc2tfc3R5bGUsCiAgICAgICAgIm1heF9wZXJfY3ljbGUiOiBtYXgoMSwgaW50KFNFTExfQUxFUlRfTUFYX1BFUl9DWUNMRSkpLAogICAgICAgICJjb29sZG93bl9ob3VycyI6IG1heCgxLCBpbnQoU0VMTF9BTEVSVF9DT09MRE9XTl9IT1VSUykpLAogICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8xaCI6IGZsb2F0KFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfMUgpLAogICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV82aCI6IGZsb2F0KFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfNkgpLAogICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8yNGgiOiBmbG9hdChTRUxMX0hZUEVfRkFERV9NQVhfQ0hBTkdFXzI0SCksCiAgICAgICAgImh5cGVfZmFkZV9tYXhfdm9sX3RvX2xpcSI6IGZsb2F0KFNFTExfSFlQRV9GQURFX01BWF9WT0xfVE9fTElRKSwKICAgICAgICAiY29uc29saWRhdGlvbl9taW5fY2hhbmdlXzI0aCI6IGZsb2F0KFNFTExfQ09OU09MSURBVElPTl9NSU5fQ0hBTkdFXzI0SCksCiAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfMWgiOiBmbG9hdChTRUxMX0NPTlNPTElEQVRJT05fTUFYX0FCU19DSEFOR0VfMUgpLAogICAgICAgICJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzZoIjogZmxvYXQoU0VMTF9DT05TT0xJREFUSU9OX01BWF9BQlNfQ0hBTkdFXzZIKSwKICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfdm9sX3RvX2xpcSI6IGZsb2F0KFNFTExfQ09OU09MSURBVElPTl9NQVhfVk9MX1RPX0xJUSksCiAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X3R4bnNfaDEiOiBpbnQoU0VMTF9DT05TT0xJREFUSU9OX01BWF9UWE5TX0gxKSwKICAgIH0KCiAgICBpZiByaXNrX3N0eWxlID09ICJjYXBpdGFsIjoKICAgICAgICBiYXNlLnVwZGF0ZSgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1heF9wZXJfY3ljbGUiOiBtYXgoMSwgYmFzZVsibWF4X3Blcl9jeWNsZSJdICsgMSksCiAgICAgICAgICAgICAgICAiY29vbGRvd25faG91cnMiOiBtYXgoMSwgaW50KHJvdW5kKGJhc2VbImNvb2xkb3duX2hvdXJzIl0gKiAwLjc1KSkpLAogICAgICAgICAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzFoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfMWgiXSAqIDAuNiwKICAgICAgICAgICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV82aCI6IGJhc2VbImh5cGVfZmFkZV9tYXhfY2hhbmdlXzZoIl0gKiAwLjYsCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF9jaGFuZ2VfMjRoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfMjRoIl0gKiAwLjYsCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIjogYmFzZVsiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIl0gKiAxLjQsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9taW5fY2hhbmdlXzI0aCI6IGJhc2VbImNvbnNvbGlkYXRpb25fbWluX2NoYW5nZV8yNGgiXSAqIDAuNywKICAgICAgICAgICAgICAgICJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzFoIjogYmFzZVsiY29uc29saWRhdGlvbl9tYXhfYWJzX2NoYW5nZV8xaCJdICogMS4zNSwKICAgICAgICAgICAgICAgICJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzZoIjogYmFzZVsiY29uc29saWRhdGlvbl9tYXhfYWJzX2NoYW5nZV82aCJdICogMS4zLAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X3ZvbF90b19saXEiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF92b2xfdG9fbGlxIl0gKiAxLjMsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfdHhuc19oMSI6IGludChiYXNlWyJjb25zb2xpZGF0aW9uX21heF90eG5zX2gxIl0gKiAxLjM1KSwKICAgICAgICAgICAgfQogICAgICAgICkKICAgIGVsaWYgcmlza19zdHlsZSA9PSAic25pcGVyIjoKICAgICAgICBiYXNlLnVwZGF0ZSgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1heF9wZXJfY3ljbGUiOiBtYXgoMSwgYmFzZVsibWF4X3Blcl9jeWNsZSJdIC0gMSksCiAgICAgICAgICAgICAgICAiY29vbGRvd25faG91cnMiOiBtYXgoMSwgaW50KHJvdW5kKGJhc2VbImNvb2xkb3duX2hvdXJzIl0gKiAxLjI1KSkpLAogICAgICAgICAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzFoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfMWgiXSAqIDEuNiwKICAgICAgICAgICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV82aCI6IGJhc2VbImh5cGVfZmFkZV9tYXhfY2hhbmdlXzZoIl0gKiAxLjYsCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF9jaGFuZ2VfMjRoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfMjRoIl0gKiAxLjYsCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIjogYmFzZVsiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIl0gKiAwLjc1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWluX2NoYW5nZV8yNGgiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21pbl9jaGFuZ2VfMjRoIl0gKiAxLjM1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfMWgiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzFoIl0gKiAwLjc1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfNmgiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzZoIl0gKiAwLjc1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X3ZvbF90b19saXEiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF92b2xfdG9fbGlxIl0gKiAwLjc1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X3R4bnNfaDEiOiBpbnQoYmFzZVsiY29uc29saWRhdGlvbl9tYXhfdHhuc19oMSJdICogMC43NSksCiAgICAgICAgICAgIH0KICAgICAgICApCgogICAgcmV0dXJuIGJhc2UKCgpkZWYgX3NlbGxfc2lnbmFsX29uX2Nvb2xkb3duKHN5bWJvbDogc3RyLCBjb29sZG93bl9ob3VyczogaW50IHwgZmxvYXQgfCBOb25lID0gTm9uZSkgLT4gYm9vbDoKICAgIGlmIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuIFRydWUKICAgIGxhc3Rfc2VudCA9IGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sKAogICAgICAgIHN5bWJvbCwKICAgICAgICBbCiAgICAgICAgICAgICJTRUxMX0FMRVJUX0hZUEVfRkFERSIsCiAgICAgICAgICAgICJTRUxMX0FMRVJUX0NPTlNPTElEQVRJT04iLAogICAgICAgICAgICAiU0VMTF9BTEVSVF9EUllfUlVOIiwKICAgICAgICBdLAogICAgKQogICAgaWYgbm90IGxhc3Rfc2VudDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGVmZmVjdGl2ZV9jb29sZG93biA9IGNvb2xkb3duX2hvdXJzIGlmIGNvb2xkb3duX2hvdXJzIGlzIG5vdCBOb25lIGVsc2UgU0VMTF9BTEVSVF9DT09MRE9XTl9IT1VSUwogICAgcmV0dXJuIChkYXRldGltZS51dGNub3coKSAtIGxhc3Rfc2VudCkgPCB0aW1lZGVsdGEoaG91cnM9bWF4KDEsIGVmZmVjdGl2ZV9jb29sZG93bikpCgoKZGVmIF9kZXRlY3Rfc2VsbF9zaWduYWwodG9rZW46IGRpY3QsIHJ1bGVzOiBkaWN0IHwgTm9uZSA9IE5vbmUpOgogICAgIiIiCiAgICBEZXRlY3QgZXhpdCBzaWduYWxzIHVzaW5nIHJlYWwgbWFya2V0IHN0cnVjdHVyZSBhbmQgZmxvdyBhbmFseXNpcy4KICAgIFByaW9yaXRpemVkIGJ5IHNldmVyaXR5OiBzdHJ1Y3R1cmUgYnJlYWsgPiBsaXF1aWRpdHkgZHJhaW4gPiBob2xkZXIgZXhvZHVzID4gaHlwZSBmYWRlID4gY29uc29saWRhdGlvbgogICAgIiIiCiAgICBzeW1ib2wgPSBzdHIodG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgaWYgbm90IHN5bWJvbCBvciBzeW1ib2wgaW4gX1NFTExfQUxFUlRfRVhDTFVERURfU1lNQk9MUzoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgaWYgbGlxdWlkaXR5IDw9IDAgb3Igdm9sdW1lXzI0aCA8PSAwOgogICAgICAgIHJldHVybiBOb25lCiAgICB2b2xfdG9fbGlxID0gdm9sdW1lXzI0aCAvIGxpcXVpZGl0eQogICAgcnVsZXMgPSBydWxlcyBvciBfc2VsbF9zdHlsZV9ydWxlcygpCgogICAgY2hhbmdlXzFoID0gdG9rZW4uZ2V0KCJjaGFuZ2VfMWgiKSBvciB0b2tlbi5nZXQoInByaWNlQ2hhbmdlMWhQZXJjZW50IikKICAgIGNoYW5nZV80aCA9IHRva2VuLmdldCgiY2hhbmdlXzRoIikgb3IgdG9rZW4uZ2V0KCJwcmljZUNoYW5nZTRoUGVyY2VudCIpCiAgICBjaGFuZ2VfNmggPSB0b2tlbi5nZXQoImNoYW5nZV82aCIpIG9yIHRva2VuLmdldCgicHJpY2VDaGFuZ2U2aFBlcmNlbnQiKQogICAgY2hhbmdlXzI0aCA9IHRva2VuLmdldCgiY2hhbmdlXzI0aCIpCiAgICBjMSA9IGZsb2F0KGNoYW5nZV8xaCkgaWYgaXNpbnN0YW5jZShjaGFuZ2VfMWgsIChpbnQsIGZsb2F0KSkgZWxzZSBOb25lCiAgICBjNCA9IGZsb2F0KGNoYW5nZV80aCkgaWYgaXNpbnN0YW5jZShjaGFuZ2VfNGgsIChpbnQsIGZsb2F0KSkgZWxzZSBOb25lCiAgICBjNiA9IGZsb2F0KGNoYW5nZV82aCkgaWYgaXNpbnN0YW5jZShjaGFuZ2VfNmgsIChpbnQsIGZsb2F0KSkgZWxzZSBOb25lCiAgICBjMjQgPSBmbG9hdChjaGFuZ2VfMjRoKSBpZiBpc2luc3RhbmNlKGNoYW5nZV8yNGgsIChpbnQsIGZsb2F0KSkgZWxzZSAwLjAKICAgIHR4bnNfaDEgPSBpbnQoZmxvYXQodG9rZW4uZ2V0KCJ0eG5zX2gxIikgb3IgMCkpCgogICAgIyBHZXQgaG9sZGVyIG1vbWVudHVtIGRhdGEKICAgIHV3XzFoX2NoYW5nZSA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0MWhDaGFuZ2VQZXJjZW50IikKICAgIHV3XzRoX2NoYW5nZSA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0NGhDaGFuZ2VQZXJjZW50IikKCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgIyAxLiBTVFJVQ1RVUkUgQlJFQUsgKGhpZ2hlc3QgcHJpb3JpdHkpCiAgICAjIFByaWNlIGJyZWFraW5nIGRvd24gaGFyZCBhY3Jvc3MgbXVsdGlwbGUgdGltZWZyYW1lcyA9IHN0cnVjdHVyYWwgZmFpbHVyZQogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIGMxIGlzIG5vdCBOb25lIGFuZCBjNCBpcyBub3QgTm9uZToKICAgICAgICBpZiBjMSA8IC04IGFuZCBjNCA8IC0xNToKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIlNUUlVDVFVSRV9CUkVBSyIsCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiU3RydWN0dXJlIEJyZWFrIiwKICAgICAgICAgICAgICAgICJhY3Rpb24iOiAiRVhJVCBOT1cgLSBzdHJ1Y3R1cmUgZmFpbGVkIiwKICAgICAgICAgICAgICAgICJzdHlsZSI6IHJ1bGVzWyJzdHlsZSJdLAogICAgICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgICAgICBmIk11bHRpLXRpbWVmcmFtZSBicmVha2Rvd246IDFoIHtjMTorLjFmfSUsIDRoIHtjNDorLjFmfSUuICIKICAgICAgICAgICAgICAgICAgICBmIlByaWNlIHN1cHBvcnQgaGFzIGZhaWxlZC4iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9CgogICAgIyBTaGFycCBkdW1wIHdpdGggYWNjZWxlcmF0aW5nIGRvd25zaWRlID0gY2FzY2FkZSBmb3JtaW5nCiAgICBpZiBjMSBpcyBub3QgTm9uZSBhbmQgYzYgaXMgbm90IE5vbmU6CiAgICAgICAgaWYgYzEgPCAtMTAgYW5kIGM2IDwgLTIwIGFuZCBjMSA8IGM2IC8gMjoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIlNUUlVDVFVSRV9CUkVBSyIsCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiU3RydWN0dXJlIEJyZWFrIiwKICAgICAgICAgICAgICAgICJhY3Rpb24iOiAiRVhJVCBOT1cgLSBjYXNjYWRlIGZvcm1pbmciLAogICAgICAgICAgICAgICAgInN0eWxlIjogcnVsZXNbInN0eWxlIl0sCiAgICAgICAgICAgICAgICAicmVhc29uIjogKAogICAgICAgICAgICAgICAgICAgIGYiQWNjZWxlcmF0aW5nIGR1bXA6IDFoIHtjMTorLjFmfSUsIDZoIHtjNjorLjFmfSUuICIKICAgICAgICAgICAgICAgICAgICBmIkRvd25zaWRlIG1vbWVudHVtIGFjY2VsZXJhdGluZy4iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9CgogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgICMgMi4gTElRVUlESVRZIERSQUlOCiAgICAjIFZvbHVtZS9saXF1aWRpdHkgcmF0aW8gY29sbGFwc2luZyA9IGNhbid0IGV4aXQgd2l0aG91dCBzbGlwcGFnZQogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIHZvbF90b19saXEgPCAwLjA1OiAgIyBWb2x1bWUgZHJvcHBlZCB0byA1JSBvZiBsaXF1aWRpdHkgPSBkcmllZCB1cAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJ0eXBlIjogIkxJUVVJRElUWV9EUkFJTiIsCiAgICAgICAgICAgICJ0aXRsZSI6ICJMaXF1aWRpdHkgRHJhaW4iLAogICAgICAgICAgICAiYWN0aW9uIjogIkVYSVQgQVNBUCAtIG1hcmtldCBkcnlpbmcgdXAiLAogICAgICAgICAgICAic3R5bGUiOiBydWxlc1sic3R5bGUiXSwKICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgIGYiVm9sdW1lIGNvbGxhcHNlZCB0byB7dm9sX3RvX2xpcTouM2Z9eCBsaXF1aWRpdHkuICIKICAgICAgICAgICAgICAgIGYiTWFya2V0IGRlcHRoIGV2YXBvcmF0aW5nIC0gZXhpdCBiZWZvcmUgc2xpcHBhZ2Ugc3Bpa2VzLiIKICAgICAgICAgICAgKSwKICAgICAgICB9CgogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgICMgMy4gSE9MREVSIEVYT0RVUwogICAgIyBVbmlxdWUgd2FsbGV0cyByYXBpZGx5IGV4aXRpbmcgPSBkaXN0cmlidXRpb24gcGhhc2UKICAgICMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACiAgICBpZiB1d18xaF9jaGFuZ2UgaXMgbm90IE5vbmUgYW5kIHV3XzRoX2NoYW5nZSBpcyBub3QgTm9uZToKICAgICAgICBpZiB1d18xaF9jaGFuZ2UgPCAtMjUgYW5kIHV3XzRoX2NoYW5nZSA8IC0yMDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIkhPTERFUl9FWE9EVVMiLAogICAgICAgICAgICAgICAgInRpdGxlIjogIkhvbGRlciBFeG9kdXMiLAogICAgICAgICAgICAgICAgImFjdGlvbiI6ICJFWElUIC0gc21hcnQgbW9uZXkgbGVhdmluZyIsCiAgICAgICAgICAgICAgICAic3R5bGUiOiBydWxlc1sic3R5bGUiXSwKICAgICAgICAgICAgICAgICJyZWFzb24iOiAoCiAgICAgICAgICAgICAgICAgICAgZiJIb2xkZXIgZXhvZHVzOiAxaCB3YWxsZXRzIHt1d18xaF9jaGFuZ2U6Ky4xZn0lLCA0aCB7dXdfNGhfY2hhbmdlOisuMWZ9JS4gIgogICAgICAgICAgICAgICAgICAgIGYiU21hcnQgbW9uZXkgaXMgZXhpdGluZyBlbiBtYXNzZS4iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9CgogICAgIyBIb2xkZXJzIGV4aXRpbmcgd2hpbGUgcHJpY2Ugc3RpbGwgaG9sZGluZyA9IGRpc3RyaWJ1dGlvbiBiZWZvcmUgZHVtcAogICAgaWYgdXdfMWhfY2hhbmdlIGlzIG5vdCBOb25lIGFuZCBjMSBpcyBub3QgTm9uZToKICAgICAgICBpZiB1d18xaF9jaGFuZ2UgPCAtMjAgYW5kIGMxID4gLTU6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJIT0xERVJfRVhPRFVTIiwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJIb2xkZXIgRXhvZHVzIiwKICAgICAgICAgICAgICAgICJhY3Rpb24iOiAiRVhJVCAtIGRpc3RyaWJ1dGlvbiBwaGFzZSIsCiAgICAgICAgICAgICAgICAic3R5bGUiOiBydWxlc1sic3R5bGUiXSwKICAgICAgICAgICAgICAgICJyZWFzb24iOiAoCiAgICAgICAgICAgICAgICAgICAgZiJIb2xkZXJzIGV4aXRpbmcgKHt1d18xaF9jaGFuZ2U6Ky4xZn0lKSB3aGlsZSBwcmljZSBzdGlsbCB7YzE6Ky4xZn0lLiAiCiAgICAgICAgICAgICAgICAgICAgZiJEaXN0cmlidXRpb24gcGhhc2UgLSBkdW1wIGluY29taW5nLiIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0KCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgIyA0LiBIWVBFIEZBREUgKG9yaWdpbmFsIGxvZ2ljLCBub3cgbG93ZXIgcHJpb3JpdHkpCiAgICAjIE1vbWVudHVtIHJvbGxlZCBvdmVyICsgcGFydGljaXBhdGlvbiBmYWRlZAogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIGMxIGlzIG5vdCBOb25lIGFuZCBjNiBpcyBub3QgTm9uZToKICAgICAgICBpZiAoCiAgICAgICAgICAgIGMxIDw9IHJ1bGVzWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8xaCJdCiAgICAgICAgICAgIGFuZCBjNiA8PSBydWxlc1siaHlwZV9mYWRlX21heF9jaGFuZ2VfNmgiXQogICAgICAgICAgICBhbmQgdm9sX3RvX2xpcSA8PSBydWxlc1siaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIl0KICAgICAgICApIG9yICgKICAgICAgICAgICAgYzI0IDw9IHJ1bGVzWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8yNGgiXQogICAgICAgICAgICBhbmQgdm9sX3RvX2xpcSA8PSBydWxlc1siaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIl0KICAgICAgICApOgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInR5cGUiOiAiSFlQRV9GQURFIiwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJIeXBlIEZhZGUiLAogICAgICAgICAgICAgICAgImFjdGlvbiI6ICJCYWQgYnV5IC8gZGUtcmlzayBub3ciLAogICAgICAgICAgICAgICAgInN0eWxlIjogcnVsZXNbInN0eWxlIl0sCiAgICAgICAgICAgICAgICAicmVhc29uIjogKAogICAgICAgICAgICAgICAgICAgIGYiTW9tZW50dW0gcm9sbGVkIG92ZXIgKDFoIHtjMTorLjFmfSUsIDZoIHtjNjorLjFmfSUpIGFuZCBwYXJ0aWNpcGF0aW9uIGZhZGVkICIKICAgICAgICAgICAgICAgICAgICBmIih2b2wvbGlxIHt2b2xfdG9fbGlxOi4yZn0pLiIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0KCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgIyA1LiBDT05TT0xJREFUSU9OIChsb3dlc3QgcHJpb3JpdHkgLSBub3QgYWx3YXlzIGJhZCkKICAgICMgVG9rZW4gcmFuIGJ1dCBpcyBzdGFsbGluZyB3aXRoIGNvb2xpbmcgZmxvdwogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIGMxIGlzIG5vdCBOb25lIGFuZCBjNiBpcyBub3QgTm9uZToKICAgICAgICBpZiAoCiAgICAgICAgICAgIGMyNCA+PSBydWxlc1siY29uc29saWRhdGlvbl9taW5fY2hhbmdlXzI0aCJdCiAgICAgICAgICAgIGFuZCBhYnMoYzEpIDw9IHJ1bGVzWyJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzFoIl0KICAgICAgICAgICAgYW5kIGFicyhjNikgPD0gcnVsZXNbImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfNmgiXQogICAgICAgICAgICBhbmQgdm9sX3RvX2xpcSA8PSBydWxlc1siY29uc29saWRhdGlvbl9tYXhfdm9sX3RvX2xpcSJdCiAgICAgICAgICAgIGFuZCB0eG5zX2gxIDw9IHJ1bGVzWyJjb25zb2xpZGF0aW9uX21heF90eG5zX2gxIl0KICAgICAgICApOgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInR5cGUiOiAiQ09OU09MSURBVElPTiIsCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiUG9zdC1SdW4gQ29uc29saWRhdGlvbiIsCiAgICAgICAgICAgICAgICAiYWN0aW9uIjogIlRha2UgcHJvZml0IC8gdGlnaHRlbiByaXNrIiwKICAgICAgICAgICAgICAgICJzdHlsZSI6IHJ1bGVzWyJzdHlsZSJdLAogICAgICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgICAgICBmIlRva2VuIHJhbiAoe2MyNDorLjFmfSUgMjRoKSBidXQgaXMgc3RhbGxpbmcgKDFoIHtjMTorLjFmfSUsIDZoIHtjNjorLjFmfSUpICIKICAgICAgICAgICAgICAgICAgICBmIndpdGggY29vbGluZyBmbG93ICh0eG5zIDFoIHt0eG5zX2gxfSwgdm9sL2xpcSB7dm9sX3RvX2xpcTouMmZ9KS4iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9CgogICAgcmV0dXJuIE5vbmUKCgpkZWYgX2Zvcm1hdF9zZWxsX2FsZXJ0X21lc3NhZ2UodG9rZW46IGRpY3QsIHNpZ25hbDogZGljdCwgY29tcGFjdDogYm9vbCA9IFRydWUpIC0+IHN0cjoKICAgIHN5bWJvbCA9IHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgbWFya2V0X2NhcCA9IHRva2VuLmdldCgibWFya2V0X2NhcCIpCiAgICBmZHYgPSB0b2tlbi5nZXQoImZkdiIpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIGNhcF9sYWJlbCA9ICJNQ2FwIiBpZiBpc2luc3RhbmNlKG1hcmtldF9jYXAsIChpbnQsIGZsb2F0KSkgYW5kIG1hcmtldF9jYXAgPiAwIGVsc2UgIkZEViIKICAgIHR4bnNfaDEgPSB0b2tlbi5nZXQoInR4bnNfaDEiKQogICAgcmlza19zdHlsZSA9IF9ub3JtYWxpemVfcmlza19zdHlsZShzaWduYWwuZ2V0KCJzdHlsZSIpKQogICAgbW92ZV8yNCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBwcmlvcml0eSA9ICJQMSIgaWYgbW92ZV8yNCA8PSAtMTAgZWxzZSAoIlAyIiBpZiBtb3ZlXzI0IDw9IC01IGVsc2UgIlAzIikKICAgIHJvd3MgPSBbCiAgICAgICAgX2t2X21haW4oIlBSSU9SSVRZIiwgcHJpb3JpdHkpLAogICAgICAgIF9rdl9tYWluKCJTSUdOQUwiLCBzaWduYWwuZ2V0KCJ0aXRsZSIsICJFeGl0IFdhcm5pbmciKSksCiAgICAgICAgX2t2X21haW4oIlBSSUNFIiwgZiJ7X2ZtdF91c2RfY29tcGFjdF9tYWluKHRva2VuLmdldCgncHJpY2UnKSl9IHwgMjRIIHtfZm10X3BjdF9tYWluKHRva2VuLmdldCgnY2hhbmdlXzI0aCcpKX0iKSwKICAgICAgICBfa3ZfbWFpbihjYXBfbGFiZWwudXBwZXIoKSwgX2ZtdF91c2RfY29tcGFjdF9tYWluKGNhcF92YWx1ZSkpLAogICAgICAgIF9rdl9tYWluKCJMSVFVSURJVFkiLCBfZm10X3VzZF9jb21wYWN0X21haW4odG9rZW4uZ2V0KCJsaXF1aWRpdHkiKSkpLAogICAgICAgIF9rdl9tYWluKCJBQ1RJT04iLCBzaWduYWwuZ2V0KCJhY3Rpb24iLCAiRGUtcmlzayIpKSwKICAgICAgICBfa3ZfbWFpbigiUkVBU09OIiwgc2lnbmFsLmdldCgicmVhc29uIiwgIkZsb3cgZGV0ZXJpb3JhdGlvbiBkZXRlY3RlZC4iKSksCiAgICBdCiAgICBpZiBub3QgY29tcGFjdDoKICAgICAgICByb3dzLmV4dGVuZCgKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgIklOVkFMSURBVEUgTW9tZW50dW0gKyB2b2x1bWUgcmVjb3ZlcnkiLAogICAgICAgICAgICAgICAgIkRBVEFfQUdFICAgTGl2ZSByZWZyZXNoIG9uIGFsZXJ0IHNlbmQiLAogICAgICAgICAgICBdCiAgICAgICAgKQogICAgaGVhZGVyID0gX2hlYWRlcl9ibG9ja19tYWluKAogICAgICAgICJbU0lHTkFMXTpTRUxMIiwKICAgICAgICByb3dzPVsKICAgICAgICAgICAgX2t2X21haW4oIlNZTUJPTCIsIGYiJHtzeW1ib2x9IiksCiAgICAgICAgICAgIF9rdl9tYWluKCJQUk9GSUxFIiwgX21vZGUoKS51cHBlcigpKSwKICAgICAgICBdLAogICAgKQogICAgcmV0dXJuIGhlYWRlciArICJcbiIgKyBfcmVuZGVyX3ByZV9tYWluKHJvd3MpCgoKZGVmIF9ub3JtYWxpemVfbWFya2V0X3RpZXIocmF3OiBzdHIgfCBOb25lKSAtPiBzdHI6CiAgICB2YWx1ZSA9IHN0cihyYXcgb3IgImJhbGFuY2VkIikuc3RyaXAoKS5sb3dlcigpCiAgICBhbGlhc2VzID0gewogICAgICAgICJjIjogImNvbnNlcnZhdGl2ZSIsCiAgICAgICAgImNvbnMiOiAiY29uc2VydmF0aXZlIiwKICAgICAgICAiY29uc2VydmF0aXZlIjogImNvbnNlcnZhdGl2ZSIsCiAgICAgICAgImIiOiAiYmFsYW5jZWQiLAogICAgICAgICJiYWwiOiAiYmFsYW5jZWQiLAogICAgICAgICJiYWxhbmNlZCI6ICJiYWxhbmNlZCIsCiAgICAgICAgImEiOiAiYWdncmVzc2l2ZSIsCiAgICAgICAgImFnZyI6ICJhZ2dyZXNzaXZlIiwKICAgICAgICAiYWdncmVzc2l2ZSI6ICJhZ2dyZXNzaXZlIiwKICAgIH0KICAgIHJldHVybiBhbGlhc2VzLmdldCh2YWx1ZSwgImJhbGFuY2VkIikKCgpkZWYgX3N0cmljdGVyX2NvbmZpZGVuY2UobWluX2E6IHN0ciwgbWluX2I6IHN0cikgLT4gc3RyOgogICAgYSA9IHN0cihtaW5fYSBvciAiQiIpLnVwcGVyKCkKICAgIGIgPSBzdHIobWluX2Igb3IgIkIiKS51cHBlcigpCiAgICBpZiBhIG5vdCBpbiBfQ09ORklERU5DRV9PUkRFUjoKICAgICAgICBhID0gIkIiCiAgICBpZiBiIG5vdCBpbiBfQ09ORklERU5DRV9PUkRFUjoKICAgICAgICBiID0gIkIiCiAgICByZXR1cm4gYSBpZiBfQ09ORklERU5DRV9PUkRFUlthXSA+PSBfQ09ORklERU5DRV9PUkRFUltiXSBlbHNlIGIKCgpkZWYgX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kOiBpbnQgPSA1LCBsaW1pdF9iYWQ6IGludCA9IDUsIHRpZXI6IHN0ciA9ICJiYWxhbmNlZCIpIC0+IGRpY3Q6CiAgICB0aWVyX2tleSA9IF9ub3JtYWxpemVfbWFya2V0X3RpZXIodGllcikKICAgIHRpZXJfcnVsZSA9IF9tYXJrZXRfdGllcl9ydWxlKHRpZXJfa2V5KQogICAgcmlza19zdHlsZSA9IF9ub3JtYWxpemVfcmlza19zdHlsZShfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSkKICAgIHRva2VucyA9IGZldGNoX21hcmtldF9kYXRhKCkgb3IgW10KICAgIHJlZ2ltZSA9IF9jb21wdXRlX3JlZ2ltZSh0b2tlbnMpCiAgICBzb2xfcHJveHkgPSBfY29tcHV0ZV9zb2xfcmVnaW1lX3Byb3h5KCkKICAgIHBvbGljeSA9IF9idWlsZF9tYXJrZXRfcG9saWN5KHJlZ2ltZSwgc29sX3Byb3h5KQoKICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInRva2VucyI6IDAsCiAgICAgICAgICAgICJwb2xpY3kiOiBwb2xpY3ksCiAgICAgICAgICAgICJyZWdpbWUiOiByZWdpbWUsCiAgICAgICAgICAgICJnb29kIjogW10sCiAgICAgICAgICAgICJiYWQiOiBbXSwKICAgICAgICAgICAgInJlZ2ltZV9ibG9ja2VkIjogRmFsc2UsCiAgICAgICAgICAgICJ0aWVyIjogdGllcl9rZXksCiAgICAgICAgICAgICJ0aWVyX3J1bGUiOiB0aWVyX3J1bGUsCiAgICAgICAgICAgICJyaXNrX3N0eWxlIjogcmlza19zdHlsZSwKICAgICAgICB9CgogICAgcmVnaW1lX21pbiA9IGZsb2F0KHBvbGljeVsicmVnaW1lX21pbl9zY29yZSJdKQogICAgcmVnaW1lX2Jsb2NrZWQgPSBFTkFCTEVfUkVHSU1FX0dBVEUgYW5kIHJlZ2ltZVsic2NvcmUiXSA8IHJlZ2ltZV9taW4KCiAgICBzY29yZWQgPSBbXQogICAgZm9yIHRva2VuIGluIHRva2VuczoKICAgICAgICBpZiBub3QgdG9rZW4uZ2V0KCJhZGRyZXNzIik6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgIyBFbnJpY2ggd2l0aCBCaXJkRXllIG92ZXJ2aWV3IGRhdGEgKHVuaXF1ZSB3YWxsZXRzLCBzb2NpYWwsIGV0Yy4pCiAgICAgICAgdG9rZW4gPSBfZW5yaWNoX3Rva2VuX2Zvcl9zY29yaW5nKHRva2VuKQogICAgICAgIHRva2VuWyJlbmdpbmVfcHJvZmlsZSJdID0gX21vZGUoKQogICAgICAgIHNjb3JlID0gY2FsY3VsYXRlX3Rva2VuX3Njb3JlKHRva2VuKQogICAgICAgIGNvbmZpZGVuY2UgPSBfY29uZmlkZW5jZV9mcm9tX3Njb3JlKHNjb3JlKQogICAgICAgIHRva2VuWyJzY29yZSJdID0gc2NvcmUKICAgICAgICB0b2tlblsiY29uZmlkZW5jZSJdID0gY29uZmlkZW5jZQogICAgICAgIHNjb3JlZC5hcHBlbmQodG9rZW4pCgogICAgc2NvcmVkLnNvcnQoa2V5PWxhbWJkYSB0OiAoZmxvYXQodC5nZXQoInNjb3JlIiwgMCkgb3IgMCksIGZsb2F0KHQuZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkpLCByZXZlcnNlPVRydWUpCgogICAgZ29vZCA9IFtdCiAgICBiYWQgPSBbXQogICAgcmVxdWlyZWRfY29uZiA9IF9zdHJpY3Rlcl9jb25maWRlbmNlKHBvbGljeVsibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiXSwgdGllcl9ydWxlWyJtaW5fY29uZmlkZW5jZSJdKQogICAgcmVxdWlyZWRfc2NvcmUgPSBmbG9hdChwb2xpY3lbImFsZXJ0X3RocmVzaG9sZCJdKSArIGZsb2F0KHRpZXJfcnVsZVsibWluX3Njb3JlX2RlbHRhIl0pCiAgICByZXF1aXJlZF9zY29yZSA9IG1heCgwLjAsIG1pbigxMDAuMCwgcmVxdWlyZWRfc2NvcmUpKQogICAgd2FsbGV0X3RhcmdldCA9ICJXMyIgaWYgdGllcl9rZXkgPT0gImFnZ3Jlc3NpdmUiIGVsc2UgKCJXMS9XMiIgaWYgdGllcl9rZXkgPT0gImNvbnNlcnZhdGl2ZSIgZWxzZSAiVzIiKQoKICAgIGZvciB0b2tlbiBpbiBzY29yZWQ6CiAgICAgICAgc3ltYm9sID0gdG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIKICAgICAgICByZWFzb25zID0gW10KICAgICAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICAgICAgdm9sdW1lXzI0aCA9IGZsb2F0KHRva2VuLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICAgICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICAgICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMC4wCgogICAgICAgIHRva2VuWyJ3YWxsZXRfZml0Il0gPSB3YWxsZXRfdGFyZ2V0CiAgICAgICAgcmlza19wbGFuLCByb3RhdGlvbl9wbGFuID0gX3dhbGxldF9ndWlkYW5jZSh3YWxsZXRfdGFyZ2V0KQogICAgICAgIHRva2VuWyJyaXNrX3BsYW4iXSA9IHJpc2tfcGxhbgogICAgICAgIHRva2VuWyJyb3RhdGlvbl9wbGFuIl0gPSByb3RhdGlvbl9wbGFuCgogICAgICAgIGlmIG5vdCBfcGFzc2VzX3F1YWxpdHlfZmlsdGVycyh0b2tlbik6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJmYWlscyBiYXNlIHF1YWxpdHkgZmlsdGVycyIpCiAgICAgICAgaWYgbm90IF9wYXNzZXNfZXhlY3V0aW9uX3F1YWxpdHlfZmlsdGVycyh0b2tlbik6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJmYWlscyBleGVjdXRpb24gcXVhbGl0eSBmaWx0ZXJzIikKICAgICAgICBpZiBub3QgX3Bhc3Nlc190YWN0aWNhbF9maWx0ZXJzKHRva2VuKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoImZhaWxzIHRhY3RpY2FsIGNvbmZpcm1hdGlvbiIpCiAgICAgICAgaWYgbGlxdWlkaXR5IDwgZmxvYXQodGllcl9ydWxlWyJtaW5fbGlxdWlkaXR5Il0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmImxpcTwke2ludCh0aWVyX3J1bGVbJ21pbl9saXF1aWRpdHknXSk6LH0iKQogICAgICAgIGlmIHZvbHVtZV8yNGggPCBmbG9hdCh0aWVyX3J1bGVbIm1pbl92b2x1bWVfMjRoIl0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmInZvbDI0aDwke2ludCh0aWVyX3J1bGVbJ21pbl92b2x1bWVfMjRoJ10pOix9IikKICAgICAgICBpZiBjaGFuZ2VfMjRoIDwgZmxvYXQodGllcl9ydWxlWyJtaW5fY2hhbmdlXzI0aCJdKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoZiIyNGg8e3RpZXJfcnVsZVsnbWluX2NoYW5nZV8yNGgnXTorLjFmfSUiKQogICAgICAgIGlmIGFicyhjaGFuZ2VfMjRoKSA+IGZsb2F0KHRpZXJfcnVsZVsibWF4X2Fic19jaGFuZ2VfMjRoIl0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmInwyNGh8Pnt0aWVyX3J1bGVbJ21heF9hYnNfY2hhbmdlXzI0aCddOi4wZn0lIikKICAgICAgICBpZiB2b2xfdG9fbGlxID4gZmxvYXQodGllcl9ydWxlWyJtYXhfdm9sX3RvX2xpcSJdKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoInR1cm5vdmVyIG92ZXJoZWF0ZWQiKQogICAgICAgIGlmIGZsb2F0KHRva2VuLmdldCgic2NvcmUiLCAwKSBvciAwKSA8IHJlcXVpcmVkX3Njb3JlOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmInNjb3JlPHtyZXF1aXJlZF9zY29yZTouMWZ9IikKICAgICAgICBpZiBub3QgX2NvbmZpZGVuY2VfbWVldHNfcnVsZSh0b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpLCByZXF1aXJlZF9jb25mKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoZiJjb25maWRlbmNlPHtyZXF1aXJlZF9jb25mfSIpCiAgICAgICAgaWYgX2lzX3N5bWJvbF9vbl9jb29sZG93bihzeW1ib2wsIGNvb2xkb3duX2hvdXJzPXBvbGljeVsiYWxlcnRfY29vbGRvd25faG91cnMiXSk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJjb29sZG93biBhY3RpdmUiKQogICAgICAgIGlmIF9hcHBseV9zeW1ib2xfY29udHJvbHMoc3ltYm9sKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoInN5bWJvbCBjb250cm9sIGFjdGl2ZSIpCiAgICAgICAgaWYgcmVnaW1lX2Jsb2NrZWQgYW5kIG5vdCBib29sKHRpZXJfcnVsZVsiYWxsb3dfcmlza19vZmYiXSk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJyZWdpbWUgZ2F0ZSBibG9ja2VkIikKICAgICAgICBpZiBwb2xpY3lbInN0YXRlIl0gaW4geyJSSVNLX09GRiIsICJFWFRSRU1FX1JJU0tfT0ZGIn0gYW5kIG5vdCBib29sKHRpZXJfcnVsZVsiYWxsb3dfcmlza19vZmYiXSk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJyaXNrLW9mZiBzdGF0ZSIpCgogICAgICAgIGlmIG5vdCByZWFzb25zOgogICAgICAgICAgICBnb29kLmFwcGVuZCh0b2tlbikKICAgICAgICBlbHNlOgogICAgICAgICAgICBiYWQuYXBwZW5kKCh0b2tlbiwgcmVhc29ucykpCgogICAgcmV0dXJuIHsKICAgICAgICAidG9rZW5zIjogbGVuKHNjb3JlZCksCiAgICAgICAgInBvbGljeSI6IHBvbGljeSwKICAgICAgICAicmVnaW1lIjogcmVnaW1lLAogICAgICAgICJnb29kIjogZ29vZFs6bWF4KDEsIGxpbWl0X2dvb2QpXSwKICAgICAgICAiYmFkIjogYmFkWzptYXgoMSwgbGltaXRfYmFkKV0sCiAgICAgICAgInJlZ2ltZV9ibG9ja2VkIjogcmVnaW1lX2Jsb2NrZWQsCiAgICAgICAgInRpZXIiOiB0aWVyX2tleSwKICAgICAgICAidGllcl9ydWxlIjogdGllcl9ydWxlLAogICAgICAgICJyaXNrX3N0eWxlIjogcmlza19zdHlsZSwKICAgIH0KCgpkZWYgX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcHNob3Q6IGRpY3QsIG1vZGU6IHN0ciA9ICJib3RoIikgLT4gc3RyOgogICAgcG9saWN5ID0gc25hcHNob3RbInBvbGljeSJdCiAgICByZWdpbWUgPSBzbmFwc2hvdFsicmVnaW1lIl0KICAgIHRpZXJfcnVsZSA9IHNuYXBzaG90LmdldCgidGllcl9ydWxlIikgb3Ige30KICAgIHRpZXJfbGFiZWwgPSB0aWVyX3J1bGUuZ2V0KCJsYWJlbCIpIG9yIHN0cihzbmFwc2hvdC5nZXQoInRpZXIiKSBvciAiQmFsYW5jZWQiKS50aXRsZSgpCiAgICByaXNrX3N0eWxlID0gX25vcm1hbGl6ZV9yaXNrX3N0eWxlKHNuYXBzaG90LmdldCgicmlza19zdHlsZSIpKQogICAgaGVhZGVyID0gKAogICAgICAgIGYiTUFSS0VUIE5PVyB8IHtfbW9kZSgpLnVwcGVyKCl9IHwge3RpZXJfbGFiZWx9XG4iCiAgICAgICAgZiJSaXNrIFByb2ZpbGU6IHtfcmlza19zdHlsZV9sYWJlbChyaXNrX3N0eWxlKX1cbiIKICAgICAgICBmIlN0YXRlOiB7cG9saWN5WydzdGF0ZSddfSB8IFNjb3JlIFRocjoge2ludChwb2xpY3lbJ2FsZXJ0X3RocmVzaG9sZCddKX0gfCBDb25mOiB7cG9saWN5WydtaW5fY29uZmlkZW5jZV90b19hbGVydCddfVxuIgogICAgICAgIGYiUmVnaW1lOiB7cmVnaW1lWydsYWJlbCddfSAoe3JlZ2ltZVsnc2NvcmUnXTouMWZ9L3twb2xpY3lbJ3JlZ2ltZV9taW5fc2NvcmUnXTouMWZ9KVxuIgogICAgICAgIGYiVW5pdmVyc2U6IHtzbmFwc2hvdFsndG9rZW5zJ119IHRva2Vuc1xuIgogICAgICAgIGYiVGllciBHYXRlczogbGlxPj17X2ZtdF91c2RfY29tcGFjdF9tYWluKHRpZXJfcnVsZS5nZXQoJ21pbl9saXF1aWRpdHknKSl9ICIKICAgICAgICBmInZvbD49e19mbXRfdXNkX2NvbXBhY3RfbWFpbih0aWVyX3J1bGUuZ2V0KCdtaW5fdm9sdW1lXzI0aCcpKX0iCiAgICApCgogICAgbGluZXMgPSBbaGVhZGVyXQoKICAgIGlmIGludChzbmFwc2hvdC5nZXQoInRva2VucyIsIDApKSA9PSAwOgogICAgICAgIGxpbmVzLmFwcGVuZCgiXG5EYXRhIGZlZWQgdW5hdmFpbGFibGUgcmlnaHQgbm93LiBUcnkgYWdhaW4gaW4gMS0yIG1pbnV0ZXMuIikKICAgICAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKQoKICAgIGlmIG1vZGUgaW4geyJib3RoIiwgImdvb2QifToKICAgICAgICBsaW5lcy5hcHBlbmQoIlxuR09PRCBCVVlTIE5PVyIpCiAgICAgICAgaWYgc25hcHNob3RbImdvb2QiXToKICAgICAgICAgICAgZm9yIGlkeCwgdG9rZW4gaW4gZW51bWVyYXRlKHNuYXBzaG90WyJnb29kIl0sIHN0YXJ0PTEpOgogICAgICAgICAgICAgICAgbGluZXMuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgIGYie2lkeH0uICR7dG9rZW4uZ2V0KCdzeW1ib2wnLCdVTktOT1dOJyl9IHwgc2NvcmUge2Zsb2F0KHRva2VuLmdldCgnc2NvcmUnLDApIG9yIDApOi4xZn0gfCAiCiAgICAgICAgICAgICAgICAgICAgZiJ7dG9rZW4uZ2V0KCdjb25maWRlbmNlJywnQycpfSB8IDI0aCB7ZmxvYXQodG9rZW4uZ2V0KCdjaGFuZ2VfMjRoJywwKSBvciAwKTorLjFmfSUgfCAiCiAgICAgICAgICAgICAgICAgICAgZiJsaXEge19mbXRfdXNkX2NvbXBhY3RfbWFpbih0b2tlbi5nZXQoJ2xpcXVpZGl0eScpKX0gfCBmaXQge3Rva2VuLmdldCgnd2FsbGV0X2ZpdCcsJ1cyJyl9IgogICAgICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vdGUgPSAiTm9uZS4gTWFya2V0IGlzIHNlbGVjdGl2ZSByaWdodCBub3cuIgogICAgICAgICAgICBpZiBzbmFwc2hvdC5nZXQoInJlZ2ltZV9ibG9ja2VkIik6CiAgICAgICAgICAgICAgICBub3RlID0gIk5vbmUuIFJlZ2ltZSBnYXRlIGlzIGJsb2NraW5nIGVudHJpZXMgcmlnaHQgbm93LiIKICAgICAgICAgICAgbGluZXMuYXBwZW5kKG5vdGUpCgogICAgaWYgbW9kZSBpbiB7ImJvdGgiLCAiYmFkIn06CiAgICAgICAgbGluZXMuYXBwZW5kKCJcbkJBRCBCVVlTIE5PVyIpCiAgICAgICAgaWYgc25hcHNob3RbImJhZCJdOgogICAgICAgICAgICBmb3IgaWR4LCBpdGVtIGluIGVudW1lcmF0ZShzbmFwc2hvdFsiYmFkIl0sIHN0YXJ0PTEpOgogICAgICAgICAgICAgICAgdG9rZW4sIHJlYXNvbnMgPSBpdGVtCiAgICAgICAgICAgICAgICByZWFzb25zX3RleHQgPSAiOyAiLmpvaW4ocmVhc29uc1s6M10pCiAgICAgICAgICAgICAgICBsaW5lcy5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgZiJ7aWR4fS4gJHt0b2tlbi5nZXQoJ3N5bWJvbCcsJ1VOS05PV04nKX0gfCAyNGgge2Zsb2F0KHRva2VuLmdldCgnY2hhbmdlXzI0aCcsMCkgb3IgMCk6Ky4xZn0lIHwge3JlYXNvbnNfdGV4dH0iCiAgICAgICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGluZXMuYXBwZW5kKCJObyBvYnZpb3VzIGF2b2lkIGxpc3QgZnJvbSBjdXJyZW50IHVuaXZlcnNlLiIpCgogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCgpkZWYgX2Zvcm1hdF9tYXJrZXRfbm93X211bHRpX3RpZXIobW9kZTogc3RyID0gImJvdGgiKSAtPiBzdHI6CiAgICBzZWN0aW9ucyA9IFtdCiAgICBmb3IgdGllciBpbiAoImNvbnNlcnZhdGl2ZSIsICJiYWxhbmNlZCIsICJhZ2dyZXNzaXZlIik6CiAgICAgICAgc25hcCA9IF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZD0zLCBsaW1pdF9iYWQ9MywgdGllcj10aWVyKQogICAgICAgIHNlY3Rpb25zLmFwcGVuZChfZm9ybWF0X21hcmtldF9ub3dfbWVzc2FnZShzbmFwLCBtb2RlPW1vZGUpKQogICAgcmV0dXJuICJcblxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiIuam9pbihzZWN0aW9ucykKCgpkZWYgX3RpZXJfYXJnX29yX2RlZmF1bHQoYXJncywgZGVmYXVsdDogc3RyID0gImJhbGFuY2VkIik6CiAgICBpZiBub3QgYXJnczoKICAgICAgICByZXR1cm4gZGVmYXVsdAogICAgcmF3ID0gc3RyKGFyZ3NbMF0pLnN0cmlwKCkubG93ZXIoKQogICAgaWYgcmF3ID09ICJhbGwiOgogICAgICAgIHJldHVybiAiYWxsIgogICAgcmV0dXJuIF9ub3JtYWxpemVfbWFya2V0X3RpZXIocmF3KQoKCmRlZiBfZm9ybWF0X3dhbGxldDJfbWVzc2FnZShtb2RlOiBzdHIgPSAiYm90aCIpIC0+IHN0cjoKICAgIGJhc2UgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9NSwgbGltaXRfYmFkPTUsIHRpZXI9ImJhbGFuY2VkIikKICAgIHN0YXRlID0gc3RyKChiYXNlLmdldCgicG9saWN5Iikgb3Ige30pLmdldCgic3RhdGUiKSBvciAiIikKICAgIHNuYXAgPSBiYXNlCiAgICBpZiBzdGF0ZSBpbiB7IlJJU0tfT0ZGIiwgIkVYVFJFTUVfUklTS19PRkYifToKICAgICAgICBzbmFwID0gX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPTUsIGxpbWl0X2JhZD01LCB0aWVyPSJjb25zZXJ2YXRpdmUiKQogICAgcmV0dXJuIF93YWxsZXRfaGVhZGVyKCJXMiIpICsgIlxuXG4iICsgX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT1tb2RlKQoKCmRlZiBfZm9ybWF0X3dhbGxldDNfbWVzc2FnZShtb2RlOiBzdHIgPSAiYm90aCIpIC0+IHN0cjoKICAgIHNuYXAgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9NSwgbGltaXRfYmFkPTUsIHRpZXI9ImFnZ3Jlc3NpdmUiKQogICAgcm93cyA9IF9idWlsZF93YXRjaGxpc3Rfcm93cygpCiAgICBsaXZlX3Jvd3MgPSBbciBmb3IgciBpbiByb3dzIGlmIGJvb2woci5nZXQoImhhc19saXZlX2RhdGEiLCBGYWxzZSkpXQogICAgZ29vZF93YXRjaCA9IFsKICAgICAgICByIGZvciByIGluIGxpdmVfcm93cwogICAgICAgIGlmIHN0cihyLmdldCgic3RhdHVzIikgb3IgIiIpLnRpdGxlKCkgaW4geyJNb21lbnR1bSIsICJSZWNsYWltIn0KICAgICAgICBhbmQgc3RyKHIuZ2V0KCJmYWlsdXJlX3Jpc2siKSBvciAiIikudGl0bGUoKSAhPSAiSGlnaCIKICAgIF1bOjRdCiAgICBiYWRfd2F0Y2ggPSBbCiAgICAgICAgciBmb3IgciBpbiByb3dzCiAgICAgICAgaWYgc3RyKHIuZ2V0KCJzdGF0dXMiKSBvciAiIikudGl0bGUoKSBpbiB7IkJyZWFrZG93biIsICJJbGxpcXVpZCIsICJOb0RhdGEifQogICAgICAgIG9yIHN0cihyLmdldCgiZmFpbHVyZV9yaXNrIikgb3IgIiIpLnRpdGxlKCkgPT0gIkhpZ2giCiAgICBdWzo0XQoKICAgIGxpbmVzID0gW193YWxsZXRfaGVhZGVyKCJXMyIpLCAiIl0KICAgIGlmIG1vZGUgaW4geyJib3RoIiwgImdvb2QifToKICAgICAgICBsaW5lcy5hcHBlbmQoIlczIFdBVENITElTVCBPUFBPUlRVTklUSUVTIikKICAgICAgICBpZiBnb29kX3dhdGNoOgogICAgICAgICAgICBmb3IgaWR4LCByIGluIGVudW1lcmF0ZShnb29kX3dhdGNoLCBzdGFydD0xKToKICAgICAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICBmIntpZHh9LiAke3N0cihyLmdldCgnc3ltYm9sJykgb3IgJ1VOS05PV04nKS51cHBlcigpfSB8IHtyLmdldCgnc3RhdHVzJyl9IHwgIgogICAgICAgICAgICAgICAgICAgIGYidXBzaWRlIHtyLmdldCgndXBzaWRlX3BvdGVudGlhbCcsJ04vQScpfSB8IHJpc2sge3IuZ2V0KCdmYWlsdXJlX3Jpc2snLCdOL0EnKX0gfCAiCiAgICAgICAgICAgICAgICAgICAgZiIyNGgge2Zsb2F0KHIuZ2V0KCdjaGFuZ2VfMjRoJywwKSBvciAwKTorLjFmfSUiCiAgICAgICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGluZXMuYXBwZW5kKCJObyB3YXRjaGxpc3Qgc2V0dXBzIHdpdGggZmF2b3JhYmxlIGFzeW1tZXRyeSByaWdodCBub3cuIikKICAgICAgICBsaW5lcy5hcHBlbmQoIiIpCgogICAgaWYgbW9kZSBpbiB7ImJvdGgiLCAiYmFkIn06CiAgICAgICAgbGluZXMuYXBwZW5kKCJXMyBXQVRDSExJU1QgQVZPSUQvQ0FVVElPTiIpCiAgICAgICAgaWYgYmFkX3dhdGNoOgogICAgICAgICAgICBmb3IgaWR4LCByIGluIGVudW1lcmF0ZShiYWRfd2F0Y2gsIHN0YXJ0PTEpOgogICAgICAgICAgICAgICAgc3RhdHVzID0gc3RyKHIuZ2V0KCJzdGF0dXMiKSBvciAiVW5rbm93biIpCiAgICAgICAgICAgICAgICByZWFzb24gPSBzdHIoci5nZXQoInJlYXNvbiIpIG9yICIiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiByZWFzb246CiAgICAgICAgICAgICAgICAgICAgcmVhc29uID0gZiIgfCB7cmVhc29ufSIKICAgICAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICBmIntpZHh9LiAke3N0cihyLmdldCgnc3ltYm9sJykgb3IgJ1VOS05PV04nKS51cHBlcigpfSB8IHtzdGF0dXN9IHwgIgogICAgICAgICAgICAgICAgICAgIGYicmlzayB7ci5nZXQoJ2ZhaWx1cmVfcmlzaycsJ04vQScpfXtyZWFzb259IgogICAgICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgiTm8gbWFqb3Igd2F0Y2hsaXN0IGRhbmdlciBmbGFncyByaWdodCBub3cuIikKICAgICAgICBsaW5lcy5hcHBlbmQoIiIpCgogICAgaWYgbW9kZSBpbiB7ImJvdGgiLCAiZ29vZCJ9OgogICAgICAgIGxpbmVzLmFwcGVuZChfZm9ybWF0X21hcmtldF9ub3dfbWVzc2FnZShzbmFwLCBtb2RlPSJnb29kIikpCiAgICBlbGlmIG1vZGUgPT0gImJhZCI6CiAgICAgICAgbGluZXMuYXBwZW5kKF9mb3JtYXRfbWFya2V0X25vd19tZXNzYWdlKHNuYXAsIG1vZGU9ImJhZCIpKQogICAgZWxzZToKICAgICAgICBsaW5lcy5hcHBlbmQoX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT0iYm90aCIpKQogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCgphc3luYyBkZWYgY21kX2hlbHAodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgIkNvbW1hbmRzOlxuIgogICAgICAgICIvc3RhdHVzIC0gRW5naW5lIGhlYWx0aCBzbmFwc2hvdFxuIgogICAgICAgICIvbW9kZSBbc3RyYXRlZ2ljfHRhY3RpY2FsXSAtIFN3aXRjaCBydW50aW1lICsgcGVyc2lzdCBwcmVzZXRcbiIKICAgICAgICAiL3Jpc2twcm9maWxlIFtjYXBpdGFsfGJhbGFuY2VkfHNuaXBlcl0gLSBTZXQgbWFya2V0IHNjYW4gcmlzayBzdHlsZVxuIgogICAgICAgICIvcmlzayAtIFJpc2sgZ292ZXJub3Igc3RhdGVcbiIKICAgICAgICAiL3BhdXNlIFtob3Vyc10gLSBQYXVzZSBhbGVydHNcbiIKICAgICAgICAiL3Jlc3VtZSAtIENsZWFyIHBhdXNlXG4iCiAgICAgICAgIi9wZXJmb3JtYW5jZSAtIDI0aC83ZCBwZXJmb3JtYW5jZSBwYW5lbFxuIgogICAgICAgICIvYnV5IDxzeW1ib2xfb3JfbWludD4gW2VudHJ5XSAtIFN0YXJ0IHRyYWNrZWQgcG9zaXRpb24gKGVuYWJsZXMgc2VsbCBhbGVydHMpXG4iCiAgICAgICAgIi9zb2xkIDxzeW1ib2xfb3JfbWludD4gW2V4aXRdIC0gQ2xvc2UgdHJhY2tlZCBwb3NpdGlvblxuIgogICAgICAgICIvcG9zaXRpb25zIC0gU2hvdyB0cmFja2VkIG9wZW4gcG9zaXRpb25zXG4iCiAgICAgICAgIi9kaWdlc3QgLSBTZW5kIGltbWVkaWF0ZSBzZXR1cCBkaWdlc3RcbiIKICAgICAgICAiL21hcmtldG5vdyBbY29uc2VydmF0aXZlfGJhbGFuY2VkfGFnZ3Jlc3NpdmV8YWxsXSAtIEdvb2QrYmFkIG5vd1xuIgogICAgICAgICIvZ29vZGJ1eSBbY29uc2VydmF0aXZlfGJhbGFuY2VkfGFnZ3Jlc3NpdmV8YWxsXSAtIEdvb2QgYnV5cyBub3dcbiIKICAgICAgICAiL2JhZGJ1eSBbY29uc2VydmF0aXZlfGJhbGFuY2VkfGFnZ3Jlc3NpdmV8YWxsXSAtIEJhZCBidXlzIG5vd1xuIgogICAgICAgICIvd2FsbGV0Mm5vdyAtIFdhbGxldCAyIGdvb2QgYnV5cyBub3dcbiIKICAgICAgICAiL3dhbGxldDJiYWQgLSBXYWxsZXQgMiBhdm9pZHMgbm93XG4iCiAgICAgICAgIi93YWxsZXQzbm93IC0gV2FsbGV0IDMgb3Bwb3J0dW5pdGllcyBub3dcbiIKICAgICAgICAiL3dhbGxldDNiYWQgLSBXYWxsZXQgMyBkYW5nZXIgbGlzdCBub3dcbiIKICAgICAgICAiL3dhbGxldHBsYW4gLSBXYWxsZXQgYWxsb2NhdGlvbi9yaXNrIHBsYXlib29rXG4iCiAgICAgICAgIi9ydW5uZXJ3YXRjaCAtIFJ1biBmaXJzdC1kYXkgcnVubmVyIHdhdGNoIHNjYW4gbm93XG4iCiAgICAgICAgIi93YXRjaGxpc3QgLSBSdW4gbWFudWFsIHdhdGNobGlzdCBzY2FuIG5vd1xuIgogICAgICAgICIvd2F0Y2hsaXN0c3VtbWFyeSAtIFNlbmQgZnVsbCBtYW51YWwgd2F0Y2hsaXN0IHN1bW1hcnkgbm93XG4iCiAgICAgICAgIkF1dG8gam9iczogMy10aWVyIGJvYXJkICg2aCkgKyBkYWlseSByZWNhcCArIHNlbGwvZXhpdCBzY2FubmVyIChvbmx5IHRyYWNrZWQgcG9zaXRpb25zKVxuIgogICAgICAgICIvaGVscCAtIFRoaXMgbWVudSIKICAgICkKCgphc3luYyBkZWYgY21kX3N0YXR1cyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBoZWFsdGggPSBnZXRfZW5naW5lX2hlYWx0aF9zbmFwc2hvdCgpCiAgICBwZXJmID0gZ2V0X3BlcmZvcm1hbmNlX3N1bW1hcnkobG9va2JhY2tfaG91cnM9MjQpCiAgICBwYXVzZSA9IGdldF9yaXNrX3BhdXNlX3N0YXRlKCkKICAgIGxhdGVzdCA9IGdldF9sYXRlc3RfZW5naW5lX2V2ZW50KCkgb3Ige30KICAgIGJsb2NrZXIgPSAoCiAgICAgICAgZiJ7bGF0ZXN0LmdldCgnZGVjaXNpb24nKX0gfCB7bGF0ZXN0LmdldCgnbm90ZXMnLCAnJyl9IgogICAgICAgIGlmIGxhdGVzdC5nZXQoImRlY2lzaW9uIikKICAgICAgICBlbHNlICJOL0EiCiAgICApCiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgbGVnYWN5X3N0YXR1cyA9ICJPTiIgaWYgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQgZWxzZSAiT0ZGIgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn6SWIFtTVEFUVVNdOiBFTkdJTkU8L2I+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57X2N1cnJlbnRfbW9kZV90ZXh0KCl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+VkCBMYXN0IHNjYW46ICAge19mbXRfZHQoaGVhbHRoLmdldCgnbGFzdF9zY2FuX3J1bicpKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk6IgTGFzdCBhbGVydDogIHtfZm10X2R0KGhlYWx0aC5nZXQoJ2xhc3RfYWxlcnQnKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OKIDI0aCBzdGF0czogICB7cGVyZlsnc2NhbnMnXX0gc2NhbnMgLyB7cGVyZlsnYWxlcnRzJ119IGFsZXJ0cyAoe3BlcmZbJ2FsZXJ0X3JhdGUnXTouMWZ9JSk8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKPuCAgUGF1c2UgdW50aWw6IHtfZm10X2R0KHBhdXNlLmdldCgncGF1c2VfdW50aWwnKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+UjiBMRUdBQ1kgUkVDT1ZFUlk6IHtsZWdhY3lfc3RhdHVzfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+ICAgQWdlIOKJpXtMRUdBQ1lfUkVDT1ZFUllfTUlOX0FHRV9EQVlTOi4wZn1kIHwgTGlxIOKJpSR7TEVHQUNZX1JFQ09WRVJZX01JTl9MSVFVSURJVFkvMWU2Oi4xZn1NIHwgVm9sIOKJpSR7TEVHQUNZX1JFQ09WRVJZX01JTl9WT0xVTUVfMjRILzFlMzouMGZ9SzwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKaoSBMYXRlc3QgZXZlbnQ6IHtodG1sLmVzY2FwZShzdHIoYmxvY2tlcikpfTwvY29kZT4iLAogICAgXQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgIlxuIi5qb2luKGxpbmVzKSwKICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICkKCgphc3luYyBkZWYgY21kX21vZGUodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgaWYgbm90IGNvbnRleHQuYXJnczoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIlVzYWdlOiAvbW9kZSBzdHJhdGVnaWMgb3IgL21vZGUgdGFjdGljYWxcblxuIgogICAgICAgICAgICBmIntfY3VycmVudF9tb2RlX3RleHQoKX0iCiAgICAgICAgKQogICAgICAgIHJldHVybgoKICAgIG1vZGUgPSBjb250ZXh0LmFyZ3NbMF0uc3RyaXAoKS5sb3dlcigpCiAgICBpZiBtb2RlIG5vdCBpbiBfTU9ERV9QUkVTRVRTOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJJbnZhbGlkIG1vZGUuIFVzZTogc3RyYXRlZ2ljIG9yIHRhY3RpY2FsIikKICAgICAgICByZXR1cm4KCiAgICBfYXBwbHlfbW9kZShtb2RlKQogICAgX3BlcnNpc3RfbW9kZShtb2RlKQogICAgX3Jlc2NoZWR1bGVfcnVuX2VuZ2luZV9qb2JzKGNvbnRleHQuYXBwbGljYXRpb24pCiAgICBsb2dfc2lnbmFsKAogICAgICAgIHsKICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAiZGVjaXNpb24iOiAiTU9ERV9TV0lUQ0giLAogICAgICAgICAgICAibm90ZXMiOiBmInRlbGVncmFtIG1vZGUgc3dpdGNoIC0+IHttb2RlfSIsCiAgICAgICAgfQogICAgKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgIk1vZGUgc3dpdGNoZWQgYW5kIHBlcnNpc3RlZC5cblxuIgogICAgICAgIGYie19jdXJyZW50X21vZGVfdGV4dCgpfSIKICAgICkKCgphc3luYyBkZWYgY21kX3Jpc2twcm9maWxlKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KCiAgICBjdXJyZW50ID0gX25vcm1hbGl6ZV9yaXNrX3N0eWxlKF9ydW50aW1lLmdldCgicmlza19zdHlsZSIpKQogICAgaWYgbm90IGNvbnRleHQuYXJnczoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIlVzYWdlOiAvcmlza3Byb2ZpbGUgY2FwaXRhbCB8IGJhbGFuY2VkIHwgc25pcGVyXG5cbiIKICAgICAgICAgICAgZiJDdXJyZW50OiB7X3Jpc2tfc3R5bGVfbGFiZWwoY3VycmVudCl9ICh7Y3VycmVudH0pXG4iCiAgICAgICAgICAgIGYie19yaXNrX3N0eWxlX2Rlc2NyaXB0aW9uKGN1cnJlbnQpfSIKICAgICAgICApCiAgICAgICAgcmV0dXJuCgogICAgcmF3ID0gc3RyKGNvbnRleHQuYXJnc1swXSkuc3RyaXAoKS5sb3dlcigpCiAgICByZXNvbHZlZCA9IF9SSVNLX1NUWUxFX0FMSUFTRVMuZ2V0KHJhdykKICAgIGlmIG5vdCByZXNvbHZlZDoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIkludmFsaWQgcmlzayBwcm9maWxlLiBVc2U6IGNhcGl0YWwsIGJhbGFuY2VkLCBvciBzbmlwZXIuIgogICAgICAgICkKICAgICAgICByZXR1cm4KCiAgICBfcnVudGltZVsicmlza19zdHlsZSJdID0gcmVzb2x2ZWQKICAgIF9zZXRfZW52X3ZhbHVlcyh7IlJJU0tfU1RZTEUiOiByZXNvbHZlZH0pCiAgICBsb2dfc2lnbmFsKAogICAgICAgIHsKICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAiZGVjaXNpb24iOiAiUklTS19TVFlMRV9TV0lUQ0giLAogICAgICAgICAgICAibm90ZXMiOiBmInRlbGVncmFtIHJpc2sgc3R5bGUgc3dpdGNoIC0+IHtyZXNvbHZlZH0iLAogICAgICAgIH0KICAgICkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJSaXNrIHByb2ZpbGUgdXBkYXRlZCBhbmQgcGVyc2lzdGVkLlxuXG4iCiAgICAgICAgZiJ7X2N1cnJlbnRfbW9kZV90ZXh0KCl9XG4iCiAgICAgICAgZiJTdHlsZSBkZXRhaWw6IHtfcmlza19zdHlsZV9kZXNjcmlwdGlvbihyZXNvbHZlZCl9IgogICAgKQoKCmFzeW5jIGRlZiBjbWRfcGF1c2UodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgaG91cnMgPSA2CiAgICBpZiBjb250ZXh0LmFyZ3M6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3VycyA9IG1heCgxLCBpbnQoY29udGV4dC5hcmdzWzBdKSkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgc2V0X3Jpc2tfcGF1c2UoaG91cnMsICJtYW51YWxfdGVsZWdyYW1fcGF1c2UiKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoZiJBbGVydHMgcGF1c2VkIGZvciB7aG91cnN9aC4iKQoKCmFzeW5jIGRlZiBjbWRfcmVzdW1lKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGNsZWFyX3Jpc2tfcGF1c2UoKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIkFsZXJ0cyByZXN1bWVkIChwYXVzZSBjbGVhcmVkKS4iKQoKCmFzeW5jIGRlZiBjbWRfcmlzayh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBwYXVzZSA9IGdldF9yaXNrX3BhdXNlX3N0YXRlKCkKICAgIHN0cmVhayA9IGdldF9jb25zZWN1dGl2ZV9sb3Npbmdfb3V0Y29tZXNfNGgobGltaXQ9MTAwKQogICAgYWxlcnRzXzI0aCA9IGNvdW50X2FsZXJ0c19zaW5jZShkYXRldGltZS51dGNub3coKSAtIHRpbWVkZWx0YShob3Vycz0yNCkpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAiUmlzayBQYW5lbFxuIgogICAgICAgIGYiR292ZXJub3I6IHsnT04nIGlmIEVOQUJMRV9SSVNLX0dPVkVSTk9SIGVsc2UgJ09GRid9XG4iCiAgICAgICAgZiJBbGVydHMgMjRoOiB7YWxlcnRzXzI0aH0ve01BWF9BTEVSVFNfUEVSX0RBWX1cbiIKICAgICAgICBmIkNvbnNlY3V0aXZlIGxvc2luZyA0aCBvdXRjb21lczoge3N0cmVha30ve01BWF9DT05TRUNVVElWRV80SF9MT1NTRVN9XG4iCiAgICAgICAgZiJQYXVzZSB1bnRpbDoge19mbXRfZHQocGF1c2UuZ2V0KCdwYXVzZV91bnRpbCcpKX1cbiIKICAgICAgICBmIlBhdXNlIHJlYXNvbjoge3BhdXNlLmdldCgncmVhc29uJykgb3IgJ04vQSd9IgogICAgKQoKCmFzeW5jIGRlZiBjbWRfcGVyZm9ybWFuY2UodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgcGVyZiA9IGdldF9wZXJmb3JtYW5jZV9zdW1tYXJ5KGxvb2tiYWNrX2hvdXJzPTI0KQogICAgc2ltID0gZ2V0X3BvcnRmb2xpb19zaW11bGF0aW9uX21ldHJpY3MobG9va2JhY2tfZGF5cz03LCBob3Jpem9uX2hvdXJzPTQpCiAgICBxdWV1ZSA9IGdldF9vdXRjb21lX3F1ZXVlX3N0YXRzKCkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJQZXJmb3JtYW5jZSBQYW5lbFxuIgogICAgICAgIGYiMjRoIHNjYW5zL2FsZXJ0czoge3BlcmZbJ3NjYW5zJ119L3twZXJmWydhbGVydHMnXX0gKHtwZXJmWydhbGVydF9yYXRlJ106LjFmfSUpXG4iCiAgICAgICAgZiJBdmcvTWF4IHNjb3JlOiB7cGVyZlsnYXZnX3Njb3JlJ106LjJmfS97cGVyZlsnbWF4X3Njb3JlJ106LjJmfVxuIgogICAgICAgIGYiU2ltIDdkQDRoOiB0cmFkZXM9e3NpbVsndHJhZGVzJ119IHdpbj17c2ltWyd3aW5fcmF0ZV9wY3QnXTouMWZ9JSAiCiAgICAgICAgZiJleHA9e3NpbVsnZXhwZWN0YW5jeV9wY3QnXTouMmZ9JSBkZD17c2ltWydtYXhfZHJhd2Rvd25fcGN0J106LjJmfSVcbiIKICAgICAgICBmIk91dGNvbWUgcXVldWU6IHBlbmRpbmc9e3F1ZXVlWydwZW5kaW5nJ119IGNvbXBsZXRlPXtxdWV1ZVsnY29tcGxldGUnXX0iCiAgICApCgoKYXN5bmMgZGVmIGNtZF9idXkodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgaWYgbm90IGNvbnRleHQuYXJnczoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIlVzYWdlOiAvYnV5IDxTWU1CT0xfb3JfTUlOVD4gW2VudHJ5X3ByaWNlXVxuIgogICAgICAgICAgICAiRXhhbXBsZTogL2J1eSBQVU1QIDAuMDA0MiIKICAgICAgICApCiAgICAgICAgcmV0dXJuCgogICAgc3ltYm9sLCBtaW50ID0gX3BhcnNlX3N5bWJvbF9vcl9taW50KGNvbnRleHQuYXJnc1swXSkKICAgIGlmIG5vdCBzeW1ib2wgYW5kIG5vdCBtaW50OgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJJbnZhbGlkIHN5bWJvbC9taW50LiBFeGFtcGxlOiAvYnV5IFBVTVAgb3IgL2J1eSA8bWludD4iKQogICAgICAgIHJldHVybgoKICAgIGVudHJ5X292ZXJyaWRlID0gTm9uZQogICAgaWYgbGVuKGNvbnRleHQuYXJncykgPj0gMjoKICAgICAgICBlbnRyeV9vdmVycmlkZSA9IF90cnlfZmxvYXQoY29udGV4dC5hcmdzWzFdKQogICAgICAgIGlmIGVudHJ5X292ZXJyaWRlIGlzIE5vbmUgb3IgZW50cnlfb3ZlcnJpZGUgPD0gMDoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIkludmFsaWQgZW50cnkgcHJpY2UuIEV4YW1wbGU6IC9idXkgUFVNUCAwLjAwNDIiKQogICAgICAgICAgICByZXR1cm4KCiAgICB0b2tlbiA9IF9yZXNvbHZlX3Rva2VuX2Zvcl90cmFja2luZyhzeW1ib2w9c3ltYm9sLCBtaW50PW1pbnQpCiAgICBpZiB0b2tlbjoKICAgICAgICBzeW1ib2wgPSBzeW1ib2wgb3Igc3RyKHRva2VuLmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkgb3IgTm9uZQogICAgICAgIG1pbnQgPSBtaW50IG9yIHRva2VuLmdldCgiYWRkcmVzcyIpCiAgICAgICAgcGFpcl9hZGRyZXNzID0gdG9rZW4uZ2V0KCJwYWlyX2FkZHJlc3MiKQogICAgICAgIGxpdmVfcHJpY2UgPSBfdHJ5X2Zsb2F0KHRva2VuLmdldCgicHJpY2UiKSkKICAgIGVsc2U6CiAgICAgICAgcGFpcl9hZGRyZXNzID0gTm9uZQogICAgICAgIGxpdmVfcHJpY2UgPSBOb25lCgogICAgaWYgbm90IHN5bWJvbCBhbmQgbWludDoKICAgICAgICBzeW1ib2wgPSBzdHIobWludClbOjEwXS51cHBlcigpCiAgICBpZiBub3Qgc3ltYm9sOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJDb3VsZCBub3QgcmVzb2x2ZSBzeW1ib2wgZm9yIHRyYWNraW5nLiBUcnkgL2J1eSA8U1lNQk9MPiA8ZW50cnlfcHJpY2U+LiIpCiAgICAgICAgcmV0dXJuCgogICAgZW50cnlfcHJpY2UgPSBlbnRyeV9vdmVycmlkZSBpZiBlbnRyeV9vdmVycmlkZSBpcyBub3QgTm9uZSBlbHNlIChsaXZlX3ByaWNlIGlmIGxpdmVfcHJpY2UgYW5kIGxpdmVfcHJpY2UgPiAwIGVsc2UgMC4wKQogICAgcmVzdWx0ID0gb3Blbl9tYW51YWxfcG9zaXRpb24oCiAgICAgICAgc3ltYm9sPXN5bWJvbCwKICAgICAgICBtaW50PW1pbnQsCiAgICAgICAgcGFpcl9hZGRyZXNzPXBhaXJfYWRkcmVzcywKICAgICAgICBlbnRyeV9wcmljZT1lbnRyeV9wcmljZSwKICAgICAgICBzdG9wX3ByaWNlPShlbnRyeV9wcmljZSAqIDAuOSBpZiBlbnRyeV9wcmljZSA+IDAgZWxzZSAwLjApLAogICAgICAgIG5vdGVzPSJtYW51YWxfdGVsZWdyYW1fYnV5IiwKICAgICkKICAgIHBvc2l0aW9uID0gcmVzdWx0LmdldCgicG9zaXRpb24iKSBvciB7fQogICAgZW50cnlfb3V0ID0gX3RyeV9mbG9hdChwb3NpdGlvbi5nZXQoImVudHJ5X3ByaWNlIikpCiAgICBtaW50X291dCA9IHN0cihwb3NpdGlvbi5nZXQoIm1pbnQiKSBvciBtaW50IG9yICIiKQoKICAgIGlmIHJlc3VsdC5nZXQoImNyZWF0ZWQiKToKICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgIm1pbnQiOiBtaW50X291dCBvciBOb25lLAogICAgICAgICAgICAgICAgInByaWNlIjogZW50cnlfb3V0LAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIlRSQUNLX1BPU0lUSU9OX09QRU5FRCIsCiAgICAgICAgICAgICAgICAibm90ZXMiOiAibWFudWFsX3RlbGVncmFtX2J1eSIsCiAgICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgZW50cnlfdGV4dCA9IGYie2VudHJ5X291dDouOGZ9IiBpZiBlbnRyeV9vdXQgYW5kIGVudHJ5X291dCA+IDAgZWxzZSAiTi9BIgogICAgICAgIGxpbmVzID0gWwogICAgICAgICAgICAiUG9zaXRpb24gdHJhY2tlZC4iLAogICAgICAgICAgICBmIlN5bWJvbDogJHtzeW1ib2x9IiwKICAgICAgICAgICAgZiJFbnRyeToge2VudHJ5X3RleHR9IiwKICAgICAgICBdCiAgICAgICAgaWYgbWludF9vdXQ6CiAgICAgICAgICAgIGxpbmVzLmFwcGVuZChmIk1pbnQ6IHttaW50X291dH0iKQogICAgICAgIGxpbmVzLmFwcGVuZCgiU2VsbCBhbGVydHMgYXJlIG5vdyBlbmFibGVkIGZvciB0aGlzIHBvc2l0aW9uIG9ubHkuIikKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiXG4iLmpvaW4obGluZXMpKQogICAgICAgIHJldHVybgoKICAgIGxvZ19zaWduYWwoCiAgICAgICAgewogICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAibWludCI6IG1pbnRfb3V0IG9yIE5vbmUsCiAgICAgICAgICAgICJwcmljZSI6IGVudHJ5X291dCwKICAgICAgICAgICAgImRlY2lzaW9uIjogIlRSQUNLX1BPU0lUSU9OX0FMUkVBRFlfT1BFTiIsCiAgICAgICAgICAgICJub3RlcyI6ICJtYW51YWxfdGVsZWdyYW1fYnV5X2R1cGxpY2F0ZSIsCiAgICAgICAgfQogICAgKQogICAgb3BlbmVkX3RzID0gcG9zaXRpb24uZ2V0KCJvcGVuZWRfdHNfdXRjIikgb3IgIk4vQSIKICAgIGVudHJ5X3RleHQgPSBmIntlbnRyeV9vdXQ6LjhmfSIgaWYgZW50cnlfb3V0IGFuZCBlbnRyeV9vdXQgPiAwIGVsc2UgIk4vQSIKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJQb3NpdGlvbiBhbHJlYWR5IHRyYWNrZWQuXG4iCiAgICAgICAgZiJTeW1ib2w6ICR7c3ltYm9sfVxuIgogICAgICAgIGYiRW50cnk6IHtlbnRyeV90ZXh0fVxuIgogICAgICAgIGYiT3BlbmVkOiB7b3BlbmVkX3RzfVxuIgogICAgICAgICJVc2UgL3NvbGQgPFNZTUJPTD4gd2hlbiB5b3UgZXhpdC4iCiAgICApCgoKYXN5bmMgZGVmIGNtZF9zb2xkKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGlmIG5vdCBjb250ZXh0LmFyZ3M6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICJVc2FnZTogL3NvbGQgPFNZTUJPTF9vcl9NSU5UPiBbZXhpdF9wcmljZV1cbiIKICAgICAgICAgICAgIkV4YW1wbGU6IC9zb2xkIFBVTVAgMC4wMDUxIgogICAgICAgICkKICAgICAgICByZXR1cm4KCiAgICBzeW1ib2wsIG1pbnQgPSBfcGFyc2Vfc3ltYm9sX29yX21pbnQoY29udGV4dC5hcmdzWzBdKQogICAgaWYgbm90IHN5bWJvbCBhbmQgbm90IG1pbnQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIkludmFsaWQgc3ltYm9sL21pbnQuIEV4YW1wbGU6IC9zb2xkIFBVTVAiKQogICAgICAgIHJldHVybgoKICAgIGV4aXRfcHJpY2UgPSBOb25lCiAgICBpZiBsZW4oY29udGV4dC5hcmdzKSA+PSAyOgogICAgICAgIGV4aXRfcHJpY2UgPSBfdHJ5X2Zsb2F0KGNvbnRleHQuYXJnc1sxXSkKICAgICAgICBpZiBleGl0X3ByaWNlIGlzIE5vbmUgb3IgZXhpdF9wcmljZSA8PSAwOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiSW52YWxpZCBleGl0IHByaWNlLiBFeGFtcGxlOiAvc29sZCBQVU1QIDAuMDA1MSIpCiAgICAgICAgICAgIHJldHVybgoKICAgIGNsb3NlZCA9IGNsb3NlX21hbnVhbF9wb3NpdGlvbigKICAgICAgICBzeW1ib2w9c3ltYm9sLAogICAgICAgIG1pbnQ9bWludCwKICAgICAgICBleGl0X3ByaWNlPWV4aXRfcHJpY2UsCiAgICAgICAgbm90ZXM9Im1hbnVhbF90ZWxlZ3JhbV9zb2xkIiwKICAgICkKICAgIGxhYmVsID0gc3ltYm9sIG9yIChzdHIobWludClbOjEwXS51cHBlcigpIGlmIG1pbnQgZWxzZSAiVU5LTk9XTiIpCiAgICBpZiBjbG9zZWQgPD0gMDoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChmIk5vIG9wZW4gdHJhY2tlZCBwb3NpdGlvbiBmb3VuZCBmb3Ige2xhYmVsfS4iKQogICAgICAgIHJldHVybgoKICAgIGxvZ19zaWduYWwoCiAgICAgICAgewogICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sIG9yIGxhYmVsLAogICAgICAgICAgICAibWludCI6IG1pbnQsCiAgICAgICAgICAgICJwcmljZSI6IGV4aXRfcHJpY2UsCiAgICAgICAgICAgICJkZWNpc2lvbiI6ICJUUkFDS19QT1NJVElPTl9DTE9TRUQiLAogICAgICAgICAgICAibm90ZXMiOiBmIm1hbnVhbF90ZWxlZ3JhbV9zb2xkIGNvdW50PXtjbG9zZWR9IiwKICAgICAgICB9CiAgICApCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICBmIkNsb3NlZCB7Y2xvc2VkfSB0cmFja2VkIHBvc2l0aW9uKHMpIGZvciB7bGFiZWx9LlxuIgogICAgICAgICJTZWxsIGFsZXJ0cyBmb3IgdGhpcyB0b2tlbiBhcmUgbm93IGRpc2FibGVkIHVubGVzcyB5b3UgL2J1eSBpdCBhZ2Fpbi4iCiAgICApCgoKYXN5bmMgZGVmIGNtZF9wb3NpdGlvbnModXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgcm93cyA9IGdldF9vcGVuX3Bvc2l0aW9ucyhsaW1pdD0zMCkKICAgIGlmIG5vdCByb3dzOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAiTm8gb3BlbiB0cmFja2VkIHBvc2l0aW9ucy5cbiIKICAgICAgICAgICAgIlNlbGwgYWxlcnRzIGFyZSBjdXJyZW50bHkgcGF1c2VkIGJlY2F1c2Ugbm90aGluZyBpcyBtYXJrZWQgYXMgYm91Z2h0LlxuIgogICAgICAgICAgICAiVXNlIC9idXkgPFNZTUJPTD4gW2VudHJ5X3ByaWNlXS4iCiAgICAgICAgKQogICAgICAgIHJldHVybgoKICAgIGxpbmVzID0gWwogICAgICAgICJUcmFja2VkIE9wZW4gUG9zaXRpb25zIChzZWxsIGFsZXJ0cyBvbmx5IGZvciB0aGVzZSk6IiwKICAgIF0KICAgIGZvciBpZHgsIHJvdyBpbiBlbnVtZXJhdGUocm93cywgc3RhcnQ9MSk6CiAgICAgICAgc3ltYm9sID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgIGVudHJ5ID0gX3RyeV9mbG9hdChyb3cuZ2V0KCJlbnRyeV9wcmljZSIpKQogICAgICAgIGVudHJ5X3RleHQgPSBmIntlbnRyeTouOGZ9IiBpZiBlbnRyeSBhbmQgZW50cnkgPiAwIGVsc2UgIk4vQSIKICAgICAgICBvcGVuZWQgPSBzdHIocm93LmdldCgib3BlbmVkX3RzX3V0YyIpIG9yICJOL0EiKQogICAgICAgIGxpbmVzLmFwcGVuZChmIntpZHh9LiAke3N5bWJvbH0gfCBlbnRyeSB7ZW50cnlfdGV4dH0gfCBvcGVuZWQge29wZW5lZH0iKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIlxuIi5qb2luKGxpbmVzKSkKCgpkZWYgX2J1aWxkX2RpZ2VzdF9tZXNzYWdlKHJvd3M6IGxpc3RbZGljdF0pIC0+IHN0ciB8IE5vbmU6CiAgICBpZiBub3Qgcm93czoKICAgICAgICByZXR1cm4gTm9uZQogICAgdW5pcXVlID0gW10KICAgIHNlZW4gPSBzZXQoKQogICAgZm9yIHJvdyBpbiByb3dzOgogICAgICAgIHN5bWJvbCA9IHJvdy5nZXQoInN5bWJvbCIpCiAgICAgICAgaWYgbm90IHN5bWJvbCBvciBzeW1ib2wgaW4gc2VlbjoKICAgICAgICAgICAgY29udGludWUKICAgICAgICBzZWVuLmFkZChzeW1ib2wpCiAgICAgICAgdW5pcXVlLmFwcGVuZChyb3cpCiAgICAgICAgaWYgbGVuKHVuaXF1ZSkgPj0gU0lHTkFMX0RJR0VTVF9NQVhfSVRFTVM6CiAgICAgICAgICAgIGJyZWFrCiAgICBpZiBub3QgdW5pcXVlOgogICAgICAgIHJldHVybiBOb25lCgogICAgcGFuZWxfcm93cyA9IFsKICAgICAgICBfa3ZfbWFpbigiTE9PS0JBQ0siLCBmIntTSUdOQUxfRElHRVNUX0xPT0tCQUNLX0hPVVJTfWgiKSwKICAgICAgICBfa3ZfbWFpbigiU0VUVVBTIiwgbGVuKHVuaXF1ZSkpLAogICAgICAgICItIiAqIDMwLAogICAgXQogICAgZm9yIGlkeCwgcm93IGluIGVudW1lcmF0ZSh1bmlxdWUsIHN0YXJ0PTEpOgogICAgICAgIHNjb3JlID0gZmxvYXQocm93LmdldCgic2NvcmVfdG90YWwiKSBvciAwKQogICAgICAgIGNoZyA9IGZsb2F0KHJvdy5nZXQoImNoYW5nZV8yNGgiKSBvciAwKQogICAgICAgIHJlZ2ltZSA9IHJvdy5nZXQoInJlZ2ltZV9sYWJlbCIpIG9yICJOL0EiCiAgICAgICAgcGFuZWxfcm93cy5hcHBlbmQoCiAgICAgICAgICAgIF90cmltX3RleHRfbWFpbigKICAgICAgICAgICAgICAgIGYie2lkeH0uICR7c3RyKHJvdy5nZXQoJ3N5bWJvbCcpIG9yICdVTktOT1dOJykudXBwZXIoKX0gfCB7c2NvcmU6LjFmfSB8IHtjaGc6Ky4xZn0lIHwge3JlZ2ltZX0iLAogICAgICAgICAgICAgICAgX1BBTkVMX1dJRFRIX01BSU4sCiAgICAgICAgICAgICkKICAgICAgICApCiAgICByZXR1cm4gX2hlYWRlcl9ibG9ja19tYWluKCJbU0lHTkFMXTpESUdFU1QiKSArICJcbiIgKyBfcmVuZGVyX3ByZV9tYWluKHBhbmVsX3Jvd3MpCgoKZGVmIF9mb3JtYXRfbXVsdGlfdGllcl9nb29kX2J1eV9idWxsZXRpbihwZXJfdGllcl9saW1pdDogaW50ID0gMikgLT4gc3RyOgogICAgdGllcl9vcmRlciA9ICgiY29uc2VydmF0aXZlIiwgImJhbGFuY2VkIiwgImFnZ3Jlc3NpdmUiKQogICAgdGllcl9wcmlvcml0eSA9IHsiY29uc2VydmF0aXZlIjogMCwgImJhbGFuY2VkIjogMSwgImFnZ3Jlc3NpdmUiOiAyfQogICAgdGllcl9kaXNwbGF5ID0gewogICAgICAgICJjb25zZXJ2YXRpdmUiOiAiTG9uZy1UZXJtIiwKICAgICAgICAiYmFsYW5jZWQiOiAiTWlkLVRlcm0iLAogICAgICAgICJhZ2dyZXNzaXZlIjogIlNob3J0LVRlcm0iLAogICAgfQoKICAgIHNuYXBzaG90cyA9IHsKICAgICAgICB0aWVyOiBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9bWF4KDgsIHBlcl90aWVyX2xpbWl0ICogMyksIGxpbWl0X2JhZD0wLCB0aWVyPXRpZXIpCiAgICAgICAgZm9yIHRpZXIgaW4gdGllcl9vcmRlcgogICAgfQogICAgYmFzZV9zbmFwID0gc25hcHNob3RzLmdldCgiYmFsYW5jZWQiKSBvciBzbmFwc2hvdHMuZ2V0KCJjb25zZXJ2YXRpdmUiKSBvciBzbmFwc2hvdHMuZ2V0KCJhZ2dyZXNzaXZlIikgb3Ige30KICAgIHJlZ2ltZSA9IGJhc2Vfc25hcC5nZXQoInJlZ2ltZSIpIG9yIHt9CiAgICBwb2xpY3kgPSBiYXNlX3NuYXAuZ2V0KCJwb2xpY3kiKSBvciB7fQogICAgcmVnaW1lX3Njb3JlID0gZmxvYXQocmVnaW1lLmdldCgic2NvcmUiLCAwKSBvciAwKQogICAgcmVnaW1lX2Zsb29yID0gZmxvYXQocG9saWN5LmdldCgicmVnaW1lX21pbl9zY29yZSIsIDApIG9yIDApCiAgICBzaWduYWxfYWN0aW9uID0gIkJVWSIgaWYgcmVnaW1lX3Njb3JlID49IHJlZ2ltZV9mbG9vciBlbHNlICJXQUlUIgoKICAgIGJlc3RfZml0X2J5X3N5bWJvbCA9IHt9CiAgICBmb3IgdGllciBpbiB0aWVyX29yZGVyOgogICAgICAgIHNuYXAgPSBzbmFwc2hvdHMuZ2V0KHRpZXIpIG9yIHt9CiAgICAgICAgZm9yIHRva2VuIGluIHNuYXAuZ2V0KCJnb29kIikgb3IgW106CiAgICAgICAgICAgIHN5bWJvbCA9IHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgICAgICBzY29yZSA9IGZsb2F0KHRva2VuLmdldCgic2NvcmUiLCAwKSBvciAwKQogICAgICAgICAgICB2b2x1bWUgPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgICAgICAgICBleGlzdGluZyA9IGJlc3RfZml0X2J5X3N5bWJvbC5nZXQoc3ltYm9sKQogICAgICAgICAgICBpZiBub3QgZXhpc3Rpbmc6CiAgICAgICAgICAgICAgICBiZXN0X2ZpdF9ieV9zeW1ib2xbc3ltYm9sXSA9IHsidGllciI6IHRpZXIsICJ0b2tlbiI6IHRva2VufQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGV4aXN0aW5nX3RpZXIgPSBzdHIoZXhpc3RpbmcuZ2V0KCJ0aWVyIikgb3IgImFnZ3Jlc3NpdmUiKQogICAgICAgICAgICBleGlzdGluZ190b2tlbiA9IGV4aXN0aW5nLmdldCgidG9rZW4iKSBvciB7fQogICAgICAgICAgICBleGlzdGluZ19zY29yZSA9IGZsb2F0KGV4aXN0aW5nX3Rva2VuLmdldCgic2NvcmUiLCAwKSBvciAwKQogICAgICAgICAgICBleGlzdGluZ192b2x1bWUgPSBmbG9hdChleGlzdGluZ190b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgICAgICAgICBpZiB0aWVyX3ByaW9yaXR5LmdldCh0aWVyLCA5KSA8IHRpZXJfcHJpb3JpdHkuZ2V0KGV4aXN0aW5nX3RpZXIsIDkpOgogICAgICAgICAgICAgICAgYmVzdF9maXRfYnlfc3ltYm9sW3N5bWJvbF0gPSB7InRpZXIiOiB0aWVyLCAidG9rZW4iOiB0b2tlbn0KICAgICAgICAgICAgZWxpZiB0aWVyX3ByaW9yaXR5LmdldCh0aWVyLCA5KSA9PSB0aWVyX3ByaW9yaXR5LmdldChleGlzdGluZ190aWVyLCA5KToKICAgICAgICAgICAgICAgIGlmIChzY29yZSwgdm9sdW1lKSA+IChleGlzdGluZ19zY29yZSwgZXhpc3Rpbmdfdm9sdW1lKToKICAgICAgICAgICAgICAgICAgICBiZXN0X2ZpdF9ieV9zeW1ib2xbc3ltYm9sXSA9IHsidGllciI6IHRpZXIsICJ0b2tlbiI6IHRva2VufQoKICAgIHJhbmtlZCA9IHNvcnRlZCgKICAgICAgICBiZXN0X2ZpdF9ieV9zeW1ib2wudmFsdWVzKCksCiAgICAgICAga2V5PWxhbWJkYSByb3c6ICgKICAgICAgICAgICAgZmxvYXQoKHJvdy5nZXQoInRva2VuIikgb3Ige30pLmdldCgic2NvcmUiLCAwKSBvciAwKSwKICAgICAgICAgICAgZmxvYXQoKHJvdy5nZXQoInRva2VuIikgb3Ige30pLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApLAogICAgICAgICksCiAgICAgICAgcmV2ZXJzZT1UcnVlLAogICAgKQoKICAgIHNlcCA9ICLilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEiCiAgICBhY3Rpb25fZW1vamkgPSAi8J+foiIgaWYgc2lnbmFsX2FjdGlvbiA9PSAiQlVZIiBlbHNlICLwn5S0IgogICAgcHJvZmlsZV9sYWJlbCA9IGYie19tb2RlKCkudXBwZXIoKX0gfCB7X3Jpc2tfc3R5bGVfbGFiZWwoKX0iCgogICAgaWYgbm90IHJhbmtlZDoKICAgICAgICBsaW5lcyA9IFsKICAgICAgICAgICAgZiI8Yj7wn5OKIFtBTkFMWVNJU106IE1BUktFVDwvYj4iLAogICAgICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+TiyBQUk9GSUxFOiB7X2VzY19odG1sX21haW4ocHJvZmlsZV9sYWJlbCl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT57YWN0aW9uX2Vtb2ppfSBTVEFUVVM6IHtfZXNjX2h0bWxfbWFpbihzaWduYWxfYWN0aW9uKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn46vIEJFU1QgRklUOiBXQUlUPC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+TnSBSRUFTT046IE5vIHF1YWxpZmllZCBzZXR1cCByaWdodCBub3c8L2NvZGU+IiwKICAgICAgICAgICAgZiIiLAogICAgICAgICAgICBmIjxpPlRpcDogVXNlIC9nb29kYnV5IGFsbCBmb3IgZnVsbCB0aWVyIGJyZWFrZG93biBvbiBkZW1hbmQuPC9pPiIsCiAgICAgICAgXQogICAgZWxzZToKICAgICAgICBiZXN0ID0gcmFua2VkWzBdCiAgICAgICAgdG9rZW4gPSBiZXN0LmdldCgidG9rZW4iKSBvciB7fQogICAgICAgIHRpZXIgPSBzdHIoYmVzdC5nZXQoInRpZXIiKSBvciAiYmFsYW5jZWQiKQogICAgICAgIHRlcm0gPSB0aWVyX2Rpc3BsYXkuZ2V0KHRpZXIsICJNaWQtVGVybSIpCiAgICAgICAgdG9wX3N5bWJvbCA9IHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgIHNuYXBfZm9yX3RpZXIgPSBzbmFwc2hvdHMuZ2V0KHRpZXIpIG9yIHt9CiAgICAgICAgcG9saWN5X2Zvcl90aWVyID0gc25hcF9mb3JfdGllci5nZXQoInBvbGljeSIpIG9yIHt9CiAgICAgICAgdGllcl9ydWxlX2Zvcl90aWVyID0gc25hcF9mb3JfdGllci5nZXQoInRpZXJfcnVsZSIpIG9yIHt9CiAgICAgICAgc2NvcmUgPSBmbG9hdCh0b2tlbi5nZXQoInNjb3JlIiwgMCkgb3IgMCkKICAgICAgICBjb25mID0gc3RyKHRva2VuLmdldCgiY29uZmlkZW5jZSIpIG9yICJDIikudXBwZXIoKQogICAgICAgIGNoZyA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICAgICAgbGlxID0gX2ZtdF91c2RfY29tcGFjdF9tYWluKHRva2VuLmdldCgibGlxdWlkaXR5IikpCiAgICAgICAgY2FwX3ZhbCA9IHRva2VuLmdldCgibWFya2V0X2NhcCIpIG9yIHRva2VuLmdldCgiZmR2IikKICAgICAgICBjYXBfZGlzcGxheSA9IF9mbXRfdXNkX2NvbXBhY3RfbWFpbihjYXBfdmFsKSBpZiBjYXBfdmFsIGVsc2UgIk4vQSIKICAgICAgICByZXF1aXJlZF9jb25mID0gX3N0cmljdGVyX2NvbmZpZGVuY2UoCiAgICAgICAgICAgIHN0cihwb2xpY3lfZm9yX3RpZXIuZ2V0KCJtaW5fY29uZmlkZW5jZV90b19hbGVydCIsICJCIikpLAogICAgICAgICAgICBzdHIodGllcl9ydWxlX2Zvcl90aWVyLmdldCgibWluX2NvbmZpZGVuY2UiLCAiQiIpKSwKICAgICAgICApCiAgICAgICAgcmVxdWlyZWRfc2NvcmUgPSBmbG9hdChwb2xpY3lfZm9yX3RpZXIuZ2V0KCJhbGVydF90aHJlc2hvbGQiLCBfcnVudGltZVsiYWxlcnRfdGhyZXNob2xkIl0pIG9yIDApICsgZmxvYXQoCiAgICAgICAgICAgIHRpZXJfcnVsZV9mb3JfdGllci5nZXQoIm1pbl9zY29yZV9kZWx0YSIsIDApIG9yIDAKICAgICAgICApCiAgICAgICAgcmVxdWlyZWRfc2NvcmUgPSBtYXgoMC4wLCBtaW4oMTAwLjAsIHJlcXVpcmVkX3Njb3JlKSkKCiAgICAgICAgbGluZXMgPSBbCiAgICAgICAgICAgIGYiPGI+8J+TiiBbQU5BTFlTSVNdOiBNQVJLRVQ8L2I+IiwKICAgICAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfk4sgUFJPRklMRToge19lc2NfaHRtbF9tYWluKHByb2ZpbGVfbGFiZWwpfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+e2FjdGlvbl9lbW9qaX0gU1RBVFVTOiB7X2VzY19odG1sX21haW4oc2lnbmFsX2FjdGlvbil9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+OryBCRVNUIEZJVDogJHtfZXNjX2h0bWxfbWFpbih0b3Bfc3ltYm9sKX0gfCB7X2VzY19odG1sX21haW4odGVybSl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+4q2QIFFVQUxJVFk6IHNjb3JlIHtzY29yZTouMGZ9ICh7X2VzY19odG1sX21haW4oY29uZil9KSB8IDI0SCB7Y2hnOisuMWZ9JSB8IGxpcSB7X2VzY19odG1sX21haW4obGlxKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5KwIE1BUktFVENBUDoge19lc2NfaHRtbF9tYWluKGNhcF9kaXNwbGF5KX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OdIFJFQVNPTjogVG9wLXJhbmtlZCBxdWFsaWZpZWQgc2V0dXAgcmlnaHQgbm93PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+TjyBSVUxFOiBzY29yZSAmZ3Q7PSB7cmVxdWlyZWRfc2NvcmU6LjBmfSBhbmQgZ3JhZGUgJmd0Oz0ge19lc2NfaHRtbF9tYWluKHJlcXVpcmVkX2NvbmYpfTwvY29kZT4iLAogICAgICAgICAgICBmIiIsCiAgICAgICAgICAgIGYiPGk+VGlwOiBVc2UgL2dvb2RidXkgYWxsIGZvciBmdWxsIHRpZXIgYnJlYWtkb3duIG9uIGRlbWFuZC48L2k+IiwKICAgICAgICBdCgogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykuc3RyaXAoKQoKCmFzeW5jIGRlZiBzZW5kX3NpZ25hbF9kaWdlc3QoY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSkgLT4gYm9vbDoKICAgIHJvd3MgPSBnZXRfcmVjZW50X3NjYW5fYmVzdHMoCiAgICAgICAgbG9va2JhY2tfaG91cnM9U0lHTkFMX0RJR0VTVF9MT09LQkFDS19IT1VSUywKICAgICAgICBsaW1pdD1tYXgoMTAsIFNJR05BTF9ESUdFU1RfTUFYX0lURU1TICogNCksCiAgICApCiAgICBtc2cgPSBfYnVpbGRfZGlnZXN0X21lc3NhZ2Uocm93cykKICAgIGlmIG5vdCBtc2c6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBsYXRlc3RfdHMgPSByb3dzWzBdLmdldCgidHNfdXRjIikKICAgIGlmIGNvbnRleHQuam9iIGFuZCBfZGlnZXN0X3N0YXRlLmdldCgibGFzdF9zZW50X3RzIikgPT0gbGF0ZXN0X3RzOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGlmIERSWV9SVU46CiAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIERpZ2VzdCBub3Qgc2VudC5cbiVzIiwgbXNnKQogICAgZWxzZToKICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICB0ZXh0PW1zZywKICAgICAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICkKICAgIF9kaWdlc3Rfc3RhdGVbImxhc3Rfc2VudF90cyJdID0gbGF0ZXN0X3RzCiAgICByZXR1cm4gVHJ1ZQoKCmFzeW5jIGRlZiBzZW5kX2dvb2RfYnV5X2J1bGxldGluKGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpIC0+IGJvb2w6CiAgICAiIiJVbmlmaWVkIG1hcmtldCBhbmFseXNpcyBidWxsZXRpbiDigJQgYWx3YXlzIHVzZXMgbXVsdGktdGllciBhbmFseXNpcyBmb3JtYXQuIiIiCiAgICBwZXJfdGllcl9saW1pdCA9IG1heCgxLCBpbnQoR09PRF9CVVlfQlVMTEVUSU5fUEVSX1RJRVJfTUFYX1RPS0VOUykpCiAgICBtc2cgPSBfZm9ybWF0X211bHRpX3RpZXJfZ29vZF9idXlfYnVsbGV0aW4ocGVyX3RpZXJfbGltaXQ9cGVyX3RpZXJfbGltaXQpCgogICAgIyBHcmFiIGEgc25hcHNob3QganVzdCBmb3IgbG9nZ2luZyBtZXRhZGF0YS4KICAgIHRpZXIgPSBfbm9ybWFsaXplX21hcmtldF90aWVyKEdPT0RfQlVZX0JVTExFVElOX1RJRVIpCiAgICBzbmFwID0gX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPTEsIGxpbWl0X2JhZD0wLCB0aWVyPXRpZXIpCgogICAgZGVjaXNpb24gPSAiQU5BTFlTSVNfQlVMTEVUSU4iCiAgICBpZiBEUllfUlVOOgogICAgICAgIGRlY2lzaW9uID0gIkFOQUxZU0lTX0JVTExFVElOX0RSWV9SVU4iCiAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIEFuYWx5c2lzIGJ1bGxldGluIHN1cHByZXNzZWQuXG4lcyIsIG1zZykKICAgIGVsc2U6CiAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICBjaGF0X2lkPWludChURUxFR1JBTV9DSEFUX0lEKSwKICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICAgICApCgogICAgbG9nX3NpZ25hbCgKICAgICAgICB7CiAgICAgICAgICAgICJzeW1ib2wiOiAiRU5HSU5FIiwKICAgICAgICAgICAgImRlY2lzaW9uIjogZGVjaXNpb24sCiAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiBmbG9hdCgoc25hcC5nZXQoInJlZ2ltZSIpIG9yIHt9KS5nZXQoInNjb3JlIikgb3IgMCksCiAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiBzdHIoKHNuYXAuZ2V0KCJyZWdpbWUiKSBvciB7fSkuZ2V0KCJsYWJlbCIpIG9yICIiKSwKICAgICAgICAgICAgIm5vdGVzIjogZiJ0aWVyPXt0aWVyfSBnb29kX2NvdW50PXtsZW4oc25hcC5nZXQoJ2dvb2QnKSBvciBbXSl9IHVuaXZlcnNlPXtzbmFwLmdldCgndG9rZW5zJywgMCl9IiwKICAgICAgICB9CiAgICApCiAgICByZXR1cm4gVHJ1ZQoKCmFzeW5jIGRlZiBydW5fc2VsbF9zaWduYWxfc2Nhbm5lcihjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFLCB0b2tlbnM6IGxpc3RbZGljdF0gfCBOb25lID0gTm9uZSk6CiAgICBpZiBub3QgU0VMTF9BTEVSVFNfRU5BQkxFRDoKICAgICAgICByZXR1cm4KCiAgICBvcGVuX3Bvc2l0aW9ucyA9IGdldF9vcGVuX3Bvc2l0aW9ucyhsaW1pdD0yMDApCiAgICBpZiBub3Qgb3Blbl9wb3NpdGlvbnM6CiAgICAgICAgcmV0dXJuCiAgICB0cmFja2VkX3N5bWJvbHMgPSB7c3RyKHAuZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKSBmb3IgcCBpbiBvcGVuX3Bvc2l0aW9ucyBpZiBwLmdldCgic3ltYm9sIil9CiAgICB0cmFja2VkX21pbnRzID0ge3N0cihwLmdldCgibWludCIpIG9yICIiKSBmb3IgcCBpbiBvcGVuX3Bvc2l0aW9ucyBpZiBwLmdldCgibWludCIpfQoKICAgIG1hcmtldF90b2tlbnMgPSB0b2tlbnMgaWYgdG9rZW5zIGlzIG5vdCBOb25lIGVsc2UgKGZldGNoX21hcmtldF9kYXRhKCkgb3IgW10pCiAgICBpZiBub3QgbWFya2V0X3Rva2VuczoKICAgICAgICByZXR1cm4KCiAgICBydWxlcyA9IF9zZWxsX3N0eWxlX3J1bGVzKCkKICAgIHNlbnQgPSAwCiAgICBmb3IgcmF3X3Rva2VuIGluIG1hcmtldF90b2tlbnM6CiAgICAgICAgaWYgc2VudCA+PSBpbnQocnVsZXNbIm1heF9wZXJfY3ljbGUiXSk6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgdG9rZW4gPSBkaWN0KHJhd190b2tlbikKICAgICAgICBzeW1ib2wgPSBzdHIodG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgICAgIG1pbnQgPSBzdHIodG9rZW4uZ2V0KCJhZGRyZXNzIikgb3IgIiIpCiAgICAgICAgaWYgc3ltYm9sIG5vdCBpbiB0cmFja2VkX3N5bWJvbHMgYW5kIG1pbnQgbm90IGluIHRyYWNrZWRfbWludHM6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgaWYgbm90IHN5bWJvbCBvciBfc2VsbF9zaWduYWxfb25fY29vbGRvd24oc3ltYm9sLCBjb29sZG93bl9ob3Vycz1ydWxlc1siY29vbGRvd25faG91cnMiXSk6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIHJlZnJlc2hlZCA9IF9yZWZyZXNoX2FsZXJ0X21hcmtldF9zbmFwc2hvdCh0b2tlbikKICAgICAgICBpZiByZWZyZXNoZWQ6CiAgICAgICAgICAgIHRva2VuID0gcmVmcmVzaGVkCgogICAgICAgIHNpZ25hbCA9IF9kZXRlY3Rfc2VsbF9zaWduYWwodG9rZW4sIHJ1bGVzPXJ1bGVzKQogICAgICAgIGlmIG5vdCBzaWduYWw6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIG1zZyA9IF9mb3JtYXRfc2VsbF9hbGVydF9tZXNzYWdlKHRva2VuLCBzaWduYWwsIGNvbXBhY3Q9VHJ1ZSkKICAgICAgICBkZWNpc2lvbiA9IGYiU0VMTF9BTEVSVF97c2lnbmFsWyd0eXBlJ119IgogICAgICAgIGlmIERSWV9SVU46CiAgICAgICAgICAgIGRlY2lzaW9uID0gIlNFTExfQUxFUlRfRFJZX1JVTiIKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIFNlbGwgYWxlcnQgc3VwcHJlc3NlZCBmb3IgJXMiLCBzeW1ib2wpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgICAgICAgICB0ZXh0PW1zZywKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPV9idWlsZF9hbGVydF9rZXlib2FyZCgKICAgICAgICAgICAgICAgICAgICBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICAgICAgICAgKQoKICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICJzY29yZSI6IHRva2VuLmdldCgic2NvcmUiKSwKICAgICAgICAgICAgICAgICJsaXF1aWRpdHkiOiB0b2tlbi5nZXQoImxpcXVpZGl0eSIpLAogICAgICAgICAgICAgICAgInZvbHVtZV8yNGgiOiB0b2tlbi5nZXQoInZvbHVtZV8yNGgiKSwKICAgICAgICAgICAgICAgICJwcmljZSI6IHRva2VuLmdldCgicHJpY2UiKSwKICAgICAgICAgICAgICAgICJjaGFuZ2VfMjRoIjogdG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiksCiAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiBkZWNpc2lvbiwKICAgICAgICAgICAgICAgICJub3RlcyI6IHNpZ25hbC5nZXQoInJlYXNvbiIpLAogICAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIHNlbnQgKz0gMQoKCmFzeW5jIGRlZiBjbWRfZGlnZXN0KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIHNlbnQgPSBhd2FpdCBzZW5kX3NpZ25hbF9kaWdlc3QoY29udGV4dCkKICAgIGlmIHNlbnQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIkRpZ2VzdCBzZW50LiIpCiAgICBlbHNlOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJObyBuZXcgc2V0dXBzIGZvciBkaWdlc3QgcmlnaHQgbm93LiIpCgoKYXN5bmMgZGVmIGNtZF9ydW5uZXJ3YXRjaCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBydW5fbmV3X3J1bm5lcl93YXRjaChjb250ZXh0KQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIlJ1bm5lciB3YXRjaCBzY2FuIGV4ZWN1dGVkLiIpCgoKYXN5bmMgZGVmIGNtZF93YXRjaGxpc3QodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgcnVuX3dhdGNobGlzdF9sYW5lKGNvbnRleHQpCiAgICByb3dzID0gX2J1aWxkX3dhdGNobGlzdF9yb3dzKCkKICAgIGxpdmUgPSBzdW0oMSBmb3IgciBpbiByb3dzIGlmIGJvb2woci5nZXQoImhhc19saXZlX2RhdGEiLCBUcnVlKSkpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICBmIldhdGNobGlzdCBzY2FuIGV4ZWN1dGVkLiBDb3ZlcmFnZToge2xpdmV9L3tsZW4ocm93cyl9IGxpdmUuIgogICAgKQoKCmFzeW5jIGRlZiBjbWRfd2F0Y2hsaXN0c3VtbWFyeSh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBzZW5kX3dhdGNobGlzdF9zdW1tYXJ5KGNvbnRleHQpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiV2F0Y2hsaXN0IHN1bW1hcnkgc2VudC4iKQoKCmFzeW5jIGRlZiBjbWRfbWFya2V0bm93KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIHRpZXIgPSBfdGllcl9hcmdfb3JfZGVmYXVsdChjb250ZXh0LmFyZ3MsIGRlZmF1bHQ9ImJhbGFuY2VkIikKICAgIGlmIHRpZXIgPT0gImFsbCI6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF9tYXJrZXRfbm93X211bHRpX3RpZXIobW9kZT0iYm90aCIpKQogICAgICAgIHJldHVybgogICAgc25hcCA9IF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZD01LCBsaW1pdF9iYWQ9NSwgdGllcj10aWVyKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT0iYm90aCIpKQoKCmFzeW5jIGRlZiBjbWRfZ29vZGJ1eSh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICB0aWVyID0gX3RpZXJfYXJnX29yX2RlZmF1bHQoY29udGV4dC5hcmdzLCBkZWZhdWx0PSJiYWxhbmNlZCIpCiAgICBpZiB0aWVyID09ICJhbGwiOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfbWFya2V0X25vd19tdWx0aV90aWVyKG1vZGU9Imdvb2QiKSkKICAgICAgICByZXR1cm4KICAgIHNuYXAgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9NiwgbGltaXRfYmFkPTMsIHRpZXI9dGllcikKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfbWFya2V0X25vd19tZXNzYWdlKHNuYXAsIG1vZGU9Imdvb2QiKSkKCgphc3luYyBkZWYgY21kX2JhZGJ1eSh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICB0aWVyID0gX3RpZXJfYXJnX29yX2RlZmF1bHQoY29udGV4dC5hcmdzLCBkZWZhdWx0PSJiYWxhbmNlZCIpCiAgICBpZiB0aWVyID09ICJhbGwiOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfbWFya2V0X25vd19tdWx0aV90aWVyKG1vZGU9ImJhZCIpKQogICAgICAgIHJldHVybgogICAgc25hcCA9IF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZD0zLCBsaW1pdF9iYWQ9NiwgdGllcj10aWVyKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT0iYmFkIikpCgoKYXN5bmMgZGVmIGNtZF93YWxsZXQybm93KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfd2FsbGV0Ml9tZXNzYWdlKG1vZGU9Imdvb2QiKSkKCgphc3luYyBkZWYgY21kX3dhbGxldDJiYWQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF93YWxsZXQyX21lc3NhZ2UobW9kZT0iYmFkIikpCgoKYXN5bmMgZGVmIGNtZF93YWxsZXQzbm93KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfd2FsbGV0M19tZXNzYWdlKG1vZGU9Imdvb2QiKSkKCgphc3luYyBkZWYgY21kX3dhbGxldDNiYWQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF93YWxsZXQzX21lc3NhZ2UobW9kZT0iYmFkIikpCgoKYXN5bmMgZGVmIGNtZF93YWxsZXRwbGFuKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIHRleHQgPSAoCiAgICAgICAgIldBTExFVCBQTEFZQk9PS1xuXG4iCiAgICAgICAgZiJ7X3dhbGxldF9oZWFkZXIoJ1cxJyl9XG5cbiIKICAgICAgICBmIntfd2FsbGV0X2hlYWRlcignVzInKX1cblxuIgogICAgICAgIGYie193YWxsZXRfaGVhZGVyKCdXMycpfVxuXG4iCiAgICAgICAgIlVzZSAvd2FsbGV0Mm5vdyAvd2FsbGV0MmJhZCAvd2FsbGV0M25vdyAvd2FsbGV0M2JhZCBmb3IgbGl2ZSByb3V0aW5nLiIKICAgICkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KHRleHQpCgoKYXN5bmMgZGVmIG9uX2FsZXJ0X2FjdGlvbih1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBxdWVyeSA9IHVwZGF0ZS5jYWxsYmFja19xdWVyeQogICAgaWYgbm90IHF1ZXJ5OgogICAgICAgIHJldHVybgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKCJVbmF1dGhvcml6ZWQiLCBzaG93X2FsZXJ0PVRydWUpCiAgICAgICAgcmV0dXJuCgogICAgZGF0YSA9IHF1ZXJ5LmRhdGEgb3IgIiIKICAgIGlmIGRhdGEuc3RhcnRzd2l0aCgibXV0ZToiKToKICAgICAgICBzeW1ib2wgPSBkYXRhLnNwbGl0KCI6IiwgMSlbMV0uc3RyaXAoKS51cHBlcigpWzoxNl0KICAgICAgICBzZXRfc3ltYm9sX2NvbnRyb2woc3ltYm9sPXN5bWJvbCwgY29udHJvbF90eXBlPSJDT09MRE9XTiIsIGhvdXJzPTI0LCByZWFzb249Im1hbnVhbF90ZWxlZ3JhbV9tdXRlIikKICAgICAgICBsb2dfc2lnbmFsKHsic3ltYm9sIjogc3ltYm9sLCAiZGVjaXNpb24iOiAiVEVMRUdSQU1fTVVURV8yNEgiLCAibm90ZXMiOiAibWFudWFsIG11dGUgZnJvbSBidXR0b24ifSkKICAgICAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoZiJ7c3ltYm9sfSBtdXRlZCAyNGgiLCBzaG93X2FsZXJ0PUZhbHNlKQogICAgZWxpZiBkYXRhLnN0YXJ0c3dpdGgoImFjazoiKToKICAgICAgICBzeW1ib2wgPSBkYXRhLnNwbGl0KCI6IiwgMSlbMV0uc3RyaXAoKS51cHBlcigpWzoxNl0KICAgICAgICBsb2dfc2lnbmFsKHsic3ltYm9sIjogc3ltYm9sLCAiZGVjaXNpb24iOiAiQUxFUlRfQUNLIiwgIm5vdGVzIjogInRlbGVncmFtIGFja25vd2xlZGdlIn0pCiAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKCJBY2tub3dsZWRnZWQiLCBzaG93X2FsZXJ0PUZhbHNlKQogICAgZWxzZToKICAgICAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoKQoKCmFzeW5jIGRlZiBydW5fbmV3X3J1bm5lcl93YXRjaChjb250ZXh0KToKICAgIGlmIG5vdCBORVdfUlVOTkVSX1dBVENIX0VOQUJMRUQ6CiAgICAgICAgcmV0dXJuCiAgICB0cnk6CiAgICAgICAgcHJpbnQoIlJ1bm5pbmcgbmV3LXJ1bm5lciB3YXRjaC4uLiIpCiAgICAgICAgdG9rZW5zID0gZmV0Y2hfcnVubmVyX3dhdGNoX2NhbmRpZGF0ZXMoCiAgICAgICAgICAgIHF1ZXJpZXM9TkVXX1JVTk5FUl9TRUFSQ0hfUVVFUklFUywKICAgICAgICAgICAgcGFpcnNfcGVyX3F1ZXJ5PU5FV19SVU5ORVJfUEFJUlNfUEVSX1FVRVJZLAogICAgICAgICAgICBsaW1pdD1ORVdfUlVOTkVSX01BWF9SRVNVTFRTLAogICAgICAgICkKICAgICAgICBpZiBub3QgdG9rZW5zOgogICAgICAgICAgICBsb2dnaW5nLmluZm8oIk5ldy1ydW5uZXIgd2F0Y2g6IG5vIGNhbmRpZGF0ZXMgZnJvbSBEZXhTY3JlZW5lci4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY2FuZGlkYXRlcyA9IFtdCiAgICAgICAgZm9yIHRva2VuIGluIHRva2VuczoKICAgICAgICAgICAgZW5yaWNoZWQgPSBfcnVubmVyX3dhdGNoX2VucmljaCh0b2tlbikKICAgICAgICAgICAgaWYgbm90IGVucmljaGVkOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc3ltYm9sID0gc3RyKGVucmljaGVkLmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkKICAgICAgICAgICAgaWYgX3J1bm5lcl93YXRjaF9vbl9jb29sZG93bihzeW1ib2wpOgogICAgICAgICAgICAgICAgbG9nX3NpZ25hbCgKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgICJtaW50IjogZW5yaWNoZWQuZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJzY29yZSI6IGVucmljaGVkLmdldCgid2F0Y2hfc2NvcmUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIlJVTk5FUl9XQVRDSF9DT09MRE9XTl9TS0lQIiwKICAgICAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogZiJjb29sZG93bl9ob3Vycz17TkVXX1JVTk5FUl9DT09MRE9XTl9IT1VSU30iLAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGNhbmRpZGF0ZXMuYXBwZW5kKGVucmljaGVkKQoKICAgICAgICBpZiBub3QgY2FuZGlkYXRlczoKICAgICAgICAgICAgcHJpbnQoIk5ldy1ydW5uZXIgd2F0Y2g6IG5vIHRva2VucyBwYXNzZWQgZmlsdGVycy4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY2FuZGlkYXRlcy5zb3J0KGtleT1sYW1iZGEgdDogdC5nZXQoIndhdGNoX3Njb3JlIiwgMCksIHJldmVyc2U9VHJ1ZSkKICAgICAgICBzZW50ID0gMAogICAgICAgIHNlZW4gPSBzZXQoKQogICAgICAgIG1heF9wZXJfY3ljbGUgPSBtYXgoMSwgTkVXX1JVTk5FUl9NQVhfQUxFUlRTX1BFUl9DWUNMRSkKCiAgICAgICAgZm9yIHRva2VuIGluIGNhbmRpZGF0ZXM6CiAgICAgICAgICAgIGlmIHNlbnQgPj0gbWF4X3Blcl9jeWNsZToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIHN5bWJvbCA9IHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpCiAgICAgICAgICAgIGlmIG5vdCBzeW1ib2wgb3Igc3ltYm9sIGluIHNlZW46CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzZWVuLmFkZChzeW1ib2wpCgogICAgICAgICAgICBtc2cgPSBmb3JtYXRfcnVubmVyX3dhdGNoKHRva2VuLCBjb21wYWN0PVRydWUpCiAgICAgICAgICAgIGRlY2lzaW9uID0gIlJVTk5FUl9XQVRDSF9BTEVSVCIKICAgICAgICAgICAgaWYgRFJZX1JVTjoKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIlJVTk5FUl9XQVRDSF9EUllfUlVOIgogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIFJ1bm5lciB3YXRjaCBhbGVydCBzdXBwcmVzc2VkIGZvciAlcyIsIHN5bWJvbCkKICAgICAgICAgICAgZWxpZiBURUxFR1JBTV9RVUlFVF9NT0RFIGFuZCBjb250ZXh0LmpvYiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIlJVTk5FUl9XQVRDSF9RVUlFVF9NT0RFIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICAgICAgICAgIHRleHQ9bXNnLAogICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1fYnVpbGRfYWxlcnRfa2V5Ym9hcmQoCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLmdldCgicGFpcl9hZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGxvZ19zaWduYWwoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJwYWlyX2FkZHJlc3MiOiB0b2tlbi5nZXQoInBhaXJfYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJzY29yZSI6IHRva2VuLmdldCgid2F0Y2hfc2NvcmUiKSwKICAgICAgICAgICAgICAgICAgICAibGlxdWlkaXR5IjogdG9rZW4uZ2V0KCJsaXF1aWRpdHkiKSwKICAgICAgICAgICAgICAgICAgICAidm9sdW1lXzI0aCI6IHRva2VuLmdldCgidm9sdW1lXzI0aCIpLAogICAgICAgICAgICAgICAgICAgICJwcmljZSI6IHRva2VuLmdldCgicHJpY2UiKSwKICAgICAgICAgICAgICAgICAgICAiY2hhbmdlXzI0aCI6IHRva2VuLmdldCgiY2hhbmdlXzI0aCIpLAogICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6IGRlY2lzaW9uLAogICAgICAgICAgICAgICAgICAgICJub3RlcyI6ICgKICAgICAgICAgICAgICAgICAgICAgICAgZiJydW5uZXJfd2F0Y2ggYWdlX2g9e3Rva2VuLmdldCgnYWdlX2hvdXJzJyk6LjJmfSAiCiAgICAgICAgICAgICAgICAgICAgICAgIGYieF9wcm94eT17dG9rZW4uZ2V0KCd4X3Byb3h5X2xhYmVsJyl9IG5hcnJhdGl2ZT17dG9rZW4uZ2V0KCduYXJyYXRpdmVfbGFiZWwnKX0iCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICBzZW50ICs9IDEKCiAgICAgICAgaWYgc2VudCA9PSAwOgogICAgICAgICAgICBwcmludCgiTmV3LXJ1bm5lciB3YXRjaDogY2FuZGlkYXRlcyBmb3VuZCBidXQgc2tpcHBlZCBieSBjb29sZG93bi9jYXBzLiIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICBwcmludCgiUlVOTkVSIFdBVENIIEVSUk9SOiIsIHJlcHIoZXhjKSkKCgphc3luYyBkZWYgcnVuX2xlZ2FjeV9yZWNvdmVyeV9zY2FubmVyKGNvbnRleHQpOgogICAgIiIiU2NhbiBlc3RhYmxpc2hlZCBTb2xhbmEgbWVtZWNvaW5zICg+OTBkKSBzaG93aW5nIGZyZXNoIHJldmVyc2FsIHBhdHRlcm5zLiIiIgogICAgaWYgbm90IExFR0FDWV9SRUNPVkVSWV9FTkFCTEVEOgogICAgICAgIHJldHVybgogICAgdHJ5OgogICAgICAgIHByaW50KCJSdW5uaW5nIGxlZ2FjeSByZWNvdmVyeSBzY2FuLi4uIikKICAgICAgICAjIFVzZSBicm9hZCBmZXRjaCDigJQgc2NhbnMgZnVsbCBlc3RhYmxpc2hlZCBTb2xhbmEgdW5pdmVyc2UsIG5vdCBhIGhhcmRjb2RlZCBsaXN0LgogICAgICAgICMgQ3VzdG9tIHF1ZXJpZXMgZnJvbSAuZW52IG92ZXJyaWRlIHRoZSBidWlsdC1pbiBicm9hZCBzd2VlcCBpZiBzZXQuCiAgICAgICAgY3VzdG9tX3F1ZXJpZXMgPSBMRUdBQ1lfUkVDT1ZFUllfU0VBUkNIX1FVRVJJRVMgaWYgTEVHQUNZX1JFQ09WRVJZX1NFQVJDSF9RVUVSSUVTIGVsc2UgTm9uZQogICAgICAgIHRva2VucyA9IGZldGNoX2xlZ2FjeV9yZWNvdmVyeV9jYW5kaWRhdGVzKAogICAgICAgICAgICBxdWVyaWVzPWN1c3RvbV9xdWVyaWVzLAogICAgICAgICAgICBwYWlyc19wZXJfcXVlcnk9TEVHQUNZX1JFQ09WRVJZX1BBSVJTX1BFUl9RVUVSWSwKICAgICAgICAgICAgbGltaXQ9MzAwLAogICAgICAgICkKICAgICAgICBpZiBub3QgdG9rZW5zOgogICAgICAgICAgICBsb2dnaW5nLmluZm8oIkxlZ2FjeSByZWNvdmVyeSBzY2FuOiBubyBjYW5kaWRhdGVzIGZyb20gRGV4U2NyZWVuZXIuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICMgR2V0IGN1cnJlbnQgU09MIHN0YXR1cyB0byBlbWJlZCBpbiBhbGVydAogICAgICAgIHNvbF9wcm94eSA9IF9jb21wdXRlX3NvbF9yZWdpbWVfcHJveHkoKQogICAgICAgIHNvbF9jaGFuZ2VfMjRoID0gZmxvYXQoc29sX3Byb3h5LmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICAgICAgc29sX2NoYW5nZV8xaCA9IGZsb2F0KHNvbF9wcm94eS5nZXQoImNoYW5nZV8xaCIsIDApIG9yIDApCiAgICAgICAgaWYgc29sX2NoYW5nZV8yNGggPD0gU09MX0VYVFJFTUVfT0ZGX0NIQU5HRV8yNEggb3Igc29sX2NoYW5nZV8xaCA8PSBTT0xfRVhUUkVNRV9PRkZfQ0hBTkdFXzFIOgogICAgICAgICAgICBzb2xfc3RhdHVzID0gIkVYVFJFTUVfUklTS19PRkYiCiAgICAgICAgZWxpZiBzb2xfY2hhbmdlXzI0aCA8PSBTT0xfUklTS19PRkZfQ0hBTkdFXzI0SDoKICAgICAgICAgICAgc29sX3N0YXR1cyA9ICJSSVNLX09GRiIKICAgICAgICBlbGlmIHNvbF9jaGFuZ2VfMjRoID49IFNPTF9SSVNLX09OX0NIQU5HRV8yNEg6CiAgICAgICAgICAgIHNvbF9zdGF0dXMgPSAiUklTS19PTiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBzb2xfc3RhdHVzID0gIk5FVVRSQUwiCgogICAgICAgIGNhbmRpZGF0ZXMgPSBbXQogICAgICAgIGZvciB0b2tlbiBpbiB0b2tlbnM6CiAgICAgICAgICAgIGVucmljaGVkID0gX2RldGVjdF9sZWdhY3lfcmVjb3ZlcnkodG9rZW4pCiAgICAgICAgICAgIGlmIG5vdCBlbnJpY2hlZDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHN5bWJvbCA9IHN0cihlbnJpY2hlZC5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpCiAgICAgICAgICAgIGlmIF9sZWdhY3lfcmVjb3Zlcnlfb25fY29vbGRvd24oc3ltYm9sKToKICAgICAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiBlbnJpY2hlZC5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiTEVHQUNZX1JFQ09WRVJZX0NPT0xET1dOX1NLSVAiLAogICAgICAgICAgICAgICAgICAgICJub3RlcyI6IGYiY29vbGRvd25faG91cnM9e0xFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9IT1VSU30iLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVucmljaGVkWyJzb2xfc3RhdHVzIl0gPSBzb2xfc3RhdHVzCiAgICAgICAgICAgIGNhbmRpZGF0ZXMuYXBwZW5kKGVucmljaGVkKQoKICAgICAgICBpZiBub3QgY2FuZGlkYXRlczoKICAgICAgICAgICAgcHJpbnQoIkxlZ2FjeSByZWNvdmVyeSBzY2FuOiBubyB0b2tlbnMgcGFzc2VkIGZpbHRlcnMuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICMgU29ydCBieSB2b2x1bWVfMjRoIGRlc2NlbmRpbmcgKG1vc3QgYWN0aXZlIGVzdGFibGlzaGVkIGNvaW5zIGZpcnN0KQogICAgICAgIGNhbmRpZGF0ZXMuc29ydChrZXk9bGFtYmRhIHQ6IGZsb2F0KHQuZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCksIHJldmVyc2U9VHJ1ZSkKICAgICAgICBzZW50ID0gMAogICAgICAgIHNlZW4gPSBzZXQoKQogICAgICAgIG1heF9wZXJfY3ljbGUgPSBtYXgoMSwgTEVHQUNZX1JFQ09WRVJZX01BWF9BTEVSVFNfUEVSX0NZQ0xFKQoKICAgICAgICBmb3IgdG9rZW4gaW4gY2FuZGlkYXRlczoKICAgICAgICAgICAgaWYgc2VudCA+PSBtYXhfcGVyX2N5Y2xlOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgc3ltYm9sID0gc3RyKHRva2VuLmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkKICAgICAgICAgICAgaWYgbm90IHN5bWJvbCBvciBzeW1ib2wgaW4gc2VlbjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHNlZW4uYWRkKHN5bWJvbCkKCiAgICAgICAgICAgIG1zZyA9IGZvcm1hdF9sZWdhY3lfcmVjb3ZlcnkodG9rZW4pCiAgICAgICAgICAgIGRlY2lzaW9uID0gIkxFR0FDWV9SRUNPVkVSWV9BTEVSVCIKICAgICAgICAgICAgaWYgRFJZX1JVTjoKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIkxFR0FDWV9SRUNPVkVSWV9EUllfUlVOIgogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIExlZ2FjeSByZWNvdmVyeSBhbGVydCBzdXBwcmVzc2VkIGZvciAlcyIsIHN5bWJvbCkKICAgICAgICAgICAgZWxpZiBURUxFR1JBTV9RVUlFVF9NT0RFIGFuZCBjb250ZXh0LmpvYiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIkxFR0FDWV9SRUNPVkVSWV9RVUlFVF9NT0RFIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICAgICAgICAgIHRleHQ9bXNnLAogICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1fYnVpbGRfYWxlcnRfa2V5Ym9hcmQoCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLmdldCgicGFpcl9hZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAicGFpcl9hZGRyZXNzIjogdG9rZW4uZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICJzY29yZSI6IDAsCiAgICAgICAgICAgICAgICAibGlxdWlkaXR5IjogdG9rZW4uZ2V0KCJsaXF1aWRpdHkiKSwKICAgICAgICAgICAgICAgICJ2b2x1bWVfMjRoIjogdG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiksCiAgICAgICAgICAgICAgICAicHJpY2UiOiB0b2tlbi5nZXQoInByaWNlIiksCiAgICAgICAgICAgICAgICAiY2hhbmdlXzI0aCI6IHRva2VuLmdldCgiY2hhbmdlXzI0aCIpLAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogZGVjaXNpb24sCiAgICAgICAgICAgICAgICAibm90ZXMiOiAoCiAgICAgICAgICAgICAgICAgICAgZiJsZWdhY3lfcmVjb3ZlcnkgYWdlX2Q9e3Rva2VuLmdldCgnYWdlX2RheXMnLCAwKTouMWZ9ICIKICAgICAgICAgICAgICAgICAgICBmInBhdHRlcm49e3Rva2VuLmdldCgncGF0dGVybl9sYWJlbCcpfSBzb2w9e3NvbF9zdGF0dXN9IgogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VudCArPSAxCgogICAgICAgIGlmIHNlbnQgPT0gMDoKICAgICAgICAgICAgcHJpbnQoIkxlZ2FjeSByZWNvdmVyeSBzY2FuOiBjYW5kaWRhdGVzIGZvdW5kIGJ1dCBza2lwcGVkIGJ5IGNvb2xkb3duL2NhcHMuIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjOgogICAgICAgIHByaW50KCJMRUdBQ1kgUkVDT1ZFUlkgU0NBTiBFUlJPUjoiLCByZXByKGV4YykpCgoKYXN5bmMgZGVmIHJ1bl9lbmdpbmUoY29udGV4dCk6CiAgICB0cnk6CiAgICAgICAgcHJpbnQoZiJSdW5uaW5nIHtfbW9kZSgpfSBzY2FuLi4uIikKICAgICAgICB0b2tlbnMgPSBmZXRjaF9tYXJrZXRfZGF0YSgpCiAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICJzeW1ib2wiOiAiRU5HSU5FIiwKICAgICAgICAgICAgImRlY2lzaW9uIjogIlNDQU5fUlVOIiwKICAgICAgICAgICAgIm5vdGVzIjogZiJmZXRjaGVkX3Rva2Vucz17bGVuKHRva2Vucyl9IiwKICAgICAgICB9KQogICAgICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgICAgIHByaW50KCJObyB2YWxpZCB0b2tlbnMgZm91bmQgKGZpbHRlcnMgcmVtb3ZlZCBldmVyeXRoaW5nKS4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgcmVnaW1lID0gX2NvbXB1dGVfcmVnaW1lKHRva2VucykKICAgICAgICBzb2xfcHJveHkgPSBfY29tcHV0ZV9zb2xfcmVnaW1lX3Byb3h5KCkKICAgICAgICBwb2xpY3kgPSBfYnVpbGRfbWFya2V0X3BvbGljeShyZWdpbWUsIHNvbF9wcm94eSkKCiAgICAgICAgIyBFeGl0LXJpc2sgYWxlcnRzIHJ1biBpbmRlcGVuZGVudGx5IG9mIGJ1eS1nYXRlIGNvbmRpdGlvbnMuCiAgICAgICAgYXdhaXQgcnVuX3NlbGxfc2lnbmFsX3NjYW5uZXIoY29udGV4dCwgdG9rZW5zPXRva2VucykKCiAgICAgICAgaWYgcG9saWN5WyJoYXJkX2Jsb2NrIl06CiAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIk1BUktFVF9IQVJEX0JMT0NLIiwKICAgICAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgIm5vdGVzIjogcG9saWN5WyJoYXJkX2Jsb2NrX3JlYXNvbiJdLAogICAgICAgICAgICB9KQogICAgICAgICAgICBwcmludChmIk1hcmtldCBoYXJkIGJsb2NrOiB7cG9saWN5WydoYXJkX2Jsb2NrX3JlYXNvbiddfSIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBjYW5fdHJhZGUsIGJsb2NrX3JlYXNvbiA9IF9yaXNrX2dvdmVybm9yX3N0YXR1cygpCiAgICAgICAgaWYgbm90IGNhbl90cmFkZToKICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogIkVOR0lORSIsCiAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiUklTS19HT1ZFUk5PUl9CTE9DSyIsCiAgICAgICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICJub3RlcyI6IGJsb2NrX3JlYXNvbiwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcHJpbnQoZiJSaXNrIGdvdmVybm9yIGJsb2NrZWQgYWxlcnRzOiB7YmxvY2tfcmVhc29ufSIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBsb2dnaW5nLmluZm8oCiAgICAgICAgICAgICJNYXJrZXQgcG9saWN5OiBzdGF0ZT0lcyBzb2wyNGg9JS4yZiUlIHNvbDFoPSUuMmYlJSB0aHI9JS4xZiBjb25mPj0lcyByZWdpbWVfbWluPSUuMWYgIgogICAgICAgICAgICAiY3ljbGVfY2FwPSVzIGRheV9jYXA9JXMgY29vbGRvd25faD0lcyIsCiAgICAgICAgICAgIHBvbGljeVsic3RhdGUiXSwKICAgICAgICAgICAgZmxvYXQoc29sX3Byb3h5LmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApLAogICAgICAgICAgICBmbG9hdChzb2xfcHJveHkuZ2V0KCJjaGFuZ2VfMWgiLCAwKSBvciAwKSwKICAgICAgICAgICAgZmxvYXQocG9saWN5WyJhbGVydF90aHJlc2hvbGQiXSksCiAgICAgICAgICAgIHBvbGljeVsibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiXSwKICAgICAgICAgICAgZmxvYXQocG9saWN5WyJyZWdpbWVfbWluX3Njb3JlIl0pLAogICAgICAgICAgICBwb2xpY3lbIm1heF9hbGVydHNfcGVyX2N5Y2xlIl0sCiAgICAgICAgICAgIHBvbGljeVsibWF4X2FsZXJ0c19wZXJfZGF5Il0sCiAgICAgICAgICAgIHBvbGljeVsiYWxlcnRfY29vbGRvd25faG91cnMiXSwKICAgICAgICApCgogICAgICAgIGFsZXJ0c18yNGggPSBjb3VudF9hbGVydHNfc2luY2UoZGF0ZXRpbWUudXRjbm93KCkgLSB0aW1lZGVsdGEoaG91cnM9MjQpKQogICAgICAgIHBvbGljeV9kYXlfY2FwID0gaW50KHBvbGljeVsibWF4X2FsZXJ0c19wZXJfZGF5Il0pCiAgICAgICAgaWYgcG9saWN5X2RheV9jYXAgPiAwIGFuZCBhbGVydHNfMjRoID49IHBvbGljeV9kYXlfY2FwOgogICAgICAgICAgICByZWFzb24gPSBmIlBvbGljeSBkYWlseSBjYXAgcmVhY2hlZCAoe2FsZXJ0c18yNGh9L3twb2xpY3lfZGF5X2NhcH0pIHN0YXRlPXtwb2xpY3lbJ3N0YXRlJ119IgogICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICJzeW1ib2wiOiAiRU5HSU5FIiwKICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJQT0xJQ1lfREFJTFlfQ0FQX0JMT0NLIiwKICAgICAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgIm5vdGVzIjogcmVhc29uLAogICAgICAgICAgICB9KQogICAgICAgICAgICBwcmludChmIlBvbGljeSBibG9ja2VkIGFsZXJ0czoge3JlYXNvbn0iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY2FuZGlkYXRlcyA9IFtdCiAgICAgICAgZm9yIHRva2VuIGluIHRva2VuczoKICAgICAgICAgICAgaWYgbm90IHRva2VuLmdldCgiYWRkcmVzcyIpOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgbm90IF9wYXNzZXNfcXVhbGl0eV9maWx0ZXJzKHRva2VuKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIG5vdCBfcGFzc2VzX2V4ZWN1dGlvbl9xdWFsaXR5X2ZpbHRlcnModG9rZW4pOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgbm90IF9wYXNzZXNfdGFjdGljYWxfZmlsdGVycyh0b2tlbik6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzeW1ib2wgPSB0b2tlbi5nZXQoInN5bWJvbCIsICIiKQogICAgICAgICAgICBjb250cm9sID0gX2FwcGx5X3N5bWJvbF9jb250cm9scyhzeW1ib2wpCiAgICAgICAgICAgIGlmIGNvbnRyb2w6CiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIlNZTUJPTF9DT05UUk9MX1NLSVAiLAogICAgICAgICAgICAgICAgICAgICJub3RlcyI6IGYie2NvbnRyb2xbJ3R5cGUnXX0gdW50aWwge2NvbnRyb2xbJ3VudGlsJ10uaXNvZm9ybWF0KCl9IiwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgIyBFbnJpY2ggd2l0aCBCaXJkRXllIG92ZXJ2aWV3IGRhdGEgKHVuaXF1ZSB3YWxsZXRzLCBzb2NpYWwsIGV0Yy4pCiAgICAgICAgICAgIHRva2VuID0gX2VucmljaF90b2tlbl9mb3Jfc2NvcmluZyh0b2tlbikKICAgICAgICAgICAgdG9rZW5bImVuZ2luZV9wcm9maWxlIl0gPSBfbW9kZSgpCiAgICAgICAgICAgIHNjb3JlID0gY2FsY3VsYXRlX3Rva2VuX3Njb3JlKHRva2VuKQogICAgICAgICAgICB0b2tlblsic2NvcmUiXSA9IHNjb3JlCiAgICAgICAgICAgIHRva2VuWyJjb25maWRlbmNlIl0gPSBfY29uZmlkZW5jZV9mcm9tX3Njb3JlKHNjb3JlKQogICAgICAgICAgICBsb2dnaW5nLmRlYnVnKCJUb2tlbiAlcyBzY29yZWQgJS4yZiIsIHRva2VuLmdldCgic3ltYm9sIiwgIlVOS05PV04iKSwgc2NvcmUpCgogICAgICAgICAgICBpZiBzY29yZSA+PSBmbG9hdChwb2xpY3lbImFsZXJ0X3RocmVzaG9sZCJdKSBhbmQgX2NvbmZpZGVuY2VfbWVldHNfcnVsZSgKICAgICAgICAgICAgICAgIHRva2VuWyJjb25maWRlbmNlIl0sCiAgICAgICAgICAgICAgICBwb2xpY3lbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0sCiAgICAgICAgICAgICk6CiAgICAgICAgICAgICAgICBjYW5kaWRhdGVzLmFwcGVuZCh0b2tlbikKCiAgICAgICAgcmVnaW1lX21pbiA9IGZsb2F0KHBvbGljeVsicmVnaW1lX21pbl9zY29yZSJdKQogICAgICAgIGlmIEVOQUJMRV9SRUdJTUVfR0FURSBhbmQgcmVnaW1lWyJzY29yZSJdIDwgcmVnaW1lX21pbjoKICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogIkVOR0lORSIsCiAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiUkVHSU1FX0JMT0NLIiwKICAgICAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgIm5vdGVzIjogKAogICAgICAgICAgICAgICAgICAgIGYiR2F0ZSBhY3RpdmUuIG1pbj17cmVnaW1lX21pbn0sIGJyZWFkdGg9e3JlZ2ltZVsnYnJlYWR0aF9wY3QnXTouMmZ9LCAiCiAgICAgICAgICAgICAgICAgICAgZiJtYXJrZXRfc3RhdGU9e3BvbGljeVsnc3RhdGUnXX0iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9KQogICAgICAgICAgICBwcmludCgKICAgICAgICAgICAgICAgIGYiUmVnaW1lIGdhdGUgYmxvY2tlZCBhbGVydHM6IHtyZWdpbWVbJ2xhYmVsJ119ICIKICAgICAgICAgICAgICAgIGYiKHtyZWdpbWVbJ3Njb3JlJ106LjFmfSA8IHtyZWdpbWVfbWlufSkuIgogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBpZiBub3QgY2FuZGlkYXRlczoKICAgICAgICAgICAgcHJpbnQoZiJObyB0b2tlbnMgbWVldCB0aGUgc2NvcmUgdGhyZXNob2xkICh7cG9saWN5WydhbGVydF90aHJlc2hvbGQnXX0pLiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBjYW5kaWRhdGVzLnNvcnQoa2V5PWxhbWJkYSB4OiB4WyJzY29yZSJdLCByZXZlcnNlPVRydWUpCiAgICAgICAgYmVzdF90b2tlbiA9IGNhbmRpZGF0ZXNbMF0KCiAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICJzeW1ib2wiOiBiZXN0X3Rva2VuLmdldCgic3ltYm9sIiksCiAgICAgICAgICAgICJtaW50IjogYmVzdF90b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgInNjb3JlIjogYmVzdF90b2tlbi5nZXQoInNjb3JlIiksCiAgICAgICAgICAgICJsaXF1aWRpdHkiOiBiZXN0X3Rva2VuLmdldCgibGlxdWlkaXR5IiksCiAgICAgICAgICAgICJ2b2x1bWVfMjRoIjogYmVzdF90b2tlbi5nZXQoInZvbHVtZV8yNGgiKSwKICAgICAgICAgICAgInByaWNlIjogYmVzdF90b2tlbi5nZXQoInByaWNlIiksCiAgICAgICAgICAgICJjaGFuZ2VfMjRoIjogYmVzdF90b2tlbi5nZXQoImNoYW5nZV8yNGgiKSwKICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgImNvbnZpY3Rpb24iOiBfQ09ORklERU5DRV9PUkRFUi5nZXQoYmVzdF90b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpLCAxKSwKICAgICAgICAgICAgImRlY2lzaW9uIjogIlNDQU5fQkVTVCIsCiAgICAgICAgfSkKICAgICAgICBwb2xpY3lfY3ljbGVfY2FwID0gbWF4KDEsIGludChwb2xpY3lbIm1heF9hbGVydHNfcGVyX2N5Y2xlIl0pKQogICAgICAgIG1heF9jeWNsZV9hbGVydHMgPSBtYXgoMSwgbWluKE1BWF9BTEVSVFNfUEVSX0NZQ0xFLCBwb2xpY3lfY3ljbGVfY2FwKSkKICAgICAgICBtYXhfcmFua2VkID0gbWF4KDEsIG1pbihBTEVSVF9UT1BfTiwgcG9saWN5X2N5Y2xlX2NhcCkpCiAgICAgICAgYWxlcnRzX3NlbnQgPSAwCiAgICAgICAgc2Vlbl9zeW1ib2xzID0gc2V0KCkKCiAgICAgICAgZm9yIHRva2VuIGluIGNhbmRpZGF0ZXM6CiAgICAgICAgICAgIGlmIGFsZXJ0c19zZW50ID49IG1heF9jeWNsZV9hbGVydHMgb3IgYWxlcnRzX3NlbnQgPj0gbWF4X3JhbmtlZDoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICByZWZyZXNoZWQgPSBfcmVmcmVzaF9hbGVydF9tYXJrZXRfc25hcHNob3QodG9rZW4pCiAgICAgICAgICAgIGlmIHJlZnJlc2hlZCBpcyBOb25lOgogICAgICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHRva2VuLmdldCgic3ltYm9sIiwgIlVOS05PV04iKSwKICAgICAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJBTEVSVF9TS0lQX05PX0xJVkVfREFUQSIsCiAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogImxpdmUgcmVmcmVzaCByZXF1aXJlZCBidXQgdW5hdmFpbGFibGUiLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHRva2VuID0gcmVmcmVzaGVkCgogICAgICAgICAgICBzeW1ib2wgPSB0b2tlbi5nZXQoInN5bWJvbCIsICJVTktOT1dOIikKICAgICAgICAgICAgaWYgc3ltYm9sIGluIHNlZW5fc3ltYm9sczoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHNlZW5fc3ltYm9scy5hZGQoc3ltYm9sKQoKICAgICAgICAgICAgaWYgX2lzX3N5bWJvbF9vbl9jb29sZG93bihzeW1ib2wsIGNvb2xkb3duX2hvdXJzPXBvbGljeVsiYWxlcnRfY29vbGRvd25faG91cnMiXSk6CiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgInNjb3JlIjogdG9rZW4uZ2V0KCJzY29yZSIpLAogICAgICAgICAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICAgICAiY29udmljdGlvbiI6IF9DT05GSURFTkNFX09SREVSLmdldCh0b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpLCAxKSwKICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiQ09PTERPV05fU0tJUCIsCiAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogZiJjb29sZG93bl9ob3Vycz17cG9saWN5WydhbGVydF9jb29sZG93bl9ob3VycyddfSBzdGF0ZT17cG9saWN5WydzdGF0ZSddfSIsCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc3ltYm9sX2RhaWx5X2FsZXJ0cyA9IGNvdW50X2FsZXJ0c19zaW5jZSgKICAgICAgICAgICAgICAgIGRhdGV0aW1lLnV0Y25vdygpIC0gdGltZWRlbHRhKGhvdXJzPTI0KSwKICAgICAgICAgICAgICAgIHN5bWJvbD1zeW1ib2wsCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgRU5BQkxFX1JJU0tfR09WRVJOT1IKICAgICAgICAgICAgICAgIGFuZCBNQVhfQUxFUlRTX1BFUl9TWU1CT0xfUEVSX0RBWSA+IDAKICAgICAgICAgICAgICAgIGFuZCBzeW1ib2xfZGFpbHlfYWxlcnRzID49IE1BWF9BTEVSVFNfUEVSX1NZTUJPTF9QRVJfREFZCiAgICAgICAgICAgICk6CiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgInNjb3JlIjogdG9rZW4uZ2V0KCJzY29yZSIpLAogICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJTWU1CT0xfREFJTFlfQ0FQX1NLSVAiLAogICAgICAgICAgICAgICAgICAgICJub3RlcyI6IGYiZGFpbHlfY2FwPXtNQVhfQUxFUlRTX1BFUl9TWU1CT0xfUEVSX0RBWX0iLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBjaGFuZ2VfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkKICAgICAgICAgICAgdHJlbmQgPSAiVXB0cmVuZCIgaWYgY2hhbmdlXzI0aCA+PSAwIGVsc2UgIlB1bGxiYWNrIgogICAgICAgICAgICBlbnRyeV90eXBlID0gIk1vbWVudHVtIGNvbnRpbnVhdGlvbiIgaWYgY2hhbmdlXzI0aCA+PSAwIGVsc2UgIkRpcCByZWNvdmVyeSBzZXR1cCIKICAgICAgICAgICAgd2FsbGV0X2ZpdCA9IF93YWxsZXRfZml0X2Zvcl9tYWluX3Rva2VuKHRva2VuLCByZWdpbWUsIHBvbGljeSkKICAgICAgICAgICAgcmlza19wbGFuLCByb3RhdGlvbl9wbGFuID0gX3dhbGxldF9ndWlkYW5jZSh3YWxsZXRfZml0KQogICAgICAgICAgICB0b2tlbl9kYXRhID0gewogICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICJzY29yZSI6IHRva2VuLmdldCgic2NvcmUiKSwKICAgICAgICAgICAgICAgICJwcmljZSI6IHRva2VuLmdldCgicHJpY2UiKSwKICAgICAgICAgICAgICAgICJsaXF1aWRpdHkiOiB0b2tlbi5nZXQoImxpcXVpZGl0eSIpLAogICAgICAgICAgICAgICAgInZvbHVtZV8yNGgiOiB0b2tlbi5nZXQoInZvbHVtZV8yNGgiKSwKICAgICAgICAgICAgICAgICJtYXJrZXRfY2FwIjogdG9rZW4uZ2V0KCJtYXJrZXRfY2FwIiksCiAgICAgICAgICAgICAgICAiZmR2IjogdG9rZW4uZ2V0KCJmZHYiKSwKICAgICAgICAgICAgICAgICJob2xkZXJzIjogX2hvbGRlcnNfZm9yX2FsZXJ0KHRva2VuKSwKICAgICAgICAgICAgICAgICJ0cmVuZCI6IHRyZW5kLAogICAgICAgICAgICAgICAgImVudHJ5X3R5cGUiOiBlbnRyeV90eXBlLAogICAgICAgICAgICAgICAgImNvbmZpZGVuY2UiOiB0b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpLAogICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICJwcm9maWxlIjogX21vZGUoKSwKICAgICAgICAgICAgICAgICJjaGFuZ2VfMjRoIjogY2hhbmdlXzI0aCwKICAgICAgICAgICAgICAgICJyc2kiOiB0b2tlbi5nZXQoInJzaSIpLAogICAgICAgICAgICAgICAgIm1hY2RfaGlzdCI6IHRva2VuLmdldCgibWFjZF9oaXN0IiksCiAgICAgICAgICAgICAgICAid2FsbGV0X2ZpdCI6IHdhbGxldF9maXQsCiAgICAgICAgICAgICAgICAicmlza19wbGFuIjogcmlza19wbGFuLAogICAgICAgICAgICAgICAgInJvdGF0aW9uX3BsYW4iOiByb3RhdGlvbl9wbGFuLAogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiBub3QgX3Bhc3Nlc19saXZlX3B1c2hfZ2F0ZSh0b2tlbiwgcG9saWN5KToKICAgICAgICAgICAgICAgIHJlcXVpcmVkX3Njb3JlID0gZmxvYXQocG9saWN5LmdldCgiYWxlcnRfdGhyZXNob2xkIiwgX3J1bnRpbWVbImFsZXJ0X3RocmVzaG9sZCJdKSBvciAwKSArIG1heCgKICAgICAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgICAgIGludChURUxFR1JBTV9QVVNIX01JTl9TQ09SRV9ERUxUQSksCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAgICAgInNjb3JlIjogdG9rZW4uZ2V0KCJzY29yZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiQUxFUlRfU1VQUFJFU1NFRF9OT0lTRV9HQVRFIiwKICAgICAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiJzY29yZT49e3JlcXVpcmVkX3Njb3JlOi4xZn0gY29uZj49e1RFTEVHUkFNX1BVU0hfTUlOX0NPTkZJREVOQ0V9ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYiZ290IHNjb3JlPXtmbG9hdCh0b2tlbi5nZXQoJ3Njb3JlJywgMCkgb3IgMCk6LjFmfSBjb25mPXt0b2tlbi5nZXQoJ2NvbmZpZGVuY2UnLCAnQycpfSIKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgbXNnID0gZm9ybWF0X3NpZ25hbCh0b2tlbl9kYXRhLCBjb21wYWN0PVRydWUpCgogICAgICAgICAgICBkZWNpc2lvbiA9ICJBTEVSVCIKICAgICAgICAgICAgaWYgRFJZX1JVTjoKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIkFMRVJUX0RSWV9SVU4iCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gVGVsZWdyYW0gYWxlcnQgc3VwcHJlc3NlZCBmb3IgJXMiLCBzeW1ib2wpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPV9idWlsZF9hbGVydF9rZXlib2FyZCgKICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICJzY29yZSI6IHRva2VuLmdldCgic2NvcmUiKSwKICAgICAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgImNvbnZpY3Rpb24iOiBfQ09ORklERU5DRV9PUkRFUi5nZXQodG9rZW4uZ2V0KCJjb25maWRlbmNlIiwgIkMiKSwgMSksCiAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiBkZWNpc2lvbiwKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGlmIE9VVENPTUVfVFJBQ0tJTkdfRU5BQkxFRDoKICAgICAgICAgICAgICAgIGVudHJ5X3ByaWNlID0gZmxvYXQodG9rZW4uZ2V0KCJwcmljZSIpIG9yIDApCiAgICAgICAgICAgICAgICBpZiBlbnRyeV9wcmljZSA+IDA6CiAgICAgICAgICAgICAgICAgICAgcXVldWVfYWxlcnRfb3V0Y29tZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJlbnRyeV9wcmljZSI6IGVudHJ5X3ByaWNlLAogICAgICAgICAgICAgICAgICAgICAgICAic2NvcmUiOiB0b2tlbi5nZXQoInNjb3JlIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICJjb25maWRlbmNlIjogdG9rZW4uZ2V0KCJjb25maWRlbmNlIiwgIkMiKSwKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgYWxlcnRzX3NlbnQgKz0gMQoKICAgICAgICBpZiBhbGVydHNfc2VudCA9PSAwOgogICAgICAgICAgICBwcmludCgiQ2FuZGlkYXRlcyBmb3VuZCBidXQgc2tpcHBlZCBieSBjb29sZG93bi9jYXBzLiIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICBwcmludCgiRU5HSU5FIEVSUk9SOiIsIHJlcHIoZXhjKSkKCgpkZWYgbWFpbigpOgogICAgX3JlcXVpcmVfZW52KCkKICAgIGluaXRfZGIoKQogICAgX2xvYWRfd2F0Y2hsaXN0X3N0YXRlKCkKICAgIGxvY2sgPSBTaW5nbGV0b25Qcm9jZXNzTG9jayhQUk9DRVNTX0xPQ0tfRklMRSkKICAgIGlmIG5vdCBsb2NrLmFjcXVpcmUoKToKICAgICAgICBsb2dnaW5nLmVycm9yKCJBbm90aGVyIGVuZ2luZSBpbnN0YW5jZSBpcyBydW5uaW5nLiBFeGl0aW5nIChsb2NrOiAlcykuIiwgUFJPQ0VTU19MT0NLX0ZJTEUpCiAgICAgICAgcmV0dXJuCgogICAgc2VsbF9ydWxlcyA9IF9zZWxsX3N0eWxlX3J1bGVzKCkKICAgIGxvZ2dpbmcuaW5mbygKICAgICAgICAiU3RhcnR1cCBjb25maWc6IEVOR0lORV9QUk9GSUxFPSVzIFJJU0tfU1RZTEU9JXMgQUxFUlRfVEhSRVNIT0xEPSVzIE1JTl9DT05GSURFTkNFX1RPX0FMRVJUPSVzICIKICAgICAgICAiRU5BQkxFX1JFR0lNRV9HQVRFPSVzIFJFR0lNRV9NSU5fU0NPUkU9JXMgRFJZX1JVTj0lcyAiCiAgICAgICAgIldFRUtMWV9UVU5JTkdfRU5BQkxFRD0lcyBXRUVLTFlfVFVOSU5HX0RBWV9VVEM9JXMgV0VFS0xZX1RVTklOR19IT1VSX1VUQz0lcyAiCiAgICAgICAgIk9VVENPTUVfVFJBQ0tJTkdfRU5BQkxFRD0lcyBPVVRDT01FX0VWQUxfSU5URVJWQUxfU0VDT05EUz0lcyAiCiAgICAgICAgIkFMRVJUX1RPUF9OPSVzIE1BWF9BTEVSVFNfUEVSX0NZQ0xFPSVzIEFMRVJUX0NPT0xET1dOX0hPVVJTPSVzICIKICAgICAgICAiRU5BQkxFX1JJU0tfR09WRVJOT1I9JXMgR0xPQkFMX1RSQURJTkdfUEFVU0U9JXMgTUFYX0FMRVJUU19QRVJfREFZPSVzICIKICAgICAgICAiTUFYX0FMRVJUU19QRVJfU1lNQk9MX1BFUl9EQVk9JXMgTUFYX0NPTlNFQ1VUSVZFXzRIX0xPU1NFUz0lcyAiCiAgICAgICAgIkxPU1NfU1RSRUFLX0xPT0tCQUNLX0hPVVJTPSVzIEVOQUJMRV9FWEVDVVRJT05fUVVBTElUWV9GSUxURVJTPSVzICIKICAgICAgICAiVEFDVElDQUxfRU5BQkxFX1JFQUxfVEVDSE5JQ0FMUz0lcyBUQUNUSUNBTF9SRVFVSVJFX1RFQ0hOSUNBTF9DT05GSVJNQVRJT049JXMgIgogICAgICAgICJUQUNUSUNBTF9PSExDVl9UWVBFPSVzIFRBQ1RJQ0FMX1JTSV9SQU5HRT0lcy0lcyBUQUNUSUNBTF9NQUNEX0hJU1RfTUlOPSVzICIKICAgICAgICAiQUxFUlRfREFUQV9SRUZSRVNIX0VOQUJMRUQ9JXMgQUxFUlRfUkVRVUlSRV9SRUZSRVNIX1NVQ0NFU1M9JXMgQUxFUlRfREFUQV9EUklGVF9XQVJOX1BDVD0lcyAiCiAgICAgICAgIkFMRVJUX0hJREVfVU5WRVJJRklFRF9IT0xERVJTPSVzIEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSPSVzICIKICAgICAgICAiQkVBUklTSF9BTEVSVF9USFJFU0hPTEQ9JXMgQkVBUklTSF9NSU5fQ09ORklERU5DRV9UT19BTEVSVD0lcyAiCiAgICAgICAgIkJFQVJJU0hfTUFYX0FMRVJUU19QRVJfQ1lDTEU9JXMgQkVBUklTSF9NQVhfQUxFUlRTX1BFUl9EQVk9JXMgIgogICAgICAgICJCRUFSSVNIX0FMRVJUX0NPT0xET1dOX0hPVVJTPSVzIEVOQUJMRV9FWFRSRU1FX1JJU0tfSEFSRF9CTE9DSz0lcyAiCiAgICAgICAgIk5FV19SVU5ORVJfV0FUQ0hfRU5BQkxFRD0lcyBORVdfUlVOTkVSX1NDQU5fSU5URVJWQUxfU0VDT05EUz0lcyAiCiAgICAgICAgIk5FV19SVU5ORVJfTUlOX01BUktFVF9DQVA9JXMgTkVXX1JVTk5FUl9NQVhfQUdFX0hPVVJTPSVzICIKICAgICAgICAiTkVXX1JVTk5FUl9NSU5fVk9MVU1FXzI0SD0lcyBORVdfUlVOTkVSX01JTl9MSVFVSURJVFk9JXMgIgogICAgICAgICJORVdfUlVOTkVSX01JTl9BTEVSVF9TQ09SRT0lcyBORVdfUlVOTkVSX0NPT0xET1dOX0hPVVJTPSVzICIKICAgICAgICAiV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRD0lcyBXQVRDSExJU1RfRU5UUklFUz0lcyBXQVRDSExJU1RfU0NBTl9JTlRFUlZBTF9TRUNPTkRTPSVzICIKICAgICAgICAiV0FUQ0hMSVNUX01BWF9BTEVSVFNfUEVSX0NZQ0xFPSVzIFdBVENITElTVF9BTEVSVF9DT09MRE9XTl9IT1VSUz0lcyAiCiAgICAgICAgIldBVENITElTVF9BTEVSVF9PTl9TVEFUVVNfQ0hBTkdFPSVzIFdBVENITElTVF9BTEVSVF9TVEFUVVNFUz0lcyAiCiAgICAgICAgIldBVENITElTVF9TVU1NQVJZX0VOQUJMRUQ9JXMgV0FUQ0hMSVNUX1NVTU1BUllfSE9VUl9VVEM9JXMgIgogICAgICAgICJBTkFMWVNJU19CVUxMRVRJTl9FTkFCTEVEPSVzIEFOQUxZU0lTX0JVTExFVElOX0lOVEVSVkFMPSVzICIKICAgICAgICAiU0VMTF9BTEVSVFNfRU5BQkxFRD0lcyBTRUxMX0FMRVJUX01BWF9QRVJfQ1lDTEU9JXMgU0VMTF9BTEVSVF9DT09MRE9XTl9IT1VSUz0lcyAiCiAgICAgICAgIlNFTExfRUZGRUNUSVZFX01BWF9QRVJfQ1lDTEU9JXMgU0VMTF9FRkZFQ1RJVkVfQ09PTERPV05fSE9VUlM9JXMgIgogICAgICAgICJMRUdBQ1lfUkVDT1ZFUllfRU5BQkxFRD0lcyBMRUdBQ1lfUkVDT1ZFUllfU0NBTl9JTlRFUlZBTF9TRUNPTkRTPSVzICIKICAgICAgICAiTEVHQUNZX1JFQ09WRVJZX01JTl9BR0VfREFZUz0lcyBMRUdBQ1lfUkVDT1ZFUllfTUlOX0xJUVVJRElUWT0lcyAiCiAgICAgICAgIkxFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SD0lcyBMRUdBQ1lfUkVDT1ZFUllfTUFYX0FMRVJUU19QRVJfQ1lDTEU9JXMgIgogICAgICAgICJMRUdBQ1lfUkVDT1ZFUllfQ09PTERPV05fSE9VUlM9JXMiLAogICAgICAgIF9tb2RlKCksCiAgICAgICAgX25vcm1hbGl6ZV9yaXNrX3N0eWxlKF9ydW50aW1lLmdldCgicmlza19zdHlsZSIpKSwKICAgICAgICBfcnVudGltZVsiYWxlcnRfdGhyZXNob2xkIl0sCiAgICAgICAgX3J1bnRpbWVbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0sCiAgICAgICAgRU5BQkxFX1JFR0lNRV9HQVRFLAogICAgICAgIF9ydW50aW1lWyJyZWdpbWVfbWluX3Njb3JlIl0sCiAgICAgICAgRFJZX1JVTiwKICAgICAgICBXRUVLTFlfVFVOSU5HX0VOQUJMRUQsCiAgICAgICAgV0VFS0xZX1RVTklOR19EQVlfVVRDLAogICAgICAgIFdFRUtMWV9UVU5JTkdfSE9VUl9VVEMsCiAgICAgICAgT1VUQ09NRV9UUkFDS0lOR19FTkFCTEVELAogICAgICAgIE9VVENPTUVfRVZBTF9JTlRFUlZBTF9TRUNPTkRTLAogICAgICAgIEFMRVJUX1RPUF9OLAogICAgICAgIE1BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgICAgIF9ydW50aW1lWyJhbGVydF9jb29sZG93bl9ob3VycyJdLAogICAgICAgIEVOQUJMRV9SSVNLX0dPVkVSTk9SLAogICAgICAgIEdMT0JBTF9UUkFESU5HX1BBVVNFLAogICAgICAgIE1BWF9BTEVSVFNfUEVSX0RBWSwKICAgICAgICBNQVhfQUxFUlRTX1BFUl9TWU1CT0xfUEVSX0RBWSwKICAgICAgICBNQVhfQ09OU0VDVVRJVkVfNEhfTE9TU0VTLAogICAgICAgIExPU1NfU1RSRUFLX0xPT0tCQUNLX0hPVVJTLAogICAgICAgIEVOQUJMRV9FWEVDVVRJT05fUVVBTElUWV9GSUxURVJTLAogICAgICAgIFRBQ1RJQ0FMX0VOQUJMRV9SRUFMX1RFQ0hOSUNBTFMsCiAgICAgICAgVEFDVElDQUxfUkVRVUlSRV9URUNITklDQUxfQ09ORklSTUFUSU9OLAogICAgICAgIFRBQ1RJQ0FMX09ITENWX1RZUEUsCiAgICAgICAgVEFDVElDQUxfUlNJX01JTiwKICAgICAgICBUQUNUSUNBTF9SU0lfTUFYLAogICAgICAgIFRBQ1RJQ0FMX01BQ0RfSElTVF9NSU4sCiAgICAgICAgQUxFUlRfREFUQV9SRUZSRVNIX0VOQUJMRUQsCiAgICAgICAgQUxFUlRfUkVRVUlSRV9SRUZSRVNIX1NVQ0NFU1MsCiAgICAgICAgQUxFUlRfREFUQV9EUklGVF9XQVJOX1BDVCwKICAgICAgICBBTEVSVF9ISURFX1VOVkVSSUZJRURfSE9MREVSUywKICAgICAgICBFTkFCTEVfU09MX1JFR0lNRV9MQVlFUiwKICAgICAgICBCRUFSSVNIX0FMRVJUX1RIUkVTSE9MRCwKICAgICAgICBCRUFSSVNIX01JTl9DT05GSURFTkNFX1RPX0FMRVJULAogICAgICAgIEJFQVJJU0hfTUFYX0FMRVJUU19QRVJfQ1lDTEUsCiAgICAgICAgQkVBUklTSF9NQVhfQUxFUlRTX1BFUl9EQVksCiAgICAgICAgQkVBUklTSF9BTEVSVF9DT09MRE9XTl9IT1VSUywKICAgICAgICBFTkFCTEVfRVhUUkVNRV9SSVNLX0hBUkRfQkxPQ0ssCiAgICAgICAgTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVELAogICAgICAgIE5FV19SVU5ORVJfU0NBTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgICAgIE5FV19SVU5ORVJfTUlOX01BUktFVF9DQVAsCiAgICAgICAgTkVXX1JVTk5FUl9NQVhfQUdFX0hPVVJTLAogICAgICAgIE5FV19SVU5ORVJfTUlOX1ZPTFVNRV8yNEgsCiAgICAgICAgTkVXX1JVTk5FUl9NSU5fTElRVUlESVRZLAogICAgICAgIE5FV19SVU5ORVJfTUlOX0FMRVJUX1NDT1JFLAogICAgICAgIE5FV19SVU5ORVJfQ09PTERPV05fSE9VUlMsCiAgICAgICAgV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRCwKICAgICAgICBsZW4oV0FUQ0hMSVNUX0VOVFJJRVMpLAogICAgICAgIFdBVENITElTVF9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAgICAgV0FUQ0hMSVNUX01BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgICAgIFdBVENITElTVF9BTEVSVF9DT09MRE9XTl9IT1VSUywKICAgICAgICBXQVRDSExJU1RfQUxFUlRfT05fU1RBVFVTX0NIQU5HRSwKICAgICAgICAiLCIuam9pbihXQVRDSExJU1RfQUxFUlRfU1RBVFVTRVMpLAogICAgICAgIFdBVENITElTVF9TVU1NQVJZX0VOQUJMRUQsCiAgICAgICAgV0FUQ0hMSVNUX1NVTU1BUllfSE9VUl9VVEMsCiAgICAgICAgR09PRF9CVVlfQlVMTEVUSU5fRU5BQkxFRCwKICAgICAgICBHT09EX0JVWV9CVUxMRVRJTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgICAgIFNFTExfQUxFUlRTX0VOQUJMRUQsCiAgICAgICAgU0VMTF9BTEVSVF9NQVhfUEVSX0NZQ0xFLAogICAgICAgIFNFTExfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICAgICAgc2VsbF9ydWxlc1sibWF4X3Blcl9jeWNsZSJdLAogICAgICAgIHNlbGxfcnVsZXNbImNvb2xkb3duX2hvdXJzIl0sCiAgICAgICAgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQsCiAgICAgICAgTEVHQUNZX1JFQ09WRVJZX1NDQU5fSU5URVJWQUxfU0VDT05EUywKICAgICAgICBMRUdBQ1lfUkVDT1ZFUllfTUlOX0FHRV9EQVlTLAogICAgICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fTElRVUlESVRZLAogICAgICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SCwKICAgICAgICBMRUdBQ1lfUkVDT1ZFUllfTUFYX0FMRVJUU19QRVJfQ1lDTEUsCiAgICAgICAgTEVHQUNZX1JFQ09WRVJZX0NPT0xET1dOX0hPVVJTLAogICAgKQogICAgdHJ5OgogICAgICAgIGdsb2JhbCBfYXBwX3JlZgogICAgICAgIGFwcCA9IEFwcGxpY2F0aW9uQnVpbGRlcigpLnRva2VuKFRFTEVHUkFNX1RPS0VOKS5idWlsZCgpCiAgICAgICAgX2FwcF9yZWYgPSBhcHAKCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJoZWxwIiwgY21kX2hlbHApKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhdHVzIiwgY21kX3N0YXR1cykpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJtb2RlIiwgY21kX21vZGUpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigicmlza3Byb2ZpbGUiLCBjbWRfcmlza3Byb2ZpbGUpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigicmlzayIsIGNtZF9yaXNrKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInBhdXNlIiwgY21kX3BhdXNlKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInJlc3VtZSIsIGNtZF9yZXN1bWUpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigicGVyZm9ybWFuY2UiLCBjbWRfcGVyZm9ybWFuY2UpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiYnV5IiwgY21kX2J1eSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzb2xkIiwgY21kX3NvbGQpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigicG9zaXRpb25zIiwgY21kX3Bvc2l0aW9ucykpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJkaWdlc3QiLCBjbWRfZGlnZXN0KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIm1hcmtldG5vdyIsIGNtZF9tYXJrZXRub3cpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiZ29vZGJ1eSIsIGNtZF9nb29kYnV5KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImJhZGJ1eSIsIGNtZF9iYWRidXkpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigid2FsbGV0Mm5vdyIsIGNtZF93YWxsZXQybm93KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIndhbGxldDJiYWQiLCBjbWRfd2FsbGV0MmJhZCkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ3YWxsZXQzbm93IiwgY21kX3dhbGxldDNub3cpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigid2FsbGV0M2JhZCIsIGNtZF93YWxsZXQzYmFkKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIndhbGxldHBsYW4iLCBjbWRfd2FsbGV0cGxhbikpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJydW5uZXJ3YXRjaCIsIGNtZF9ydW5uZXJ3YXRjaCkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ3YXRjaGxpc3QiLCBjbWRfd2F0Y2hsaXN0KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIndhdGNobGlzdHN1bW1hcnkiLCBjbWRfd2F0Y2hsaXN0c3VtbWFyeSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENhbGxiYWNrUXVlcnlIYW5kbGVyKG9uX2FsZXJ0X2FjdGlvbiwgcGF0dGVybj1yIl4obXV0ZXxhY2spOiIpKQoKICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgICAgICBydW5fZW5naW5lLAogICAgICAgICAgICB3aGVuPTEsCiAgICAgICAgICAgIG5hbWU9InJ1bl9lbmdpbmVfYm9vdCIsCiAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAzMH0sCiAgICAgICAgKQogICAgICAgIGFwcC5qb2JfcXVldWUucnVuX3JlcGVhdGluZygKICAgICAgICAgICAgcnVuX2VuZ2luZSwKICAgICAgICAgICAgaW50ZXJ2YWw9aW50KF9ydW50aW1lWyJzY2FuX2ludGVydmFsX3NlY29uZHMiXSksCiAgICAgICAgICAgIGZpcnN0PWludChfcnVudGltZVsic2Nhbl9pbnRlcnZhbF9zZWNvbmRzIl0pLAogICAgICAgICAgICBuYW1lPSJydW5fZW5naW5lX2N5Y2xlIiwKICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDMwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICAgICApCiAgICAgICAgaWYgTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVEOgogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgICAgICAgICAgcnVuX25ld19ydW5uZXJfd2F0Y2gsCiAgICAgICAgICAgICAgICB3aGVuPTE1LAogICAgICAgICAgICAgICAgbmFtZT0icnVubmVyX3dhdGNoX2Jvb3QiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDYwfSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgICAgICAgICBydW5fbmV3X3J1bm5lcl93YXRjaCwKICAgICAgICAgICAgICAgIGludGVydmFsPW1heCgzMDAsIGludChORVdfUlVOTkVSX1NDQU5fSU5URVJWQUxfU0VDT05EUykpLAogICAgICAgICAgICAgICAgZmlyc3Q9bWF4KDMwMCwgaW50KE5FV19SVU5ORVJfU0NBTl9JTlRFUlZBTF9TRUNPTkRTKSksCiAgICAgICAgICAgICAgICBuYW1lPSJydW5uZXJfd2F0Y2hfY3ljbGUiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDEyMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBMRUdBQ1lfUkVDT1ZFUllfRU5BQkxFRDoKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICAgICAgICAgIHJ1bl9sZWdhY3lfcmVjb3Zlcnlfc2Nhbm5lciwKICAgICAgICAgICAgICAgIHdoZW49MzUsCiAgICAgICAgICAgICAgICBuYW1lPSJsZWdhY3lfcmVjb3ZlcnlfYm9vdCIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogNjB9LAogICAgICAgICAgICApCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX3JlcGVhdGluZygKICAgICAgICAgICAgICAgIHJ1bl9sZWdhY3lfcmVjb3Zlcnlfc2Nhbm5lciwKICAgICAgICAgICAgICAgIGludGVydmFsPW1heCgzMDAsIGludChMRUdBQ1lfUkVDT1ZFUllfU0NBTl9JTlRFUlZBTF9TRUNPTkRTKSksCiAgICAgICAgICAgICAgICBmaXJzdD1tYXgoMzAwLCBpbnQoTEVHQUNZX1JFQ09WRVJZX1NDQU5fSU5URVJWQUxfU0VDT05EUykpLAogICAgICAgICAgICAgICAgbmFtZT0ibGVnYWN5X3JlY292ZXJ5X2N5Y2xlIiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAxMjAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCiAgICAgICAgaWYgV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRCBhbmQgV0FUQ0hMSVNUX0VOVFJJRVM6CiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgICAgICAgICBydW5fd2F0Y2hsaXN0X2xhbmUsCiAgICAgICAgICAgICAgICB3aGVuPTI1LAogICAgICAgICAgICAgICAgbmFtZT0id2F0Y2hsaXN0X2Jvb3QiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDYwfSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgICAgICAgICBydW5fd2F0Y2hsaXN0X2xhbmUsCiAgICAgICAgICAgICAgICBpbnRlcnZhbD1tYXgoMzAwLCBpbnQoV0FUQ0hMSVNUX1NDQU5fSU5URVJWQUxfU0VDT05EUykpLAogICAgICAgICAgICAgICAgZmlyc3Q9bWF4KDMwMCwgaW50KFdBVENITElTVF9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMpKSwKICAgICAgICAgICAgICAgIG5hbWU9IndhdGNobGlzdF9jeWNsZSIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMTIwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICAgICAgICAgKQogICAgICAgIGlmIE9VVENPTUVfVFJBQ0tJTkdfRU5BQkxFRDoKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKAogICAgICAgICAgICAgICAgcnVuX291dGNvbWVfZXZhbHVhdG9yLAogICAgICAgICAgICAgICAgaW50ZXJ2YWw9T1VUQ09NRV9FVkFMX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAgICAgICAgICAgICBmaXJzdD1PVVRDT01FX0VWQUxfSU5URVJWQUxfU0VDT05EUywKICAgICAgICAgICAgICAgIG5hbWU9Im91dGNvbWVfZXZhbHVhdG9yIiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAxMjAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCiAgICAgICAgaWYgU0lHTkFMX0RJR0VTVF9FTkFCTEVEOgogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgICAgICAgICBzZW5kX3NpZ25hbF9kaWdlc3QsCiAgICAgICAgICAgICAgICBpbnRlcnZhbD1TSUdOQUxfRElHRVNUX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAgICAgICAgICAgICBmaXJzdD1TSUdOQUxfRElHRVNUX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAgICAgICAgICAgICBuYW1lPSJzaWduYWxfZGlnZXN0IiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAxMjAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCiAgICAgICAgaWYgR09PRF9CVVlfQlVMTEVUSU5fRU5BQkxFRDoKICAgICAgICAgICAgYnVsbGV0aW5faW50ZXJ2YWwgPSBtYXgoOTAwLCBpbnQoR09PRF9CVVlfQlVMTEVUSU5fSU5URVJWQUxfU0VDT05EUykpCiAgICAgICAgICAgIGJ1bGxldGluX2Jvb3QgPSBtYXgoMTUsIG1pbihpbnQoR09PRF9CVVlfQlVMTEVUSU5fQk9PVF9TRUNPTkRTKSwgYnVsbGV0aW5faW50ZXJ2YWwpKQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgICAgICAgICAgc2VuZF9nb29kX2J1eV9idWxsZXRpbiwKICAgICAgICAgICAgICAgIHdoZW49YnVsbGV0aW5fYm9vdCwKICAgICAgICAgICAgICAgIG5hbWU9Imdvb2RfYnV5X2J1bGxldGluX2Jvb3QiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDEyMH0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKAogICAgICAgICAgICAgICAgc2VuZF9nb29kX2J1eV9idWxsZXRpbiwKICAgICAgICAgICAgICAgIGludGVydmFsPWJ1bGxldGluX2ludGVydmFsLAogICAgICAgICAgICAgICAgZmlyc3Q9YnVsbGV0aW5faW50ZXJ2YWwsCiAgICAgICAgICAgICAgICBuYW1lPSJnb29kX2J1eV9idWxsZXRpbiIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMzAwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICAgICAgICAgKQoKICAgICAgICBpZiBEQUlMWV9TVU1NQVJZX0VOQUJMRUQ6CiAgICAgICAgICAgIHN1bW1hcnlfaG91ciA9IG1heCgwLCBtaW4oMjMsIERBSUxZX1NVTU1BUllfSE9VUl9VVEMpKQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9kYWlseSgKICAgICAgICAgICAgICAgIHNlbmRfZGFpbHlfc3VtbWFyeSwKICAgICAgICAgICAgICAgIHRpbWU9dGltZShob3VyPXN1bW1hcnlfaG91ciwgbWludXRlPTAsIHR6aW5mbz10aW1lem9uZS51dGMpLAogICAgICAgICAgICAgICAgbmFtZT0iZGFpbHlfc3VtbWFyeSIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMTgwMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBXRUVLTFlfVFVOSU5HX0VOQUJMRUQ6CiAgICAgICAgICAgIHdlZWtseV9ob3VyID0gbWF4KDAsIG1pbigyMywgV0VFS0xZX1RVTklOR19IT1VSX1VUQykpCiAgICAgICAgICAgIHdlZWtseV9kYXkgPSBfREFZX1RPX1dFRUtEQVkuZ2V0KFdFRUtMWV9UVU5JTkdfREFZX1VUQywgNikKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fZGFpbHkoCiAgICAgICAgICAgICAgICBzZW5kX3dlZWtseV90dW5pbmdfcmVwb3J0LAogICAgICAgICAgICAgICAgdGltZT10aW1lKGhvdXI9d2Vla2x5X2hvdXIsIG1pbnV0ZT01LCB0emluZm89dGltZXpvbmUudXRjKSwKICAgICAgICAgICAgICAgIGRheXM9KHdlZWtseV9kYXksKSwKICAgICAgICAgICAgICAgIG5hbWU9IndlZWtseV90dW5pbmciLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDM2MDAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCiAgICAgICAgaWYgV0FUQ0hMSVNUX1NVTU1BUllfRU5BQkxFRCBhbmQgV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRCBhbmQgV0FUQ0hMSVNUX0VOVFJJRVM6CiAgICAgICAgICAgIHdhdGNoX3N1bW1hcnlfaG91ciA9IG1heCgwLCBtaW4oMjMsIFdBVENITElTVF9TVU1NQVJZX0hPVVJfVVRDKSkKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fZGFpbHkoCiAgICAgICAgICAgICAgICBzZW5kX3dhdGNobGlzdF9zdW1tYXJ5LAogICAgICAgICAgICAgICAgdGltZT10aW1lKGhvdXI9d2F0Y2hfc3VtbWFyeV9ob3VyLCBtaW51dGU9MTAsIHR6aW5mbz10aW1lem9uZS51dGMpLAogICAgICAgICAgICAgICAgbmFtZT0id2F0Y2hsaXN0X3N1bW1hcnkiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDE4MDAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCgogICAgICAgIHByaW50KCJFbmdpbmUgc3RhcnRlZC4uLiIpCiAgICAgICAgYXBwLnJ1bl9wb2xsaW5nKCkKICAgIGZpbmFsbHk6CiAgICAgICAgbG9jay5yZWxlYXNlKCkKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgbWFpbigpCg==',
}

def deploy(path, b64):
    data = base64.b64decode(b64)
    try:
        ast.parse(data.decode("utf-8"))
        print(f"  {path} syntax OK - {len(data)} chars")
    except SyntaxError as e:
        print(f"  SYNTAX ERROR in {path}: {e}")
        sys.exit(1)
    with open(path, "wb") as f:
        f.write(data)
    print(f"  Written: {path}")

for path, b64 in FILES.items():
    deploy(path, b64)
print("\nDeploy complete.")
