#!/usr/bin/env python3
import base64, ast, sys

FILES = {
    '/root/memecoin_engine/utils/format.py': 'ZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGh0bWwKCgpkZWYgX2VzYyh2YWx1ZSk6CiAgICByZXR1cm4gaHRtbC5lc2NhcGUoc3RyKHZhbHVlKSkKCgpkZWYgX3JlbmRlcl9wcmUocm93cyk6CiAgICBsaW5lcyA9IFtzdHIocm93IG9yICIiKSBmb3Igcm93IGluIHJvd3NdCiAgICBpZiBub3QgbGluZXM6CiAgICAgICAgcmV0dXJuICIiCiAgICBwYW5lbF93aWR0aCA9IF9QQU5FTF9XSURUSAogICAgd3JhcHBlZCA9IFtdCiAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICB3cmFwcGVkLmV4dGVuZChfd3JhcF90ZXh0KGxpbmUsIHBhbmVsX3dpZHRoKSkKICAgIHJldHVybiAiXG4iLmpvaW4oZiI8Y29kZT57X2VzYyhsaW5lKX08L2NvZGU+IiBmb3IgbGluZSBpbiB3cmFwcGVkKQoKCl9QQU5FTF9XSURUSCA9IDQyCgoKZGVmIF90cmltX3RleHQodmFsdWUsIG1heF9sZW4pOgogICAgdGV4dCA9IHN0cih2YWx1ZSBvciAiIikKICAgIGlmIG1heF9sZW4gPD0gMDoKICAgICAgICByZXR1cm4gdGV4dAogICAgcmV0dXJuIHRleHQKCgpkZWYgX3dyYXBfdGV4dCh2YWx1ZSwgbWF4X2xlbik6CiAgICB0ZXh0ID0gc3RyKHZhbHVlIG9yICIiKQogICAgaWYgbWF4X2xlbiA8PSAwIG9yIGxlbih0ZXh0KSA8PSBtYXhfbGVuOgogICAgICAgIHJldHVybiBbdGV4dF0KICAgIG91dCA9IFtdCiAgICByZW1haW5pbmcgPSB0ZXh0CiAgICB3aGlsZSBsZW4ocmVtYWluaW5nKSA+IG1heF9sZW46CiAgICAgICAgY3V0ID0gcmVtYWluaW5nLnJmaW5kKCIgIiwgMCwgbWF4X2xlbiArIDEpCiAgICAgICAgaWYgY3V0IDw9IDA6CiAgICAgICAgICAgIGN1dCA9IG1heF9sZW4KICAgICAgICBvdXQuYXBwZW5kKHJlbWFpbmluZ1s6Y3V0XS5yc3RyaXAoKSkKICAgICAgICByZW1haW5pbmcgPSByZW1haW5pbmdbY3V0Ol0ubHN0cmlwKCkKICAgIG91dC5hcHBlbmQocmVtYWluaW5nKQogICAgcmV0dXJuIG91dAoKCmRlZiBfa3YobGFiZWwsIHZhbHVlLCB3aWR0aDogaW50ID0gX1BBTkVMX1dJRFRIKToKICAgIGtleSA9IHN0cihsYWJlbCBvciAiIikudXBwZXIoKVs6OV0KICAgIGxpbmUgPSBmIntrZXk6PDl9IHwge3ZhbHVlfSIKICAgIHJldHVybiBfdHJpbV90ZXh0KGxpbmUsIHdpZHRoKQoKCmRlZiBfaGVhZGVyX2Jsb2NrKHRhZzogc3RyLCBoZWFkZXJfcm93cz1Ob25lLCB3aWR0aDogaW50ID0gX1BBTkVMX1dJRFRIKToKICAgIHJvd3MgPSBbCiAgICAgICAgZiI8Yj57X2VzYyh0YWcpfTwvYj4iLAogICAgICAgIGYiPGNvZGU+eyctJyAqIG1pbigzMCwgd2lkdGgpfTwvY29kZT4iLAogICAgXQogICAgZm9yIHJvdyBpbiAoaGVhZGVyX3Jvd3Mgb3IgW10pOgogICAgICAgIHJvd3MuYXBwZW5kKGYiPGNvZGU+e19lc2MoX3RyaW1fdGV4dChzdHIocm93IG9yICcnKSwgd2lkdGgpKX08L2NvZGU+IikKICAgIHJldHVybiAiXG4iLmpvaW4ocm93cykKCgpkZWYgX3Njb3JlX2JhcihzY29yZSk6CiAgICBzY29yZSA9IG1heCgwLCBtaW4oMTAwLCBmbG9hdChzY29yZSBvciAwKSkpCiAgICBibG9ja3MgPSBpbnQocm91bmQoc2NvcmUgLyAxMC4wKSkKICAgIHJldHVybiAoIiMiICogYmxvY2tzKSArICgiLSIgKiAoMTAgLSBibG9ja3MpKQoKCmRlZiBfZm10X3BjdCh2YWx1ZSk6CiAgICBpZiB2YWx1ZSBpcyBOb25lOgogICAgICAgIHJldHVybiAiTi9BIgogICAgdHJ5OgogICAgICAgIG51bWJlciA9IGZsb2F0KHZhbHVlKQogICAgICAgIHNpZ24gPSAiKyIgaWYgbnVtYmVyID4gMCBlbHNlICIiCiAgICAgICAgcmV0dXJuIGYie3NpZ259e251bWJlcjouMmZ9JSIKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKCgpkZWYgX2ZtdF9udW0odmFsdWUsIGRpZ2l0cz0wKToKICAgIHRyeToKICAgICAgICByZXR1cm4gZiJ7ZmxvYXQodmFsdWUpOiwue2RpZ2l0c31mfSIKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKCgpkZWYgX2ZtdF91c2RfY29tcGFjdCh2YWx1ZSk6CiAgICB0cnk6CiAgICAgICAgbiA9IGZsb2F0KHZhbHVlKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiAiTi9BIgogICAgYWJzX24gPSBhYnMobikKICAgIGlmIGFic19uID49IDFfMDAwXzAwMF8wMDA6CiAgICAgICAgcmV0dXJuIGYiJHtuLzFfMDAwXzAwMF8wMDA6LjJmfUIiCiAgICBpZiBhYnNfbiA+PSAxXzAwMF8wMDA6CiAgICAgICAgcmV0dXJuIGYiJHtuLzFfMDAwXzAwMDouMmZ9TSIKICAgIGlmIGFic19uID49IDFfMDAwOgogICAgICAgIHJldHVybiBmIiR7bi8xXzAwMDouMWZ9SyIKICAgIHJldHVybiBmIiR7bjouMGZ9IgoKCmRlZiBfZm10X3ByaWNlX3ByZWNpc2UodmFsdWUpOgogICAgdHJ5OgogICAgICAgIHAgPSBmbG9hdCh2YWx1ZSkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKICAgIGlmIHAgPD0gMDoKICAgICAgICByZXR1cm4gIk4vQSIKICAgIGlmIHAgPCAwLjAxOgogICAgICAgIHJldHVybiBmIiR7cDouOGZ9Ii5yc3RyaXAoIjAiKS5yc3RyaXAoIi4iKQogICAgaWYgcCA8IDE6CiAgICAgICAgcmV0dXJuIGYiJHtwOi42Zn0iLnJzdHJpcCgiMCIpLnJzdHJpcCgiLiIpCiAgICBpZiBwIDwgMTAwMDoKICAgICAgICByZXR1cm4gZiIke3A6LjRmfSIucnN0cmlwKCIwIikucnN0cmlwKCIuIikKICAgIHJldHVybiBfZm10X3VzZF9jb21wYWN0KHApCgoKZGVmIF9mbXRfaG9sZGVycyh2YWx1ZSk6CiAgICBpZiB2YWx1ZSBpbiAoTm9uZSwgIiIsICJOL0EiKToKICAgICAgICByZXR1cm4gIk4vQSIKICAgIHRyeToKICAgICAgICByZXR1cm4gZiJ7aW50KGZsb2F0KHZhbHVlKSk6LH0iCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuICJOL0EiCgoKZGVmIF9jb25maWRlbmNlX2xhYmVsKGNvbmZpZGVuY2UpOgogICAgY29uZiA9IHN0cihjb25maWRlbmNlIG9yICJDIikudXBwZXIoKQogICAgaWYgY29uZiA9PSAiQSI6CiAgICAgICAgcmV0dXJuICJBIgogICAgaWYgY29uZiA9PSAiQiI6CiAgICAgICAgcmV0dXJuICJCIgogICAgcmV0dXJuICJDIgoKCmRlZiBfY29tcGFjdF9lbnRyeShlbnRyeV90eXBlKToKICAgIHRleHQgPSBzdHIoZW50cnlfdHlwZSBvciAiIikuc3RyaXAoKS5sb3dlcigpCiAgICBpZiB0ZXh0ID09ICJtb21lbnR1bSBjb250aW51YXRpb24iOgogICAgICAgIHJldHVybiAiTW9tZW50dW0gY29udGludWF0aW9uIgogICAgaWYgdGV4dCA9PSAiZGlwIHJlY292ZXJ5IHNldHVwIjoKICAgICAgICByZXR1cm4gIkRpcCByZWNvdmVyeSIKICAgIHJldHVybiBzdHIoZW50cnlfdHlwZSBvciAiTi9BIikKCgpkZWYgX3JzaV9tZWFuaW5nKHJzaV92YWx1ZSk6CiAgICBpZiByc2lfdmFsdWUgaXMgTm9uZToKICAgICAgICByZXR1cm4gTm9uZQogICAgdHJ5OgogICAgICAgIHIgPSBmbG9hdChyc2lfdmFsdWUpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIHIgPCAzNToKICAgICAgICByZXR1cm4gIlJTSSBvdmVyc29sZCIKICAgIGlmIHIgPCA1MDoKICAgICAgICByZXR1cm4gIlJTSSB3ZWFrIgogICAgaWYgciA8IDY1OgogICAgICAgIHJldHVybiAiUlNJIGhlYWx0aHkiCiAgICBpZiByIDwgNzU6CiAgICAgICAgcmV0dXJuICJSU0kgc3Ryb25nIgogICAgcmV0dXJuICJSU0kgb3ZlcmJvdWdodCIKCgpkZWYgX21hY2RfbWVhbmluZyhtYWNkX2hpc3RfdmFsdWUpOgogICAgaWYgbWFjZF9oaXN0X3ZhbHVlIGlzIE5vbmU6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHRyeToKICAgICAgICBoID0gZmxvYXQobWFjZF9oaXN0X3ZhbHVlKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiBOb25lCiAgICBpZiBoID4gMC4wMToKICAgICAgICByZXR1cm4gIk1BQ0QgYnVsbGlzaCBzdHJvbmciCiAgICBpZiBoID4gMDoKICAgICAgICByZXR1cm4gIk1BQ0QgYnVsbGlzaCIKICAgIGlmIGggPiAtMC4wMToKICAgICAgICByZXR1cm4gIk1BQ0QgbmV1dHJhbCIKICAgIHJldHVybiAiTUFDRCBiZWFyaXNoIgoKCmRlZiBfcHJpb3JpdHlfZnJvbV9zY29yZShzY29yZSk6CiAgICB0cnk6CiAgICAgICAgcyA9IGZsb2F0KHNjb3JlIG9yIDApCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuICJQMyIKICAgIGlmIHMgPj0gOTA6CiAgICAgICAgcmV0dXJuICJQMSIKICAgIGlmIHMgPj0gODA6CiAgICAgICAgcmV0dXJuICJQMiIKICAgIHJldHVybiAiUDMiCgoKZGVmIF9kYXRhX2FnZV90ZXh0KGxhc3RfdHJhZGVfdW5peCk6CiAgICB0cnk6CiAgICAgICAgdHMgPSBpbnQoZmxvYXQobGFzdF90cmFkZV91bml4KSkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKICAgIGlmIHRzIDw9IDA6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICBub3dfdHMgPSBpbnQoZGF0ZXRpbWUudXRjbm93KCkudGltZXN0YW1wKCkpCiAgICBhZ2Vfc2VjID0gbWF4KDAsIG5vd190cyAtIHRzKQogICAgaWYgYWdlX3NlYyA8IDYwOgogICAgICAgIHJldHVybiBmInthZ2Vfc2VjfXMiCiAgICBpZiBhZ2Vfc2VjIDwgMzYwMDoKICAgICAgICByZXR1cm4gZiJ7YWdlX3NlYyAvLyA2MH1tIgogICAgcmV0dXJuIGYie2FnZV9zZWMgLy8gMzYwMH1oIgoKCmRlZiBfaW52YWxpZGF0aW9uX2Zyb21fcmlza19wbGFuKHJpc2tfcGxhbik6CiAgICByYXcgPSBzdHIocmlza19wbGFuIG9yICIiKS5zdHJpcCgpCiAgICBpZiBub3QgcmF3OgogICAgICAgIHJldHVybiAiVGhlc2lzIGJyZWFrIgogICAgcmV0dXJuIHJhdy5zcGxpdCgifCIsIDEpWzBdLnN0cmlwKCkKCgpkZWYgZm9ybWF0X3NpZ25hbCh0b2tlbl9kYXRhLCBjb21wYWN0OiBib29sID0gVHJ1ZSk6CiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgc3ltYm9sID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpKS51cHBlcigpCiAgICBzY29yZSA9IGZsb2F0KHRva2VuX2RhdGEuZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICBob2xkZXJzID0gX2ZtdF9ob2xkZXJzKHRva2VuX2RhdGEuZ2V0KCJob2xkZXJzIiwgIk4vQSIpKQogICAgdHJlbmQgPSB0b2tlbl9kYXRhLmdldCgidHJlbmQiLCAiVW5rbm93biIpCiAgICBlbnRyeV90eXBlID0gX2NvbXBhY3RfZW50cnkodG9rZW5fZGF0YS5nZXQoImVudHJ5X3R5cGUiLCAiTi9BIikpCiAgICBjb25maWRlbmNlID0gdG9rZW5fZGF0YS5nZXQoImNvbmZpZGVuY2UiLCAiQyIpCiAgICByZWdpbWVfbGFiZWwgPSBzdHIodG9rZW5fZGF0YS5nZXQoInJlZ2ltZV9sYWJlbCIsICJVTktOT1dOIikpCiAgICBwcm9maWxlID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJwcm9maWxlIiwgIlNUUkFURUdJQyIpKS51cHBlcigpCiAgICBjaGFuZ2VfMjRoID0gdG9rZW5fZGF0YS5nZXQoImNoYW5nZV8yNGgiKQogICAgcnNpID0gdG9rZW5fZGF0YS5nZXQoInJzaSIpCiAgICBtYWNkX2hpc3QgPSB0b2tlbl9kYXRhLmdldCgibWFjZF9oaXN0IikKICAgIG1hcmtldF9jYXAgPSB0b2tlbl9kYXRhLmdldCgibWFya2V0X2NhcCIpCiAgICBmZHYgPSB0b2tlbl9kYXRhLmdldCgiZmR2IikKICAgIHdhbGxldF9maXQgPSBzdHIodG9rZW5fZGF0YS5nZXQoIndhbGxldF9maXQiKSBvciAiVzIiKQogICAgcmlza19wbGFuID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJyaXNrX3BsYW4iKSBvciAiU0wgLTEwJSB8IFRQICsxMi8rMjUgfCBUcmFpbCAxMCUiKQogICAgcm90YXRpb25fcGxhbiA9IHN0cih0b2tlbl9kYXRhLmdldCgicm90YXRpb25fcGxhbiIpIG9yICJSb3RhdGUgcHJvZml0cyB0byBXMS9VU0RDIHBlciBwbGFuIikKICAgIGxhc3RfdHJhZGVfdW5peCA9IHRva2VuX2RhdGEuZ2V0KCJsYXN0X3RyYWRlX3VuaXgiKQoKICAgIHNjb3JlX2xpbmUgPSBmIntzY29yZTouMWZ9LzEwMCB7X3Njb3JlX2JhcihzY29yZSl9IgogICAgY29uZmlkZW5jZV9saW5lID0gX2NvbmZpZGVuY2VfbGFiZWwoY29uZmlkZW5jZSkKICAgIGNoYW5nZV9saW5lID0gX2ZtdF9wY3QoY2hhbmdlXzI0aCkKICAgIHByaW9yaXR5ID0gX3ByaW9yaXR5X2Zyb21fc2NvcmUoc2NvcmUpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIGFjdGlvbiA9ICJFTlRFUiBOT1ciIGlmIHNjb3JlID49IDc1IGVsc2UgIldBVENIIgogICAgYWN0aW9uX2Vtb2ppID0gIvCfn6IiIGlmIHNjb3JlID49IDc1IGVsc2UgIvCfn6EiCiAgICByZWdpbWVfZW1vamkgPSAi8J+foiIgaWYgIk9OIiBpbiByZWdpbWVfbGFiZWwgZWxzZSAoIvCflLQiIGlmICJPRkYiIGluIHJlZ2ltZV9sYWJlbCBlbHNlICLwn5+hIikKICAgIGludmFsaWRhdGlvbiA9IF9pbnZhbGlkYXRpb25fZnJvbV9yaXNrX3BsYW4ocmlza19wbGFuKQoKICAgICMgRW50cnkgcHJpY2UgYW5kIHRhcmdldHMKICAgIHByaWNlID0gZmxvYXQodG9rZW5fZGF0YS5nZXQoInByaWNlIikgb3IgMCkKICAgIGVudHJ5X2Rpc3BsYXkgPSBfZm10X3ByaWNlX3ByZWNpc2UocHJpY2UpIGlmIHByaWNlID4gMCBlbHNlICJOL0EiCiAgICBpZiBwcmljZSA+IDA6CiAgICAgICAgdGFyZ2V0MSA9IF9mbXRfcHJpY2VfcHJlY2lzZShwcmljZSAqIDEuMTIpCiAgICAgICAgdGFyZ2V0MiA9IF9mbXRfcHJpY2VfcHJlY2lzZShwcmljZSAqIDEuMjUpCiAgICAgICAgc3RvcCA9IF9mbXRfcHJpY2VfcHJlY2lzZShwcmljZSAqIDAuOTApCiAgICBlbHNlOgogICAgICAgIHRhcmdldDEgPSB0YXJnZXQyID0gc3RvcCA9ICJOL0EiCgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5OLIFtTSUdOQUxdOiBNRU1FQ09JTiBTRVRVUDwvYj4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfjq8gQ09JTjogJHtfZXNjKHN5bWJvbCl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OKIFBST0ZJTEU6IHtfZXNjKHByb2ZpbGUpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+4q2QIFNDT1JFOiB7X2VzYyhzY29yZV9saW5lKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkrAgTUFSS0VUQ0FQOiB7X2VzYyhfZm10X3VzZF9jb21wYWN0KGNhcF92YWx1ZSkpfSB8IDI0SCB7X2VzYyhjaGFuZ2VfbGluZSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KnIExJUVVJRElUWToge19lc2MoX2ZtdF91c2RfY29tcGFjdChsaXF1aWRpdHkpKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntyZWdpbWVfZW1vaml9IFJFR0lNRToge19lc2MocmVnaW1lX2xhYmVsKX0gfCBHUkFERSB7X2VzYyhjb25maWRlbmNlX2xpbmUpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPnthY3Rpb25fZW1vaml9IFNJR05BTDoge19lc2MoYWN0aW9uKX08L2NvZGU+IiwKICAgIF0KCiAgICBpZiBub3QgY29tcGFjdDoKICAgICAgICB0ZWNoX3BhcnRzID0gW3ggZm9yIHggaW4gW19yc2lfbWVhbmluZyhyc2kpLCBfbWFjZF9tZWFuaW5nKG1hY2RfaGlzdCldIGlmIHhdCiAgICAgICAgaWYgdGVjaF9wYXJ0czoKICAgICAgICAgICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+8J+TiCBNT01FTlRVTToge19lc2MoJyB8ICcuam9pbih0ZWNoX3BhcnRzKSl9PC9jb2RlPiIpCiAgICAgICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+8J+RmyBXQUxMRVQgRklUOiB7X2VzYyh3YWxsZXRfZml0KX08L2NvZGU+IikKICAgICAgICBpZiBob2xkZXJzICE9ICJOL0EiOgogICAgICAgICAgICBsaW5lcy5hcHBlbmQoZiI8Y29kZT7wn5GlIEhPTERFUlM6IHtfZXNjKGhvbGRlcnMpfTwvY29kZT4iKQogICAgICAgIGxpbmVzLmFwcGVuZChmIjxjb2RlPvCfmqsgSU5WQUxJRDoge19lc2MoaW52YWxpZGF0aW9uKX08L2NvZGU+IikKCiAgICBsaW5lcyArPSBbCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TjSBFbnRyeToge19lc2MoZW50cnlfZGlzcGxheSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIFRhcmdldCAxOiB7X2VzYyh0YXJnZXQxKX0gKCsxMiUpPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIFRhcmdldCAyOiB7X2VzYyh0YXJnZXQyKX0gKCsyNSUpPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5uRIFN0b3A6IHtfZXNjKHN0b3ApfSAoLTEwJSk8L2NvZGU+IiwKICAgIF0KCiAgICBpZiBub3QgY29tcGFjdDoKICAgICAgICBsaW5lcyArPSBbCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OLIFJJU0s6IHtfZXNjKHJpc2tfcGxhbil9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+UhCBST1RBVElPTjoge19lc2Mocm90YXRpb25fcGxhbil9PC9jb2RlPiIsCiAgICAgICAgXQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIGZvcm1hdF9ydW5uZXJfd2F0Y2godG9rZW5fZGF0YSwgY29tcGFjdDogYm9vbCA9IFRydWUpOgogICAgc2VwID0gIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIKICAgIHN5bWJvbCA9IHN0cih0b2tlbl9kYXRhLmdldCgic3ltYm9sIikgb3IgIlVOS05PV04iKS51cHBlcigpCiAgICBuYW1lID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJuYW1lIikgb3Igc3ltYm9sKQogICAgYWdlX2hvdXJzID0gdG9rZW5fZGF0YS5nZXQoImFnZV9ob3VycyIpCiAgICBtYXJrZXRfY2FwID0gdG9rZW5fZGF0YS5nZXQoIm1hcmtldF9jYXAiKQogICAgZmR2ID0gdG9rZW5fZGF0YS5nZXQoImZkdiIpCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgibGlxdWlkaXR5Iikgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgidm9sdW1lXzI0aCIpIG9yIDApCiAgICBjaGFuZ2VfMjRoID0gdG9rZW5fZGF0YS5nZXQoImNoYW5nZV8yNGgiKQogICAgdHhuc19oMSA9IHRva2VuX2RhdGEuZ2V0KCJ0eG5zX2gxIikKICAgIHdhdGNoX3Njb3JlID0gdG9rZW5fZGF0YS5nZXQoIndhdGNoX3Njb3JlIikKICAgIHhfcHJveHkgPSBzdHIodG9rZW5fZGF0YS5nZXQoInhfcHJveHlfbGFiZWwiKSBvciAiTi9BIikKICAgIG5hcnJhdGl2ZSA9IHN0cih0b2tlbl9kYXRhLmdldCgibmFycmF0aXZlX2xhYmVsIikgb3IgIk4vQSIpCiAgICBub3RlID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJub3RlIikgb3IgIiIpCiAgICB3YWxsZXRfZml0ID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJ3YWxsZXRfZml0Iikgb3IgIlczIikKICAgIHJpc2tfcGxhbiA9IHN0cih0b2tlbl9kYXRhLmdldCgicmlza19wbGFuIikgb3IgIlNtYWxsIHNpemUgb25seSB8IGhhcmQgc3RvcCB8IHF1aWNrIHNjYWxlLW91dHMiKQogICAgcm90YXRpb25fcGxhbiA9IHN0cih0b2tlbl9kYXRhLmdldCgicm90YXRpb25fcGxhbiIpIG9yICJSb3RhdGUgd2lucyBpbnRvIFcxL1cyIG9yIFVTREMiKQogICAgY2FwX3ZhbHVlID0gbWFya2V0X2NhcCBpZiBpc2luc3RhbmNlKG1hcmtldF9jYXAsIChpbnQsIGZsb2F0KSkgYW5kIG1hcmtldF9jYXAgPiAwIGVsc2UgZmR2CiAgICBhZ2VfdGV4dCA9IGYie2Zsb2F0KGFnZV9ob3Vycyk6LjFmfWgiIGlmIGlzaW5zdGFuY2UoYWdlX2hvdXJzLCAoaW50LCBmbG9hdCkpIGVsc2UgIk4vQSIKICAgIHNjb3JlX3RleHQgPSBmIntmbG9hdCh3YXRjaF9zY29yZSk6LjFmfS8xMDAiIGlmIGlzaW5zdGFuY2Uod2F0Y2hfc2NvcmUsIChpbnQsIGZsb2F0KSkgZWxzZSAiTi9BIgogICAgY2hhbmdlX2xpbmUgPSBfZm10X3BjdChjaGFuZ2VfMjRoKQogICAgcHJpY2UgPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgicHJpY2UiKSBvciAwKQogICAgZW50cnlfZGlzcGxheSA9IF9mbXRfcHJpY2VfcHJlY2lzZShwcmljZSkgaWYgcHJpY2UgPiAwIGVsc2UgIk4vQSIKICAgIHR4bnNfdGV4dCA9IHN0cihpbnQodHhuc19oMSkpIGlmIGlzaW5zdGFuY2UodHhuc19oMSwgKGludCwgZmxvYXQpKSBlbHNlICJOL0EiCgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5qAIFtTSUdOQUxdOiBSVU5ORVIgV0FUQ0g8L2I+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIENPSU46ICR7X2VzYyhzeW1ib2wpfSAoe19lc2MobmFtZSl9KTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+4q2QIFNDT1JFOiB7X2VzYyhzY29yZV90ZXh0KX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflZAgQUdFOiB7X2VzYyhhZ2VfdGV4dCl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KwIE1BUktFVENBUDoge19lc2MoX2ZtdF91c2RfY29tcGFjdChjYXBfdmFsdWUpKX0gfCAyNEgge19lc2MoY2hhbmdlX2xpbmUpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SpyBMSVFVSURJVFk6IHtfZXNjKF9mbXRfdXNkX2NvbXBhY3QobGlxdWlkaXR5KSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OKIFZPTFVNRSAyNEg6IHtfZXNjKF9mbXRfdXNkX2NvbXBhY3Qodm9sdW1lXzI0aCkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfn6EgU0lHTkFMOiBNT05JVE9SPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5ONIEVOVFJZOiB7X2VzYyhlbnRyeV9kaXNwbGF5KX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk50gUkVBU09OOiBGcmVzaCBsaXN0aW5nIHdpdGggYWN0aXZlIGZsb3c8L2NvZGU+IiwKICAgIF0KCiAgICBpZiBub3QgY29tcGFjdDoKICAgICAgICBsaW5lcyArPSBbCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5SlIFRYTlMgMUg6IHtfZXNjKHR4bnNfdGV4dCl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+ToyBYIFBST1hZOiB7X2VzYyh4X3Byb3h5KX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn4+377iPIE5BUlJBVElWRToge19lc2MobmFycmF0aXZlKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5GbIFdBTExFVCBGSVQ6IHtfZXNjKHdhbGxldF9maXQpfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfmqsgSU5WQUxJRDogRmxvdyBjb2xsYXBzZSAvIGxpcXVpZGl0eSBmYWRlPC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OLIFJJU0sgUExBTjoge19lc2Mocmlza19wbGFuKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5SEIFJPVEFUSU9OOiB7X2VzYyhyb3RhdGlvbl9wbGFuKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7ihLnvuI8gTk9URToge19lc2Mobm90ZSBvciAnV2F0Y2hsaXN0LW9ubHkgYWxlcnQuIE5vdCBhIGJ1eSBzaWduYWwuJyl9PC9jb2RlPiIsCiAgICAgICAgXQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIF93YXRjaGxpc3Rfc3RhdHVzX2xhYmVsKHN0YXR1cyk6CiAgICByYXcgPSBzdHIoc3RhdHVzIG9yICIiKS5zdHJpcCgpCiAgICBpZiBub3QgcmF3OgogICAgICAgIHJldHVybiAiVW5rbm93biIKICAgIHVwcGVyID0gcmF3LnVwcGVyKCkKICAgIGlmIHVwcGVyID09ICJOT0RBVEEiOgogICAgICAgIHJldHVybiAiTm9EYXRhIgogICAgcmV0dXJuIHJhdy50aXRsZSgpCgoKZGVmIF93YXRjaGxpc3Rfc3RhdHVzX2NvZGUoc3RhdHVzKToKICAgIHN0YXR1c19ub3JtID0gX3dhdGNobGlzdF9zdGF0dXNfbGFiZWwoc3RhdHVzKQogICAgbWFwcGluZyA9IHsKICAgICAgICAiTW9tZW50dW0iOiAiTU9NIiwKICAgICAgICAiUmVjbGFpbSI6ICJSRUMiLAogICAgICAgICJCcmVha2Rvd24iOiAiQlJLIiwKICAgICAgICAiUmFuZ2UiOiAiUk5HIiwKICAgICAgICAiVm9sYXRpbGUiOiAiVk9MIiwKICAgICAgICAiSWxsaXF1aWQiOiAiSUxMIiwKICAgICAgICAiTm9EYXRhIjogIk5PRCIsCiAgICAgICAgIlVua25vd24iOiAiVU5LIiwKICAgIH0KICAgIHJldHVybiBtYXBwaW5nLmdldChzdGF0dXNfbm9ybSwgIlVOSyIpLCBzdGF0dXNfbm9ybQoKCmRlZiBmb3JtYXRfd2F0Y2hsaXN0X3NpZ25hbCh0b2tlbl9kYXRhLCBjb21wYWN0OiBib29sID0gVHJ1ZSk6CiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgc3ltYm9sID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIpLnVwcGVyKCkKICAgIHN0YXR1c19jb2RlLCBzdGF0dXNfbGFiZWwgPSBfd2F0Y2hsaXN0X3N0YXR1c19jb2RlKHRva2VuX2RhdGEuZ2V0KCJzdGF0dXMiKSkKICAgIHJlYXNvbiA9IHN0cih0b2tlbl9kYXRhLmdldCgicmVhc29uIikgb3IgIlN0YXR1cyBjb25kaXRpb24gdHJpZ2dlcmVkLiIpCiAgICBtYXJrZXRfY2FwID0gdG9rZW5fZGF0YS5nZXQoIm1hcmtldF9jYXAiKQogICAgZmR2ID0gdG9rZW5fZGF0YS5nZXQoImZkdiIpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIHVwc2lkZSA9IHN0cih0b2tlbl9kYXRhLmdldCgidXBzaWRlX3BvdGVudGlhbCIpIG9yICJNZWRpdW0iKS50aXRsZSgpCiAgICBmYWlsdXJlID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJmYWlsdXJlX3Jpc2siKSBvciAiTWVkaXVtIikudGl0bGUoKQogICAgd2FsbGV0X2ZpdCA9IHN0cih0b2tlbl9kYXRhLmdldCgid2FsbGV0X2ZpdCIpIG9yICJXMyIpCiAgICByaXNrX3BsYW4gPSBzdHIodG9rZW5fZGF0YS5nZXQoInJpc2tfcGxhbiIpIG9yICJTbWFsbCBzaXplIG9ubHkgfCBoYXJkIHN0b3AgfCBxdWljayBzY2FsZS1vdXRzIikKICAgIHJvdGF0aW9uX3BsYW4gPSBzdHIodG9rZW5fZGF0YS5nZXQoInJvdGF0aW9uX3BsYW4iKSBvciAiUm90YXRlIHdpbnMgaW50byBXMS9XMiBvciBVU0RDIikKICAgIGNoYW5nZV8yNGggPSB0b2tlbl9kYXRhLmdldCgiY2hhbmdlXzI0aCIpCiAgICBjaGFuZ2VfbGluZSA9IF9mbXRfcGN0KGNoYW5nZV8yNGgpCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbl9kYXRhLmdldCgibGlxdWlkaXR5Iikgb3IgMCkKICAgIHByaWNlID0gZmxvYXQodG9rZW5fZGF0YS5nZXQoInByaWNlIikgb3IgMCkKICAgIGVudHJ5X2Rpc3BsYXkgPSBfZm10X3ByaWNlX3ByZWNpc2UocHJpY2UpIGlmIHByaWNlID4gMCBlbHNlICJOL0EiCgogICAgaWYgc3RhdHVzX2xhYmVsID09ICJCcmVha2Rvd24iOgogICAgICAgIGFjdGlvbiA9ICJBVk9JRCAvIEVYSVQiCiAgICAgICAgYWN0aW9uX2Vtb2ppID0gIvCflLQiCiAgICBlbGlmIHN0YXR1c19sYWJlbCBpbiB7Ik1vbWVudHVtIiwgIlJlY2xhaW0ifToKICAgICAgICBhY3Rpb24gPSAiV0FUQ0ggRk9SIEVOVFJZIgogICAgICAgIGFjdGlvbl9lbW9qaSA9ICLwn5+hIgogICAgZWxzZToKICAgICAgICBhY3Rpb24gPSAiTU9OSVRPUiIKICAgICAgICBhY3Rpb25fZW1vamkgPSAi4pqqIgoKICAgIGxpbmVzID0gWwogICAgICAgIGYiPGI+8J+RgSBbU0lHTkFMXTogV0FUQ0hMSVNUPC9iPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+OryBDT0lOOiAke19lc2Moc3ltYm9sKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk4ogU1RBVFVTOiB7X2VzYyhzdGF0dXNfbGFiZWwpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SsCBNQVJLRVRDQVA6IHtfZXNjKF9mbXRfdXNkX2NvbXBhY3QoY2FwX3ZhbHVlKSl9IHwgMjRIIHtfZXNjKGNoYW5nZV9saW5lKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkqcgTElRVUlESVRZOiB7X2VzYyhfZm10X3VzZF9jb21wYWN0KGxpcXVpZGl0eSkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPnthY3Rpb25fZW1vaml9IFNJR05BTDoge19lc2MoYWN0aW9uKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk40gRU5UUlk6IHtfZXNjKGVudHJ5X2Rpc3BsYXkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TnSBSRUFTT046IHtfZXNjKHJlYXNvbil9PC9jb2RlPiIsCiAgICBdCgogICAgaWYgbm90IGNvbXBhY3Q6CiAgICAgICAgbGluZXMgKz0gWwogICAgICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+TiCBVUFNJREU6IHtfZXNjKHVwc2lkZSl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+4pqg77iPIFJJU0s6IHtfZXNjKGZhaWx1cmUpfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfkZsgV0FMTEVUIEZJVDoge19lc2Mod2FsbGV0X2ZpdCl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+aqyBJTlZBTElEOiBCcmVha2Rvd24gLyBsaXF1aWRpdHkgY3JhY2s8L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfk4sgUklTSyBQTEFOOiB7X2VzYyhyaXNrX3BsYW4pfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCflIQgUk9UQVRJT046IHtfZXNjKHJvdGF0aW9uX3BsYW4pfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPuKEue+4jyBOT1RFOiBXYXRjaGxpc3Qtb25seSBhbGVydCAobm90IGFuIGF1dG8tYnV5IHNpZ25hbCkuPC9jb2RlPiIsCiAgICAgICAgXQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIGZvcm1hdF9sZWdhY3lfcmVjb3ZlcnkodG9rZW5fZGF0YSk6CiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgc3ltYm9sID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpKS51cHBlcigpCiAgICBwcmljZSA9IGZsb2F0KHRva2VuX2RhdGEuZ2V0KCJwcmljZSIsIDApIG9yIDApCiAgICBjaGFuZ2VfMjRoID0gdG9rZW5fZGF0YS5nZXQoImNoYW5nZV8yNGgiKQogICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW5fZGF0YS5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICBtYXJrZXRfY2FwID0gdG9rZW5fZGF0YS5nZXQoIm1hcmtldF9jYXAiKQogICAgZmR2ID0gdG9rZW5fZGF0YS5nZXQoImZkdiIpCiAgICBwYXR0ZXJuX2xhYmVsID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJwYXR0ZXJuX2xhYmVsIikgb3IgIlJldmVyc2FsIikKICAgIHBhdHRlcm5fc3RhdHVzID0gc3RyKHRva2VuX2RhdGEuZ2V0KCJwYXR0ZXJuX3N0YXR1cyIpIG9yICJGb3JtaW5nIikKICAgIHNvbF9zdGF0dXMgPSBzdHIodG9rZW5fZGF0YS5nZXQoInNvbF9zdGF0dXMiKSBvciAiTkVVVFJBTCIpCiAgICBhZ2VfZGF5cyA9IHRva2VuX2RhdGEuZ2V0KCJhZ2VfZGF5cyIpCgogICAgIyBNYXJrZXRjYXAgZGlzcGxheSAocHJlZmVyIG1hcmtldF9jYXAsIGZhbGwgYmFjayB0byBmZHYpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIGNhcF9kaXNwbGF5ID0gX2ZtdF91c2RfY29tcGFjdChjYXBfdmFsdWUpIGlmIGNhcF92YWx1ZSBlbHNlICJOL0EiCgogICAgIyBGb3JtYXQgZW50cnkgcHJpY2UgZm9yIHRhcmdldHMvc3RvcHMKICAgIGlmIHByaWNlID49IDEuMDoKICAgICAgICBkaXNwbGF5X3ByaWNlID0gZiIke3ByaWNlOi40Zn0iCiAgICBlbGlmIHByaWNlID49IDAuMDE6CiAgICAgICAgZGlzcGxheV9wcmljZSA9IGYiJHtwcmljZTouNmZ9IgogICAgZWxpZiBwcmljZSA+IDA6CiAgICAgICAgZGlzcGxheV9wcmljZSA9IGYiJHtwcmljZTouOGZ9IgogICAgZWxzZToKICAgICAgICBkaXNwbGF5X3ByaWNlID0gIk4vQSIKCiAgICBjaGFuZ2VfbGluZSA9IF9mbXRfcGN0KGNoYW5nZV8yNGgpCiAgICBpZiBwcmljZSA+PSAwLjAxOgogICAgICAgIHRhcmdldDEgPSBmIiR7cHJpY2UgKiAxLjU6LjZmfSIgaWYgcHJpY2UgPiAwIGVsc2UgIk4vQSIKICAgICAgICB0YXJnZXQyID0gZiIke3ByaWNlICogMi4wOi42Zn0iIGlmIHByaWNlID4gMCBlbHNlICJOL0EiCiAgICAgICAgc3RvcCA9IGYiJHtwcmljZSAqIDAuNTouNmZ9IiBpZiBwcmljZSA+IDAgZWxzZSAiTi9BIgogICAgZWxzZToKICAgICAgICB0YXJnZXQxID0gZiIke3ByaWNlICogMS41Oi44Zn0iLnJzdHJpcCgiMCIpLnJzdHJpcCgiLiIpIGlmIHByaWNlID4gMCBlbHNlICJOL0EiCiAgICAgICAgdGFyZ2V0MiA9IGYiJHtwcmljZSAqIDIuMDouOGZ9Ii5yc3RyaXAoIjAiKS5yc3RyaXAoIi4iKSBpZiBwcmljZSA+IDAgZWxzZSAiTi9BIgogICAgICAgIHN0b3AgPSBmIiR7cHJpY2UgKiAwLjU6LjhmfSIucnN0cmlwKCIwIikucnN0cmlwKCIuIikgaWYgcHJpY2UgPiAwIGVsc2UgIk4vQSIKCiAgICBhZ2VfdGV4dCA9IGYie2ludChhZ2VfZGF5cyl9ZCIgaWYgaXNpbnN0YW5jZShhZ2VfZGF5cywgKGludCwgZmxvYXQpKSBhbmQgYWdlX2RheXMgPiAwIGVsc2UgIj45MGQiCiAgICBzb2xfZW1vamkgPSAi8J+foiIgaWYgc29sX3N0YXR1cyA9PSAiUklTS19PTiIgZWxzZSAoIvCflLQiIGlmICJPRkYiIGluIHNvbF9zdGF0dXMgZWxzZSAi8J+foSIpCgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5OLIFtTSUdOQUxdOiBMRUdBQ1kgUkVDT1ZFUlk8L2I+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIENPSU46ICR7X2VzYyhzeW1ib2wpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SsCBNQVJLRVRDQVA6IHtfZXNjKGNhcF9kaXNwbGF5KX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk4ggMjRIIENIRzoge19lc2MoY2hhbmdlX2xpbmUpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SpyBMSVFVSURJVFk6IHtfZXNjKF9mbXRfdXNkX2NvbXBhY3QobGlxdWlkaXR5KSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5SlIFBBVFRFUk46IHtfZXNjKHBhdHRlcm5fbGFiZWwpfSAoe19lc2MocGF0dGVybl9zdGF0dXMpfSk8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflZAgQUdFOiB7X2VzYyhhZ2VfdGV4dCl9IChlc3RhYmxpc2hlZCBjb2luKTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKchSBCVVkgU0lHTkFMIChMRUdBQ1kgUkVDT1ZFUlkpPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KhIEVzdGFibGlzaGVkIGNvaW4gd2l0aCBmcmVzaCByZXZlcnNhbCBwYXR0ZXJuICsgdm9sdW1lIHNwaWtlPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OKIENvbW11bml0eSBzdGlsbCBhY3RpdmUsID45MCBkYXlzIHByb3ZlbiBuYXJyYXRpdmU8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzb2xfZW1vaml9IFNPTCBTdGF0dXM6IHtfZXNjKHNvbF9zdGF0dXMpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk40gRW50cnk6IHtfZXNjKGRpc3BsYXlfcHJpY2UpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+OryBUYXJnZXQgMToge19lc2ModGFyZ2V0MSl9ICgrNTAlKTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+OryBUYXJnZXQgMjoge19lc2ModGFyZ2V0Mil9ICgrMTAwJSk8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfm5EgU3RvcDoge19lc2Moc3RvcCl9ICgtNTAlKTwvY29kZT4iLAogICAgXQogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCgpkZWYgZm9ybWF0X3dhdGNobGlzdF9zdW1tYXJ5KHJvd3MpOgogICAgc2VwID0gIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIKICAgIGlmIG5vdCByb3dzOgogICAgICAgIHJldHVybiAiXG4iLmpvaW4oWwogICAgICAgICAgICBmIjxiPvCfkYEgW1NJR05BTF06IFdBVENITElTVCBTVU1NQVJZPC9iPiIsCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT5ObyB3YXRjaGxpc3QgdG9rZW5zIGNvbmZpZ3VyZWQuPC9jb2RlPiIsCiAgICAgICAgXSkKCiAgICBvcmRlciA9IHsiTW9tZW50dW0iOiAwLCAiUmVjbGFpbSI6IDEsICJCcmVha2Rvd24iOiAyLCAiUmFuZ2UiOiAzLCAiVm9sYXRpbGUiOiA0LCAiSWxsaXF1aWQiOiA1LCAiTm9EYXRhIjogNn0KICAgIHNvcnRlZF9yb3dzID0gc29ydGVkKAogICAgICAgIHJvd3MsCiAgICAgICAga2V5PWxhbWJkYSByOiAoCiAgICAgICAgICAgIG9yZGVyLmdldChzdHIoci5nZXQoInN0YXR1cyIpIG9yICIiKSwgOSksCiAgICAgICAgICAgIC0oZmxvYXQoci5nZXQoInZvbHVtZV8yNGgiKSBvciAwKSksCiAgICAgICAgKSwKICAgICkKCiAgICB0b3RhbCA9IGxlbihzb3J0ZWRfcm93cykKICAgIGxpdmUgPSBzdW0oMSBmb3IgciBpbiBzb3J0ZWRfcm93cyBpZiBib29sKHIuZ2V0KCJoYXNfbGl2ZV9kYXRhIiwgVHJ1ZSkpKQogICAgbm9fZGF0YSA9IHRvdGFsIC0gbGl2ZQoKICAgIHN0YXR1c19lbW9qaSA9IHsiTW9tZW50dW0iOiAi8J+foiIsICJSZWNsYWltIjogIvCfn6EiLCAiQnJlYWtkb3duIjogIvCflLQiLCAiUmFuZ2UiOiAi4pqqIiwgIlZvbGF0aWxlIjogIvCfn6AiLCAiSWxsaXF1aWQiOiAi4puUIiwgIk5vRGF0YSI6ICLinZMifQoKICAgIGhlYWRlcl9saW5lcyA9IFsKICAgICAgICBmIjxiPvCfkYEgW1NJR05BTF06IFdBVENITElTVCBTVU1NQVJZPC9iPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TiiBDT1ZFUkFHRToge2xpdmV9L3t0b3RhbH0gbGl2ZSAoe25vX2RhdGF9IG5vLWRhdGEpPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgXQogICAgdG9rZW5fbGluZXMgPSBbXQogICAgZm9yIGlkeCwgcm93IGluIGVudW1lcmF0ZShzb3J0ZWRfcm93cywgc3RhcnQ9MSk6CiAgICAgICAgc3RhdHVzX2NvZGUsIHN0YXR1c19sYWJlbCA9IF93YXRjaGxpc3Rfc3RhdHVzX2NvZGUocm93LmdldCgic3RhdHVzIikpCiAgICAgICAgc3ltYm9sID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgIGNoMjQgPSBfZm10X3BjdChyb3cuZ2V0KCJjaGFuZ2VfMjRoIikpCiAgICAgICAgbGlxID0gX2ZtdF91c2RfY29tcGFjdChyb3cuZ2V0KCJsaXF1aWRpdHkiKSkKICAgICAgICB2b2wgPSBfZm10X3VzZF9jb21wYWN0KHJvdy5nZXQoInZvbHVtZV8yNGgiKSkKICAgICAgICBzX2Vtb2ppID0gc3RhdHVzX2Vtb2ppLmdldChzdGF0dXNfbGFiZWwsICLimqoiKQogICAgICAgIHRva2VuX2xpbmVzLmFwcGVuZChmIjxjb2RlPntzX2Vtb2ppfSB7aWR4OjAyZH0ge3N5bWJvbDo8OX0ge3N0YXR1c19jb2RlOjwzfSAyNEgge2NoMjQ6Pjh9IExJUSB7bGlxOj43fTwvY29kZT4iKQoKICAgIHJldHVybiAiXG4iLmpvaW4oaGVhZGVyX2xpbmVzICsgdG9rZW5fbGluZXMpCg==',
    '/root/memecoin_engine/main.py': 'aW1wb3J0IGxvZ2dpbmcKaW1wb3J0IGpzb24KaW1wb3J0IGh0bWwKaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUgYXMgdGltZV9tb2R1bGUKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lLCB0aW1lZGVsdGEsIHRpbWV6b25lCmZyb20gbG9nZ2luZy5oYW5kbGVycyBpbXBvcnQgUm90YXRpbmdGaWxlSGFuZGxlcgoKZnJvbSB0ZWxlZ3JhbSBpbXBvcnQgQ29weVRleHRCdXR0b24sIElubGluZUtleWJvYXJkQnV0dG9uLCBJbmxpbmVLZXlib2FyZE1hcmt1cCwgVXBkYXRlCmZyb20gdGVsZWdyYW0uZXh0IGltcG9ydCAoCiAgICBBcHBsaWNhdGlvbkJ1aWxkZXIsCiAgICBDYWxsYmFja1F1ZXJ5SGFuZGxlciwKICAgIENvbW1hbmRIYW5kbGVyLAogICAgQ29udGV4dFR5cGVzLAopCgpmcm9tIGNvbmZpZyBpbXBvcnQgKAogICAgRU5HSU5FX1BST0ZJTEUsCiAgICBBTEVSVF9USFJFU0hPTEQsCiAgICBBTEVSVF9UT1BfTiwKICAgIEFMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgQUxFUlRfREFUQV9EUklGVF9XQVJOX1BDVCwKICAgIEFMRVJUX0RBVEFfUkVGUkVTSF9FTkFCTEVELAogICAgQUxFUlRfSElERV9VTlZFUklGSUVEX0hPTERFUlMsCiAgICBBTEVSVF9SRVFVSVJFX1JFRlJFU0hfU1VDQ0VTUywKICAgIEJFQVJJU0hfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICBCRUFSSVNIX0FMRVJUX1RIUkVTSE9MRCwKICAgIEJFQVJJU0hfTUFYX0FMRVJUU19QRVJfQ1lDTEUsCiAgICBCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0RBWSwKICAgIEJFQVJJU0hfTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICBCRUFSSVNIX1JFR0lNRV9NSU5fU0NPUkUsCiAgICBDT05GSURFTkNFX01JTl9BLAogICAgQ09ORklERU5DRV9NSU5fQiwKICAgIERBSUxZX1NVTU1BUllfRU5BQkxFRCwKICAgIERBSUxZX1NVTU1BUllfSE9VUl9VVEMsCiAgICBEUllfUlVOLAogICAgRU5BQkxFX1JFR0lNRV9HQVRFLAogICAgRU5BQkxFX0VYRUNVVElPTl9RVUFMSVRZX0ZJTFRFUlMsCiAgICBFTkFCTEVfRVhUUkVNRV9SSVNLX0hBUkRfQkxPQ0ssCiAgICBFTkFCTEVfUklTS19HT1ZFUk5PUiwKICAgIEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSLAogICAgR0xPQkFMX1RSQURJTkdfUEFVU0UsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9CT09UX1NFQ09ORFMsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9FTkFCTEVELAogICAgR09PRF9CVVlfQlVMTEVUSU5fSU5URVJWQUxfU0VDT05EUywKICAgIEdPT0RfQlVZX0JVTExFVElOX1BFUl9USUVSX01BWF9UT0tFTlMsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9USUVSLAogICAgTE9HX0JBQ0tVUF9DT1VOVCwKICAgIExPR19KU09OX0VOQUJMRUQsCiAgICBMT0dfSlNPTl9QQVRILAogICAgTE9HX01BWF9CWVRFUywKICAgIExPU1NfU1RSRUFLX1BBVVNFX0hPVVJTLAogICAgTE9TU19TVFJFQUtfTE9PS0JBQ0tfSE9VUlMsCiAgICBNQVhfQUJTX0NIQU5HRV8yNEgsCiAgICBNQVhfQUxFUlRTX1BFUl9EQVksCiAgICBNQVhfQUxFUlRTX1BFUl9TWU1CT0xfUEVSX0RBWSwKICAgIE1BWF9BTExPV0VEX0RSQVdET1dOXzI0SCwKICAgIE1BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgTUFYX0NPTlNFQ1VUSVZFXzRIX0xPU1NFUywKICAgIE1BWF9WT0xfVE9fTElRX1JBVElPLAogICAgTUlOX0xJUVVJRElUWV9QRVJfSE9MREVSLAogICAgTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICBNSU5fSE9MREVSUywKICAgIE1JTl9MSVFVSURJVFksCiAgICBNSU5fUFJJQ0VfVVNELAogICAgTUlOX1ZPTF9UT19MSVFfUkFUSU8sCiAgICBNSU5fVk9MVU1FXzI0SCwKICAgIE5FV19SVU5ORVJfQ09PTERPV05fSE9VUlMsCiAgICBORVdfUlVOTkVSX01BWF9BR0VfSE9VUlMsCiAgICBORVdfUlVOTkVSX01BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgTkVXX1JVTk5FUl9NQVhfUkVTVUxUUywKICAgIE5FV19SVU5ORVJfTUlOX0FMRVJUX1NDT1JFLAogICAgTkVXX1JVTk5FUl9NSU5fQ0hBTkdFXzI0SCwKICAgIE5FV19SVU5ORVJfTUlOX0xJUVVJRElUWSwKICAgIE5FV19SVU5ORVJfTUlOX01BUktFVF9DQVAsCiAgICBORVdfUlVOTkVSX01JTl9UWE5TX0gxLAogICAgTkVXX1JVTk5FUl9NSU5fVk9MVU1FXzI0SCwKICAgIE5FV19SVU5ORVJfTkFSUkFUSVZFX0tFWVdPUkRTLAogICAgTkVXX1JVTk5FUl9QQUlSU19QRVJfUVVFUlksCiAgICBORVdfUlVOTkVSX1JFUVVJUkVfU09DSUFMX0xJTktTLAogICAgTkVXX1JVTk5FUl9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICBORVdfUlVOTkVSX1NFQVJDSF9RVUVSSUVTLAogICAgTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVELAogICAgT1VUQ09NRV9FVkFMX0JBVENIX1NJWkUsCiAgICBPVVRDT01FX0VWQUxfSU5URVJWQUxfU0VDT05EUywKICAgIE9VVENPTUVfVFJBQ0tJTkdfRU5BQkxFRCwKICAgIFBST0NFU1NfTE9DS19GSUxFLAogICAgUkVHSU1FX01JTl9TQ09SRSwKICAgIFJJU0tfU1RZTEUsCiAgICBTQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICBTRUxMX0FMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgU0VMTF9BTEVSVF9NQVhfUEVSX0NZQ0xFLAogICAgU0VMTF9BTEVSVFNfRU5BQkxFRCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfQUJTX0NIQU5HRV8xSCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfQUJTX0NIQU5HRV82SCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfVFhOU19IMSwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfVk9MX1RPX0xJUSwKICAgIFNFTExfQ09OU09MSURBVElPTl9NSU5fQ0hBTkdFXzI0SCwKICAgIFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfMUgsCiAgICBTRUxMX0hZUEVfRkFERV9NQVhfQ0hBTkdFXzI0SCwKICAgIFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfNkgsCiAgICBTRUxMX0hZUEVfRkFERV9NQVhfVk9MX1RPX0xJUSwKICAgIFNJR05BTF9ESUdFU1RfRU5BQkxFRCwKICAgIFNJR05BTF9ESUdFU1RfSU5URVJWQUxfU0VDT05EUywKICAgIFNJR05BTF9ESUdFU1RfTE9PS0JBQ0tfSE9VUlMsCiAgICBTSUdOQUxfRElHRVNUX01BWF9JVEVNUywKICAgIFNPTF9CUkVBRFRIX01JTl9GT1JfUklTS19PTiwKICAgIFNPTF9FWFRSRU1FX09GRl9DSEFOR0VfMUgsCiAgICBTT0xfRVhUUkVNRV9PRkZfQ0hBTkdFXzI0SCwKICAgIFNPTF9SRUdJTUVfUVVFUlksCiAgICBTT0xfUklTS19PRkZfQ0hBTkdFXzI0SCwKICAgIFNPTF9SSVNLX09OX0NIQU5HRV8yNEgsCiAgICBURUxFR1JBTV9DSEFUX0lELAogICAgVEVMRUdSQU1fQUNUSU9OX0JVVFRPTlNfRU5BQkxFRCwKICAgIFRFTEVHUkFNX1RPS0VOLAogICAgVEVMRUdSQU1fUVVJRVRfTU9ERSwKICAgIFRFTEVHUkFNX1BVU0hfTUlOX0NPTkZJREVOQ0UsCiAgICBURUxFR1JBTV9QVVNIX01JTl9TQ09SRV9ERUxUQSwKICAgIFRFTEVHUkFNX1BVU0hfU1RST05HX09OTFksCiAgICBXQVRDSExJU1RfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICBXQVRDSExJU1RfQUxFUlRfT05fU1RBVFVTX0NIQU5HRSwKICAgIFdBVENITElTVF9BTEVSVF9TVEFUVVNFUywKICAgIFdBVENITElTVF9FTlRSSUVTLAogICAgV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRCwKICAgIFdBVENITElTVF9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgIFdBVENITElTVF9NSU5fTElRVUlESVRZLAogICAgV0FUQ0hMSVNUX01JTl9WT0xVTUVfMjRILAogICAgV0FUQ0hMSVNUX1NDQU5fSU5URVJWQUxfU0VDT05EUywKICAgIFdBVENITElTVF9TVU1NQVJZX0VOQUJMRUQsCiAgICBXQVRDSExJU1RfU1VNTUFSWV9IT1VSX1VUQywKICAgIFdFRUtMWV9UVU5JTkdfREFZX1VUQywKICAgIFdFRUtMWV9UVU5JTkdfRU5BQkxFRCwKICAgIFdFRUtMWV9UVU5JTkdfSE9VUl9VVEMsCiAgICBXRUVLTFlfVFVOSU5HX0xPT0tCQUNLX0RBWVMsCiAgICBXRUVLTFlfVFVOSU5HX01JTl9PVVRDT01FU180SCwKICAgIFNZTUJPTF9CTEFDS0xJU1RfQVZHXzI0SF9QQ1QsCiAgICBTWU1CT0xfQkxBQ0tMSVNUX0hPVVJTLAogICAgU1lNQk9MX0JMQUNLTElTVF9NSU5fU0FNUExFUywKICAgIFNZTUJPTF9DT05UUk9MX0VOQUJMRUQsCiAgICBTWU1CT0xfQ09PTERPV05fSE9VUlMsCiAgICBTWU1CT0xfTE9TU19TVFJFQUtfVFJJR0dFUiwKICAgIFRBQ1RJQ0FMX01BWF9MQVNUX1RSQURFX0FHRV9NSU5VVEVTLAogICAgVEFDVElDQUxfRU5BQkxFX1JFQUxfVEVDSE5JQ0FMUywKICAgIFRBQ1RJQ0FMX01BQ0RfSElTVF9NSU4sCiAgICBUQUNUSUNBTF9PSExDVl9MT09LQkFDS19IT1VSUywKICAgIFRBQ1RJQ0FMX09ITENWX1RZUEUsCiAgICBUQUNUSUNBTF9SRVFVSVJFX1RFQ0hOSUNBTF9DT05GSVJNQVRJT04sCiAgICBUQUNUSUNBTF9SU0lfTUFYLAogICAgVEFDVElDQUxfUlNJX01JTiwKICAgIFRBQ1RJQ0FMX1JTSV9QRVJJT0QsCiAgICBUQUNUSUNBTF9URUNIX0NBQ0hFX1NFQ09ORFMsCiAgICBUQUNUSUNBTF9NSU5fTU9NRU5UVU1fQ0hBTkdFXzFILAogICAgVEFDVElDQUxfTUlOX1ZPTF9UT19MSVFfUkFUSU8sCiAgICBUQUNUSUNBTF9QVUxMQkFDS19NQVhfUENULAogICAgVEFDVElDQUxfUFVMTEJBQ0tfTUlOX1BDVCwKICAgIFRBQ1RJQ0FMX1RSRU5EX01JTl9DSEFOR0VfMjRILAogICAgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQsCiAgICBMRUdBQ1lfUkVDT1ZFUllfU0NBTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgTEVHQUNZX1JFQ09WRVJZX1NFQVJDSF9RVUVSSUVTLAogICAgTEVHQUNZX1JFQ09WRVJZX1BBSVJTX1BFUl9RVUVSWSwKICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVMsCiAgICBMRUdBQ1lfUkVDT1ZFUllfTUlOX0xJUVVJRElUWSwKICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SCwKICAgIExFR0FDWV9SRUNPVkVSWV9WT0xVTUVfU1BJS0VfTVVMVElQTElFUiwKICAgIExFR0FDWV9SRUNPVkVSWV9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgIExFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9IT1VSUywKKQpmcm9tIGRhdGEuYmlyZGV5ZSBpbXBvcnQgKAogICAgZmV0Y2hfYmlyZGV5ZV9vaGxjdiwKICAgIGZldGNoX2JpcmRleWVfcHJpY2UsCiAgICBmZXRjaF9iaXJkZXllX3Rva2VuX292ZXJ2aWV3LAopCmZyb20gZGF0YS5kZXhzY3JlZW5lciBpbXBvcnQgKAogICAgZmV0Y2hfbGVnYWN5X3JlY292ZXJ5X2NhbmRpZGF0ZXMsCiAgICBmZXRjaF9ydW5uZXJfd2F0Y2hfY2FuZGlkYXRlcywKICAgIGZldGNoX3NvbF9tYXJrZXRfcHJveHksCiAgICBmZXRjaF90b2tlbl9zbmFwc2hvdCBhcyBmZXRjaF9kZXhzY3JlZW5lcl90b2tlbl9zbmFwc2hvdCwKKQpmcm9tIGRhdGEubWFya2V0X2RhdGEgaW1wb3J0IGZldGNoX21hcmtldF9kYXRhCmZyb20gc2NvcmluZyBpbXBvcnQgY2FsY3VsYXRlX3Rva2VuX3Njb3JlCmZyb20gdXRpbHMubWV0cmljcyBpbXBvcnQgY2xvc2VzLCBtYWNkLCByc2kKZnJvbSB1dGlscy5kYiBpbXBvcnQgKAogICAgY2xvc2VfbWFudWFsX3Bvc2l0aW9uLAogICAgY2xlYXJfcmlza19wYXVzZSwKICAgIGNvdW50X2FsZXJ0c19zaW5jZSwKICAgIGdldF9hY3RpdmVfc3ltYm9sX2NvbnRyb2wsCiAgICBnZXRfYWxlcnRfb3V0Y29tZV9yZWNhcCwKICAgIGdldF9jb25zZWN1dGl2ZV9sb3Npbmdfb3V0Y29tZXNfNGgsCiAgICBnZXRfZW5naW5lX2hlYWx0aF9zbmFwc2hvdCwKICAgIGdldF9sYXN0X2FsZXJ0X3RpbWVzdGFtcCwKICAgIGdldF9sYXRlc3RfNGhfb3V0Y29tZV90aW1lc3RhbXAsCiAgICBnZXRfbGF0ZXN0X2VuZ2luZV9ldmVudCwKICAgIGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sLAogICAgZ2V0X291dGNvbWVfcXVldWVfc3RhdHMsCiAgICBnZXRfb3Blbl9wb3NpdGlvbnMsCiAgICBnZXRfcGVuZGluZ19hbGVydF9vdXRjb21lcywKICAgIGdldF9wZXJmb3JtYW5jZV9zdW1tYXJ5LAogICAgZ2V0X3BvcnRmb2xpb19zaW11bGF0aW9uX21ldHJpY3MsCiAgICBnZXRfcmVjZW50X3NjYW5fYmVzdHMsCiAgICBnZXRfcmlza19wYXVzZV9zdGF0ZSwKICAgIGdldF9zeW1ib2xfb3V0Y29tZV9zdGF0cywKICAgIGdldF93ZWVrbHlfdHVuaW5nX3JlcG9ydCwKICAgIGluaXRfZGIsCiAgICBsb2dfc2lnbmFsLAogICAgbWFya19hbGVydF9vdXRjb21lX2NvbXBsZXRlLAogICAgbWFya19hbGVydF9vdXRjb21lX2Vycm9yLAogICAgb3Blbl9tYW51YWxfcG9zaXRpb24sCiAgICBxdWV1ZV9hbGVydF9vdXRjb21lLAogICAgc2V0X3Jpc2tfcGF1c2UsCiAgICBzZXRfc3ltYm9sX2NvbnRyb2wsCiAgICB1cGRhdGVfYWxlcnRfb3V0Y29tZV9ob3Jpem9uLAopCmZyb20gdXRpbHMuZm9ybWF0IGltcG9ydCAoCiAgICBmb3JtYXRfbGVnYWN5X3JlY292ZXJ5LAogICAgZm9ybWF0X3J1bm5lcl93YXRjaCwKICAgIGZvcm1hdF9zaWduYWwsCiAgICBmb3JtYXRfd2F0Y2hsaXN0X3NpZ25hbCwKICAgIGZvcm1hdF93YXRjaGxpc3Rfc3VtbWFyeSwKKQpmcm9tIHV0aWxzLnNpbmdsZXRvbiBpbXBvcnQgU2luZ2xldG9uUHJvY2Vzc0xvY2sKCmNsYXNzIF9NYXhMZXZlbEZpbHRlcihsb2dnaW5nLkZpbHRlcik6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbWF4X2xldmVsKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm1heF9sZXZlbCA9IG1heF9sZXZlbAoKICAgIGRlZiBmaWx0ZXIoc2VsZiwgcmVjb3JkKToKICAgICAgICByZXR1cm4gcmVjb3JkLmxldmVsbm8gPD0gc2VsZi5tYXhfbGV2ZWwKCgpjbGFzcyBfSnNvbkZvcm1hdHRlcihsb2dnaW5nLkZvcm1hdHRlcik6CiAgICBkZWYgZm9ybWF0KHNlbGYsIHJlY29yZCk6CiAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgInRzIjogZGF0ZXRpbWUudXRjbm93KCkuaXNvZm9ybWF0KCkgKyAiWiIsCiAgICAgICAgICAgICJsZXZlbCI6IHJlY29yZC5sZXZlbG5hbWUsCiAgICAgICAgICAgICJsb2dnZXIiOiByZWNvcmQubmFtZSwKICAgICAgICAgICAgIm1zZyI6IHJlY29yZC5nZXRNZXNzYWdlKCksCiAgICAgICAgfQogICAgICAgIGlmIHJlY29yZC5leGNfaW5mbzoKICAgICAgICAgICAgcGF5bG9hZFsiZXhjIl0gPSBzZWxmLmZvcm1hdEV4Y2VwdGlvbihyZWNvcmQuZXhjX2luZm8pCiAgICAgICAgcmV0dXJuIGpzb24uZHVtcHMocGF5bG9hZCwgc2VwYXJhdG9ycz0oIiwiLCAiOiIpKQoKCl9yb290X2xvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKCkKX3Jvb3RfbG9nZ2VyLnNldExldmVsKGxvZ2dpbmcuSU5GTykKX3Jvb3RfbG9nZ2VyLmhhbmRsZXJzLmNsZWFyKCkKCl9zdGRvdXRfaGFuZGxlciA9IGxvZ2dpbmcuU3RyZWFtSGFuZGxlcihzeXMuc3Rkb3V0KQpfc3Rkb3V0X2hhbmRsZXIuc2V0TGV2ZWwobG9nZ2luZy5ERUJVRykKX3N0ZG91dF9oYW5kbGVyLmFkZEZpbHRlcihfTWF4TGV2ZWxGaWx0ZXIobG9nZ2luZy5JTkZPKSkKCl9zdGRlcnJfaGFuZGxlciA9IGxvZ2dpbmcuU3RyZWFtSGFuZGxlcihzeXMuc3RkZXJyKQpfc3RkZXJyX2hhbmRsZXIuc2V0TGV2ZWwobG9nZ2luZy5XQVJOSU5HKQoKX2Zvcm1hdHRlciA9IGxvZ2dpbmcuRm9ybWF0dGVyKCIlKGxldmVsbmFtZSlzOiUobmFtZSlzOiUobWVzc2FnZSlzIikKX3N0ZG91dF9oYW5kbGVyLnNldEZvcm1hdHRlcihfZm9ybWF0dGVyKQpfc3RkZXJyX2hhbmRsZXIuc2V0Rm9ybWF0dGVyKF9mb3JtYXR0ZXIpCgpfcm9vdF9sb2dnZXIuYWRkSGFuZGxlcihfc3Rkb3V0X2hhbmRsZXIpCl9yb290X2xvZ2dlci5hZGRIYW5kbGVyKF9zdGRlcnJfaGFuZGxlcikKCmlmIExPR19KU09OX0VOQUJMRUQ6CiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmRpcm5hbWUoTE9HX0pTT05fUEFUSCkgb3IgIi4iLCBleGlzdF9vaz1UcnVlKQogICAgX2pzb25faGFuZGxlciA9IFJvdGF0aW5nRmlsZUhhbmRsZXIoCiAgICAgICAgTE9HX0pTT05fUEFUSCwKICAgICAgICBtYXhCeXRlcz1MT0dfTUFYX0JZVEVTLAogICAgICAgIGJhY2t1cENvdW50PUxPR19CQUNLVVBfQ09VTlQsCiAgICApCiAgICBfanNvbl9oYW5kbGVyLnNldExldmVsKGxvZ2dpbmcuSU5GTykKICAgIF9qc29uX2hhbmRsZXIuc2V0Rm9ybWF0dGVyKF9Kc29uRm9ybWF0dGVyKCkpCiAgICBfcm9vdF9sb2dnZXIuYWRkSGFuZGxlcihfanNvbl9oYW5kbGVyKQoKbG9nZ2luZy5nZXRMb2dnZXIoImh0dHB4Iikuc2V0TGV2ZWwobG9nZ2luZy5XQVJOSU5HKQpsb2dnaW5nLmdldExvZ2dlcigiaHR0cGNvcmUiKS5zZXRMZXZlbChsb2dnaW5nLldBUk5JTkcpCmxvZ2dpbmcuZ2V0TG9nZ2VyKCJ0ZWxlZ3JhbS52ZW5kb3IucHRiX3VybGxpYjMudXJsbGliMyIpLnNldExldmVsKGxvZ2dpbmcuV0FSTklORykKCl90YWN0aWNhbF90ZWNoX2NhY2hlID0ge30KX2JpcmRleWVfZW5yaWNobWVudF9jYWNoZSA9IHt9CgpfQ09ORklERU5DRV9PUkRFUiA9IHsiQyI6IDEsICJCIjogMiwgIkEiOiAzfQoKCmRlZiBfZW5yaWNoX3Rva2VuX2Zvcl9zY29yaW5nKHRva2VuKToKICAgICIiIgogICAgRW5yaWNoIHRva2VuIHdpdGggQmlyZEV5ZSB0b2tlbl9vdmVydmlldyBkYXRhIGJlZm9yZSBzY29yaW5nLgogICAgVGhlIG5ldyBzY29yaW5nIG1vZGVsIG5lZWRzIHVuaXF1ZSB3YWxsZXQgbWV0cmljcyBhbmQgc29jaWFsIGRhdGEuCiAgICBSZXR1cm5zIGVucmljaGVkIHRva2VuIGRpY3QuCiAgICAiIiIKICAgIGFkZHJlc3MgPSB0b2tlbi5nZXQoImFkZHJlc3MiKQogICAgaWYgbm90IGFkZHJlc3M6CiAgICAgICAgcmV0dXJuIHRva2VuCgogICAgIyBDaGVjayBjYWNoZSBmaXJzdCAoNW1pbiBUVEwgPSBzY2FuIGludGVydmFsLCBhdm9pZHMgQVBJIHNwYW0pCiAgICAjIFVuaXF1ZSB3YWxsZXQgZGF0YSBkb2Vzbid0IGNoYW5nZSBkcmFzdGljYWxseSBzZWNvbmQtdG8tc2Vjb25kCiAgICBjYWNoZV9rZXkgPSBhZGRyZXNzCiAgICBub3cgPSB0aW1lX21vZHVsZS50aW1lKCkKICAgIGNhY2hlX3R0bCA9IDMwMCAgIyA1IG1pbnV0ZXMKCiAgICBpZiBjYWNoZV9rZXkgaW4gX2JpcmRleWVfZW5yaWNobWVudF9jYWNoZToKICAgICAgICBjYWNoZWRfZGF0YSwgY2FjaGVkX3RzID0gX2JpcmRleWVfZW5yaWNobWVudF9jYWNoZVtjYWNoZV9rZXldCiAgICAgICAgaWYgbm93IC0gY2FjaGVkX3RzIDwgY2FjaGVfdHRsOgogICAgICAgICAgICBlbnJpY2hlZCA9IGRpY3QodG9rZW4pCiAgICAgICAgICAgIGVucmljaGVkLnVwZGF0ZShjYWNoZWRfZGF0YSkKICAgICAgICAgICAgcmV0dXJuIGVucmljaGVkCgogICAgIyBGZXRjaCBmcmVzaCBkYXRhIGZyb20gQmlyZEV5ZQogICAgb3ZlcnZpZXdfZGF0YSA9IGZldGNoX2JpcmRleWVfdG9rZW5fb3ZlcnZpZXcoYWRkcmVzcykKICAgIGlmIG92ZXJ2aWV3X2RhdGE6CiAgICAgICAgX2JpcmRleWVfZW5yaWNobWVudF9jYWNoZVtjYWNoZV9rZXldID0gKG92ZXJ2aWV3X2RhdGEsIG5vdykKICAgICAgICBlbnJpY2hlZCA9IGRpY3QodG9rZW4pCiAgICAgICAgZW5yaWNoZWQudXBkYXRlKG92ZXJ2aWV3X2RhdGEpCiAgICAgICAgcmV0dXJuIGVucmljaGVkCgogICAgcmV0dXJuIHRva2VuCl9EQVlfVE9fV0VFS0RBWSA9IHsiTU9OIjogMCwgIlRVRSI6IDEsICJXRUQiOiAyLCAiVEhVIjogMywgIkZSSSI6IDQsICJTQVQiOiA1LCAiU1VOIjogNn0KX1BST0pFQ1RfUk9PVCA9IFBhdGgoX19maWxlX18pLnJlc29sdmUoKS5wYXJlbnQKX0VOVl9QQVRIID0gX1BST0pFQ1RfUk9PVCAvICIuZW52IgpfV0FUQ0hMSVNUX1NUQVRFX1BBVEggPSBfUFJPSkVDVF9ST09UIC8gImRhdGFfc3RvcmFnZSIgLyAid2F0Y2hsaXN0X3N0YXRlLmpzb24iCl9BTExPV0VEX0NIQVRfSUQgPSBpbnQoVEVMRUdSQU1fQ0hBVF9JRCkKX2FwcF9yZWYgPSBOb25lCl9kaWdlc3Rfc3RhdGUgPSB7Imxhc3Rfc2VudF90cyI6IE5vbmV9Cl93YXRjaGxpc3Rfc3RhdGUgPSB7InN0YXR1c2VzIjoge319Cl9TRUxMX0FMRVJUX0VYQ0xVREVEX1NZTUJPTFMgPSB7IlVTREMiLCAiVVNEVCIsICJVU0RTIiwgIlVTRDEiLCAiREFJIiwgIlNPTCIsICJXU09MIn0KCl9NT0RFX1BSRVNFVFMgPSB7CiAgICAic3RyYXRlZ2ljIjogewogICAgICAgICJwcm9maWxlIjogInN0cmF0ZWdpYyIsCiAgICAgICAgInNjYW5faW50ZXJ2YWxfc2Vjb25kcyI6IDM2MDAsCiAgICAgICAgIm1pbl9saXF1aWRpdHkiOiAxXzAwMF8wMDAuMCwKICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiAzMDBfMDAwLjAsCiAgICAgICAgImFsZXJ0X2Nvb2xkb3duX2hvdXJzIjogMTIsCiAgICAgICAgImFsZXJ0X3RocmVzaG9sZCI6IDgwLAogICAgICAgICJtaW5fY29uZmlkZW5jZV90b19hbGVydCI6ICJBIiwKICAgICAgICAicmVnaW1lX21pbl9zY29yZSI6IDQ1LAogICAgfSwKICAgICJ0YWN0aWNhbCI6IHsKICAgICAgICAicHJvZmlsZSI6ICJ0YWN0aWNhbCIsCiAgICAgICAgInNjYW5faW50ZXJ2YWxfc2Vjb25kcyI6IDE4MDAsCiAgICAgICAgIm1pbl9saXF1aWRpdHkiOiA1MDBfMDAwLjAsCiAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogMjAwXzAwMC4wLAogICAgICAgICJhbGVydF9jb29sZG93bl9ob3VycyI6IDYsCiAgICAgICAgImFsZXJ0X3RocmVzaG9sZCI6IDcwLAogICAgICAgICJtaW5fY29uZmlkZW5jZV90b19hbGVydCI6ICJCIiwKICAgICAgICAicmVnaW1lX21pbl9zY29yZSI6IDE1LAogICAgfSwKfQoKX1JJU0tfU1RZTEVfQUxJQVNFUyA9IHsKICAgICJjYXBpdGFsIjogImNhcGl0YWwiLAogICAgImNhcGl0YWwtcHJlc2VydmF0aW9uIjogImNhcGl0YWwiLAogICAgInByZXNlcnZhdGlvbiI6ICJjYXBpdGFsIiwKICAgICJzYWZlIjogImNhcGl0YWwiLAogICAgImJhbGFuY2VkIjogImJhbGFuY2VkIiwKICAgICJiYWxhbmNlIjogImJhbGFuY2VkIiwKICAgICJzbmlwZXIiOiAic25pcGVyIiwKICAgICJoaWdoLWJldGEiOiAic25pcGVyIiwKICAgICJhZ2dyZXNzaXZlIjogInNuaXBlciIsCn0KCl9SSVNLX1NUWUxFX0xBQkVMUyA9IHsKICAgICJjYXBpdGFsIjogIkNhcGl0YWwgUHJlc2VydmF0aW9uIiwKICAgICJiYWxhbmNlZCI6ICJCYWxhbmNlZCIsCiAgICAic25pcGVyIjogIlNuaXBlciIsCn0KCl9SSVNLX1NUWUxFX0RFU0NSSVBUSU9OUyA9IHsKICAgICJjYXBpdGFsIjogIkRlZmVuc2l2ZTogc3RyaWN0ZXIgbGlxdWlkaXR5L3ZvbHVtZSBhbmQgdGlnaHRlciB2b2xhdGlsaXR5IGxpbWl0cy4iLAogICAgImJhbGFuY2VkIjogIkRlZmF1bHQ6IG1vZGVyYXRlIGZpbHRlcnMgZm9yIHN0ZWFkeSBvcHBvcnR1bml0eSBmbG93LiIsCiAgICAic25pcGVyIjogIkhpZ2gtYmV0YTogd2lkZXIgZ2F0ZXMgZm9yIGZhc3Rlciwgcmlza2llciBzZXR1cHMuIiwKfQoKX01BUktFVF9USUVSX1JVTEVTID0gewogICAgImNvbnNlcnZhdGl2ZSI6IHsKICAgICAgICAibGFiZWwiOiAiTG9uZy1UZXJtIiwKICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQSIsCiAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IDYuMCwKICAgICAgICAibWluX2xpcXVpZGl0eSI6IDFfNTAwXzAwMC4wLAogICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDYwMF8wMDAuMCwKICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAxLjUsCiAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDMwLjAsCiAgICAgICAgIm1heF92b2xfdG9fbGlxIjogMS4yLAogICAgICAgICJhbGxvd19yaXNrX29mZiI6IEZhbHNlLAogICAgfSwKICAgICJiYWxhbmNlZCI6IHsKICAgICAgICAibGFiZWwiOiAiTWlkLVRlcm0iLAogICAgICAgICJtaW5fY29uZmlkZW5jZSI6ICJCIiwKICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogMC4wLAogICAgICAgICJtaW5fbGlxdWlkaXR5IjogNzAwXzAwMC4wLAogICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDI1MF8wMDAuMCwKICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAwLjUsCiAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDQ1LjAsCiAgICAgICAgIm1heF92b2xfdG9fbGlxIjogMS44LAogICAgICAgICJhbGxvd19yaXNrX29mZiI6IFRydWUsCiAgICB9LAogICAgImFnZ3Jlc3NpdmUiOiB7CiAgICAgICAgImxhYmVsIjogIlNob3J0LVRlcm0iLAogICAgICAgICJtaW5fY29uZmlkZW5jZSI6ICJCIiwKICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogLTYuMCwKICAgICAgICAibWluX2xpcXVpZGl0eSI6IDI1MF8wMDAuMCwKICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiAxMjBfMDAwLjAsCiAgICAgICAgIm1pbl9jaGFuZ2VfMjRoIjogLTIuMCwKICAgICAgICAibWF4X2Fic19jaGFuZ2VfMjRoIjogNzAuMCwKICAgICAgICAibWF4X3ZvbF90b19saXEiOiAyLjgsCiAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogVHJ1ZSwKICAgIH0sCn0KCl9SSVNLX1NUWUxFX1RJRVJfT1ZFUlJJREVTID0gewogICAgImNhcGl0YWwiOiB7CiAgICAgICAgImNvbnNlcnZhdGl2ZSI6IHsKICAgICAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IDguMCwKICAgICAgICAgICAgIm1pbl9saXF1aWRpdHkiOiAyXzAwMF8wMDAuMCwKICAgICAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogODAwXzAwMC4wLAogICAgICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAyLjUsCiAgICAgICAgICAgICJtYXhfYWJzX2NoYW5nZV8yNGgiOiAyNC4wLAogICAgICAgICAgICAibWF4X3ZvbF90b19saXEiOiAxLjAsCiAgICAgICAgICAgICJhbGxvd19yaXNrX29mZiI6IEZhbHNlLAogICAgICAgIH0sCiAgICAgICAgImJhbGFuY2VkIjogewogICAgICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQSIsCiAgICAgICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiA0LjAsCiAgICAgICAgICAgICJtaW5fbGlxdWlkaXR5IjogMV8xMDBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDQ1MF8wMDAuMCwKICAgICAgICAgICAgIm1pbl9jaGFuZ2VfMjRoIjogMS4wLAogICAgICAgICAgICAibWF4X2Fic19jaGFuZ2VfMjRoIjogMzUuMCwKICAgICAgICAgICAgIm1heF92b2xfdG9fbGlxIjogMS40LAogICAgICAgICAgICAiYWxsb3dfcmlza19vZmYiOiBGYWxzZSwKICAgICAgICB9LAogICAgICAgICJhZ2dyZXNzaXZlIjogewogICAgICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQiIsCiAgICAgICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiAwLjAsCiAgICAgICAgICAgICJtaW5fbGlxdWlkaXR5IjogNjAwXzAwMC4wLAogICAgICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiAyNDBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fY2hhbmdlXzI0aCI6IDAuMCwKICAgICAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDUwLjAsCiAgICAgICAgICAgICJtYXhfdm9sX3RvX2xpcSI6IDEuOCwKICAgICAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogRmFsc2UsCiAgICAgICAgfSwKICAgIH0sCiAgICAiYmFsYW5jZWQiOiB7fSwKICAgICJzbmlwZXIiOiB7CiAgICAgICAgImNvbnNlcnZhdGl2ZSI6IHsKICAgICAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IDQuMCwKICAgICAgICAgICAgIm1pbl9saXF1aWRpdHkiOiAxXzEwMF8wMDAuMCwKICAgICAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogNDIwXzAwMC4wLAogICAgICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAxLjAsCiAgICAgICAgICAgICJtYXhfYWJzX2NoYW5nZV8yNGgiOiAzNi4wLAogICAgICAgICAgICAibWF4X3ZvbF90b19saXEiOiAxLjUsCiAgICAgICAgICAgICJhbGxvd19yaXNrX29mZiI6IEZhbHNlLAogICAgICAgIH0sCiAgICAgICAgImJhbGFuY2VkIjogewogICAgICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQiIsCiAgICAgICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiAtMi4wLAogICAgICAgICAgICAibWluX2xpcXVpZGl0eSI6IDUwMF8wMDAuMCwKICAgICAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogMTgwXzAwMC4wLAogICAgICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAwLjAsCiAgICAgICAgICAgICJtYXhfYWJzX2NoYW5nZV8yNGgiOiA1NS4wLAogICAgICAgICAgICAibWF4X3ZvbF90b19saXEiOiAyLjIsCiAgICAgICAgICAgICJhbGxvd19yaXNrX29mZiI6IFRydWUsCiAgICAgICAgfSwKICAgICAgICAiYWdncmVzc2l2ZSI6IHsKICAgICAgICAgICAgIm1pbl9jb25maWRlbmNlIjogIkIiLAogICAgICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogLTEwLjAsCiAgICAgICAgICAgICJtaW5fbGlxdWlkaXR5IjogMTgwXzAwMC4wLAogICAgICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiA5MF8wMDAuMCwKICAgICAgICAgICAgIm1pbl9jaGFuZ2VfMjRoIjogLTQuMCwKICAgICAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDgwLjAsCiAgICAgICAgICAgICJtYXhfdm9sX3RvX2xpcSI6IDMuMiwKICAgICAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogVHJ1ZSwKICAgICAgICB9LAogICAgfSwKfQoKX1dBTExFVF9QTEFZQk9PSyA9IHsKICAgICJXMSI6IHsKICAgICAgICAibmFtZSI6ICJDb3JlIExvbmctVGVybSIsCiAgICAgICAgInBvc2l0aW9uX2hpbnQiOiAic2l6ZSA4LTE1JSBtYXgsIHNjYWxlLWluIG9ubHkiLAogICAgICAgICJyaXNrX3BsYW4iOiAiU29mdCBzdG9wIG9uIHRoZXNpcyBicmVhazsgYXZvaWQgaW1wdWxzZSBleGl0cyIsCiAgICAgICAgInJvdGF0aW9uX3BsYW4iOiAiUHJpbWFyeSBkZXN0aW5hdGlvbiBmb3IgaGFydmVzdGVkIHByb2ZpdHMiLAogICAgfSwKICAgICJXMiI6IHsKICAgICAgICAibmFtZSI6ICJRdWFsaXR5IFN3aW5nIiwKICAgICAgICAicG9zaXRpb25faGludCI6ICJzaXplIDQtOCUgbWF4IiwKICAgICAgICAicmlza19wbGFuIjogIkhhcmQgU0wgLTglIHwgVFAgKzEyLysyNSB8IHRyYWlsIDEwJSIsCiAgICAgICAgInJvdGF0aW9uX3BsYW4iOiAiUm90YXRlIDQwLTYwJSB3aW5zIHRvIFcxL3N0YWtpbmcvVVNEQyIsCiAgICB9LAogICAgIlczIjogewogICAgICAgICJuYW1lIjogIlRhY3RpY2FsL0RlZ2VuIiwKICAgICAgICAicG9zaXRpb25faGludCI6ICJzaXplIDEtMyUgbWF4IiwKICAgICAgICAicmlza19wbGFuIjogIkhhcmQgU0wgLTEyJSB8IHNjYWxlIGF0ICsxNS8rMzAvKzUwIiwKICAgICAgICAicm90YXRpb25fcGxhbiI6ICJSb3RhdGUgNjAtODAlIHdpbnMgdG8gVzEvVzIgb3IgVVNEQyIsCiAgICB9LAp9CgpfcnVudGltZSA9IHsKICAgICJwcm9maWxlIjogRU5HSU5FX1BST0ZJTEUgaWYgRU5HSU5FX1BST0ZJTEUgaW4gX01PREVfUFJFU0VUUyBlbHNlICJzdHJhdGVnaWMiLAogICAgInJpc2tfc3R5bGUiOiBfUklTS19TVFlMRV9BTElBU0VTLmdldChzdHIoUklTS19TVFlMRSBvciAiIikubG93ZXIoKSwgImJhbGFuY2VkIiksCiAgICAic2Nhbl9pbnRlcnZhbF9zZWNvbmRzIjogU0NBTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgIm1pbl9saXF1aWRpdHkiOiBmbG9hdChNSU5fTElRVUlESVRZKSwKICAgICJtaW5fdm9sdW1lXzI0aCI6IGZsb2F0KE1JTl9WT0xVTUVfMjRIKSwKICAgICJhbGVydF9jb29sZG93bl9ob3VycyI6IEFMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgImFsZXJ0X3RocmVzaG9sZCI6IEFMRVJUX1RIUkVTSE9MRCwKICAgICJtaW5fY29uZmlkZW5jZV90b19hbGVydCI6IE1JTl9DT05GSURFTkNFX1RPX0FMRVJULAogICAgInJlZ2ltZV9taW5fc2NvcmUiOiBSRUdJTUVfTUlOX1NDT1JFLAp9CgoKZGVmIF9tb2RlKCkgLT4gc3RyOgogICAgcmV0dXJuIHN0cihfcnVudGltZVsicHJvZmlsZSJdKS5sb3dlcigpCgoKZGVmIF9ub3JtYWxpemVfcmlza19zdHlsZShyYXc6IHN0ciB8IE5vbmUpIC0+IHN0cjoKICAgIHJldHVybiBfUklTS19TVFlMRV9BTElBU0VTLmdldChzdHIocmF3IG9yICIiKS5zdHJpcCgpLmxvd2VyKCksICJiYWxhbmNlZCIpCgoKZGVmIF9yaXNrX3N0eWxlX2xhYmVsKHN0eWxlOiBzdHIgfCBOb25lID0gTm9uZSkgLT4gc3RyOgogICAgbm9ybWFsaXplZCA9IF9ub3JtYWxpemVfcmlza19zdHlsZShzdHlsZSBvciBfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSkKICAgIHJldHVybiBfUklTS19TVFlMRV9MQUJFTFMuZ2V0KG5vcm1hbGl6ZWQsICJCYWxhbmNlZCIpCgoKZGVmIF9yaXNrX3N0eWxlX2Rlc2NyaXB0aW9uKHN0eWxlOiBzdHIgfCBOb25lID0gTm9uZSkgLT4gc3RyOgogICAgbm9ybWFsaXplZCA9IF9ub3JtYWxpemVfcmlza19zdHlsZShzdHlsZSBvciBfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSkKICAgIHJldHVybiBfUklTS19TVFlMRV9ERVNDUklQVElPTlMuZ2V0KAogICAgICAgIG5vcm1hbGl6ZWQsCiAgICAgICAgIkRlZmF1bHQ6IG1vZGVyYXRlIGZpbHRlcnMgZm9yIHN0ZWFkeSBvcHBvcnR1bml0eSBmbG93LiIsCiAgICApCgoKZGVmIF9tYXJrZXRfdGllcl9ydWxlKHRpZXJfa2V5OiBzdHIpIC0+IGRpY3Q6CiAgICB0aWVyID0gX25vcm1hbGl6ZV9tYXJrZXRfdGllcih0aWVyX2tleSkKICAgIGJhc2UgPSBkaWN0KF9NQVJLRVRfVElFUl9SVUxFU1t0aWVyXSkKICAgIHN0eWxlID0gX25vcm1hbGl6ZV9yaXNrX3N0eWxlKF9ydW50aW1lLmdldCgicmlza19zdHlsZSIpKQogICAgb3ZlcnJpZGVzID0gX1JJU0tfU1RZTEVfVElFUl9PVkVSUklERVMuZ2V0KHN0eWxlLCB7fSkuZ2V0KHRpZXIsIHt9KQogICAgaWYgb3ZlcnJpZGVzOgogICAgICAgIGJhc2UudXBkYXRlKG92ZXJyaWRlcykKICAgIHJldHVybiBiYXNlCgoKZGVmIF9pc19hdXRob3JpemVkKHVwZGF0ZTogVXBkYXRlKSAtPiBib29sOgogICAgY2hhdCA9IHVwZGF0ZS5lZmZlY3RpdmVfY2hhdAogICAgcmV0dXJuIGJvb2woY2hhdCBhbmQgY2hhdC5pZCA9PSBfQUxMT1dFRF9DSEFUX0lEKQoKCmRlZiBfc2V0X2Vudl92YWx1ZXModmFsdWVzOiBkaWN0W3N0ciwgc3RyXSk6CiAgICBleGlzdGluZyA9IF9FTlZfUEFUSC5yZWFkX3RleHQoKS5zcGxpdGxpbmVzKCkgaWYgX0VOVl9QQVRILmV4aXN0cygpIGVsc2UgW10KICAgIG91dHB1dCA9IFtdCiAgICBzZWVuID0gc2V0KCkKCiAgICBmb3IgbGluZSBpbiBleGlzdGluZzoKICAgICAgICBzdHJpcHBlZCA9IGxpbmUuc3RyaXAoKQogICAgICAgIHJlcGxhY2VkID0gRmFsc2UKICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiB2YWx1ZXMuaXRlbXMoKToKICAgICAgICAgICAgaWYgc3RyaXBwZWQuc3RhcnRzd2l0aChmIntrZXl9PSIpOgogICAgICAgICAgICAgICAgaWYga2V5IG5vdCBpbiBzZWVuOgogICAgICAgICAgICAgICAgICAgIG91dHB1dC5hcHBlbmQoZiJ7a2V5fT17dmFsdWV9IikKICAgICAgICAgICAgICAgICAgICBzZWVuLmFkZChrZXkpCiAgICAgICAgICAgICAgICByZXBsYWNlZCA9IFRydWUKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgbm90IHJlcGxhY2VkOgogICAgICAgICAgICBvdXRwdXQuYXBwZW5kKGxpbmUpCgogICAgZm9yIGtleSwgdmFsdWUgaW4gdmFsdWVzLml0ZW1zKCk6CiAgICAgICAgaWYga2V5IG5vdCBpbiBzZWVuOgogICAgICAgICAgICBvdXRwdXQuYXBwZW5kKGYie2tleX09e3ZhbHVlfSIpCgogICAgX0VOVl9QQVRILndyaXRlX3RleHQoIlxuIi5qb2luKG91dHB1dCkucnN0cmlwKCkgKyAiXG4iKQoKCmRlZiBfYXBwbHlfbW9kZShtb2RlOiBzdHIpOgogICAgbW9kZSA9IG1vZGUubG93ZXIoKQogICAgaWYgbW9kZSBub3QgaW4gX01PREVfUFJFU0VUUzoKICAgICAgICByZXR1cm4KICAgIF9ydW50aW1lLnVwZGF0ZShfTU9ERV9QUkVTRVRTW21vZGVdKQoKCmRlZiBfcGVyc2lzdF9tb2RlKG1vZGU6IHN0cik6CiAgICBwcmVzZXQgPSBfTU9ERV9QUkVTRVRTW21vZGVdCiAgICBfc2V0X2Vudl92YWx1ZXMoCiAgICAgICAgewogICAgICAgICAgICAiRU5HSU5FX1BST0ZJTEUiOiBwcmVzZXRbInByb2ZpbGUiXSwKICAgICAgICAgICAgIlNDQU5fSU5URVJWQUxfU0VDT05EUyI6IHN0cihwcmVzZXRbInNjYW5faW50ZXJ2YWxfc2Vjb25kcyJdKSwKICAgICAgICAgICAgIk1JTl9MSVFVSURJVFkiOiBzdHIoaW50KHByZXNldFsibWluX2xpcXVpZGl0eSJdKSksCiAgICAgICAgICAgICJNSU5fVk9MVU1FXzI0SCI6IHN0cihpbnQocHJlc2V0WyJtaW5fdm9sdW1lXzI0aCJdKSksCiAgICAgICAgICAgICJBTEVSVF9DT09MRE9XTl9IT1VSUyI6IHN0cihwcmVzZXRbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0pLAogICAgICAgICAgICAiQUxFUlRfVEhSRVNIT0xEIjogc3RyKHByZXNldFsiYWxlcnRfdGhyZXNob2xkIl0pLAogICAgICAgICAgICAiTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQiOiBzdHIocHJlc2V0WyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdKSwKICAgICAgICAgICAgIlJFR0lNRV9NSU5fU0NPUkUiOiBzdHIocHJlc2V0WyJyZWdpbWVfbWluX3Njb3JlIl0pLAogICAgICAgIH0KICAgICkKCgpkZWYgX2ZtdF9kdChkdCk6CiAgICBpZiBub3QgZHQ6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICByZXR1cm4gZHQuc3RyZnRpbWUoIiVZLSVtLSVkICVIOiVNOiVTIFVUQyIpCgoKZGVmIF90cnlfZmxvYXQodmFsdWUpOgogICAgdHJ5OgogICAgICAgIHJldHVybiBmbG9hdCh2YWx1ZSkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gTm9uZQoKCmRlZiBfcGFyc2Vfc3ltYm9sX29yX21pbnQocmF3OiBzdHIpOgogICAgdG9rZW4gPSBzdHIocmF3IG9yICIiKS5zdHJpcCgpCiAgICBpZiBub3QgdG9rZW46CiAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUKICAgIHRva2VuID0gdG9rZW4ubHN0cmlwKCIkIikKICAgIGlmIGxlbih0b2tlbikgPj0gMzI6CiAgICAgICAgcmV0dXJuIE5vbmUsIHRva2VuCiAgICBzeW1ib2wgPSAiIi5qb2luKGNoIGZvciBjaCBpbiB0b2tlbi51cHBlcigpIGlmIGNoLmlzYWxudW0oKSlbOjE2XQogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gTm9uZSwgTm9uZQogICAgcmV0dXJuIHN5bWJvbCwgTm9uZQoKCmRlZiBfcmVzb2x2ZV90b2tlbl9mb3JfdHJhY2tpbmcoc3ltYm9sOiBzdHIgfCBOb25lLCBtaW50OiBzdHIgfCBOb25lKToKICAgIGlmIG1pbnQ6CiAgICAgICAgc25hcCA9IGZldGNoX2RleHNjcmVlbmVyX3Rva2VuX3NuYXBzaG90KG1pbnQpCiAgICAgICAgaWYgc25hcDoKICAgICAgICAgICAgcmV0dXJuIHNuYXAKICAgIGlmIHN5bWJvbDoKICAgICAgICBjYW5kaWRhdGVzID0gZmV0Y2hfcnVubmVyX3dhdGNoX2NhbmRpZGF0ZXMoCiAgICAgICAgICAgIHF1ZXJpZXM9W3N5bWJvbF0sCiAgICAgICAgICAgIHBhaXJzX3Blcl9xdWVyeT0xNiwKICAgICAgICAgICAgbGltaXQ9NTAsCiAgICAgICAgKQogICAgICAgIGlmIGNhbmRpZGF0ZXM6CiAgICAgICAgICAgIGV4YWN0ID0gW3QgZm9yIHQgaW4gY2FuZGlkYXRlcyBpZiBzdHIodC5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpID09IHN5bWJvbF0KICAgICAgICAgICAgcG9vbCA9IGV4YWN0IG9yIGNhbmRpZGF0ZXMKICAgICAgICAgICAgcG9vbC5zb3J0KGtleT1sYW1iZGEgdDogKGZsb2F0KHQuZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKSwgZmxvYXQodC5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKSksIHJldmVyc2U9VHJ1ZSkKICAgICAgICAgICAgcmV0dXJuIHBvb2xbMF0KICAgIHJldHVybiBOb25lCgoKZGVmIF9idWlsZF9hbGVydF9rZXlib2FyZChzeW1ib2w6IHN0ciwgbWludDogc3RyIHwgTm9uZSwgcGFpcl9hZGRyZXNzOiBzdHIgfCBOb25lID0gTm9uZSk6CiAgICBpZiBub3QgVEVMRUdSQU1fQUNUSU9OX0JVVFRPTlNfRU5BQkxFRDoKICAgICAgICByZXR1cm4gTm9uZQogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICBzeW1ib2wgPSAiVU5LTk9XTiIKICAgIHJvd3MgPSBbXQogICAgbWludF90ZXh0ID0gc3RyKG1pbnQgb3IgIiIpLnN0cmlwKCkKICAgIGRleHNjcmVlbmVyX3RhcmdldCA9IHBhaXJfYWRkcmVzcyBvciBtaW50CiAgICBpZiBkZXhzY3JlZW5lcl90YXJnZXQ6CiAgICAgICAgZmlyc3Rfcm93ID0gWwogICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigiRGV4U2NyZWVuZXIiLCB1cmw9ZiJodHRwczovL2RleHNjcmVlbmVyLmNvbS9zb2xhbmEve2RleHNjcmVlbmVyX3RhcmdldH0iKSwKICAgICAgICBdCiAgICAgICAgaWYgbWludF90ZXh0OgogICAgICAgICAgICBmaXJzdF9yb3cuYXBwZW5kKAogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oCiAgICAgICAgICAgICAgICAgICAgIkNvcHkgQ0EiLAogICAgICAgICAgICAgICAgICAgIGNvcHlfdGV4dD1Db3B5VGV4dEJ1dHRvbih0ZXh0PW1pbnRfdGV4dCksCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICByb3dzLmFwcGVuZChmaXJzdF9yb3cpCiAgICBpZiBtaW50X3RleHQ6CiAgICAgICAgcm93cy5hcHBlbmQoCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCJTb2xzY2FuIiwgdXJsPWYiaHR0cHM6Ly9zb2xzY2FuLmlvL3Rva2VuL3ttaW50X3RleHR9IiksCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigiUnVnQ2hlY2siLCB1cmw9ZiJodHRwczovL3J1Z2NoZWNrLnh5ei90b2tlbnMve21pbnRfdGV4dH0iKSwKICAgICAgICAgICAgXQogICAgICAgICkKICAgIGlmIG5vdCByb3dzOgogICAgICAgIHJldHVybiBOb25lCiAgICByZXR1cm4gSW5saW5lS2V5Ym9hcmRNYXJrdXAocm93cykKCgpkZWYgX3Jlc2NoZWR1bGVfcnVuX2VuZ2luZV9qb2JzKGFwcGxpY2F0aW9uKToKICAgIGludGVydmFsID0gaW50KF9ydW50aW1lWyJzY2FuX2ludGVydmFsX3NlY29uZHMiXSkKICAgIGZvciBqb2IgaW4gYXBwbGljYXRpb24uam9iX3F1ZXVlLmdldF9qb2JzX2J5X25hbWUoInJ1bl9lbmdpbmVfY3ljbGUiKToKICAgICAgICBqb2Iuc2NoZWR1bGVfcmVtb3ZhbCgpCiAgICBmb3Igam9iIGluIGFwcGxpY2F0aW9uLmpvYl9xdWV1ZS5nZXRfam9ic19ieV9uYW1lKCJydW5fZW5naW5lX2Jvb3QiKToKICAgICAgICBqb2Iuc2NoZWR1bGVfcmVtb3ZhbCgpCgogICAgYXBwbGljYXRpb24uam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgIHJ1bl9lbmdpbmUsCiAgICAgICAgd2hlbj0yLAogICAgICAgIG5hbWU9InJ1bl9lbmdpbmVfYm9vdCIsCiAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDMwfSwKICAgICkKICAgIGFwcGxpY2F0aW9uLmpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKAogICAgICAgIHJ1bl9lbmdpbmUsCiAgICAgICAgaW50ZXJ2YWw9aW50ZXJ2YWwsCiAgICAgICAgZmlyc3Q9aW50ZXJ2YWwsCiAgICAgICAgbmFtZT0icnVuX2VuZ2luZV9jeWNsZSIsCiAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDMwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICkKCgpkZWYgX3JlcXVpcmVfZW52KCk6CiAgICBpZiBub3QgVEVMRUdSQU1fVE9LRU46CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigi4p2MIFRFTEVHUkFNX1RPS0VOIG1pc3NpbmcgaW4gLmVudiIpCiAgICBpZiBub3QgVEVMRUdSQU1fQ0hBVF9JRDoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCLinYwgVEVMRUdSQU1fQ0hBVF9JRCBtaXNzaW5nIGluIC5lbnYiKQogICAgaWYgbm90IHN0cihURUxFR1JBTV9DSEFUX0lEKS5pc2RpZ2l0KCk6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigi4p2MIFRFTEVHUkFNX0NIQVRfSUQgbXVzdCBiZSBudW1lcmljIChleGFtcGxlOiAxODg3Njc4MDIzKSIpCgoKZGVmIF90b19pbnRfb3Jfbm9uZSh2YWx1ZSk6CiAgICBpZiB2YWx1ZSBpbiAoTm9uZSwgIiIsICJOL0EiKToKICAgICAgICByZXR1cm4gTm9uZQogICAgdHJ5OgogICAgICAgIHJldHVybiBpbnQoZmxvYXQodmFsdWUpKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiBOb25lCgoKZGVmIF9wYXNzZXNfcXVhbGl0eV9maWx0ZXJzKHRva2VuKToKICAgICIiIgogICAgQmFzaWMgcXVhbGl0eSBmaWx0ZXJzIHRvIGV4Y2x1ZGUganVuay9pbGxpcXVpZCB0b2tlbnMuCiAgICBGb2N1czogbWluaW11bSBzdGFuZGFyZHMsIG5vdCBlbnRyeSB0aW1pbmcuCiAgICAiIiIKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBob2xkZXJzID0gX3RvX2ludF9vcl9ub25lKHRva2VuLmdldCgiaG9sZGVycyIpKQoKICAgICMgTWluaW11bSBsaXF1aWRpdHkvdm9sdW1lIHN0YW5kYXJkcwogICAgaWYgbGlxdWlkaXR5IDwgZmxvYXQoX3J1bnRpbWVbIm1pbl9saXF1aWRpdHkiXSk6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBpZiB2b2x1bWVfMjRoIDwgZmxvYXQoX3J1bnRpbWVbIm1pbl92b2x1bWVfMjRoIl0pOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgTm90IGFscmVhZHkgZHVtcGluZyBoYXJkCiAgICBpZiBjaGFuZ2VfMjRoIDw9IE1BWF9BTExPV0VEX0RSQVdET1dOXzI0SDoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIE1pbmltdW0gaG9sZGVyIGJhc2UKICAgIGlmIGhvbGRlcnMgaXMgbm90IE5vbmUgYW5kIGhvbGRlcnMgPCBNSU5fSE9MREVSUzoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIEVBUkxZIEVOVFJZIExPR0lDOiBBdm9pZCBsYXRlIHB1bXBzCiAgICAjIElmIDI0aCBjaGFuZ2UgaXMgdG9vIGV4dHJlbWUsIHdlJ3JlIGxhdGUgdG8gdGhlIHBhcnR5CiAgICBpZiBjaGFuZ2VfMjRoID4gMTAwOiAgIyBBbHJlYWR5IDJ4KyBpbiAyNGggPSB0b28gbGF0ZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgSWYgaG9sZGVycyBhcmUgcHJlc2VudCwgY2hlY2sgZm9yIGhlYWx0aHkgZ3Jvd3RoIHZzIHB1bXAgJiBkdW1wCiAgICB1d18xaCA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0MWgiKQogICAgdXdfMWhfY2hhbmdlID0gdG9rZW4uZ2V0KCJ1bmlxdWVXYWxsZXQxaENoYW5nZVBlcmNlbnQiKQoKICAgICMgSWYgaG9sZGVycyBhcmUgcmFwaWRseSBleGl0aW5nIChuZWdhdGl2ZSBncm93dGgpLCBza2lwCiAgICBpZiB1d18xaF9jaGFuZ2UgaXMgbm90IE5vbmUgYW5kIHV3XzFoX2NoYW5nZSA8IC0xNToKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIElmIHdlIGhhdmUgdmVyeSBsb3cgaG9sZGVyIGNvdW50IHdpdGggbWFzc2l2ZSBwcmljZSBwdW1wID0gbGlrZWx5IGJvdCBmYXJtCiAgICBpZiB1d18xaCBpcyBub3QgTm9uZSBhbmQgdXdfMWggPCAzMCBhbmQgY2hhbmdlXzI0aCA+IDUwOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIHJldHVybiBUcnVlCgoKZGVmIF9wYXNzZXNfZXhlY3V0aW9uX3F1YWxpdHlfZmlsdGVycyh0b2tlbik6CiAgICAiIiIKICAgIEFkdmFuY2VkIGZpbHRlcnMgZm9jdXNlZCBvbiBleGVjdXRpb24gcXVhbGl0eSBhbmQgZWFybHktc3RhZ2UgZGV0ZWN0aW9uLgogICAgR29hbDogY2F0Y2ggbW9tZW50dW0gRUFSTFksIG5vdCBhZnRlciBwYXJhYm9saWMgbW92ZXMuCiAgICAiIiIKICAgIGlmIG5vdCBFTkFCTEVfRVhFQ1VUSU9OX1FVQUxJVFlfRklMVEVSUzoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgcHJpY2UgPSBmbG9hdCh0b2tlbi5nZXQoInByaWNlIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzFoID0gdG9rZW4uZ2V0KCJjaGFuZ2VfMWgiKSBvciB0b2tlbi5nZXQoInByaWNlQ2hhbmdlMWhQZXJjZW50IikKICAgIGNoYW5nZV80aCA9IHRva2VuLmdldCgiY2hhbmdlXzRoIikgb3IgdG9rZW4uZ2V0KCJwcmljZUNoYW5nZTRoUGVyY2VudCIpCiAgICBob2xkZXJzID0gX3RvX2ludF9vcl9ub25lKHRva2VuLmdldCgiaG9sZGVycyIpKQoKICAgICMgUHJpY2UgbXVzdCBiZSB0cmFkZWFibGUKICAgIGlmIHByaWNlIDwgTUlOX1BSSUNFX1VTRDoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIEF2b2lkIHBhcmFib2xpYyBsYXRlIHB1bXBzCiAgICBpZiBhYnMoY2hhbmdlXzI0aCkgPiBNQVhfQUJTX0NIQU5HRV8yNEg6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgIyBWb2x1bWUvbGlxdWlkaXR5IHJhdGlvIG11c3QgYmUgaGVhbHRoeSAobm90IG92ZXJoZWF0ZWQsIG5vdCBkZWFkKQogICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMAogICAgaWYgdm9sX3RvX2xpcSA8IE1JTl9WT0xfVE9fTElRX1JBVElPIG9yIHZvbF90b19saXEgPiBNQVhfVk9MX1RPX0xJUV9SQVRJTzoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIExpcXVpZGl0eSBwZXIgaG9sZGVyIGNvbmNlbnRyYXRpb24gY2hlY2sKICAgIGlmIGhvbGRlcnMgYW5kIGhvbGRlcnMgPiAwOgogICAgICAgIGxpcV9wZXJfaG9sZGVyID0gbGlxdWlkaXR5IC8gaG9sZGVycwogICAgICAgIGlmIGxpcV9wZXJfaG9sZGVyIDwgTUlOX0xJUVVJRElUWV9QRVJfSE9MREVSOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIEVBUkxZIEVOVFJZIEVOSEFOQ0VNRU5UOiBMb29rIGZvciBhY2NlbGVyYXRpb24gcGF0dGVybnMKICAgICMgQmVzdCBzaWduYWw6IDRoIHRyZW5kICsgMWggYWNjZWxlcmF0aW9uIChub3QgbGF0ZSBwdW1wKQogICAgaWYgY2hhbmdlXzRoIGlzIG5vdCBOb25lIGFuZCBjaGFuZ2VfMWggaXMgbm90IE5vbmU6CiAgICAgICAgIyBJZiA0aCBpcyBzdHJvbmdseSBwb3NpdGl2ZSBidXQgMWggaXMgZHVtcGluZyA9IHRvcCBzaWduYWwsIHNraXAKICAgICAgICBpZiBjaGFuZ2VfNGggPiAxMCBhbmQgY2hhbmdlXzFoIDwgLTU6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAjIElmIDI0aCBpcyBwYXJhYm9saWMgYnV0IHNob3J0LXRlcm0gaXMgZmFkaW5nID0gbGF0ZSwgc2tpcAogICAgICAgIGlmIGNoYW5nZV8yNGggPiA1MCBhbmQgY2hhbmdlXzRoIDwgNToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgIyBDaGVjayBob2xkZXIgbW9tZW50dW0gZm9yIHF1YWxpdHkKICAgIHV3XzFoX2NoYW5nZSA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0MWhDaGFuZ2VQZXJjZW50IikKICAgIHV3XzRoX2NoYW5nZSA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0NGhDaGFuZ2VQZXJjZW50IikKCiAgICAjIElmIGhvbGRlcnMgYXJlIGFjY2VsZXJhdGluZyBvdXQgKG5lZ2F0aXZlIGdyb3d0aCksIHNraXAKICAgIGlmIHV3XzFoX2NoYW5nZSBpcyBub3QgTm9uZSBhbmQgdXdfMWhfY2hhbmdlIDwgLTIwOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgSWYgNGggaG9sZGVyIHRyZW5kIGlzIG5lZ2F0aXZlIHdoaWxlIHByaWNlIGlzIHB1bXBpbmcgPSBkaXN0cmlidXRpb24KICAgIGlmIHV3XzRoX2NoYW5nZSBpcyBub3QgTm9uZSBhbmQgY2hhbmdlXzI0aCA+IDIwIGFuZCB1d180aF9jaGFuZ2UgPCAtMTA6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgcmV0dXJuIFRydWUKCgpkZWYgX3Bhc3Nlc190YWN0aWNhbF9maWx0ZXJzKHRva2VuKToKICAgIGlmIF9tb2RlKCkgIT0gInRhY3RpY2FsIjoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBjaGFuZ2VfMWhfcmF3ID0gdG9rZW4uZ2V0KCJjaGFuZ2VfMWgiKQogICAgY2hhbmdlXzZoX3JhdyA9IHRva2VuLmdldCgiY2hhbmdlXzZoIikKICAgIGNoYW5nZV8xaCA9IGZsb2F0KGNoYW5nZV8xaF9yYXcpIGlmIGlzaW5zdGFuY2UoY2hhbmdlXzFoX3JhdywgKGludCwgZmxvYXQpKSBlbHNlIE5vbmUKICAgIGNoYW5nZV82aCA9IGZsb2F0KGNoYW5nZV82aF9yYXcpIGlmIGlzaW5zdGFuY2UoY2hhbmdlXzZoX3JhdywgKGludCwgZmxvYXQpKSBlbHNlIE5vbmUKCiAgICBpZiBsaXF1aWRpdHkgPD0gMCBvciB2b2x1bWVfMjRoIDw9IDA6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgdm9sX3RvX2xpcSA9IHZvbHVtZV8yNGggLyBsaXF1aWRpdHkKICAgIGlmIHZvbF90b19saXEgPCBUQUNUSUNBTF9NSU5fVk9MX1RPX0xJUV9SQVRJTzoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBwdWxsYmFja19wY3QgPSBhYnMoY2hhbmdlXzI0aCkgaWYgY2hhbmdlXzI0aCA8IDAgZWxzZSAwLjAKICAgIGluX3B1bGxiYWNrX3pvbmUgPSBUQUNUSUNBTF9QVUxMQkFDS19NSU5fUENUIDw9IHB1bGxiYWNrX3BjdCA8PSBUQUNUSUNBTF9QVUxMQkFDS19NQVhfUENUCgogICAgbW9tZW50dW1fb2sgPSBjaGFuZ2VfMjRoID49IFRBQ1RJQ0FMX1RSRU5EX01JTl9DSEFOR0VfMjRICiAgICBpZiBjaGFuZ2VfMWggaXMgbm90IE5vbmU6CiAgICAgICAgbW9tZW50dW1fb2sgPSBtb21lbnR1bV9vayBhbmQgY2hhbmdlXzFoID49IFRBQ1RJQ0FMX01JTl9NT01FTlRVTV9DSEFOR0VfMUgKICAgIGVsaWYgY2hhbmdlXzZoIGlzIG5vdCBOb25lOgogICAgICAgIG1vbWVudHVtX29rID0gbW9tZW50dW1fb2sgYW5kIGNoYW5nZV82aCA+IDAKCiAgICBzdXBwb3J0X2JvdW5jZV9vayA9IGluX3B1bGxiYWNrX3pvbmUgYW5kICgKICAgICAgICAoY2hhbmdlXzFoIGlzIG5vdCBOb25lIGFuZCBjaGFuZ2VfMWggPj0gMCkKICAgICAgICBvciAoY2hhbmdlXzZoIGlzIG5vdCBOb25lIGFuZCBjaGFuZ2VfNmggPj0gMCkKICAgICAgICBvciAoY2hhbmdlXzFoIGlzIE5vbmUgYW5kIGNoYW5nZV82aCBpcyBOb25lKQogICAgKQoKICAgIGlmIG5vdCAobW9tZW50dW1fb2sgb3Igc3VwcG9ydF9ib3VuY2Vfb2spOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGxhc3RfdHJhZGVfdW5peCA9IF90b19pbnRfb3Jfbm9uZSh0b2tlbi5nZXQoImxhc3RfdHJhZGVfdW5peCIpKQogICAgaWYgbGFzdF90cmFkZV91bml4OgogICAgICAgIGFnZV9taW51dGVzID0gKGRhdGV0aW1lLnV0Y25vdygpIC0gZGF0ZXRpbWUudXRjZnJvbXRpbWVzdGFtcChsYXN0X3RyYWRlX3VuaXgpKS50b3RhbF9zZWNvbmRzKCkgLyA2MC4wCiAgICAgICAgaWYgYWdlX21pbnV0ZXMgPiBUQUNUSUNBTF9NQVhfTEFTVF9UUkFERV9BR0VfTUlOVVRFUzoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgdGVjaCA9IF9nZXRfdGFjdGljYWxfdGVjaG5pY2Fscyh0b2tlbikKICAgIGlmIHRlY2g6CiAgICAgICAgdG9rZW4udXBkYXRlKHRlY2gpCiAgICAgICAgcnNpX29rID0gVEFDVElDQUxfUlNJX01JTiA8PSB0ZWNoWyJyc2kiXSA8PSBUQUNUSUNBTF9SU0lfTUFYCiAgICAgICAgbWFjZF9vayA9ICgKICAgICAgICAgICAgdGVjaFsibWFjZF9oaXN0Il0gPj0gVEFDVElDQUxfTUFDRF9ISVNUX01JTgogICAgICAgICAgICBhbmQgdGVjaFsibWFjZF9saW5lIl0gPj0gdGVjaFsibWFjZF9zaWduYWwiXQogICAgICAgICkKICAgICAgICBpZiBub3QgKHJzaV9vayBhbmQgbWFjZF9vayk6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgZWxpZiBUQUNUSUNBTF9FTkFCTEVfUkVBTF9URUNITklDQUxTIGFuZCBUQUNUSUNBTF9SRVFVSVJFX1RFQ0hOSUNBTF9DT05GSVJNQVRJT046CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgcmV0dXJuIFRydWUKCgpkZWYgX3BjdF9kcmlmdChvbGRfdmFsdWUsIG5ld192YWx1ZSk6CiAgICB0cnk6CiAgICAgICAgb2xkX24gPSBmbG9hdChvbGRfdmFsdWUpCiAgICAgICAgbmV3X24gPSBmbG9hdChuZXdfdmFsdWUpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIG9sZF9uIDw9IDAgb3IgbmV3X24gPD0gMDoKICAgICAgICByZXR1cm4gTm9uZQogICAgcmV0dXJuIGFicyhuZXdfbiAtIG9sZF9uKSAvIG9sZF9uICogMTAwLjAKCgpkZWYgX3JlZnJlc2hfYWxlcnRfbWFya2V0X3NuYXBzaG90KHRva2VuOiBkaWN0KToKICAgIGlmIG5vdCBBTEVSVF9EQVRBX1JFRlJFU0hfRU5BQkxFRDoKICAgICAgICByZXR1cm4gdG9rZW4KCiAgICBhZGRyZXNzID0gdG9rZW4uZ2V0KCJhZGRyZXNzIikKICAgIGlmIG5vdCBhZGRyZXNzOgogICAgICAgIHJldHVybiB0b2tlbgoKICAgIHNuYXBzaG90ID0gZmV0Y2hfZGV4c2NyZWVuZXJfdG9rZW5fc25hcHNob3QoYWRkcmVzcykKICAgIGlmIG5vdCBzbmFwc2hvdDoKICAgICAgICBpZiBBTEVSVF9SRVFVSVJFX1JFRlJFU0hfU1VDQ0VTUzoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICByZXR1cm4gdG9rZW4KCiAgICBtZXJnZWQgPSBkaWN0KHRva2VuKQogICAgZm9yIGZpZWxkIGluICgibGlxdWlkaXR5IiwgInZvbHVtZV8yNGgiLCAicHJpY2UiLCAiY2hhbmdlXzI0aCIsICJjaGFuZ2VfNmgiLCAiY2hhbmdlXzFoIiwgIm1hcmtldF9jYXAiLCAiZmR2Iik6CiAgICAgICAgc25hcF92YWx1ZSA9IHNuYXBzaG90LmdldChmaWVsZCkKICAgICAgICBpZiBzbmFwX3ZhbHVlIGlzIE5vbmU6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZHJpZnQgPSBfcGN0X2RyaWZ0KHRva2VuLmdldChmaWVsZCksIHNuYXBfdmFsdWUpCiAgICAgICAgaWYgZHJpZnQgaXMgbm90IE5vbmUgYW5kIGRyaWZ0ID49IEFMRVJUX0RBVEFfRFJJRlRfV0FSTl9QQ1Q6CiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygKICAgICAgICAgICAgICAgICJBbGVydCBkYXRhIGRyaWZ0IGFkanVzdGVkIGZvciAlcyBmaWVsZD0lcyBvbGQ9JS40ZiBuZXc9JS40ZiBkcmlmdD0lLjFmJSUiLAogICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpLAogICAgICAgICAgICAgICAgZmllbGQsCiAgICAgICAgICAgICAgICBmbG9hdCh0b2tlbi5nZXQoZmllbGQpIG9yIDApLAogICAgICAgICAgICAgICAgZmxvYXQoc25hcF92YWx1ZSBvciAwKSwKICAgICAgICAgICAgICAgIGRyaWZ0LAogICAgICAgICAgICApCiAgICAgICAgbWVyZ2VkW2ZpZWxkXSA9IHNuYXBfdmFsdWUKCiAgICBpZiBzbmFwc2hvdC5nZXQoInBhaXJfYWRkcmVzcyIpOgogICAgICAgIG1lcmdlZFsicGFpcl9hZGRyZXNzIl0gPSBzbmFwc2hvdFsicGFpcl9hZGRyZXNzIl0KCiAgICAjIERleCBsaXZlIHNuYXBzaG90IGN1cnJlbnRseSBkb2VzIG5vdCBwcm92aWRlIGhvbGRlciBjb3VudDsgbWFyayBhcyB1bnZlcmlmaWVkLgogICAgbWVyZ2VkWyJob2xkZXJzX3ZlcmlmaWVkIl0gPSBib29sKHNuYXBzaG90LmdldCgiaG9sZGVycyIpKQogICAgaWYgbWVyZ2VkWyJob2xkZXJzX3ZlcmlmaWVkIl06CiAgICAgICAgbWVyZ2VkWyJob2xkZXJzIl0gPSBzbmFwc2hvdC5nZXQoImhvbGRlcnMiKQoKICAgIG1lcmdlZFsic291cmNlIl0gPSAiZGV4c2NyZWVuZXJfbGl2ZSIKICAgIHJldHVybiBtZXJnZWQKCgpkZWYgX2hvbGRlcnNfZm9yX2FsZXJ0KHRva2VuOiBkaWN0KToKICAgIGhvbGRlcnMgPSB0b2tlbi5nZXQoImhvbGRlcnMiKQogICAgaWYgbm90IEFMRVJUX0hJREVfVU5WRVJJRklFRF9IT0xERVJTOgogICAgICAgIHJldHVybiBob2xkZXJzCiAgICBpZiB0b2tlbi5nZXQoImhvbGRlcnNfdmVyaWZpZWQiKToKICAgICAgICByZXR1cm4gaG9sZGVycwogICAgcmV0dXJuICJOL0EiCgoKZGVmIF9nZXRfdGFjdGljYWxfdGVjaG5pY2Fscyh0b2tlbik6CiAgICBpZiBfbW9kZSgpICE9ICJ0YWN0aWNhbCIgb3Igbm90IFRBQ1RJQ0FMX0VOQUJMRV9SRUFMX1RFQ0hOSUNBTFM6CiAgICAgICAgcmV0dXJuIHt9CiAgICBhZGRyZXNzID0gdG9rZW4uZ2V0KCJhZGRyZXNzIikKICAgIGlmIG5vdCBhZGRyZXNzOgogICAgICAgIHJldHVybiB7fQoKICAgIG5vd190cyA9IGludCh0aW1lX21vZHVsZS50aW1lKCkpCiAgICBjYWNoZWQgPSBfdGFjdGljYWxfdGVjaF9jYWNoZS5nZXQoYWRkcmVzcykKICAgIGlmIGNhY2hlZCBhbmQgbm93X3RzIC0gY2FjaGVkWyJ0cyJdIDw9IFRBQ1RJQ0FMX1RFQ0hfQ0FDSEVfU0VDT05EUzoKICAgICAgICByZXR1cm4gY2FjaGVkWyJkYXRhIl0KCiAgICBjYW5kbGVzID0gZmV0Y2hfYmlyZGV5ZV9vaGxjdigKICAgICAgICBhZGRyZXNzPWFkZHJlc3MsCiAgICAgICAgY2FuZGxlX3R5cGU9VEFDVElDQUxfT0hMQ1ZfVFlQRSwKICAgICAgICBsb29rYmFja19ob3Vycz1UQUNUSUNBTF9PSExDVl9MT09LQkFDS19IT1VSUywKICAgICkKICAgIGNsb3NlX3ZhbHVlcyA9IGNsb3NlcyhjYW5kbGVzKQogICAgaWYgbGVuKGNsb3NlX3ZhbHVlcykgPCBtYXgoMzUsIFRBQ1RJQ0FMX1JTSV9QRVJJT0QgKyAyKToKICAgICAgICByZXR1cm4ge30KCiAgICByc2lfdmFsdWUgPSByc2koY2xvc2VfdmFsdWVzLCBwZXJpb2Q9VEFDVElDQUxfUlNJX1BFUklPRCkKICAgIG1hY2RfdmFsdWUgPSBtYWNkKGNsb3NlX3ZhbHVlcykKICAgIGlmIHJzaV92YWx1ZSBpcyBOb25lIG9yIG5vdCBtYWNkX3ZhbHVlOgogICAgICAgIHJldHVybiB7fQoKICAgIHNuYXBzaG90ID0gewogICAgICAgICJyc2kiOiBmbG9hdChyc2lfdmFsdWUpLAogICAgICAgICJtYWNkX2xpbmUiOiBmbG9hdChtYWNkX3ZhbHVlWyJtYWNkX2xpbmUiXSksCiAgICAgICAgIm1hY2Rfc2lnbmFsIjogZmxvYXQobWFjZF92YWx1ZVsibWFjZF9zaWduYWwiXSksCiAgICAgICAgIm1hY2RfaGlzdCI6IGZsb2F0KG1hY2RfdmFsdWVbIm1hY2RfaGlzdCJdKSwKICAgIH0KICAgIF90YWN0aWNhbF90ZWNoX2NhY2hlW2FkZHJlc3NdID0geyJ0cyI6IG5vd190cywgImRhdGEiOiBzbmFwc2hvdH0KICAgIHJldHVybiBzbmFwc2hvdAoKCmRlZiBfY29uZmlkZW5jZV9mcm9tX3Njb3JlKHNjb3JlKToKICAgIGlmIHNjb3JlID49IENPTkZJREVOQ0VfTUlOX0E6CiAgICAgICAgcmV0dXJuICJBIgogICAgaWYgc2NvcmUgPj0gQ09ORklERU5DRV9NSU5fQjoKICAgICAgICByZXR1cm4gIkIiCiAgICByZXR1cm4gIkMiCgoKZGVmIF9jb25maWRlbmNlX21lZXRzX3J1bGUoY29uZmlkZW5jZSwgbWluaW11bSk6CiAgICBtaW5pbXVtX3JhdyA9IHN0cihtaW5pbXVtIG9yICJCIikudXBwZXIoKQogICAgbWluaW11bV9ub3JtID0gbWluaW11bV9yYXcgaWYgbWluaW11bV9yYXcgaW4gX0NPTkZJREVOQ0VfT1JERVIgZWxzZSAiQiIKICAgIHJldHVybiBfQ09ORklERU5DRV9PUkRFUi5nZXQoY29uZmlkZW5jZSwgMCkgPj0gX0NPTkZJREVOQ0VfT1JERVJbbWluaW11bV9ub3JtXQoKCmRlZiBfY29uZmlkZW5jZV9tZWV0c19hbGVydF9ydWxlKGNvbmZpZGVuY2UpOgogICAgcmV0dXJuIF9jb25maWRlbmNlX21lZXRzX3J1bGUoY29uZmlkZW5jZSwgX3J1bnRpbWVbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0pCgoKZGVmIF9pc19zeW1ib2xfb25fY29vbGRvd24oc3ltYm9sOiBzdHIsIGNvb2xkb3duX2hvdXJzOiBpbnQgfCBmbG9hdCB8IE5vbmUgPSBOb25lKSAtPiBib29sOgogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGxhc3RfYWxlcnRfdHMgPSBnZXRfbGFzdF9hbGVydF90aW1lc3RhbXAoc3ltYm9sKQogICAgaWYgbm90IGxhc3RfYWxlcnRfdHM6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBlZmZlY3RpdmVfaG91cnMgPSBpbnQoY29vbGRvd25faG91cnMgaWYgY29vbGRvd25faG91cnMgaXMgbm90IE5vbmUgZWxzZSBfcnVudGltZVsiYWxlcnRfY29vbGRvd25faG91cnMiXSkKICAgIHJldHVybiAoZGF0ZXRpbWUudXRjbm93KCkgLSBsYXN0X2FsZXJ0X3RzKSA8IHRpbWVkZWx0YShob3Vycz1lZmZlY3RpdmVfaG91cnMpCgoKZGVmIF9hcHBseV9zeW1ib2xfY29udHJvbHMoc3ltYm9sOiBzdHIpOgogICAgaWYgbm90IFNZTUJPTF9DT05UUk9MX0VOQUJMRUQgb3Igbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gTm9uZQogICAgcmV0dXJuIGdldF9hY3RpdmVfc3ltYm9sX2NvbnRyb2woc3ltYm9sKQoKCmRlZiBfcmlza19nb3Zlcm5vcl9zdGF0dXMoKSAtPiB0dXBsZVtib29sLCBzdHJdOgogICAgaWYgR0xPQkFMX1RSQURJTkdfUEFVU0U6CiAgICAgICAgcmV0dXJuIEZhbHNlLCAiR0xPQkFMX1RSQURJTkdfUEFVU0UgZW5hYmxlZCIKICAgIGlmIG5vdCBFTkFCTEVfUklTS19HT1ZFUk5PUjoKICAgICAgICByZXR1cm4gVHJ1ZSwgIiIKCiAgICBub3cgPSBkYXRldGltZS51dGNub3coKQogICAgcGF1c2Vfc3RhdGUgPSBnZXRfcmlza19wYXVzZV9zdGF0ZSgpCiAgICBwYXVzZV91bnRpbCA9IHBhdXNlX3N0YXRlLmdldCgicGF1c2VfdW50aWwiKQogICAgaWYgcGF1c2VfdW50aWwgYW5kIHBhdXNlX3VudGlsID4gbm93OgogICAgICAgIHJldHVybiBGYWxzZSwgZiJSaXNrIHBhdXNlIGFjdGl2ZSB1bnRpbCB7cGF1c2VfdW50aWwuaXNvZm9ybWF0KCl9IgogICAgaWYgcGF1c2VfdW50aWwgYW5kIHBhdXNlX3VudGlsIDw9IG5vdzoKICAgICAgICBjbGVhcl9yaXNrX3BhdXNlKCkKCiAgICBzdHJlYWsgPSBnZXRfY29uc2VjdXRpdmVfbG9zaW5nX291dGNvbWVzXzRoKGxpbWl0PTEwMCkKICAgIGxhdGVzdF80aF9vdXRjb21lID0gZ2V0X2xhdGVzdF80aF9vdXRjb21lX3RpbWVzdGFtcCgpCiAgICByZWNlbnRfb3V0Y29tZV93aW5kb3cgPSBub3cgLSB0aW1lZGVsdGEoaG91cnM9TE9TU19TVFJFQUtfTE9PS0JBQ0tfSE9VUlMpCiAgICBpZiAoCiAgICAgICAgc3RyZWFrID49IE1BWF9DT05TRUNVVElWRV80SF9MT1NTRVMKICAgICAgICBhbmQgbGF0ZXN0XzRoX291dGNvbWUKICAgICAgICBhbmQgbGF0ZXN0XzRoX291dGNvbWUgPj0gcmVjZW50X291dGNvbWVfd2luZG93CiAgICApOgogICAgICAgIHJlYXNvbiA9IGYiTG9zcyBzdHJlYWsge3N0cmVha30gPj0ge01BWF9DT05TRUNVVElWRV80SF9MT1NTRVN9IgogICAgICAgIHNldF9yaXNrX3BhdXNlKExPU1NfU1RSRUFLX1BBVVNFX0hPVVJTLCByZWFzb24pCiAgICAgICAgcmV0dXJuIEZhbHNlLCByZWFzb24KCiAgICBhbGVydHNfMjRoID0gY291bnRfYWxlcnRzX3NpbmNlKGRhdGV0aW1lLnV0Y25vdygpIC0gdGltZWRlbHRhKGhvdXJzPTI0KSkKICAgIGlmIE1BWF9BTEVSVFNfUEVSX0RBWSA+IDAgYW5kIGFsZXJ0c18yNGggPj0gTUFYX0FMRVJUU19QRVJfREFZOgogICAgICAgIHJldHVybiBGYWxzZSwgZiJEYWlseSBhbGVydCBjYXAgcmVhY2hlZCAoe2FsZXJ0c18yNGh9L3tNQVhfQUxFUlRTX1BFUl9EQVl9KSIKCiAgICByZXR1cm4gVHJ1ZSwgIiIKCgpkZWYgX2NvbXB1dGVfcmVnaW1lKHRva2Vucyk6CiAgICBpZiBub3QgdG9rZW5zOgogICAgICAgIHJldHVybiB7InNjb3JlIjogMC4wLCAibGFiZWwiOiAiUklTS19PRkYiLCAiYnJlYWR0aF9wY3QiOiAwLjAsICJhdmdfY2hhbmdlXzI0aCI6IDAuMH0KCiAgICBjaGFuZ2VzID0gW2Zsb2F0KHQuZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkgZm9yIHQgaW4gdG9rZW5zXQogICAgcG9zaXRpdmVzID0gc3VtKDEgZm9yIHggaW4gY2hhbmdlcyBpZiB4ID4gMCkKICAgIGJyZWFkdGhfcGN0ID0gcG9zaXRpdmVzIC8gbGVuKGNoYW5nZXMpCiAgICBhdmdfY2hhbmdlID0gc3VtKGNoYW5nZXMpIC8gbGVuKGNoYW5nZXMpCgogICAgIyBCbGVuZCBkaXJlY3Rpb25hbCBicmVhZHRoIGFuZCBtZWFuIGNoYW5nZSBpbnRvIGEgMC0xMDAgcmVnaW1lIHNjb3JlLgogICAgcmVnaW1lX3Njb3JlID0gNTAuMCArIChhdmdfY2hhbmdlICogMi4wKSArICgoYnJlYWR0aF9wY3QgLSAwLjUpICogNDAuMCkKICAgIHJlZ2ltZV9zY29yZSA9IG1heCgwLjAsIG1pbigxMDAuMCwgcmVnaW1lX3Njb3JlKSkKCiAgICBpZiByZWdpbWVfc2NvcmUgPj0gNjU6CiAgICAgICAgbGFiZWwgPSAiUklTS19PTiIKICAgIGVsaWYgcmVnaW1lX3Njb3JlID49IDQ1OgogICAgICAgIGxhYmVsID0gIk5FVVRSQUwiCiAgICBlbHNlOgogICAgICAgIGxhYmVsID0gIlJJU0tfT0ZGIgoKICAgIHJldHVybiB7CiAgICAgICAgInNjb3JlIjogcmVnaW1lX3Njb3JlLAogICAgICAgICJsYWJlbCI6IGxhYmVsLAogICAgICAgICJicmVhZHRoX3BjdCI6IGJyZWFkdGhfcGN0LAogICAgICAgICJhdmdfY2hhbmdlXzI0aCI6IGF2Z19jaGFuZ2UsCiAgICB9CgoKZGVmIF9jb21wdXRlX3NvbF9yZWdpbWVfcHJveHkoKToKICAgIGlmIG5vdCBFTkFCTEVfU09MX1JFR0lNRV9MQVlFUjoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiZW5hYmxlZCI6IEZhbHNlLAogICAgICAgICAgICAiYXZhaWxhYmxlIjogRmFsc2UsCiAgICAgICAgICAgICJzeW1ib2wiOiAiU09MIiwKICAgICAgICAgICAgImNoYW5nZV8yNGgiOiAwLjAsCiAgICAgICAgICAgICJjaGFuZ2VfMWgiOiAwLjAsCiAgICAgICAgICAgICJwYWlyX2FkZHJlc3MiOiBOb25lLAogICAgICAgICAgICAibGlxdWlkaXR5IjogMC4wLAogICAgICAgIH0KCiAgICBzbmFwc2hvdCA9IGZldGNoX3NvbF9tYXJrZXRfcHJveHkoU09MX1JFR0lNRV9RVUVSWSkKICAgIGlmIG5vdCBzbmFwc2hvdDoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiZW5hYmxlZCI6IFRydWUsCiAgICAgICAgICAgICJhdmFpbGFibGUiOiBGYWxzZSwKICAgICAgICAgICAgInN5bWJvbCI6ICJTT0wiLAogICAgICAgICAgICAiY2hhbmdlXzI0aCI6IDAuMCwKICAgICAgICAgICAgImNoYW5nZV8xaCI6IDAuMCwKICAgICAgICAgICAgInBhaXJfYWRkcmVzcyI6IE5vbmUsCiAgICAgICAgICAgICJsaXF1aWRpdHkiOiAwLjAsCiAgICAgICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgImVuYWJsZWQiOiBUcnVlLAogICAgICAgICJhdmFpbGFibGUiOiBUcnVlLAogICAgICAgICJzeW1ib2wiOiBzbmFwc2hvdC5nZXQoInN5bWJvbCIpIG9yICJTT0wiLAogICAgICAgICJjaGFuZ2VfMjRoIjogZmxvYXQoc25hcHNob3QuZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCksCiAgICAgICAgImNoYW5nZV8xaCI6IGZsb2F0KHNuYXBzaG90LmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCksCiAgICAgICAgInBhaXJfYWRkcmVzcyI6IHNuYXBzaG90LmdldCgicGFpcl9hZGRyZXNzIiksCiAgICAgICAgImxpcXVpZGl0eSI6IGZsb2F0KHNuYXBzaG90LmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCksCiAgICB9CgoKZGVmIF9idWlsZF9tYXJrZXRfcG9saWN5KHJlZ2ltZSwgc29sX3Byb3h5KToKICAgIHBvbGljeSA9IHsKICAgICAgICAic3RhdGUiOiByZWdpbWUuZ2V0KCJsYWJlbCIsICJORVVUUkFMIiksCiAgICAgICAgImFsZXJ0X3RocmVzaG9sZCI6IGZsb2F0KF9ydW50aW1lWyJhbGVydF90aHJlc2hvbGQiXSksCiAgICAgICAgIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Ijogc3RyKF9ydW50aW1lWyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdKS51cHBlcigpLAogICAgICAgICJyZWdpbWVfbWluX3Njb3JlIjogZmxvYXQoX3J1bnRpbWVbInJlZ2ltZV9taW5fc2NvcmUiXSksCiAgICAgICAgIm1heF9hbGVydHNfcGVyX2N5Y2xlIjogbWF4KDEsIGludChNQVhfQUxFUlRTX1BFUl9DWUNMRSkpLAogICAgICAgICJtYXhfYWxlcnRzX3Blcl9kYXkiOiBpbnQoTUFYX0FMRVJUU19QRVJfREFZKSwKICAgICAgICAiYWxlcnRfY29vbGRvd25faG91cnMiOiBpbnQoX3J1bnRpbWVbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0pLAogICAgICAgICJoYXJkX2Jsb2NrIjogRmFsc2UsCiAgICAgICAgImhhcmRfYmxvY2tfcmVhc29uIjogIiIsCiAgICB9CgogICAgaWYgbm90IEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSOgogICAgICAgIHBvbGljeVsic3RhdGUiXSA9IHJlZ2ltZS5nZXQoImxhYmVsIiwgIk5FVVRSQUwiKQogICAgICAgIHJldHVybiBwb2xpY3kKCiAgICBzb2xfY2hhbmdlXzI0aCA9IGZsb2F0KHNvbF9wcm94eS5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgc29sX2NoYW5nZV8xaCA9IGZsb2F0KHNvbF9wcm94eS5nZXQoImNoYW5nZV8xaCIsIDApIG9yIDApCiAgICBicmVhZHRoID0gZmxvYXQocmVnaW1lLmdldCgiYnJlYWR0aF9wY3QiLCAwKSBvciAwKQogICAgcmVnaW1lX3Njb3JlID0gZmxvYXQocmVnaW1lLmdldCgic2NvcmUiLCAwKSBvciAwKQoKICAgIGlmICgKICAgICAgICBzb2xfY2hhbmdlXzI0aCA8PSBTT0xfRVhUUkVNRV9PRkZfQ0hBTkdFXzI0SAogICAgICAgIG9yIHNvbF9jaGFuZ2VfMWggPD0gU09MX0VYVFJFTUVfT0ZGX0NIQU5HRV8xSAogICAgKToKICAgICAgICBzdGF0ZSA9ICJFWFRSRU1FX1JJU0tfT0ZGIgogICAgZWxpZiBzb2xfY2hhbmdlXzI0aCA8PSBTT0xfUklTS19PRkZfQ0hBTkdFXzI0SCBvciByZWdpbWUuZ2V0KCJsYWJlbCIpID09ICJSSVNLX09GRiI6CiAgICAgICAgc3RhdGUgPSAiUklTS19PRkYiCiAgICBlbGlmICgKICAgICAgICBzb2xfY2hhbmdlXzI0aCA+PSBTT0xfUklTS19PTl9DSEFOR0VfMjRICiAgICAgICAgYW5kIGJyZWFkdGggPj0gU09MX0JSRUFEVEhfTUlOX0ZPUl9SSVNLX09OCiAgICAgICAgYW5kIHJlZ2ltZV9zY29yZSA+PSA0NQogICAgKToKICAgICAgICBzdGF0ZSA9ICJSSVNLX09OIgogICAgZWxzZToKICAgICAgICBzdGF0ZSA9ICJORVVUUkFMIgoKICAgIHBvbGljeVsic3RhdGUiXSA9IHN0YXRlCgogICAgaWYgc3RhdGUgaW4geyJSSVNLX09GRiIsICJFWFRSRU1FX1JJU0tfT0ZGIn06CiAgICAgICAgcG9saWN5WyJhbGVydF90aHJlc2hvbGQiXSA9IG1heChwb2xpY3lbImFsZXJ0X3RocmVzaG9sZCJdLCBmbG9hdChCRUFSSVNIX0FMRVJUX1RIUkVTSE9MRCkpCiAgICAgICAgcG9saWN5WyJyZWdpbWVfbWluX3Njb3JlIl0gPSBtYXgocG9saWN5WyJyZWdpbWVfbWluX3Njb3JlIl0sIGZsb2F0KEJFQVJJU0hfUkVHSU1FX01JTl9TQ09SRSkpCgogICAgICAgIGJlYXJpc2hfY29uZiA9IHN0cihCRUFSSVNIX01JTl9DT05GSURFTkNFX1RPX0FMRVJUKS51cHBlcigpCiAgICAgICAgaWYgYmVhcmlzaF9jb25mIG5vdCBpbiBfQ09ORklERU5DRV9PUkRFUjoKICAgICAgICAgICAgYmVhcmlzaF9jb25mID0gIkEiCiAgICAgICAgcG9saWN5WyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdID0gYmVhcmlzaF9jb25mCgogICAgICAgIGJlYXJpc2hfY3ljbGVfY2FwID0gbWF4KDEsIGludChCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0NZQ0xFKSkKICAgICAgICBwb2xpY3lbIm1heF9hbGVydHNfcGVyX2N5Y2xlIl0gPSBtaW4ocG9saWN5WyJtYXhfYWxlcnRzX3Blcl9jeWNsZSJdLCBiZWFyaXNoX2N5Y2xlX2NhcCkKCiAgICAgICAgYmVhcmlzaF9kYWlseV9jYXAgPSBpbnQoQkVBUklTSF9NQVhfQUxFUlRTX1BFUl9EQVkpCiAgICAgICAgaWYgYmVhcmlzaF9kYWlseV9jYXAgPiAwOgogICAgICAgICAgICBpZiBwb2xpY3lbIm1heF9hbGVydHNfcGVyX2RheSJdID4gMDoKICAgICAgICAgICAgICAgIHBvbGljeVsibWF4X2FsZXJ0c19wZXJfZGF5Il0gPSBtaW4ocG9saWN5WyJtYXhfYWxlcnRzX3Blcl9kYXkiXSwgYmVhcmlzaF9kYWlseV9jYXApCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwb2xpY3lbIm1heF9hbGVydHNfcGVyX2RheSJdID0gYmVhcmlzaF9kYWlseV9jYXAKCiAgICAgICAgcG9saWN5WyJhbGVydF9jb29sZG93bl9ob3VycyJdID0gbWF4KHBvbGljeVsiYWxlcnRfY29vbGRvd25faG91cnMiXSwgaW50KEJFQVJJU0hfQUxFUlRfQ09PTERPV05fSE9VUlMpKQoKICAgIGlmIHN0YXRlID09ICJFWFRSRU1FX1JJU0tfT0ZGIiBhbmQgRU5BQkxFX0VYVFJFTUVfUklTS19IQVJEX0JMT0NLOgogICAgICAgIHBvbGljeVsiaGFyZF9ibG9jayJdID0gVHJ1ZQogICAgICAgIHBvbGljeVsiaGFyZF9ibG9ja19yZWFzb24iXSA9ICgKICAgICAgICAgICAgZiJFWFRSRU1FX1JJU0tfT0ZGIHNvbDI0aD17c29sX2NoYW5nZV8yNGg6LjJmfSUgc29sMWg9e3NvbF9jaGFuZ2VfMWg6LjJmfSUiCiAgICAgICAgKQoKICAgIHJldHVybiBwb2xpY3kKCgpkZWYgX3Bhc3Nlc19saXZlX3B1c2hfZ2F0ZSh0b2tlbjogZGljdCwgcG9saWN5OiBkaWN0KSAtPiBib29sOgogICAgaWYgbm90IFRFTEVHUkFNX1BVU0hfU1RST05HX09OTFk6CiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBjb25mID0gc3RyKHRva2VuLmdldCgiY29uZmlkZW5jZSIpIG9yICJDIikudXBwZXIoKQogICAgbWluX2NvbmYgPSBzdHIoVEVMRUdSQU1fUFVTSF9NSU5fQ09ORklERU5DRSBvciAiQSIpLnVwcGVyKCkKICAgIGlmIG1pbl9jb25mIG5vdCBpbiBfQ09ORklERU5DRV9PUkRFUjoKICAgICAgICBtaW5fY29uZiA9ICJBIgogICAgaWYgX0NPTkZJREVOQ0VfT1JERVIuZ2V0KGNvbmYsIDEpIDwgX0NPTkZJREVOQ0VfT1JERVJbbWluX2NvbmZdOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIHNjb3JlID0gZmxvYXQodG9rZW4uZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICBiYXNlX3RocmVzaG9sZCA9IGZsb2F0KHBvbGljeS5nZXQoImFsZXJ0X3RocmVzaG9sZCIsIF9ydW50aW1lWyJhbGVydF90aHJlc2hvbGQiXSkgb3IgMCkKICAgIHJlcXVpcmVkX3Njb3JlID0gYmFzZV90aHJlc2hvbGQgKyBtYXgoMCwgaW50KFRFTEVHUkFNX1BVU0hfTUlOX1NDT1JFX0RFTFRBKSkKICAgIHJldHVybiBzY29yZSA+PSByZXF1aXJlZF9zY29yZQoKCmRlZiBfcGFpcl9hZ2VfaG91cnMocGFpcl9jcmVhdGVkX2F0KToKICAgIGlmIHBhaXJfY3JlYXRlZF9hdCBpcyBOb25lOgogICAgICAgIHJldHVybiBOb25lCiAgICB0cnk6CiAgICAgICAgdHMgPSBmbG9hdChwYWlyX2NyZWF0ZWRfYXQpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIHRzIDw9IDA6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgICMgRGV4U2NyZWVuZXIgbWF5IHByb3ZpZGUgbWlsbGlzZWNvbmRzLgogICAgaWYgdHMgPiAxXzAwMF8wMDBfMDAwXzAwMDoKICAgICAgICB0cyA9IHRzIC8gMTAwMC4wCiAgICB0cnk6CiAgICAgICAgY3JlYXRlZCA9IGRhdGV0aW1lLnV0Y2Zyb210aW1lc3RhbXAodHMpCiAgICBleGNlcHQgKE92ZXJmbG93RXJyb3IsIE9TRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiBOb25lCiAgICBhZ2UgPSAoZGF0ZXRpbWUudXRjbm93KCkgLSBjcmVhdGVkKS50b3RhbF9zZWNvbmRzKCkgLyAzNjAwLjAKICAgIGlmIGFnZSA8IDA6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHJldHVybiBhZ2UKCgpkZWYgX3J1bm5lcl9uYXJyYXRpdmVfbGFiZWwodG9rZW4pOgogICAgdGV4dCA9IGYie3Rva2VuLmdldCgnc3ltYm9sJywgJycpfSB7dG9rZW4uZ2V0KCduYW1lJywgJycpfSB7dG9rZW4uZ2V0KCdkZXNjcmlwdGlvbicsICcnKX0iLmxvd2VyKCkKICAgIGhpdHMgPSBba3cgZm9yIGt3IGluIE5FV19SVU5ORVJfTkFSUkFUSVZFX0tFWVdPUkRTIGlmIGt3IGFuZCBrdyBpbiB0ZXh0XQogICAgc29jaWFsX2xpbmtzID0gaW50KHRva2VuLmdldCgic29jaWFsX2xpbmtzIikgb3IgMCkKICAgIGlmIGxlbihoaXRzKSA+PSAyIGFuZCBzb2NpYWxfbGlua3MgPiAwOgogICAgICAgIHJldHVybiAiU3Ryb25nIiwgbGVuKGhpdHMpCiAgICBpZiBsZW4oaGl0cykgPj0gMSBvciBzb2NpYWxfbGlua3MgPiAwOgogICAgICAgIHJldHVybiAiRGV2ZWxvcGluZyIsIGxlbihoaXRzKQogICAgcmV0dXJuICJXZWFrIiwgbGVuKGhpdHMpCgoKZGVmIF9ydW5uZXJfeF9wcm94eV9sYWJlbCh0b2tlbik6CiAgICB0eG5zX2gxID0gaW50KHRva2VuLmdldCgidHhuc19oMSIpIG9yIDApCiAgICBzb2NpYWxfbGlua3MgPSBpbnQodG9rZW4uZ2V0KCJzb2NpYWxfbGlua3MiKSBvciAwKQogICAgYm9vc3RzX2FjdGl2ZSA9IGludCh0b2tlbi5nZXQoImJvb3N0c19hY3RpdmUiKSBvciAwKQogICAgaWYgdHhuc19oMSA+PSBtYXgoMjUwLCBORVdfUlVOTkVSX01JTl9UWE5TX0gxICogMikgb3IgKHNvY2lhbF9saW5rcyA+IDEgYW5kIGJvb3N0c19hY3RpdmUgPiAwKToKICAgICAgICByZXR1cm4gIkhpZ2giCiAgICBpZiB0eG5zX2gxID49IE5FV19SVU5ORVJfTUlOX1RYTlNfSDE6CiAgICAgICAgcmV0dXJuICJNZWRpdW0iCiAgICByZXR1cm4gIkxvdyIKCgpkZWYgX3J1bm5lcl93YXRjaF9lbnJpY2godG9rZW4pOgogICAgYWdlX2hvdXJzID0gX3BhaXJfYWdlX2hvdXJzKHRva2VuLmdldCgicGFpcl9jcmVhdGVkX2F0IikpCiAgICBpZiBhZ2VfaG91cnMgaXMgTm9uZSBvciBhZ2VfaG91cnMgPiBORVdfUlVOTkVSX01BWF9BR0VfSE9VUlM6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBtYXJrZXRfY2FwID0gdG9rZW4uZ2V0KCJtYXJrZXRfY2FwIikKICAgIGZkdiA9IHRva2VuLmdldCgiZmR2IikKICAgIGNhcF92YWx1ZSA9IG1hcmtldF9jYXAgaWYgaXNpbnN0YW5jZShtYXJrZXRfY2FwLCAoaW50LCBmbG9hdCkpIGFuZCBtYXJrZXRfY2FwID4gMCBlbHNlIGZkdgogICAgaWYgbm90IGlzaW5zdGFuY2UoY2FwX3ZhbHVlLCAoaW50LCBmbG9hdCkpIG9yIGNhcF92YWx1ZSA8IE5FV19SVU5ORVJfTUlOX01BUktFVF9DQVA6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgdHhuc19oMSA9IGludCh0b2tlbi5nZXQoInR4bnNfaDEiKSBvciAwKQogICAgc29jaWFsX2xpbmtzID0gaW50KHRva2VuLmdldCgic29jaWFsX2xpbmtzIikgb3IgMCkKICAgIGJvb3N0c19hY3RpdmUgPSBpbnQodG9rZW4uZ2V0KCJib29zdHNfYWN0aXZlIikgb3IgMCkKCiAgICBpZiBsaXF1aWRpdHkgPCBORVdfUlVOTkVSX01JTl9MSVFVSURJVFk6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIHZvbHVtZV8yNGggPCBORVdfUlVOTkVSX01JTl9WT0xVTUVfMjRIOgogICAgICAgIHJldHVybiBOb25lCiAgICBpZiBjaGFuZ2VfMjRoIDwgTkVXX1JVTk5FUl9NSU5fQ0hBTkdFXzI0SDoKICAgICAgICByZXR1cm4gTm9uZQogICAgaWYgdHhuc19oMSA8IE5FV19SVU5ORVJfTUlOX1RYTlNfSDE6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIE5FV19SVU5ORVJfUkVRVUlSRV9TT0NJQUxfTElOS1MgYW5kIHNvY2lhbF9saW5rcyA8PSAwOgogICAgICAgIHJldHVybiBOb25lCgogICAgbmFycmF0aXZlX2xhYmVsLCBrZXl3b3JkX2hpdHMgPSBfcnVubmVyX25hcnJhdGl2ZV9sYWJlbCh0b2tlbikKICAgIHhfcHJveHlfbGFiZWwgPSBfcnVubmVyX3hfcHJveHlfbGFiZWwodG9rZW4pCgogICAgd2F0Y2hfc2NvcmUgPSAwLjAKICAgIHdhdGNoX3Njb3JlICs9IDIwLjAgICMgZmlyc3QtZGF5IGFnZSBjb25kaXRpb24gcGFzc2VkCiAgICB3YXRjaF9zY29yZSArPSAyMC4wIGlmIGNhcF92YWx1ZSA+PSBORVdfUlVOTkVSX01JTl9NQVJLRVRfQ0FQIGVsc2UgMC4wCiAgICB3YXRjaF9zY29yZSArPSAyMC4wIGlmIHZvbHVtZV8yNGggPj0gTkVXX1JVTk5FUl9NSU5fVk9MVU1FXzI0SCBlbHNlIDAuMAogICAgd2F0Y2hfc2NvcmUgKz0gMTUuMCBpZiBsaXF1aWRpdHkgPj0gTkVXX1JVTk5FUl9NSU5fTElRVUlESVRZIGVsc2UgMC4wCiAgICB3YXRjaF9zY29yZSArPSBtaW4oMTUuMCwgKHR4bnNfaDEgLyBtYXgoMSwgTkVXX1JVTk5FUl9NSU5fVFhOU19IMSkpICogMTUuMCkKICAgIHdhdGNoX3Njb3JlICs9IG1pbig1LjAsIGtleXdvcmRfaGl0cyAqIDIuNSkKICAgIHdhdGNoX3Njb3JlICs9IDUuMCBpZiBzb2NpYWxfbGlua3MgPiAwIGVsc2UgMC4wCiAgICB3YXRjaF9zY29yZSArPSAzLjAgaWYgYm9vc3RzX2FjdGl2ZSA+IDAgZWxzZSAwLjAKICAgIHdhdGNoX3Njb3JlID0gbWluKDEwMC4wLCB3YXRjaF9zY29yZSkKICAgIGlmIHdhdGNoX3Njb3JlIDwgTkVXX1JVTk5FUl9NSU5fQUxFUlRfU0NPUkU6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBlbnJpY2hlZCA9IGRpY3QodG9rZW4pCiAgICByaXNrX3BsYW4sIHJvdGF0aW9uX3BsYW4gPSBfd2FsbGV0X2d1aWRhbmNlKCJXMyIpCiAgICBlbnJpY2hlZC51cGRhdGUoCiAgICAgICAgewogICAgICAgICAgICAiYWdlX2hvdXJzIjogYWdlX2hvdXJzLAogICAgICAgICAgICAid2F0Y2hfc2NvcmUiOiB3YXRjaF9zY29yZSwKICAgICAgICAgICAgInhfcHJveHlfbGFiZWwiOiB4X3Byb3h5X2xhYmVsLAogICAgICAgICAgICAibmFycmF0aXZlX2xhYmVsIjogbmFycmF0aXZlX2xhYmVsLAogICAgICAgICAgICAid2FsbGV0X2ZpdCI6ICJXMyIsCiAgICAgICAgICAgICJyaXNrX3BsYW4iOiByaXNrX3BsYW4sCiAgICAgICAgICAgICJyb3RhdGlvbl9wbGFuIjogcm90YXRpb25fcGxhbiwKICAgICAgICAgICAgIm5vdGUiOiAiV2F0Y2hsaXN0LW9ubHkgYWxlcnQuIEVhcmx5IHJ1bm5lciB0byBtb25pdG9yLCBub3QgYSBidXkgc2lnbmFsLiIsCiAgICAgICAgfQogICAgKQogICAgcmV0dXJuIGVucmljaGVkCgoKZGVmIF9ydW5uZXJfd2F0Y2hfb25fY29vbGRvd24oc3ltYm9sOiBzdHIpIC0+IGJvb2w6CiAgICBpZiBub3Qgc3ltYm9sOgogICAgICAgIHJldHVybiBUcnVlCiAgICBsYXN0X3NlbnQgPSBnZXRfbGFzdF9kZWNpc2lvbl90aW1lc3RhbXBfZm9yX3N5bWJvbCgKICAgICAgICBzeW1ib2wsCiAgICAgICAgWyJSVU5ORVJfV0FUQ0hfQUxFUlQiLCAiUlVOTkVSX1dBVENIX0RSWV9SVU4iXSwKICAgICkKICAgIGlmIG5vdCBsYXN0X3NlbnQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gKGRhdGV0aW1lLnV0Y25vdygpIC0gbGFzdF9zZW50KSA8IHRpbWVkZWx0YShob3Vycz1ORVdfUlVOTkVSX0NPT0xET1dOX0hPVVJTKQoKCiMg4pSA4pSAIExFR0FDWSBSRUNPVkVSWSBoZWxwZXJzIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAoKX1JFVkVSU0FMX1BBVFRFUk5TID0geyJmYWxsaW5nX3dlZGdlIiwgImRvdWJsZV9ib3R0b20iLCAiY3VwX2hhbmRsZSIsICJjdXBfYW5kX2hhbmRsZSIsICJyZXZlcnNhbCJ9CgoKZGVmIF9kZXRlY3RfbGVnYWN5X3JlY292ZXJ5KHRva2VuOiBkaWN0KSAtPiBkaWN0IHwgTm9uZToKICAgICIiIgogICAgUmV0dXJucyBhbiBlbnJpY2hlZCB0b2tlbiBkaWN0IGlmIGl0IHBhc3NlcyBhbGwgTEVHQUNZIFJFQ09WRVJZIGNyaXRlcmlhLAogICAgb3IgTm9uZSBpZiBpdCBmYWlscyBhbnkgZmlsdGVyLgoKICAgIENyaXRlcmlhOgogICAgICAtIGFnZSA+PSBMRUdBQ1lfUkVDT1ZFUllfTUlOX0FHRV9EQVlTIChkZWZhdWx0IDkwIGRheXMpCiAgICAgIC0gbGlxdWlkaXR5ID49IExFR0FDWV9SRUNPVkVSWV9NSU5fTElRVUlESVRZIChkZWZhdWx0ICQxTSkKICAgICAgLSB2b2x1bWVfMjRoID49IExFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SCAoZGVmYXVsdCAkNTAwSykKICAgICAgLSB2b2x1bWUgc3Bpa2U6IHR4bnNfaDEgPj0gTEVHQUNZX1JFQ09WRVJZX1ZPTFVNRV9TUElLRV9NVUxUSVBMSUVSIMOXICh0eG5zX2gyNC8yNCkKICAgICAgLSByZXZlcnNhbC10eXBlIHBhdHRlcm4gKGZhbGxpbmcgd2VkZ2UgLyBkb3VibGUgYm90dG9tIC8gY3VwICYgaGFuZGxlKQogICAgICAgIGluZmVycmVkIGZyb20gcHJpY2UgYWN0aW9uIHdoZW4gbm8gZXhwbGljaXQgcGF0dGVybiBmaWVsZCBwcmVzZW50CiAgICAiIiIKICAgIGFnZV9ob3VycyA9IF9wYWlyX2FnZV9ob3Vycyh0b2tlbi5nZXQoInBhaXJfY3JlYXRlZF9hdCIpKQogICAgbWluX2FnZV9ob3VycyA9IExFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVMgKiAyNC4wCiAgICBpZiBhZ2VfaG91cnMgaXMgTm9uZSBvciBhZ2VfaG91cnMgPCBtaW5fYWdlX2hvdXJzOgogICAgICAgIHJldHVybiBOb25lCgogICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW4uZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKQogICAgaWYgbGlxdWlkaXR5IDwgTEVHQUNZX1JFQ09WRVJZX01JTl9MSVFVSURJVFk6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGlmIHZvbHVtZV8yNGggPCBMRUdBQ1lfUkVDT1ZFUllfTUlOX1ZPTFVNRV8yNEg6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAjIFZvbHVtZSBzcGlrZTogY29tcGFyZSBsYXN0LWhvdXIgdHhuIHJhdGUgdnMgMjRoIGF2ZXJhZ2UgcmF0ZQogICAgdHhuc19oMSA9IGZsb2F0KHRva2VuLmdldCgidHhuc19oMSIsIDApIG9yIDApCiAgICB0eG5zX2gyNCA9IGZsb2F0KHRva2VuLmdldCgidHhuc19oMjQiLCAwKSBvciAwKQogICAgYXZnX2hvdXJseSA9IHR4bnNfaDI0IC8gMjQuMCBpZiB0eG5zX2gyNCA+IDAgZWxzZSAwLjAKICAgIGhhc192b2x1bWVfc3Bpa2UgPSBhdmdfaG91cmx5ID4gMCBhbmQgdHhuc19oMSA+PSBMRUdBQ1lfUkVDT1ZFUllfVk9MVU1FX1NQSUtFX01VTFRJUExJRVIgKiBhdmdfaG91cmx5CgogICAgIyBSZXZlcnNhbCBwYXR0ZXJuIGRldGVjdGlvbgogICAgcGF0dGVybl9zZXR1cCA9IHRva2VuLmdldCgicGF0dGVybl9zZXR1cCIpCiAgICBleHBsaWNpdF9wYXR0ZXJuID0gIiIKICAgIGlmIGlzaW5zdGFuY2UocGF0dGVybl9zZXR1cCwgZGljdCk6CiAgICAgICAgZXhwbGljaXRfcGF0dGVybiA9IHN0cihwYXR0ZXJuX3NldHVwLmdldCgicGF0dGVybiIsICIiKSBvciAiIikubG93ZXIoKS5yZXBsYWNlKCIgIiwgIl8iKQogICAgZWxpZiBpc2luc3RhbmNlKHBhdHRlcm5fc2V0dXAsIHN0cik6CiAgICAgICAgZXhwbGljaXRfcGF0dGVybiA9IHBhdHRlcm5fc2V0dXAubG93ZXIoKS5yZXBsYWNlKCIgIiwgIl8iKQoKICAgIGhhc19yZXZlcnNhbF9wYXR0ZXJuID0gZXhwbGljaXRfcGF0dGVybiBpbiBfUkVWRVJTQUxfUEFUVEVSTlMKCiAgICAjIEluZmVyIHJldmVyc2FsIGZyb20gcHJpY2UgYWN0aW9uIHdoZW4gbm8gZXhwbGljaXQgcGF0dGVybjoKICAgICMgQSBkZWNsaW5pbmcgMjRoIGJ1dCBwb3NpdGl2ZSBvciByZWNvdmVyaW5nIDFoIHN1Z2dlc3RzIHBvdGVudGlhbCByZXZlcnNhbCBiYXNlCiAgICBpZiBub3QgaGFzX3JldmVyc2FsX3BhdHRlcm46CiAgICAgICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICAgICAgY2hhbmdlXzFoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMWgiLCAwKSBvciAwKQogICAgICAgIGNoYW5nZV82aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzZoIiwgMCkgb3IgMCkKICAgICAgICAjIERvdWJsZS1ib3R0b20gLyBmYWxsaW5nLXdlZGdlIHByb3h5OiBjb2luIHdhcyBkb3duIDI0aCBidXQgMWggaXMgcmVjb3ZlcmluZwogICAgICAgIGlmIC00MC4wIDwgY2hhbmdlXzI0aCA8IC01LjAgYW5kIGNoYW5nZV8xaCA+IDEuNToKICAgICAgICAgICAgaGFzX3JldmVyc2FsX3BhdHRlcm4gPSBUcnVlCiAgICAgICAgICAgIGV4cGxpY2l0X3BhdHRlcm4gPSAiZG91YmxlX2JvdHRvbSIKICAgICAgICAjIEN1cC1hbmQtaGFuZGxlIHByb3h5OiBtb2Rlc3QgMjRoIGRlY2xpbmUgYnV0IDZoIGFuZCAxaCBib3RoIHJlY292ZXJpbmcKICAgICAgICBlbGlmIC0yMC4wIDwgY2hhbmdlXzI0aCA8IDAgYW5kIGNoYW5nZV82aCA+IDAgYW5kIGNoYW5nZV8xaCA+IDAuNToKICAgICAgICAgICAgaGFzX3JldmVyc2FsX3BhdHRlcm4gPSBUcnVlCiAgICAgICAgICAgIGV4cGxpY2l0X3BhdHRlcm4gPSAiY3VwX2hhbmRsZSIKCiAgICBpZiBub3QgaGFzX3JldmVyc2FsX3BhdHRlcm46CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBpZiBub3QgaGFzX3ZvbHVtZV9zcGlrZToKICAgICAgICByZXR1cm4gTm9uZQoKICAgICMgTWFwIGludGVybmFsIHBhdHRlcm4ga2V5IHRvIGh1bWFuIGxhYmVsCiAgICBfcGF0dGVybl9sYWJlbHMgPSB7CiAgICAgICAgImZhbGxpbmdfd2VkZ2UiOiAiRmFsbGluZyBXZWRnZSIsCiAgICAgICAgImRvdWJsZV9ib3R0b20iOiAiRG91YmxlIEJvdHRvbSIsCiAgICAgICAgImN1cF9oYW5kbGUiOiAiQ3VwICYgSGFuZGxlIiwKICAgICAgICAiY3VwX2FuZF9oYW5kbGUiOiAiQ3VwICYgSGFuZGxlIiwKICAgICAgICAicmV2ZXJzYWwiOiAiUmV2ZXJzYWwiLAogICAgfQogICAgcGF0dGVybl9sYWJlbCA9IF9wYXR0ZXJuX2xhYmVscy5nZXQoZXhwbGljaXRfcGF0dGVybiwgIlJldmVyc2FsIikKICAgIHBhdHRlcm5fc3RhdHVzID0gIkNvbmZpcm1lZCIgaWYgdHhuc19oMSA+PSBhdmdfaG91cmx5ICogMyBlbHNlICJGb3JtaW5nIgogICAgYWdlX2RheXMgPSBhZ2VfaG91cnMgLyAyNC4wCgogICAgcmV0dXJuIHsKICAgICAgICAqKnRva2VuLAogICAgICAgICJhZ2VfZGF5cyI6IGFnZV9kYXlzLAogICAgICAgICJwYXR0ZXJuX2xhYmVsIjogcGF0dGVybl9sYWJlbCwKICAgICAgICAicGF0dGVybl9zdGF0dXMiOiBwYXR0ZXJuX3N0YXR1cywKICAgIH0KCgpkZWYgX2xlZ2FjeV9yZWNvdmVyeV9vbl9jb29sZG93bihzeW1ib2w6IHN0cikgLT4gYm9vbDoKICAgIGlmIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuIFRydWUKICAgIGxhc3Rfc2VudCA9IGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sKAogICAgICAgIHN5bWJvbCwKICAgICAgICBbIkxFR0FDWV9SRUNPVkVSWV9BTEVSVCIsICJMRUdBQ1lfUkVDT1ZFUllfRFJZX1JVTiJdLAogICAgKQogICAgaWYgbm90IGxhc3Rfc2VudDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiAoZGF0ZXRpbWUudXRjbm93KCkgLSBsYXN0X3NlbnQpIDwgdGltZWRlbHRhKGhvdXJzPUxFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9IT1VSUykKCgpkZWYgX2xvYWRfd2F0Y2hsaXN0X3N0YXRlKCk6CiAgICBnbG9iYWwgX3dhdGNobGlzdF9zdGF0ZQogICAgaWYgbm90IF9XQVRDSExJU1RfU1RBVEVfUEFUSC5leGlzdHMoKToKICAgICAgICBfd2F0Y2hsaXN0X3N0YXRlID0geyJzdGF0dXNlcyI6IHt9fQogICAgICAgIHJldHVybgogICAgdHJ5OgogICAgICAgIHJhdyA9IGpzb24ubG9hZHMoX1dBVENITElTVF9TVEFURV9QQVRILnJlYWRfdGV4dCgpKQogICAgICAgIHN0YXR1c2VzID0gcmF3LmdldCgic3RhdHVzZXMiKQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHN0YXR1c2VzLCBkaWN0KToKICAgICAgICAgICAgc3RhdHVzZXMgPSB7fQogICAgICAgIF93YXRjaGxpc3Rfc3RhdGUgPSB7InN0YXR1c2VzIjoge3N0cihrKS51cHBlcigpOiBzdHIodikgZm9yIGssIHYgaW4gc3RhdHVzZXMuaXRlbXMoKX19CiAgICBleGNlcHQgKFZhbHVlRXJyb3IsIE9TRXJyb3IpOgogICAgICAgIF93YXRjaGxpc3Rfc3RhdGUgPSB7InN0YXR1c2VzIjoge319CgoKZGVmIF9zYXZlX3dhdGNobGlzdF9zdGF0ZSgpOgogICAgdHJ5OgogICAgICAgIF9XQVRDSExJU1RfU1RBVEVfUEFUSC5wYXJlbnQubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgIF9XQVRDSExJU1RfU1RBVEVfUEFUSC53cml0ZV90ZXh0KGpzb24uZHVtcHMoX3dhdGNobGlzdF9zdGF0ZSwgaW5kZW50PTIpKQogICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgbG9nZ2luZy53YXJuaW5nKCJGYWlsZWQgdG8gcGVyc2lzdCB3YXRjaGxpc3Qgc3RhdGUgYXQgJXMiLCBfV0FUQ0hMSVNUX1NUQVRFX1BBVEgpCgoKZGVmIF93YXRjaGxpc3Rfc3RhdHVzX2Zvcl90b2tlbih0b2tlbjogZGljdCk6CiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8xaCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV82aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzZoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMC4wCgogICAgaWYgbGlxdWlkaXR5IDwgV0FUQ0hMSVNUX01JTl9MSVFVSURJVFkgb3Igdm9sdW1lXzI0aCA8IFdBVENITElTVF9NSU5fVk9MVU1FXzI0SDoKICAgICAgICByZXR1cm4gIklsbGlxdWlkIiwgKAogICAgICAgICAgICBmIkxpcXVpZGl0eS92b2x1bWUgYmVsb3cgd2F0Y2ggZmxvb3IgIgogICAgICAgICAgICBmIigke1dBVENITElTVF9NSU5fTElRVUlESVRZOiwuMGZ9LyR7V0FUQ0hMSVNUX01JTl9WT0xVTUVfMjRIOiwuMGZ9KS4iCiAgICAgICAgKQoKICAgIGlmIGNoYW5nZV8yNGggPj0gMTIgYW5kIGNoYW5nZV82aCA+PSA0IGFuZCBjaGFuZ2VfMWggPj0gMSBhbmQgdm9sX3RvX2xpcSA+PSAwLjM1OgogICAgICAgIHJldHVybiAiTW9tZW50dW0iLCAiTXVsdGktdGltZWZyYW1lIHN0cmVuZ3RoIHdpdGggc3VzdGFpbmVkIHR1cm5vdmVyLiIKICAgIGlmIGNoYW5nZV8yNGggPj0gMiBhbmQgY2hhbmdlXzZoIDw9IC0yIGFuZCBjaGFuZ2VfMWggPj0gMC44IGFuZCB2b2xfdG9fbGlxID49IDAuMjA6CiAgICAgICAgcmV0dXJuICJSZWNsYWltIiwgIlNob3J0LXRlcm0gcmVjbGFpbSBhZnRlciBwdWxsYmFjazsgYnV5ZXJzIHN0ZXBwaW5nIGJhY2sgaW4uIgogICAgaWYgY2hhbmdlXzFoIDw9IC0yLjUgYW5kIGNoYW5nZV82aCA8PSAtNjoKICAgICAgICByZXR1cm4gIkJyZWFrZG93biIsICJEb3duc2lkZSBwcmVzc3VyZSBhY2NlbGVyYXRpbmc7IHN0cnVjdHVyZSBsaWtlbHkgd2Vha2VuaW5nLiIKICAgIGlmIGFicyhjaGFuZ2VfMWgpIDw9IDEuMiBhbmQgYWJzKGNoYW5nZV82aCkgPD0gNCBhbmQgYWJzKGNoYW5nZV8yNGgpIDw9IDEyOgogICAgICAgIHJldHVybiAiUmFuZ2UiLCAiUmFuZ2UtYm91bmQgY29uZGl0aW9ucyB3aXRoIG5vIGNvbmZpcm1lZCBicmVhay4iCiAgICByZXR1cm4gIlZvbGF0aWxlIiwgIk1peGVkIHRhcGU7IG1vbWVudHVtIGFuZCBtZWFuLXJldmVyc2lvbiBzaWduYWxzIGNvbmZsaWN0LiIKCgpkZWYgX3dhdGNobGlzdF9vcHBvcnR1bml0eV90YWdzKHRva2VuOiBkaWN0LCBzdGF0dXM6IHN0cik6CiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8xaCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgdHhuc19oMSA9IGludCh0b2tlbi5nZXQoInR4bnNfaDEiKSBvciAwKQogICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMC4wCgogICAgdXBzaWRlX3BvaW50cyA9IDAuMAogICAgcmlza19wb2ludHMgPSAwLjAKICAgIHMgPSBzdHIoc3RhdHVzIG9yICIiKS50aXRsZSgpCgogICAgaWYgcyA9PSAiTW9tZW50dW0iOgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMi4wCiAgICBlbGlmIHMgPT0gIlJlY2xhaW0iOgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMS41CiAgICBlbGlmIHMgPT0gIkJyZWFrZG93biI6CiAgICAgICAgcmlza19wb2ludHMgKz0gMi41CiAgICBlbGlmIHMgPT0gIklsbGlxdWlkIjoKICAgICAgICByaXNrX3BvaW50cyArPSAzLjAKICAgIGVsaWYgcyA9PSAiVm9sYXRpbGUiOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuNQoKICAgIGlmIGNoYW5nZV8yNGggPj0gMTI6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAyLjAKICAgIGVsaWYgY2hhbmdlXzI0aCA+PSA1OgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMS4wCiAgICBlbGlmIGNoYW5nZV8yNGggPD0gLTEwOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuNQoKICAgIGlmIGNoYW5nZV8xaCA+PSAxLjA6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAxLjAKICAgIGVsaWYgY2hhbmdlXzFoIDw9IC0yLjA6CiAgICAgICAgcmlza19wb2ludHMgKz0gMS4yCgogICAgaWYgdHhuc19oMSA+PSAzMDA6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAxLjAKICAgIGVsaWYgdHhuc19oMSA+PSAxNTA6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAwLjUKCiAgICBpZiBsaXF1aWRpdHkgPj0gNzUwXzAwMDoKICAgICAgICB1cHNpZGVfcG9pbnRzICs9IDEuMAogICAgZWxpZiBsaXF1aWRpdHkgPCAyNTBfMDAwOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuMgoKICAgIGlmIHZvbHVtZV8yNGggPj0gMV81MDBfMDAwOgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMS4wCgogICAgaWYgdm9sX3RvX2xpcSA+IDIuMDoKICAgICAgICByaXNrX3BvaW50cyArPSAxLjUKICAgIGVsaWYgdm9sX3RvX2xpcSA+IDEuMDoKICAgICAgICByaXNrX3BvaW50cyArPSAxLjAKCiAgICBpZiBhYnMoY2hhbmdlXzI0aCkgPiAzNToKICAgICAgICByaXNrX3BvaW50cyArPSAxLjAKCiAgICBpZiB1cHNpZGVfcG9pbnRzID49IDUuMDoKICAgICAgICB1cHNpZGVfbGFiZWwgPSAiSGlnaCIKICAgIGVsaWYgdXBzaWRlX3BvaW50cyA+PSAzLjA6CiAgICAgICAgdXBzaWRlX2xhYmVsID0gIk1lZGl1bSIKICAgIGVsc2U6CiAgICAgICAgdXBzaWRlX2xhYmVsID0gIkxvdyIKCiAgICBpZiByaXNrX3BvaW50cyA+PSA0LjU6CiAgICAgICAgcmlza19sYWJlbCA9ICJIaWdoIgogICAgZWxpZiByaXNrX3BvaW50cyA+PSAyLjU6CiAgICAgICAgcmlza19sYWJlbCA9ICJNZWRpdW0iCiAgICBlbHNlOgogICAgICAgIHJpc2tfbGFiZWwgPSAiTG93IgoKICAgIHJldHVybiB1cHNpZGVfbGFiZWwsIHJpc2tfbGFiZWwKCgpkZWYgX3dhbGxldF9maXRfZm9yX21haW5fdG9rZW4odG9rZW46IGRpY3QsIHJlZ2ltZTogZGljdCwgcG9saWN5OiBkaWN0KSAtPiBzdHI6CiAgICBzY29yZSA9IGZsb2F0KHRva2VuLmdldCgic2NvcmUiLCAwKSBvciAwKQogICAgY29uZmlkZW5jZSA9IHN0cih0b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpKS51cHBlcigpCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8yNGggPSBhYnMoZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkpCiAgICByZWdpbWVfc2NvcmUgPSBmbG9hdChyZWdpbWUuZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICBzdGF0ZSA9IHN0cihwb2xpY3kuZ2V0KCJzdGF0ZSIpIG9yICIiKQoKICAgIGlmICgKICAgICAgICBjb25maWRlbmNlID09ICJBIgogICAgICAgIGFuZCBzY29yZSA+PSBtYXgoODguMCwgZmxvYXQocG9saWN5LmdldCgiYWxlcnRfdGhyZXNob2xkIiwgNzApKSArIDYuMCkKICAgICAgICBhbmQgbGlxdWlkaXR5ID49IDJfMDAwXzAwMAogICAgICAgIGFuZCB2b2x1bWVfMjRoID49IDFfMjAwXzAwMAogICAgICAgIGFuZCBjaGFuZ2VfMjRoIDw9IDI1CiAgICAgICAgYW5kIHJlZ2ltZV9zY29yZSA+PSA1NQogICAgICAgIGFuZCBzdGF0ZSBpbiB7IlJJU0tfT04iLCAiTkVVVFJBTCJ9CiAgICApOgogICAgICAgIHJldHVybiAiVzEvVzIiCgogICAgaWYgKAogICAgICAgIF9jb25maWRlbmNlX21lZXRzX3J1bGUoY29uZmlkZW5jZSwgIkEiKQogICAgICAgIGFuZCBzY29yZSA+PSBmbG9hdChwb2xpY3kuZ2V0KCJhbGVydF90aHJlc2hvbGQiLCA3MCkpCiAgICAgICAgYW5kIGxpcXVpZGl0eSA+PSA3MDBfMDAwCiAgICAgICAgYW5kIHZvbHVtZV8yNGggPj0gMjUwXzAwMAogICAgKToKICAgICAgICByZXR1cm4gIlcyIgoKICAgIHJldHVybiAiVzMiCgoKZGVmIF93YWxsZXRfZ3VpZGFuY2Uod2FsbGV0X2ZpdDogc3RyKToKICAgIGZpdCA9IHN0cih3YWxsZXRfZml0IG9yICJXMiIpLnVwcGVyKCkKICAgIGlmIGZpdCA9PSAiVzEvVzIiOgogICAgICAgIHJpc2sgPSAiVGllcmVkIGVudHJpZXMgfCBhdm9pZCBjaGFzaW5nID4xNSUgY2FuZGxlcyB8IHRoZXNpcyBzdG9wIG9ubHkiCiAgICAgICAgcm90YXRpb24gPSAiVGFrZSBwYXJ0aWFscyBpbnRvIFcxIHN0YWtpbmcvVVNEQyB3aGlsZSBwcmVzZXJ2aW5nIGNvcmUiCiAgICAgICAgcmV0dXJuIHJpc2ssIHJvdGF0aW9uCiAgICBpZiBmaXQgPT0gIlcyIjoKICAgICAgICBwYiA9IF9XQUxMRVRfUExBWUJPT0tbIlcyIl0KICAgICAgICByZXR1cm4gcGJbInJpc2tfcGxhbiJdLCBwYlsicm90YXRpb25fcGxhbiJdCiAgICBwYiA9IF9XQUxMRVRfUExBWUJPT0tbIlczIl0KICAgIHJldHVybiBwYlsicmlza19wbGFuIl0sIHBiWyJyb3RhdGlvbl9wbGFuIl0KCgpkZWYgX3dhbGxldF9oZWFkZXIod2FsbGV0X2lkOiBzdHIpIC0+IHN0cjoKICAgIHBiID0gX1dBTExFVF9QTEFZQk9PSy5nZXQod2FsbGV0X2lkLCBfV0FMTEVUX1BMQVlCT09LWyJXMiJdKQogICAgcmV0dXJuICgKICAgICAgICBmInt3YWxsZXRfaWR9IHwge3BiWyduYW1lJ119XG4iCiAgICAgICAgZiJQb3NpdGlvbjoge3BiWydwb3NpdGlvbl9oaW50J119XG4iCiAgICAgICAgZiJSaXNrOiB7cGJbJ3Jpc2tfcGxhbiddfVxuIgogICAgICAgIGYiUm90YXRpb246IHtwYlsncm90YXRpb25fcGxhbiddfSIKICAgICkKCgpkZWYgX3dhdGNobGlzdF9vbl9jb29sZG93bihzeW1ib2w6IHN0cikgLT4gYm9vbDoKICAgIGlmIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBsYXN0X3NlbnQgPSBnZXRfbGFzdF9kZWNpc2lvbl90aW1lc3RhbXBfZm9yX3N5bWJvbCgKICAgICAgICBzeW1ib2wsCiAgICAgICAgWyJXQVRDSExJU1RfQUxFUlQiLCAiV0FUQ0hMSVNUX0FMRVJUX0RSWV9SVU4iXSwKICAgICkKICAgIGlmIG5vdCBsYXN0X3NlbnQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gKGRhdGV0aW1lLnV0Y25vdygpIC0gbGFzdF9zZW50KSA8IHRpbWVkZWx0YShob3Vycz1XQVRDSExJU1RfQUxFUlRfQ09PTERPV05fSE9VUlMpCgoKZGVmIF9idWlsZF93YXRjaGxpc3Rfcm93cygpOgogICAgaW1wb3J0IHRpbWUgYXMgX3RpbWUKICAgIHJvd3MgPSBbXQogICAgaWYgbm90IFdBVENITElTVF9FTlRSSUVTOgogICAgICAgIHJldHVybiByb3dzCgogICAgZm9yIGVudHJ5IGluIFdBVENITElTVF9FTlRSSUVTOgogICAgICAgIGNvbmZpZ3VyZWRfc3ltYm9sID0gc3RyKGVudHJ5LmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkKICAgICAgICBhZGRyZXNzID0gc3RyKGVudHJ5LmdldCgiYWRkcmVzcyIpIG9yICIiKS5zdHJpcCgpCiAgICAgICAgaWYgbm90IGFkZHJlc3M6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgc3ltYm9sID0gY29uZmlndXJlZF9zeW1ib2wgb3IgIlVOS05PV04iCiAgICAgICAgcHJldmlvdXNfc3RhdHVzID0gc3RyKF93YXRjaGxpc3Rfc3RhdGUuZ2V0KCJzdGF0dXNlcyIsIHt9KS5nZXQoc3ltYm9sKSBvciAiIikKCiAgICAgICAgX3RpbWUuc2xlZXAoMC4zNSkKICAgICAgICBzbmFwc2hvdCA9IGZldGNoX2RleHNjcmVlbmVyX3Rva2VuX3NuYXBzaG90KGFkZHJlc3MpCiAgICAgICAgaWYgbm90IHNuYXBzaG90OgogICAgICAgICAgICByaXNrX3BsYW4sIHJvdGF0aW9uX3BsYW4gPSBfd2FsbGV0X2d1aWRhbmNlKCJXMyIpCiAgICAgICAgICAgIHJvd3MuYXBwZW5kKAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgImFkZHJlc3MiOiBhZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICJzdGF0dXMiOiBwcmV2aW91c19zdGF0dXMgb3IgIk5vRGF0YSIsCiAgICAgICAgICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgICAgICAgICAgIkxpdmUgZGF0YSB1bmF2YWlsYWJsZTsgc2hvd2luZyBsYXN0IGtub3duIHN0YXR1cy4iCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHByZXZpb3VzX3N0YXR1cwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlICJObyBsaXZlIERleFNjcmVlbmVyIHBhaXIgZm91bmQuIgogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgImVsaWdpYmxlIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImhhc19saXZlX2RhdGEiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAid2FsbGV0X2ZpdCI6ICJXMyIsCiAgICAgICAgICAgICAgICAgICAgInJpc2tfcGxhbiI6IHJpc2tfcGxhbiwKICAgICAgICAgICAgICAgICAgICAicm90YXRpb25fcGxhbiI6IHJvdGF0aW9uX3BsYW4sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgcm93ID0gZGljdChzbmFwc2hvdCkKICAgICAgICBpZiBjb25maWd1cmVkX3N5bWJvbCBhbmQgY29uZmlndXJlZF9zeW1ib2wgIT0gIldBVENIIjoKICAgICAgICAgICAgcm93WyJzeW1ib2wiXSA9IGNvbmZpZ3VyZWRfc3ltYm9sCiAgICAgICAgc3RhdHVzLCByZWFzb24gPSBfd2F0Y2hsaXN0X3N0YXR1c19mb3JfdG9rZW4ocm93KQogICAgICAgIHVwc2lkZSwgcmlzayA9IF93YXRjaGxpc3Rfb3Bwb3J0dW5pdHlfdGFncyhyb3csIHN0YXR1cykKICAgICAgICByb3dbInN0YXR1cyJdID0gc3RhdHVzCiAgICAgICAgcm93WyJyZWFzb24iXSA9IHJlYXNvbgogICAgICAgIHJvd1sidXBzaWRlX3BvdGVudGlhbCJdID0gdXBzaWRlCiAgICAgICAgcm93WyJmYWlsdXJlX3Jpc2siXSA9IHJpc2sKICAgICAgICByb3dbImVsaWdpYmxlIl0gPSBzdGF0dXMgIT0gIklsbGlxdWlkIgogICAgICAgIHJvd1siaGFzX2xpdmVfZGF0YSJdID0gVHJ1ZQogICAgICAgIHJvd1sid2FsbGV0X2ZpdCJdID0gIlczIgogICAgICAgIHJpc2tfcGxhbiwgcm90YXRpb25fcGxhbiA9IF93YWxsZXRfZ3VpZGFuY2UoIlczIikKICAgICAgICByb3dbInJpc2tfcGxhbiJdID0gcmlza19wbGFuCiAgICAgICAgcm93WyJyb3RhdGlvbl9wbGFuIl0gPSByb3RhdGlvbl9wbGFuCiAgICAgICAgcm93cy5hcHBlbmQocm93KQoKICAgIHJldHVybiByb3dzCgoKYXN5bmMgZGVmIHNlbmRfd2F0Y2hsaXN0X3N1bW1hcnkoY29udGV4dCk6CiAgICByb3dzID0gX2J1aWxkX3dhdGNobGlzdF9yb3dzKCkKICAgIGlmIG5vdCByb3dzOgogICAgICAgIHJldHVybgogICAgbWVzc2FnZSA9IGZvcm1hdF93YXRjaGxpc3Rfc3VtbWFyeShyb3dzKQogICAgaWYgRFJZX1JVTjoKICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gV2F0Y2hsaXN0IHN1bW1hcnkgbm90IHNlbnQuXG4lcyIsIG1lc3NhZ2UpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgdGV4dD1tZXNzYWdlLAogICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgKQogICAgbG9nX3NpZ25hbCgKICAgICAgICB7CiAgICAgICAgICAgICJzeW1ib2wiOiAiV0FUQ0hMSVNUIiwKICAgICAgICAgICAgImRlY2lzaW9uIjogIldBVENITElTVF9TVU1NQVJZIiwKICAgICAgICAgICAgIm5vdGVzIjogZiJyb3dzPXtsZW4ocm93cyl9IiwKICAgICAgICB9CiAgICApCgoKYXN5bmMgZGVmIHJ1bl93YXRjaGxpc3RfbGFuZShjb250ZXh0KToKICAgIGlmIG5vdCBXQVRDSExJU1RfTEFORV9FTkFCTEVEIG9yIG5vdCBXQVRDSExJU1RfRU5UUklFUzoKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBwcmludCgiUnVubmluZyB3YXRjaGxpc3QgbGFuZSBzY2FuLi4uIikKICAgICAgICByb3dzID0gX2J1aWxkX3dhdGNobGlzdF9yb3dzKCkKICAgICAgICBpZiBub3Qgcm93czoKICAgICAgICAgICAgcHJpbnQoIldhdGNobGlzdCBsYW5lOiBubyByb3dzLiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICByb3dzLnNvcnQoCiAgICAgICAgICAgIGtleT1sYW1iZGEgcjogKAogICAgICAgICAgICAgICAgc3RyKHIuZ2V0KCJzdGF0dXMiLCAiIikpIG5vdCBpbiBzZXQoV0FUQ0hMSVNUX0FMRVJUX1NUQVRVU0VTKSwKICAgICAgICAgICAgICAgIC0oZmxvYXQoci5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKSksCiAgICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIGFsZXJ0c19zZW50ID0gMAogICAgICAgIG1heF9wZXJfY3ljbGUgPSBtYXgoMSwgV0FUQ0hMSVNUX01BWF9BTEVSVFNfUEVSX0NZQ0xFKQogICAgICAgIG5vX2RhdGFfY291bnQgPSAwCgogICAgICAgIGZvciByb3cgaW4gcm93czoKICAgICAgICAgICAgc3ltYm9sID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgICAgICBzdGF0dXMgPSBzdHIocm93LmdldCgic3RhdHVzIikgb3IgIlVua25vd24iKS50aXRsZSgpCiAgICAgICAgICAgIGhhc19saXZlX2RhdGEgPSBib29sKHJvdy5nZXQoImhhc19saXZlX2RhdGEiLCBUcnVlKSkKICAgICAgICAgICAgaWYgbm90IGhhc19saXZlX2RhdGE6CiAgICAgICAgICAgICAgICBub19kYXRhX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHByZXZpb3VzX3N0YXR1cyA9IHN0cihfd2F0Y2hsaXN0X3N0YXRlLmdldCgic3RhdHVzZXMiLCB7fSkuZ2V0KHN5bWJvbCkgb3IgIiIpCiAgICAgICAgICAgIGNoYW5nZWQgPSBwcmV2aW91c19zdGF0dXMgIT0gc3RhdHVzCiAgICAgICAgICAgIF93YXRjaGxpc3Rfc3RhdGUuc2V0ZGVmYXVsdCgic3RhdHVzZXMiLCB7fSlbc3ltYm9sXSA9IHN0YXR1cwoKICAgICAgICAgICAgaWYgc3RhdHVzIG5vdCBpbiBXQVRDSExJU1RfQUxFUlRfU1RBVFVTRVM6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBub3Qgcm93LmdldCgiZWxpZ2libGUiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBXQVRDSExJU1RfQUxFUlRfT05fU1RBVFVTX0NIQU5HRSBhbmQgbm90IGNoYW5nZWQ6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBfd2F0Y2hsaXN0X29uX2Nvb2xkb3duKHN5bWJvbCk6CiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiByb3cuZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJXQVRDSExJU1RfQ09PTERPV05fU0tJUCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJub3RlcyI6IGYic3RhdHVzPXtzdGF0dXN9IGNvb2xkb3duX2g9e1dBVENITElTVF9BTEVSVF9DT09MRE9XTl9IT1VSU30iLAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIGFsZXJ0c19zZW50ID49IG1heF9wZXJfY3ljbGU6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgbXNnID0gZm9ybWF0X3dhdGNobGlzdF9zaWduYWwocm93LCBjb21wYWN0PVRydWUpCiAgICAgICAgICAgIGRlY2lzaW9uID0gIldBVENITElTVF9BTEVSVCIKICAgICAgICAgICAgaWYgRFJZX1JVTjoKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIldBVENITElTVF9BTEVSVF9EUllfUlVOIgogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIFdhdGNobGlzdCBhbGVydCBzdXBwcmVzc2VkIGZvciAlcyIsIHN5bWJvbCkKICAgICAgICAgICAgZWxpZiBURUxFR1JBTV9RVUlFVF9NT0RFIGFuZCBjb250ZXh0LmpvYiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGRlY2lzaW9uID0gIldBVENITElTVF9BTEVSVF9RVUlFVF9NT0RFIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICAgICAgICAgIHRleHQ9bXNnLAogICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1fYnVpbGRfYWxlcnRfa2V5Ym9hcmQoCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgcm93LmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICAgICByb3cuZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgbG9nX3NpZ25hbCgKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICJtaW50Ijogcm93LmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJwYWlyX2FkZHJlc3MiOiByb3cuZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAibGlxdWlkaXR5Ijogcm93LmdldCgibGlxdWlkaXR5IiksCiAgICAgICAgICAgICAgICAgICAgInZvbHVtZV8yNGgiOiByb3cuZ2V0KCJ2b2x1bWVfMjRoIiksCiAgICAgICAgICAgICAgICAgICAgInByaWNlIjogcm93LmdldCgicHJpY2UiKSwKICAgICAgICAgICAgICAgICAgICAiY2hhbmdlXzI0aCI6IHJvdy5nZXQoImNoYW5nZV8yNGgiKSwKICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiBkZWNpc2lvbiwKICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiBmInN0YXR1cz17c3RhdHVzfSByZWFzb249e3Jvdy5nZXQoJ3JlYXNvbicsICcnKX0iLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIGFsZXJ0c19zZW50ICs9IDEKCiAgICAgICAgX3NhdmVfd2F0Y2hsaXN0X3N0YXRlKCkKICAgICAgICBpZiBub19kYXRhX2NvdW50OgogICAgICAgICAgICBsb2dnaW5nLmluZm8oIldhdGNobGlzdCBsYW5lOiBsaXZlIGRhdGEgdW5hdmFpbGFibGUgZm9yICVkIHRva2VuKHMpIHRoaXMgY3ljbGUuIiwgbm9fZGF0YV9jb3VudCkKICAgICAgICBpZiBhbGVydHNfc2VudCA9PSAwOgogICAgICAgICAgICBwcmludCgiV2F0Y2hsaXN0IGxhbmU6IG5vIHN0YXR1cy1jaGFuZ2UgYWxlcnRzIHRoaXMgY3ljbGUuIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjOgogICAgICAgIHByaW50KCJXQVRDSExJU1QgTEFORSBFUlJPUjoiLCByZXByKGV4YykpCgoKZGVmIF9mb3JtYXRfZGFpbHlfc3VtbWFyeShzdW1tYXJ5LCBvdXRjb21lX3JlY2FwPU5vbmUpOgogICAgc2VwID0gIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIKICAgIHRvcF9zeW1ib2xzID0gc3VtbWFyeS5nZXQoInRvcF9hbGVydF9zeW1ib2xzIiwgW10pCiAgICB0b3BfbGluZSA9ICIsICIuam9pbihmIiR7cm93WydzeW1ib2wnXX0oe3Jvd1snYWxlcnRzJ119KSIgZm9yIHJvdyBpbiB0b3Bfc3ltYm9scykgaWYgdG9wX3N5bWJvbHMgZWxzZSAiTm9uZSIKICAgIGxpbmVzID0gWwogICAgICAgIGYiPGI+8J+ThSBbU0lHTkFMXTogREFJTFkgU1VNTUFSWTwvYj4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflZAgV0lORE9XOiAyNEg8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflI0gU0NBTlM6IHtfZXNjX2h0bWxfbWFpbihzdHIoc3VtbWFyeVsnc2NhbnMnXSkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+aqCBBTEVSVFM6IHtfZXNjX2h0bWxfbWFpbihzdHIoc3VtbWFyeVsnYWxlcnRzJ10pKX0gKHtzdW1tYXJ5WydhbGVydF9yYXRlJ106LjFmfSUgcmF0ZSk8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKtkCBBVkcgU0NPUkU6IHtzdW1tYXJ5Wydhdmdfc2NvcmUnXTouMmZ9IHwgTUFYOiB7c3VtbWFyeVsnbWF4X3Njb3JlJ106LjJmfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+PhiBUT1A6IHtfZXNjX2h0bWxfbWFpbih0b3BfbGluZSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TiyBSRUNBUCAoMjRIKTwvY29kZT4iLAogICAgXQogICAgcmVjYXBfcm93cyA9IG91dGNvbWVfcmVjYXAgb3IgW10KICAgIGlmIHJlY2FwX3Jvd3M6CiAgICAgICAgZm9yIGlkeCwgcm93IGluIGVudW1lcmF0ZShyZWNhcF9yb3dzWzo2XSwgc3RhcnQ9MSk6CiAgICAgICAgICAgIHN5bWJvbCA9IHN0cihyb3cuZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIpLnVwcGVyKCkKICAgICAgICAgICAgYWxlcnRzID0gaW50KHJvdy5nZXQoImFsZXJ0cyIpIG9yIDApCiAgICAgICAgICAgIGF2Z180aCA9IHJvdy5nZXQoImF2Z180aCIpCiAgICAgICAgICAgIG5fNGggPSBpbnQocm93LmdldCgibl80aCIpIG9yIDApCiAgICAgICAgICAgIHdpbnNfNGggPSBpbnQocm93LmdldCgid2luc180aCIpIG9yIDApCiAgICAgICAgICAgIGF2Z180aF90ZXh0ID0gZiJ7ZmxvYXQoYXZnXzRoKTorLjJmfSUiIGlmIGF2Z180aCBpcyBub3QgTm9uZSBlbHNlICJOL0EiCiAgICAgICAgICAgIHdpbl9yYXRlX3RleHQgPSBmInsod2luc180aCAvIG5fNGggKiAxMDAuMCk6LjBmfSUiIGlmIG5fNGggPiAwIGVsc2UgIk4vQSIKICAgICAgICAgICAgcmVzdWx0X2Vtb2ppID0gIuKchSIgaWYgYXZnXzRoIGlzIG5vdCBOb25lIGFuZCBmbG9hdChhdmdfNGgpID4gMCBlbHNlICLinYwiCiAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgKICAgICAgICAgICAgICAgIGYiPGNvZGU+e3Jlc3VsdF9lbW9qaX0ge2lkeH0uICR7X2VzY19odG1sX21haW4oc3ltYm9sKX0gfCB7YWxlcnRzfSBhbGVydHMgfCA0aCB7X2VzY19odG1sX21haW4oYXZnXzRoX3RleHQpfSB8IHdpbiB7X2VzY19odG1sX21haW4od2luX3JhdGVfdGV4dCl9ICh7d2luc180aH0ve25fNGh9KTwvY29kZT4iCiAgICAgICAgICAgICkKICAgIGVsc2U6CiAgICAgICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+4pqqIE5vIGV2YWx1YXRlZCBvdXRjb21lcyB5ZXQuPC9jb2RlPiIpCiAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKQoKCmRlZiBfZm9ybWF0X3dlZWtseV90dW5pbmdfcmVwb3J0KHJlcG9ydCk6CiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgY3VycmVudCA9IHJlcG9ydFsiY3VycmVudCJdCiAgICByZWNvbW1lbmRlZCA9IHJlcG9ydFsicmVjb21tZW5kZWQiXQogICAgcmVhc29ucyA9IFtzdHIocikgZm9yIHIgaW4gcmVwb3J0WyJyZWFzb25zIl1dCiAgICBwZiA9IHJlcG9ydC5nZXQoInBvcnRmb2xpb180aCIsIHt9KQogICAgb3B0aW1pemVyID0gcmVwb3J0LmdldCgib3B0aW1pemVyIikKCiAgICBlID0gX2VzY19odG1sX21haW4KICAgIGxpbmVzID0gWwogICAgICAgIGYiPGI+8J+TiiBbU0lHTkFMXTogV0VFS0xZIFRVTklORzwvYj4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflZAgV0lORE9XOiA3RDwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+UjSBTQ0FOUzoge2Uoc3RyKHJlcG9ydFsnc2Nhbl9ydW5zJ10pKX0gfCBCRVNUOiB7ZShzdHIocmVwb3J0WydzY2FuX2Jlc3QnXSkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+aqCBBTEVSVFM6IHtlKHN0cihyZXBvcnRbJ2FsZXJ0cyddKSl9ICh7cmVwb3J0WydhbGVydF9yYXRlJ106LjFmfSUgcmF0ZSkgfCBCTE9DSzoge3JlcG9ydFsnYmxvY2tfcmF0ZSddOi4xZn0lPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7irZAgU0NPUkVTIFA1MC83NS85MDoge3JlcG9ydFsncDUwX3Njb3JlJ106LjBmfS97cmVwb3J0WydwNzVfc2NvcmUnXTouMGZ9L3tyZXBvcnRbJ3A5MF9zY29yZSddOi4wZn08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OIIEVER0U8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPiAgMUg6ICB7cmVwb3J0WydhdmdfcmV0dXJuXzFoJ106Ky4yZn0lIHwgd2luIHtyZXBvcnRbJ3dpbnJhdGVfMWgnXTouMGZ9JSB8IG49e3JlcG9ydFsnb3V0Y29tZXNfMWhfY291bnQnXX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPiAgNEg6ICB7cmVwb3J0WydhdmdfcmV0dXJuXzRoJ106Ky4yZn0lIHwgd2luIHtyZXBvcnRbJ3dpbnJhdGVfNGgnXTouMGZ9JSB8IG49e3JlcG9ydFsnb3V0Y29tZXNfNGhfY291bnQnXX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPiAgMjRIOiB7cmVwb3J0WydhdmdfcmV0dXJuXzI0aCddOisuMmZ9JSB8IHdpbiB7cmVwb3J0Wyd3aW5yYXRlXzI0aCddOi4wZn0lIHwgbj17cmVwb3J0WydvdXRjb21lc18yNGhfY291bnQnXX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfp64gU0lNIDRIOiB7cGYuZ2V0KCd0cmFkZXMnLCAwKX0gdHJhZGVzIHwgZXhwIHtwZi5nZXQoJ2V4cGVjdGFuY3lfcGN0JywgMCk6LjJmfSUgfCBERCB7cGYuZ2V0KCdtYXhfZHJhd2Rvd25fcGN0JywgMCk6LjJmfSU8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7impnvuI8gU0VUVElOR1M8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPiAgQ1VSUkVOVCDihpIgdGhyIHtlKHN0cihjdXJyZW50WydhbGVydF90aHJlc2hvbGQnXSkpfSB8IHJlZyB7ZShzdHIoY3VycmVudFsncmVnaW1lX21pbl9zY29yZSddKSl9IHwgY29uZiB7ZShzdHIoY3VycmVudFsnbWluX2NvbmZpZGVuY2VfdG9fYWxlcnQnXSkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+ICBORVcgICAgIOKGkiB0aHIge2Uoc3RyKHJlY29tbWVuZGVkWydhbGVydF90aHJlc2hvbGQnXSkpfSB8IHJlZyB7ZShzdHIocmVjb21tZW5kZWRbJ3JlZ2ltZV9taW5fc2NvcmUnXSkpfSB8IGNvbmYge2Uoc3RyKHJlY29tbWVuZGVkWydtaW5fY29uZmlkZW5jZV90b19hbGVydCddKSl9PC9jb2RlPiIsCiAgICBdCiAgICBpZiBvcHRpbWl6ZXI6CiAgICAgICAgbGluZXMuYXBwZW5kKAogICAgICAgICAgICBmIjxjb2RlPvCflKcgT1BUOiB0aHIge2Uoc3RyKG9wdGltaXplclsnYWxlcnRfdGhyZXNob2xkJ10pKX0gcmVnIHtlKHN0cihvcHRpbWl6ZXJbJ3JlZ2ltZV9taW5fc2NvcmUnXSkpfSBjb25mIHtlKHN0cihvcHRpbWl6ZXJbJ21pbl9jb25maWRlbmNlX3RvX2FsZXJ0J10pKX0gbj17ZShzdHIob3B0aW1pemVyWydzYW1wbGVzJ10pKX08L2NvZGU+IgogICAgICAgICkKICAgIGxpbmVzLmFwcGVuZChmIjxjb2RlPntzZXB9PC9jb2RlPiIpCiAgICBsaW5lcy5hcHBlbmQoZiI8Y29kZT7wn5OdIFJBVElPTkFMRTwvY29kZT4iKQogICAgZm9yIHJlYXNvbiBpbiAocmVhc29uc1s6NF0gaWYgcmVhc29ucyBlbHNlIFsiTm8gcmF0aW9uYWxlIGF2YWlsYWJsZSJdKToKICAgICAgICBsaW5lcy5hcHBlbmQoZiI8Y29kZT4gIOKAoiB7ZShyZWFzb24pfTwvY29kZT4iKQogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCgphc3luYyBkZWYgc2VuZF9kYWlseV9zdW1tYXJ5KGNvbnRleHQpOgogICAgc3VtbWFyeSA9IGdldF9wZXJmb3JtYW5jZV9zdW1tYXJ5KGxvb2tiYWNrX2hvdXJzPTI0KQogICAgcmVjYXAgPSBnZXRfYWxlcnRfb3V0Y29tZV9yZWNhcChsb29rYmFja19ob3Vycz0yNCwgbGltaXQ9OCkKICAgIG1lc3NhZ2UgPSBfZm9ybWF0X2RhaWx5X3N1bW1hcnkoc3VtbWFyeSwgb3V0Y29tZV9yZWNhcD1yZWNhcCkKICAgIGlmIERSWV9SVU46CiAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIERhaWx5IHN1bW1hcnkgbm90IHNlbnQuXG4lcyIsIG1lc3NhZ2UpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgdGV4dD1tZXNzYWdlLAogICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgKQoKCmFzeW5jIGRlZiBzZW5kX3dlZWtseV90dW5pbmdfcmVwb3J0KGNvbnRleHQpOgogICAgcmVwb3J0ID0gZ2V0X3dlZWtseV90dW5pbmdfcmVwb3J0KAogICAgICAgIGxvb2tiYWNrX2RheXM9V0VFS0xZX1RVTklOR19MT09LQkFDS19EQVlTLAogICAgICAgIGN1cnJlbnRfYWxlcnRfdGhyZXNob2xkPUFMRVJUX1RIUkVTSE9MRCwKICAgICAgICBjdXJyZW50X3JlZ2ltZV9taW5fc2NvcmU9UkVHSU1FX01JTl9TQ09SRSwKICAgICAgICBjdXJyZW50X21pbl9jb25maWRlbmNlX3RvX2FsZXJ0PU1JTl9DT05GSURFTkNFX1RPX0FMRVJULAogICAgICAgIG1pbl9vdXRjb21lc180aD1XRUVLTFlfVFVOSU5HX01JTl9PVVRDT01FU180SCwKICAgICkKICAgIG1lc3NhZ2UgPSBfZm9ybWF0X3dlZWtseV90dW5pbmdfcmVwb3J0KHJlcG9ydCkKICAgIGlmIERSWV9SVU46CiAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIFdlZWtseSB0dW5pbmcgcmVwb3J0IG5vdCBzZW50LlxuJXMiLCBtZXNzYWdlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgIHRleHQ9bWVzc2FnZSwKICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICkKCgpkZWYgX3VwZGF0ZV9zeW1ib2xfY29udHJvbF9mcm9tX291dGNvbWVzKHN5bWJvbDogc3RyKToKICAgIGlmIG5vdCBTWU1CT0xfQ09OVFJPTF9FTkFCTEVEIG9yIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuCiAgICBzdGF0cyA9IGdldF9zeW1ib2xfb3V0Y29tZV9zdGF0cyhzeW1ib2wsIGxvb2tiYWNrX2RheXM9MzApCiAgICByZXR1cm5zXzRoID0gc3RhdHMuZ2V0KCJyZXR1cm5zXzRoIiwgW10pCiAgICByZXR1cm5zXzI0aCA9IHN0YXRzLmdldCgicmV0dXJuc18yNGgiLCBbXSkKICAgIGF2Z18yNGggPSBmbG9hdChzdGF0cy5nZXQoImF2Z18yNGgiLCAwKSBvciAwKQoKICAgIGlmIGxlbihyZXR1cm5zXzI0aCkgPj0gU1lNQk9MX0JMQUNLTElTVF9NSU5fU0FNUExFUyBhbmQgYXZnXzI0aCA8PSBTWU1CT0xfQkxBQ0tMSVNUX0FWR18yNEhfUENUOgogICAgICAgIHNldF9zeW1ib2xfY29udHJvbCgKICAgICAgICAgICAgc3ltYm9sPXN5bWJvbCwKICAgICAgICAgICAgY29udHJvbF90eXBlPSJCTEFDS0xJU1QiLAogICAgICAgICAgICBob3Vycz1TWU1CT0xfQkxBQ0tMSVNUX0hPVVJTLAogICAgICAgICAgICByZWFzb249ZiIyNGggYXZnIHthdmdfMjRoOi4yZn0lIDw9IHtTWU1CT0xfQkxBQ0tMSVNUX0FWR18yNEhfUENUOi4yZn0lIiwKICAgICAgICApCiAgICAgICAgcmV0dXJuCgogICAgdHJpZ2dlciA9IG1heCgxLCBTWU1CT0xfTE9TU19TVFJFQUtfVFJJR0dFUikKICAgIGlmIGxlbihyZXR1cm5zXzRoKSA+PSB0cmlnZ2VyIGFuZCBhbGwocmV0IDwgMCBmb3IgcmV0IGluIHJldHVybnNfNGhbOnRyaWdnZXJdKToKICAgICAgICBzZXRfc3ltYm9sX2NvbnRyb2woCiAgICAgICAgICAgIHN5bWJvbD1zeW1ib2wsCiAgICAgICAgICAgIGNvbnRyb2xfdHlwZT0iQ09PTERPV04iLAogICAgICAgICAgICBob3Vycz1TWU1CT0xfQ09PTERPV05fSE9VUlMsCiAgICAgICAgICAgIHJlYXNvbj1mInt0cmlnZ2VyfSBjb25zZWN1dGl2ZSBuZWdhdGl2ZSA0aCBvdXRjb21lcyIsCiAgICAgICAgKQoKCmFzeW5jIGRlZiBydW5fb3V0Y29tZV9ldmFsdWF0b3IoY29udGV4dCk6CiAgICBpZiBub3QgT1VUQ09NRV9UUkFDS0lOR19FTkFCTEVEOgogICAgICAgIHJldHVybgoKICAgIHJvd3MgPSBnZXRfcGVuZGluZ19hbGVydF9vdXRjb21lcyhsaW1pdD1PVVRDT01FX0VWQUxfQkFUQ0hfU0laRSkKICAgIGlmIG5vdCByb3dzOgogICAgICAgIHJldHVybgoKICAgICMgT1BUSU1JWkFUSU9OOiBGZXRjaCBtYXJrZXQgZGF0YSBvbmNlIGluc3RlYWQgb2YgcGVyLXRva2VuIEFQSSBjYWxscwogICAgIyBUaGlzIGRyYW1hdGljYWxseSByZWR1Y2VzIEJpcmRFeWUgQVBJIHByZXNzdXJlCiAgICBtYXJrZXRfdG9rZW5zID0gZmV0Y2hfbWFya2V0X2RhdGEoKSBvciBbXQogICAgcHJpY2VfYnlfbWludCA9IHsKICAgICAgICBzdHIodC5nZXQoImFkZHJlc3MiKSBvciAiIik6IGZsb2F0KHQuZ2V0KCJwcmljZSIsIDApIG9yIDApCiAgICAgICAgZm9yIHQgaW4gbWFya2V0X3Rva2VucwogICAgICAgIGlmIHQuZ2V0KCJhZGRyZXNzIikgYW5kIHQuZ2V0KCJwcmljZSIpCiAgICB9CgogICAgbm93ID0gZGF0ZXRpbWUudXRjbm93KCkKICAgIHVwZGF0ZWQgPSAwCiAgICB0b3VjaGVkX3N5bWJvbHMgPSBzZXQoKQogICAgZm9yIHJvdyBpbiByb3dzOgogICAgICAgIG91dGNvbWVfaWQgPSBpbnQocm93WyJpZCJdKQogICAgICAgIG1pbnQgPSByb3cuZ2V0KCJtaW50IikKICAgICAgICBlbnRyeV9wcmljZSA9IGZsb2F0KHJvdy5nZXQoImVudHJ5X3ByaWNlIikgb3IgMCkKICAgICAgICBpZiBub3QgbWludCBvciBlbnRyeV9wcmljZSA8PSAwOgogICAgICAgICAgICBtYXJrX2FsZXJ0X291dGNvbWVfY29tcGxldGUob3V0Y29tZV9pZCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjcmVhdGVkID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChyb3dbImNyZWF0ZWRfdHNfdXRjIl0pCiAgICAgICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgICAgICBtYXJrX2FsZXJ0X291dGNvbWVfZXJyb3Iob3V0Y29tZV9pZCwgImludmFsaWRfY3JlYXRlZF90cyIpCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGFnZSA9IG5vdyAtIGNyZWF0ZWQKICAgICAgICBkdWVfaG9yaXpvbnMgPSBbXQogICAgICAgIGlmIHJvdy5nZXQoInJldHVybl8xaF9wY3QiKSBpcyBOb25lIGFuZCBhZ2UgPj0gdGltZWRlbHRhKGhvdXJzPTEpOgogICAgICAgICAgICBkdWVfaG9yaXpvbnMuYXBwZW5kKDEpCiAgICAgICAgaWYgcm93LmdldCgicmV0dXJuXzRoX3BjdCIpIGlzIE5vbmUgYW5kIGFnZSA+PSB0aW1lZGVsdGEoaG91cnM9NCk6CiAgICAgICAgICAgIGR1ZV9ob3Jpem9ucy5hcHBlbmQoNCkKICAgICAgICBpZiByb3cuZ2V0KCJyZXR1cm5fMjRoX3BjdCIpIGlzIE5vbmUgYW5kIGFnZSA+PSB0aW1lZGVsdGEoaG91cnM9MjQpOgogICAgICAgICAgICBkdWVfaG9yaXpvbnMuYXBwZW5kKDI0KQogICAgICAgIGlmIG5vdCBkdWVfaG9yaXpvbnM6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICMgVHJ5IHRvIGdldCBwcmljZSBmcm9tIG1hcmtldCBkYXRhIGZpcnN0IChiYXRjaGVkLCBlZmZpY2llbnQpCiAgICAgICAgY3VycmVudF9wcmljZSA9IHByaWNlX2J5X21pbnQuZ2V0KG1pbnQpCgogICAgICAgICMgRmFsbGJhY2sgdG8gaW5kaXZpZHVhbCBmZXRjaCBvbmx5IGlmIG5vdCBpbiBtYXJrZXQgZGF0YQogICAgICAgIGlmIGN1cnJlbnRfcHJpY2UgaXMgTm9uZSBvciBjdXJyZW50X3ByaWNlIDw9IDA6CiAgICAgICAgICAgIGN1cnJlbnRfcHJpY2UgPSBmZXRjaF9iaXJkZXllX3ByaWNlKG1pbnQpCiAgICAgICAgICAgIGlmIGN1cnJlbnRfcHJpY2UgaXMgTm9uZSBvciBmbG9hdChjdXJyZW50X3ByaWNlKSA8PSAwOgogICAgICAgICAgICAgICAgbWFya19hbGVydF9vdXRjb21lX2Vycm9yKG91dGNvbWVfaWQsICJwcmljZV91bmF2YWlsYWJsZSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICByZXRfcGN0ID0gKChmbG9hdChjdXJyZW50X3ByaWNlKSAtIGVudHJ5X3ByaWNlKSAvIGVudHJ5X3ByaWNlKSAqIDEwMC4wCiAgICAgICAgZm9yIGhvcml6b24gaW4gZHVlX2hvcml6b25zOgogICAgICAgICAgICB1cGRhdGVfYWxlcnRfb3V0Y29tZV9ob3Jpem9uKG91dGNvbWVfaWQsIGhvcml6b24sIHJldF9wY3QpCiAgICAgICAgICAgIHVwZGF0ZWQgKz0gMQogICAgICAgICAgICBpZiByb3cuZ2V0KCJzeW1ib2wiKToKICAgICAgICAgICAgICAgIHRvdWNoZWRfc3ltYm9scy5hZGQoc3RyKHJvdy5nZXQoInN5bWJvbCIpKSkKCiAgICBmb3Igc3ltYm9sIGluIHRvdWNoZWRfc3ltYm9sczoKICAgICAgICBfdXBkYXRlX3N5bWJvbF9jb250cm9sX2Zyb21fb3V0Y29tZXMoc3ltYm9sKQoKICAgIGlmIHVwZGF0ZWQ6CiAgICAgICAgbG9nZ2luZy5pbmZvKCJPdXRjb21lIGV2YWx1YXRvciB1cGRhdGVkICVkIGhvcml6b24gcmVzdWx0KHMpIiwgdXBkYXRlZCkKCgphc3luYyBkZWYgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlOiBVcGRhdGUpOgogICAgbXNnID0gdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlCiAgICBpZiBtc2c6CiAgICAgICAgYXdhaXQgbXNnLnJlcGx5X3RleHQoIlVuYXV0aG9yaXplZCBjaGF0LiIpCgoKZGVmIF9jdXJyZW50X21vZGVfdGV4dCgpOgogICAgc2VsbF9ydWxlcyA9IF9zZWxsX3N0eWxlX3J1bGVzKCkKICAgIHJldHVybiAoCiAgICAgICAgZiJNb2RlOiB7X21vZGUoKX1cbiIKICAgICAgICBmIlJpc2sgcHJvZmlsZToge19yaXNrX3N0eWxlX2xhYmVsKCl9ICh7X25vcm1hbGl6ZV9yaXNrX3N0eWxlKF9ydW50aW1lLmdldCgncmlza19zdHlsZScpKX0pXG4iCiAgICAgICAgZiJTY2FuIGludGVydmFsOiB7X3J1bnRpbWVbJ3NjYW5faW50ZXJ2YWxfc2Vjb25kcyddfXNcbiIKICAgICAgICBmIlRocmVzaG9sZDoge19ydW50aW1lWydhbGVydF90aHJlc2hvbGQnXX0gfCBDb25maWRlbmNlOiB7X3J1bnRpbWVbJ21pbl9jb25maWRlbmNlX3RvX2FsZXJ0J119XG4iCiAgICAgICAgZiJSZWdpbWUgbWluOiB7X3J1bnRpbWVbJ3JlZ2ltZV9taW5fc2NvcmUnXX1cbiIKICAgICAgICBmIk1pbiBsaXEvdm9sMjRoOiAke2ludChfcnVudGltZVsnbWluX2xpcXVpZGl0eSddKTosfSAvICR7aW50KF9ydW50aW1lWydtaW5fdm9sdW1lXzI0aCddKTosfVxuIgogICAgICAgIGYiQ29vbGRvd246IHtfcnVudGltZVsnYWxlcnRfY29vbGRvd25faG91cnMnXX1oXG4iCiAgICAgICAgZiJTT0wgcmVnaW1lIGxheWVyOiB7J09OJyBpZiBFTkFCTEVfU09MX1JFR0lNRV9MQVlFUiBlbHNlICdPRkYnfVxuIgogICAgICAgIGYiTmV3IHJ1bm5lciB3YXRjaDogeydPTicgaWYgTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVEIGVsc2UgJ09GRid9XG4iCiAgICAgICAgZiJMZWdhY3kgcmVjb3Zlcnkgc2NhbjogeydPTicgaWYgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQgZWxzZSAnT0ZGJ30gIgogICAgICAgIGYiKGFnZT49e0xFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVM6LjBmfWQsIGxpcT4ke0xFR0FDWV9SRUNPVkVSWV9NSU5fTElRVUlESVRZLzFlNjouMWZ9TSwgdm9sPiR7TEVHQUNZX1JFQ09WRVJZX01JTl9WT0xVTUVfMjRILzFlMzouMGZ9SylcbiIKICAgICAgICBmIk1hbnVhbCB3YXRjaGxpc3QgbGFuZTogeydPTicgaWYgV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRCBhbmQgYm9vbChXQVRDSExJU1RfRU5UUklFUykgZWxzZSAnT0ZGJ31cbiIKICAgICAgICBmIkFuYWx5c2lzIGJ1bGxldGluOiB7J09OJyBpZiBHT09EX0JVWV9CVUxMRVRJTl9FTkFCTEVEIGVsc2UgJ09GRid9ICh7R09PRF9CVVlfQlVMTEVUSU5fSU5URVJWQUxfU0VDT05EU31zKVxuIgogICAgICAgIGYiUXVpZXQgbW9kZTogeydPTicgaWYgVEVMRUdSQU1fUVVJRVRfTU9ERSBlbHNlICdPRkYnfVxuIgogICAgICAgIGYiTGl2ZSBwdXNoIGdhdGU6IHsnU1RST05HLU9OTFknIGlmIFRFTEVHUkFNX1BVU0hfU1RST05HX09OTFkgZWxzZSAnT0ZGJ30gIgogICAgICAgIGYiKCt7VEVMRUdSQU1fUFVTSF9NSU5fU0NPUkVfREVMVEF9LCBjb25mPj17VEVMRUdSQU1fUFVTSF9NSU5fQ09ORklERU5DRX0pXG4iCiAgICAgICAgZiJTZWxsL2V4aXQgc2Nhbm5lcjogeydPTicgaWYgU0VMTF9BTEVSVFNfRU5BQkxFRCBlbHNlICdPRkYnfSAiCiAgICAgICAgZiIobWF4L2N5Y2xlPXtzZWxsX3J1bGVzWydtYXhfcGVyX2N5Y2xlJ119LCBjb29sZG93bj17c2VsbF9ydWxlc1snY29vbGRvd25faG91cnMnXX1oKSIKICAgICkKCgpkZWYgX2ZtdF91c2RfY29tcGFjdF9tYWluKHZhbHVlKToKICAgIHRyeToKICAgICAgICBuID0gZmxvYXQodmFsdWUpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICBhYnNfbiA9IGFicyhuKQogICAgaWYgYWJzX24gPj0gMV8wMDBfMDAwXzAwMDoKICAgICAgICByZXR1cm4gZiIke24vMV8wMDBfMDAwXzAwMDouMmZ9QiIKICAgIGlmIGFic19uID49IDFfMDAwXzAwMDoKICAgICAgICByZXR1cm4gZiIke24vMV8wMDBfMDAwOi4yZn1NIgogICAgaWYgYWJzX24gPj0gMV8wMDA6CiAgICAgICAgcmV0dXJuIGYiJHtuLzFfMDAwOi4xZn1LIgogICAgcmV0dXJuIGYiJHtuOi4wZn0iCgoKZGVmIF9mbXRfcGN0X21haW4odmFsdWUpOgogICAgdHJ5OgogICAgICAgIG51bWJlciA9IGZsb2F0KHZhbHVlKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiAiTi9BIgogICAgc2lnbiA9ICIrIiBpZiBudW1iZXIgPiAwIGVsc2UgIiIKICAgIHJldHVybiBmIntzaWdufXtudW1iZXI6LjFmfSUiCgoKZGVmIF9mbXRfaW50X21haW4odmFsdWUpOgogICAgdHJ5OgogICAgICAgIHJldHVybiBmIntpbnQoZmxvYXQodmFsdWUpKTosfSIKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKCgpkZWYgX2VzY19odG1sX21haW4odmFsdWUpOgogICAgcmV0dXJuIGh0bWwuZXNjYXBlKHN0cih2YWx1ZSkpCgoKZGVmIF9yZW5kZXJfcHJlX21haW4ocm93cyk6CiAgICBsaW5lcyA9IFtzdHIocm93IG9yICIiKSBmb3Igcm93IGluIHJvd3NdCiAgICBpZiBub3QgbGluZXM6CiAgICAgICAgcmV0dXJuICIiCiAgICBwYW5lbF93aWR0aCA9IF9QQU5FTF9XSURUSF9NQUlOCiAgICB3cmFwcGVkID0gW10KICAgIGZvciBsaW5lIGluIGxpbmVzOgogICAgICAgIHdyYXBwZWQuZXh0ZW5kKF93cmFwX3RleHRfbWFpbihsaW5lLCBwYW5lbF93aWR0aCkpCiAgICByZXR1cm4gIlxuIi5qb2luKGYiPGNvZGU+e19lc2NfaHRtbF9tYWluKGxpbmUpfTwvY29kZT4iIGZvciBsaW5lIGluIHdyYXBwZWQpCgoKX1BBTkVMX1dJRFRIX01BSU4gPSA0MgoKCmRlZiBfdHJpbV90ZXh0X21haW4odmFsdWUsIG1heF9sZW4pOgogICAgdGV4dCA9IHN0cih2YWx1ZSBvciAiIikKICAgIGlmIG1heF9sZW4gPD0gMDoKICAgICAgICByZXR1cm4gdGV4dAogICAgcmV0dXJuIHRleHQKCgpkZWYgX3dyYXBfdGV4dF9tYWluKHZhbHVlLCBtYXhfbGVuKToKICAgIHRleHQgPSBzdHIodmFsdWUgb3IgIiIpCiAgICBpZiBtYXhfbGVuIDw9IDAgb3IgbGVuKHRleHQpIDw9IG1heF9sZW46CiAgICAgICAgcmV0dXJuIFt0ZXh0XQogICAgb3V0ID0gW10KICAgIHJlbWFpbmluZyA9IHRleHQKICAgIHdoaWxlIGxlbihyZW1haW5pbmcpID4gbWF4X2xlbjoKICAgICAgICBjdXQgPSByZW1haW5pbmcucmZpbmQoIiAiLCAwLCBtYXhfbGVuICsgMSkKICAgICAgICBpZiBjdXQgPD0gMDoKICAgICAgICAgICAgY3V0ID0gbWF4X2xlbgogICAgICAgIG91dC5hcHBlbmQocmVtYWluaW5nWzpjdXRdLnJzdHJpcCgpKQogICAgICAgIHJlbWFpbmluZyA9IHJlbWFpbmluZ1tjdXQ6XS5sc3RyaXAoKQogICAgb3V0LmFwcGVuZChyZW1haW5pbmcpCiAgICByZXR1cm4gb3V0CgoKZGVmIF9rdl9tYWluKGxhYmVsLCB2YWx1ZSwgd2lkdGg6IGludCA9IF9QQU5FTF9XSURUSF9NQUlOKToKICAgIGtleSA9IHN0cihsYWJlbCBvciAiIikudXBwZXIoKVs6OV0KICAgIGxpbmUgPSBmIntrZXk6PDl9IHwge3ZhbHVlfSIKICAgIHJldHVybiBfdHJpbV90ZXh0X21haW4obGluZSwgd2lkdGgpCgoKZGVmIF9oZWFkZXJfYmxvY2tfbWFpbih0YWc6IHN0ciwgcm93cz1Ob25lLCB3aWR0aDogaW50ID0gX1BBTkVMX1dJRFRIX01BSU4pIC0+IHN0cjoKICAgIGhlYWRlcl9yb3dzID0gWwogICAgICAgIGYiPGI+e19lc2NfaHRtbF9tYWluKHRhZyl9PC9iPiIsCiAgICAgICAgZiI8Y29kZT57Jy0nICogbWluKDMwLCB3aWR0aCl9PC9jb2RlPiIsCiAgICBdCiAgICBmb3Igcm93IGluIChyb3dzIG9yIFtdKToKICAgICAgICB0ZXh0ID0gX3RyaW1fdGV4dF9tYWluKHN0cihyb3cgb3IgIiIpLCB3aWR0aCkKICAgICAgICBoZWFkZXJfcm93cy5hcHBlbmQoZiI8Y29kZT57X2VzY19odG1sX21haW4odGV4dCl9PC9jb2RlPiIpCiAgICByZXR1cm4gIlxuIi5qb2luKGhlYWRlcl9yb3dzKQoKCmRlZiBfcHJpb3JpdHlfZnJvbV9zY29yZV9tYWluKHNjb3JlKToKICAgIHRyeToKICAgICAgICBzID0gZmxvYXQoc2NvcmUgb3IgMCkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIlAzIgogICAgaWYgcyA+PSA5MDoKICAgICAgICByZXR1cm4gIlAxIgogICAgaWYgcyA+PSA4MDoKICAgICAgICByZXR1cm4gIlAyIgogICAgcmV0dXJuICJQMyIKCgpkZWYgX2dvb2RfYnV5X3JlYXNvbih0b2tlbjogZGljdCkgLT4gc3RyOgogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICB2b2x1bWVfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgIHZvbF90b19saXEgPSAodm9sdW1lXzI0aCAvIGxpcXVpZGl0eSkgaWYgbGlxdWlkaXR5ID4gMCBlbHNlIDAuMAogICAgaWYgY2hhbmdlXzI0aCA+PSAxMiBhbmQgdm9sX3RvX2xpcSA+PSAwLjY6CiAgICAgICAgcmV0dXJuICJTdHJvbmcgdHJlbmQgKyBzdHJvbmcgcGFydGljaXBhdGlvbiIKICAgIGlmIGNoYW5nZV8yNGggPj0gNSBhbmQgdm9sX3RvX2xpcSA+PSAwLjM1OgogICAgICAgIHJldHVybiAiTW9tZW50dW0gY29uZmlybWVkICsgaGVhbHRoeSB0dXJub3ZlciIKICAgIGlmIGNoYW5nZV8yNGggPj0gMDoKICAgICAgICByZXR1cm4gIkNvbnN0cnVjdGl2ZSBzdHJ1Y3R1cmUgKyBhY2NlcHRhYmxlIGxpcXVpZGl0eSIKICAgIHJldHVybiAiUHVsbGJhY2sgc2V0dXAgd2l0aCBzdGlsbC12YWxpZCBsaXF1aWRpdHkiCgoKZGVmIF9zZWxsX3N0eWxlX3J1bGVzKHN0eWxlOiBzdHIgfCBOb25lID0gTm9uZSkgLT4gZGljdDoKICAgIHJpc2tfc3R5bGUgPSBfbm9ybWFsaXplX3Jpc2tfc3R5bGUoc3R5bGUgb3IgX3J1bnRpbWUuZ2V0KCJyaXNrX3N0eWxlIikpCiAgICBiYXNlID0gewogICAgICAgICJzdHlsZSI6IHJpc2tfc3R5bGUsCiAgICAgICAgIm1heF9wZXJfY3ljbGUiOiBtYXgoMSwgaW50KFNFTExfQUxFUlRfTUFYX1BFUl9DWUNMRSkpLAogICAgICAgICJjb29sZG93bl9ob3VycyI6IG1heCgxLCBpbnQoU0VMTF9BTEVSVF9DT09MRE9XTl9IT1VSUykpLAogICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8xaCI6IGZsb2F0KFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfMUgpLAogICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV82aCI6IGZsb2F0KFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfNkgpLAogICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8yNGgiOiBmbG9hdChTRUxMX0hZUEVfRkFERV9NQVhfQ0hBTkdFXzI0SCksCiAgICAgICAgImh5cGVfZmFkZV9tYXhfdm9sX3RvX2xpcSI6IGZsb2F0KFNFTExfSFlQRV9GQURFX01BWF9WT0xfVE9fTElRKSwKICAgICAgICAiY29uc29saWRhdGlvbl9taW5fY2hhbmdlXzI0aCI6IGZsb2F0KFNFTExfQ09OU09MSURBVElPTl9NSU5fQ0hBTkdFXzI0SCksCiAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfMWgiOiBmbG9hdChTRUxMX0NPTlNPTElEQVRJT05fTUFYX0FCU19DSEFOR0VfMUgpLAogICAgICAgICJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzZoIjogZmxvYXQoU0VMTF9DT05TT0xJREFUSU9OX01BWF9BQlNfQ0hBTkdFXzZIKSwKICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfdm9sX3RvX2xpcSI6IGZsb2F0KFNFTExfQ09OU09MSURBVElPTl9NQVhfVk9MX1RPX0xJUSksCiAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X3R4bnNfaDEiOiBpbnQoU0VMTF9DT05TT0xJREFUSU9OX01BWF9UWE5TX0gxKSwKICAgIH0KCiAgICBpZiByaXNrX3N0eWxlID09ICJjYXBpdGFsIjoKICAgICAgICBiYXNlLnVwZGF0ZSgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1heF9wZXJfY3ljbGUiOiBtYXgoMSwgYmFzZVsibWF4X3Blcl9jeWNsZSJdICsgMSksCiAgICAgICAgICAgICAgICAiY29vbGRvd25faG91cnMiOiBtYXgoMSwgaW50KHJvdW5kKGJhc2VbImNvb2xkb3duX2hvdXJzIl0gKiAwLjc1KSkpLAogICAgICAgICAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzFoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfMWgiXSAqIDAuNiwKICAgICAgICAgICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV82aCI6IGJhc2VbImh5cGVfZmFkZV9tYXhfY2hhbmdlXzZoIl0gKiAwLjYsCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF9jaGFuZ2VfMjRoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfMjRoIl0gKiAwLjYsCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIjogYmFzZVsiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIl0gKiAxLjQsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9taW5fY2hhbmdlXzI0aCI6IGJhc2VbImNvbnNvbGlkYXRpb25fbWluX2NoYW5nZV8yNGgiXSAqIDAuNywKICAgICAgICAgICAgICAgICJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzFoIjogYmFzZVsiY29uc29saWRhdGlvbl9tYXhfYWJzX2NoYW5nZV8xaCJdICogMS4zNSwKICAgICAgICAgICAgICAgICJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzZoIjogYmFzZVsiY29uc29saWRhdGlvbl9tYXhfYWJzX2NoYW5nZV82aCJdICogMS4zLAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X3ZvbF90b19saXEiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF92b2xfdG9fbGlxIl0gKiAxLjMsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfdHhuc19oMSI6IGludChiYXNlWyJjb25zb2xpZGF0aW9uX21heF90eG5zX2gxIl0gKiAxLjM1KSwKICAgICAgICAgICAgfQogICAgICAgICkKICAgIGVsaWYgcmlza19zdHlsZSA9PSAic25pcGVyIjoKICAgICAgICBiYXNlLnVwZGF0ZSgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1heF9wZXJfY3ljbGUiOiBtYXgoMSwgYmFzZVsibWF4X3Blcl9jeWNsZSJdIC0gMSksCiAgICAgICAgICAgICAgICAiY29vbGRvd25faG91cnMiOiBtYXgoMSwgaW50KHJvdW5kKGJhc2VbImNvb2xkb3duX2hvdXJzIl0gKiAxLjI1KSkpLAogICAgICAgICAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzFoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfMWgiXSAqIDEuNiwKICAgICAgICAgICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV82aCI6IGJhc2VbImh5cGVfZmFkZV9tYXhfY2hhbmdlXzZoIl0gKiAxLjYsCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF9jaGFuZ2VfMjRoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfMjRoIl0gKiAxLjYsCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIjogYmFzZVsiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIl0gKiAwLjc1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWluX2NoYW5nZV8yNGgiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21pbl9jaGFuZ2VfMjRoIl0gKiAxLjM1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfMWgiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzFoIl0gKiAwLjc1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfNmgiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzZoIl0gKiAwLjc1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X3ZvbF90b19saXEiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF92b2xfdG9fbGlxIl0gKiAwLjc1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X3R4bnNfaDEiOiBpbnQoYmFzZVsiY29uc29saWRhdGlvbl9tYXhfdHhuc19oMSJdICogMC43NSksCiAgICAgICAgICAgIH0KICAgICAgICApCgogICAgcmV0dXJuIGJhc2UKCgpkZWYgX3NlbGxfc2lnbmFsX29uX2Nvb2xkb3duKHN5bWJvbDogc3RyLCBjb29sZG93bl9ob3VyczogaW50IHwgZmxvYXQgfCBOb25lID0gTm9uZSkgLT4gYm9vbDoKICAgIGlmIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuIFRydWUKICAgIGxhc3Rfc2VudCA9IGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sKAogICAgICAgIHN5bWJvbCwKICAgICAgICBbCiAgICAgICAgICAgICJTRUxMX0FMRVJUX0hZUEVfRkFERSIsCiAgICAgICAgICAgICJTRUxMX0FMRVJUX0NPTlNPTElEQVRJT04iLAogICAgICAgICAgICAiU0VMTF9BTEVSVF9EUllfUlVOIiwKICAgICAgICBdLAogICAgKQogICAgaWYgbm90IGxhc3Rfc2VudDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGVmZmVjdGl2ZV9jb29sZG93biA9IGNvb2xkb3duX2hvdXJzIGlmIGNvb2xkb3duX2hvdXJzIGlzIG5vdCBOb25lIGVsc2UgU0VMTF9BTEVSVF9DT09MRE9XTl9IT1VSUwogICAgcmV0dXJuIChkYXRldGltZS51dGNub3coKSAtIGxhc3Rfc2VudCkgPCB0aW1lZGVsdGEoaG91cnM9bWF4KDEsIGVmZmVjdGl2ZV9jb29sZG93bikpCgoKZGVmIF9kZXRlY3Rfc2VsbF9zaWduYWwodG9rZW46IGRpY3QsIHJ1bGVzOiBkaWN0IHwgTm9uZSA9IE5vbmUpOgogICAgIiIiCiAgICBEZXRlY3QgZXhpdCBzaWduYWxzIHVzaW5nIHJlYWwgbWFya2V0IHN0cnVjdHVyZSBhbmQgZmxvdyBhbmFseXNpcy4KICAgIFByaW9yaXRpemVkIGJ5IHNldmVyaXR5OiBzdHJ1Y3R1cmUgYnJlYWsgPiBsaXF1aWRpdHkgZHJhaW4gPiBob2xkZXIgZXhvZHVzID4gaHlwZSBmYWRlID4gY29uc29saWRhdGlvbgogICAgIiIiCiAgICBzeW1ib2wgPSBzdHIodG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgaWYgbm90IHN5bWJvbCBvciBzeW1ib2wgaW4gX1NFTExfQUxFUlRfRVhDTFVERURfU1lNQk9MUzoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgaWYgbGlxdWlkaXR5IDw9IDAgb3Igdm9sdW1lXzI0aCA8PSAwOgogICAgICAgIHJldHVybiBOb25lCiAgICB2b2xfdG9fbGlxID0gdm9sdW1lXzI0aCAvIGxpcXVpZGl0eQogICAgcnVsZXMgPSBydWxlcyBvciBfc2VsbF9zdHlsZV9ydWxlcygpCgogICAgY2hhbmdlXzFoID0gdG9rZW4uZ2V0KCJjaGFuZ2VfMWgiKSBvciB0b2tlbi5nZXQoInByaWNlQ2hhbmdlMWhQZXJjZW50IikKICAgIGNoYW5nZV80aCA9IHRva2VuLmdldCgiY2hhbmdlXzRoIikgb3IgdG9rZW4uZ2V0KCJwcmljZUNoYW5nZTRoUGVyY2VudCIpCiAgICBjaGFuZ2VfNmggPSB0b2tlbi5nZXQoImNoYW5nZV82aCIpIG9yIHRva2VuLmdldCgicHJpY2VDaGFuZ2U2aFBlcmNlbnQiKQogICAgY2hhbmdlXzI0aCA9IHRva2VuLmdldCgiY2hhbmdlXzI0aCIpCiAgICBjMSA9IGZsb2F0KGNoYW5nZV8xaCkgaWYgaXNpbnN0YW5jZShjaGFuZ2VfMWgsIChpbnQsIGZsb2F0KSkgZWxzZSBOb25lCiAgICBjNCA9IGZsb2F0KGNoYW5nZV80aCkgaWYgaXNpbnN0YW5jZShjaGFuZ2VfNGgsIChpbnQsIGZsb2F0KSkgZWxzZSBOb25lCiAgICBjNiA9IGZsb2F0KGNoYW5nZV82aCkgaWYgaXNpbnN0YW5jZShjaGFuZ2VfNmgsIChpbnQsIGZsb2F0KSkgZWxzZSBOb25lCiAgICBjMjQgPSBmbG9hdChjaGFuZ2VfMjRoKSBpZiBpc2luc3RhbmNlKGNoYW5nZV8yNGgsIChpbnQsIGZsb2F0KSkgZWxzZSAwLjAKICAgIHR4bnNfaDEgPSBpbnQoZmxvYXQodG9rZW4uZ2V0KCJ0eG5zX2gxIikgb3IgMCkpCgogICAgIyBHZXQgaG9sZGVyIG1vbWVudHVtIGRhdGEKICAgIHV3XzFoX2NoYW5nZSA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0MWhDaGFuZ2VQZXJjZW50IikKICAgIHV3XzRoX2NoYW5nZSA9IHRva2VuLmdldCgidW5pcXVlV2FsbGV0NGhDaGFuZ2VQZXJjZW50IikKCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgIyAxLiBTVFJVQ1RVUkUgQlJFQUsgKGhpZ2hlc3QgcHJpb3JpdHkpCiAgICAjIFByaWNlIGJyZWFraW5nIGRvd24gaGFyZCBhY3Jvc3MgbXVsdGlwbGUgdGltZWZyYW1lcyA9IHN0cnVjdHVyYWwgZmFpbHVyZQogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIGMxIGlzIG5vdCBOb25lIGFuZCBjNCBpcyBub3QgTm9uZToKICAgICAgICBpZiBjMSA8IC04IGFuZCBjNCA8IC0xNToKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIlNUUlVDVFVSRV9CUkVBSyIsCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiU3RydWN0dXJlIEJyZWFrIiwKICAgICAgICAgICAgICAgICJhY3Rpb24iOiAiRVhJVCBOT1cgLSBzdHJ1Y3R1cmUgZmFpbGVkIiwKICAgICAgICAgICAgICAgICJzdHlsZSI6IHJ1bGVzWyJzdHlsZSJdLAogICAgICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgICAgICBmIk11bHRpLXRpbWVmcmFtZSBicmVha2Rvd246IDFoIHtjMTorLjFmfSUsIDRoIHtjNDorLjFmfSUuICIKICAgICAgICAgICAgICAgICAgICBmIlByaWNlIHN1cHBvcnQgaGFzIGZhaWxlZC4iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9CgogICAgIyBTaGFycCBkdW1wIHdpdGggYWNjZWxlcmF0aW5nIGRvd25zaWRlID0gY2FzY2FkZSBmb3JtaW5nCiAgICBpZiBjMSBpcyBub3QgTm9uZSBhbmQgYzYgaXMgbm90IE5vbmU6CiAgICAgICAgaWYgYzEgPCAtMTAgYW5kIGM2IDwgLTIwIGFuZCBjMSA8IGM2IC8gMjoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIlNUUlVDVFVSRV9CUkVBSyIsCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiU3RydWN0dXJlIEJyZWFrIiwKICAgICAgICAgICAgICAgICJhY3Rpb24iOiAiRVhJVCBOT1cgLSBjYXNjYWRlIGZvcm1pbmciLAogICAgICAgICAgICAgICAgInN0eWxlIjogcnVsZXNbInN0eWxlIl0sCiAgICAgICAgICAgICAgICAicmVhc29uIjogKAogICAgICAgICAgICAgICAgICAgIGYiQWNjZWxlcmF0aW5nIGR1bXA6IDFoIHtjMTorLjFmfSUsIDZoIHtjNjorLjFmfSUuICIKICAgICAgICAgICAgICAgICAgICBmIkRvd25zaWRlIG1vbWVudHVtIGFjY2VsZXJhdGluZy4iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9CgogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgICMgMi4gTElRVUlESVRZIERSQUlOCiAgICAjIFZvbHVtZS9saXF1aWRpdHkgcmF0aW8gY29sbGFwc2luZyA9IGNhbid0IGV4aXQgd2l0aG91dCBzbGlwcGFnZQogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIHZvbF90b19saXEgPCAwLjA1OiAgIyBWb2x1bWUgZHJvcHBlZCB0byA1JSBvZiBsaXF1aWRpdHkgPSBkcmllZCB1cAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJ0eXBlIjogIkxJUVVJRElUWV9EUkFJTiIsCiAgICAgICAgICAgICJ0aXRsZSI6ICJMaXF1aWRpdHkgRHJhaW4iLAogICAgICAgICAgICAiYWN0aW9uIjogIkVYSVQgQVNBUCAtIG1hcmtldCBkcnlpbmcgdXAiLAogICAgICAgICAgICAic3R5bGUiOiBydWxlc1sic3R5bGUiXSwKICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgIGYiVm9sdW1lIGNvbGxhcHNlZCB0byB7dm9sX3RvX2xpcTouM2Z9eCBsaXF1aWRpdHkuICIKICAgICAgICAgICAgICAgIGYiTWFya2V0IGRlcHRoIGV2YXBvcmF0aW5nIC0gZXhpdCBiZWZvcmUgc2xpcHBhZ2Ugc3Bpa2VzLiIKICAgICAgICAgICAgKSwKICAgICAgICB9CgogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgICMgMy4gSE9MREVSIEVYT0RVUwogICAgIyBVbmlxdWUgd2FsbGV0cyByYXBpZGx5IGV4aXRpbmcgPSBkaXN0cmlidXRpb24gcGhhc2UKICAgICMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACiAgICBpZiB1d18xaF9jaGFuZ2UgaXMgbm90IE5vbmUgYW5kIHV3XzRoX2NoYW5nZSBpcyBub3QgTm9uZToKICAgICAgICBpZiB1d18xaF9jaGFuZ2UgPCAtMjUgYW5kIHV3XzRoX2NoYW5nZSA8IC0yMDoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIkhPTERFUl9FWE9EVVMiLAogICAgICAgICAgICAgICAgInRpdGxlIjogIkhvbGRlciBFeG9kdXMiLAogICAgICAgICAgICAgICAgImFjdGlvbiI6ICJFWElUIC0gc21hcnQgbW9uZXkgbGVhdmluZyIsCiAgICAgICAgICAgICAgICAic3R5bGUiOiBydWxlc1sic3R5bGUiXSwKICAgICAgICAgICAgICAgICJyZWFzb24iOiAoCiAgICAgICAgICAgICAgICAgICAgZiJIb2xkZXIgZXhvZHVzOiAxaCB3YWxsZXRzIHt1d18xaF9jaGFuZ2U6Ky4xZn0lLCA0aCB7dXdfNGhfY2hhbmdlOisuMWZ9JS4gIgogICAgICAgICAgICAgICAgICAgIGYiU21hcnQgbW9uZXkgaXMgZXhpdGluZyBlbiBtYXNzZS4iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9CgogICAgIyBIb2xkZXJzIGV4aXRpbmcgd2hpbGUgcHJpY2Ugc3RpbGwgaG9sZGluZyA9IGRpc3RyaWJ1dGlvbiBiZWZvcmUgZHVtcAogICAgaWYgdXdfMWhfY2hhbmdlIGlzIG5vdCBOb25lIGFuZCBjMSBpcyBub3QgTm9uZToKICAgICAgICBpZiB1d18xaF9jaGFuZ2UgPCAtMjAgYW5kIGMxID4gLTU6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJIT0xERVJfRVhPRFVTIiwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJIb2xkZXIgRXhvZHVzIiwKICAgICAgICAgICAgICAgICJhY3Rpb24iOiAiRVhJVCAtIGRpc3RyaWJ1dGlvbiBwaGFzZSIsCiAgICAgICAgICAgICAgICAic3R5bGUiOiBydWxlc1sic3R5bGUiXSwKICAgICAgICAgICAgICAgICJyZWFzb24iOiAoCiAgICAgICAgICAgICAgICAgICAgZiJIb2xkZXJzIGV4aXRpbmcgKHt1d18xaF9jaGFuZ2U6Ky4xZn0lKSB3aGlsZSBwcmljZSBzdGlsbCB7YzE6Ky4xZn0lLiAiCiAgICAgICAgICAgICAgICAgICAgZiJEaXN0cmlidXRpb24gcGhhc2UgLSBkdW1wIGluY29taW5nLiIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0KCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgIyA0LiBIWVBFIEZBREUgKG9yaWdpbmFsIGxvZ2ljLCBub3cgbG93ZXIgcHJpb3JpdHkpCiAgICAjIE1vbWVudHVtIHJvbGxlZCBvdmVyICsgcGFydGljaXBhdGlvbiBmYWRlZAogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIGMxIGlzIG5vdCBOb25lIGFuZCBjNiBpcyBub3QgTm9uZToKICAgICAgICBpZiAoCiAgICAgICAgICAgIGMxIDw9IHJ1bGVzWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8xaCJdCiAgICAgICAgICAgIGFuZCBjNiA8PSBydWxlc1siaHlwZV9mYWRlX21heF9jaGFuZ2VfNmgiXQogICAgICAgICAgICBhbmQgdm9sX3RvX2xpcSA8PSBydWxlc1siaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIl0KICAgICAgICApIG9yICgKICAgICAgICAgICAgYzI0IDw9IHJ1bGVzWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8yNGgiXQogICAgICAgICAgICBhbmQgdm9sX3RvX2xpcSA8PSBydWxlc1siaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIl0KICAgICAgICApOgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInR5cGUiOiAiSFlQRV9GQURFIiwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJIeXBlIEZhZGUiLAogICAgICAgICAgICAgICAgImFjdGlvbiI6ICJCYWQgYnV5IC8gZGUtcmlzayBub3ciLAogICAgICAgICAgICAgICAgInN0eWxlIjogcnVsZXNbInN0eWxlIl0sCiAgICAgICAgICAgICAgICAicmVhc29uIjogKAogICAgICAgICAgICAgICAgICAgIGYiTW9tZW50dW0gcm9sbGVkIG92ZXIgKDFoIHtjMTorLjFmfSUsIDZoIHtjNjorLjFmfSUpIGFuZCBwYXJ0aWNpcGF0aW9uIGZhZGVkICIKICAgICAgICAgICAgICAgICAgICBmIih2b2wvbGlxIHt2b2xfdG9fbGlxOi4yZn0pLiIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0KCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgIyA1LiBDT05TT0xJREFUSU9OIChsb3dlc3QgcHJpb3JpdHkgLSBub3QgYWx3YXlzIGJhZCkKICAgICMgVG9rZW4gcmFuIGJ1dCBpcyBzdGFsbGluZyB3aXRoIGNvb2xpbmcgZmxvdwogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIGMxIGlzIG5vdCBOb25lIGFuZCBjNiBpcyBub3QgTm9uZToKICAgICAgICBpZiAoCiAgICAgICAgICAgIGMyNCA+PSBydWxlc1siY29uc29saWRhdGlvbl9taW5fY2hhbmdlXzI0aCJdCiAgICAgICAgICAgIGFuZCBhYnMoYzEpIDw9IHJ1bGVzWyJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzFoIl0KICAgICAgICAgICAgYW5kIGFicyhjNikgPD0gcnVsZXNbImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfNmgiXQogICAgICAgICAgICBhbmQgdm9sX3RvX2xpcSA8PSBydWxlc1siY29uc29saWRhdGlvbl9tYXhfdm9sX3RvX2xpcSJdCiAgICAgICAgICAgIGFuZCB0eG5zX2gxIDw9IHJ1bGVzWyJjb25zb2xpZGF0aW9uX21heF90eG5zX2gxIl0KICAgICAgICApOgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInR5cGUiOiAiQ09OU09MSURBVElPTiIsCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiUG9zdC1SdW4gQ29uc29saWRhdGlvbiIsCiAgICAgICAgICAgICAgICAiYWN0aW9uIjogIlRha2UgcHJvZml0IC8gdGlnaHRlbiByaXNrIiwKICAgICAgICAgICAgICAgICJzdHlsZSI6IHJ1bGVzWyJzdHlsZSJdLAogICAgICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgICAgICBmIlRva2VuIHJhbiAoe2MyNDorLjFmfSUgMjRoKSBidXQgaXMgc3RhbGxpbmcgKDFoIHtjMTorLjFmfSUsIDZoIHtjNjorLjFmfSUpICIKICAgICAgICAgICAgICAgICAgICBmIndpdGggY29vbGluZyBmbG93ICh0eG5zIDFoIHt0eG5zX2gxfSwgdm9sL2xpcSB7dm9sX3RvX2xpcTouMmZ9KS4iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9CgogICAgcmV0dXJuIE5vbmUKCgpkZWYgX2Zvcm1hdF9zZWxsX2FsZXJ0X21lc3NhZ2UodG9rZW46IGRpY3QsIHNpZ25hbDogZGljdCwgY29tcGFjdDogYm9vbCA9IFRydWUpIC0+IHN0cjoKICAgIGltcG9ydCBodG1sIGFzIF9odG1sCiAgICBkZWYgX2VzYyh2KToKICAgICAgICByZXR1cm4gX2h0bWwuZXNjYXBlKHN0cih2KSkKICAgIHNlcCA9ICLilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEiCiAgICBzeW1ib2wgPSBzdHIodG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIpLnVwcGVyKCkKICAgIG1hcmtldF9jYXAgPSB0b2tlbi5nZXQoIm1hcmtldF9jYXAiKQogICAgZmR2ID0gdG9rZW4uZ2V0KCJmZHYiKQogICAgY2FwX3ZhbHVlID0gbWFya2V0X2NhcCBpZiBpc2luc3RhbmNlKG1hcmtldF9jYXAsIChpbnQsIGZsb2F0KSkgYW5kIG1hcmtldF9jYXAgPiAwIGVsc2UgZmR2CiAgICBtb3ZlXzI0ID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkKICAgIHByaW9yaXR5ID0gIlAxIiBpZiBtb3ZlXzI0IDw9IC0xMCBlbHNlICgiUDIiIGlmIG1vdmVfMjQgPD0gLTUgZWxzZSAiUDMiKQogICAgcHJpb3JpdHlfZW1vamkgPSAi8J+UtCIgaWYgcHJpb3JpdHkgPT0gIlAxIiBlbHNlICgi8J+foCIgaWYgcHJpb3JpdHkgPT0gIlAyIiBlbHNlICLwn5+hIikKICAgIGFjdGlvbiA9IHN0cihzaWduYWwuZ2V0KCJhY3Rpb24iKSBvciAiRGUtcmlzayIpCiAgICByZWFzb24gPSBzdHIoc2lnbmFsLmdldCgicmVhc29uIikgb3IgIkZsb3cgZGV0ZXJpb3JhdGlvbiBkZXRlY3RlZC4iKQogICAgc2lnbmFsX3RpdGxlID0gc3RyKHNpZ25hbC5nZXQoInRpdGxlIikgb3IgIkV4aXQgV2FybmluZyIpCiAgICBwcmljZV9saW5lID0gZiJ7X2ZtdF91c2RfY29tcGFjdF9tYWluKHRva2VuLmdldCgncHJpY2UnKSl9IHwgMjRIIHtfZm10X3BjdF9tYWluKHRva2VuLmdldCgnY2hhbmdlXzI0aCcpKX0iCgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5qoIFtTSUdOQUxdOiBTRUxMIC8gRVhJVDwvYj4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfjq8gQ09JTjogJHtfZXNjKHN5bWJvbCl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OKIFBST0ZJTEU6IHtfZXNjKF9tb2RlKCkudXBwZXIoKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57cHJpb3JpdHlfZW1vaml9IFBSSU9SSVRZOiB7X2VzYyhwcmlvcml0eSl9IOKAlCB7X2VzYyhzaWduYWxfdGl0bGUpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SsCBNQVJLRVRDQVA6IHtfZXNjKF9mbXRfdXNkX2NvbXBhY3RfbWFpbihjYXBfdmFsdWUpKX0gfCAyNEgge19lc2MoX2ZtdF9wY3RfbWFpbih0b2tlbi5nZXQoJ2NoYW5nZV8yNGgnKSkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SpyBMSVFVSURJVFk6IHtfZXNjKF9mbXRfdXNkX2NvbXBhY3RfbWFpbih0b2tlbi5nZXQoJ2xpcXVpZGl0eScpKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+UtCBTSUdOQUw6IHtfZXNjKGFjdGlvbi51cHBlcigpKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk50gUkVBU09OOiB7X2VzYyhyZWFzb24pfTwvY29kZT4iLAogICAgXQogICAgaWYgbm90IGNvbXBhY3Q6CiAgICAgICAgbGluZXMgKz0gWwogICAgICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+aqyBJTlZBTElEOiBNb21lbnR1bSArIHZvbHVtZSByZWNvdmVyeTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCflIQgREFUQTogTGl2ZSByZWZyZXNoIG9uIGFsZXJ0IHNlbmQ8L2NvZGU+IiwKICAgICAgICBdCiAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKQoKCmRlZiBfbm9ybWFsaXplX21hcmtldF90aWVyKHJhdzogc3RyIHwgTm9uZSkgLT4gc3RyOgogICAgdmFsdWUgPSBzdHIocmF3IG9yICJiYWxhbmNlZCIpLnN0cmlwKCkubG93ZXIoKQogICAgYWxpYXNlcyA9IHsKICAgICAgICAiYyI6ICJjb25zZXJ2YXRpdmUiLAogICAgICAgICJjb25zIjogImNvbnNlcnZhdGl2ZSIsCiAgICAgICAgImNvbnNlcnZhdGl2ZSI6ICJjb25zZXJ2YXRpdmUiLAogICAgICAgICJiIjogImJhbGFuY2VkIiwKICAgICAgICAiYmFsIjogImJhbGFuY2VkIiwKICAgICAgICAiYmFsYW5jZWQiOiAiYmFsYW5jZWQiLAogICAgICAgICJhIjogImFnZ3Jlc3NpdmUiLAogICAgICAgICJhZ2ciOiAiYWdncmVzc2l2ZSIsCiAgICAgICAgImFnZ3Jlc3NpdmUiOiAiYWdncmVzc2l2ZSIsCiAgICB9CiAgICByZXR1cm4gYWxpYXNlcy5nZXQodmFsdWUsICJiYWxhbmNlZCIpCgoKZGVmIF9zdHJpY3Rlcl9jb25maWRlbmNlKG1pbl9hOiBzdHIsIG1pbl9iOiBzdHIpIC0+IHN0cjoKICAgIGEgPSBzdHIobWluX2Egb3IgIkIiKS51cHBlcigpCiAgICBiID0gc3RyKG1pbl9iIG9yICJCIikudXBwZXIoKQogICAgaWYgYSBub3QgaW4gX0NPTkZJREVOQ0VfT1JERVI6CiAgICAgICAgYSA9ICJCIgogICAgaWYgYiBub3QgaW4gX0NPTkZJREVOQ0VfT1JERVI6CiAgICAgICAgYiA9ICJCIgogICAgcmV0dXJuIGEgaWYgX0NPTkZJREVOQ0VfT1JERVJbYV0gPj0gX0NPTkZJREVOQ0VfT1JERVJbYl0gZWxzZSBiCgoKZGVmIF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZDogaW50ID0gNSwgbGltaXRfYmFkOiBpbnQgPSA1LCB0aWVyOiBzdHIgPSAiYmFsYW5jZWQiKSAtPiBkaWN0OgogICAgdGllcl9rZXkgPSBfbm9ybWFsaXplX21hcmtldF90aWVyKHRpZXIpCiAgICB0aWVyX3J1bGUgPSBfbWFya2V0X3RpZXJfcnVsZSh0aWVyX2tleSkKICAgIHJpc2tfc3R5bGUgPSBfbm9ybWFsaXplX3Jpc2tfc3R5bGUoX3J1bnRpbWUuZ2V0KCJyaXNrX3N0eWxlIikpCiAgICB0b2tlbnMgPSBmZXRjaF9tYXJrZXRfZGF0YSgpIG9yIFtdCiAgICByZWdpbWUgPSBfY29tcHV0ZV9yZWdpbWUodG9rZW5zKQogICAgc29sX3Byb3h5ID0gX2NvbXB1dGVfc29sX3JlZ2ltZV9wcm94eSgpCiAgICBwb2xpY3kgPSBfYnVpbGRfbWFya2V0X3BvbGljeShyZWdpbWUsIHNvbF9wcm94eSkKCiAgICBpZiBub3QgdG9rZW5zOgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJ0b2tlbnMiOiAwLAogICAgICAgICAgICAicG9saWN5IjogcG9saWN5LAogICAgICAgICAgICAicmVnaW1lIjogcmVnaW1lLAogICAgICAgICAgICAiZ29vZCI6IFtdLAogICAgICAgICAgICAiYmFkIjogW10sCiAgICAgICAgICAgICJyZWdpbWVfYmxvY2tlZCI6IEZhbHNlLAogICAgICAgICAgICAidGllciI6IHRpZXJfa2V5LAogICAgICAgICAgICAidGllcl9ydWxlIjogdGllcl9ydWxlLAogICAgICAgICAgICAicmlza19zdHlsZSI6IHJpc2tfc3R5bGUsCiAgICAgICAgfQoKICAgIHJlZ2ltZV9taW4gPSBmbG9hdChwb2xpY3lbInJlZ2ltZV9taW5fc2NvcmUiXSkKICAgIHJlZ2ltZV9ibG9ja2VkID0gRU5BQkxFX1JFR0lNRV9HQVRFIGFuZCByZWdpbWVbInNjb3JlIl0gPCByZWdpbWVfbWluCgogICAgc2NvcmVkID0gW10KICAgIGZvciB0b2tlbiBpbiB0b2tlbnM6CiAgICAgICAgaWYgbm90IHRva2VuLmdldCgiYWRkcmVzcyIpOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgICMgRW5yaWNoIHdpdGggQmlyZEV5ZSBvdmVydmlldyBkYXRhICh1bmlxdWUgd2FsbGV0cywgc29jaWFsLCBldGMuKQogICAgICAgIHRva2VuID0gX2VucmljaF90b2tlbl9mb3Jfc2NvcmluZyh0b2tlbikKICAgICAgICB0b2tlblsiZW5naW5lX3Byb2ZpbGUiXSA9IF9tb2RlKCkKICAgICAgICBzY29yZSA9IGNhbGN1bGF0ZV90b2tlbl9zY29yZSh0b2tlbikKICAgICAgICBjb25maWRlbmNlID0gX2NvbmZpZGVuY2VfZnJvbV9zY29yZShzY29yZSkKICAgICAgICB0b2tlblsic2NvcmUiXSA9IHNjb3JlCiAgICAgICAgdG9rZW5bImNvbmZpZGVuY2UiXSA9IGNvbmZpZGVuY2UKICAgICAgICBzY29yZWQuYXBwZW5kKHRva2VuKQoKICAgIHNjb3JlZC5zb3J0KGtleT1sYW1iZGEgdDogKGZsb2F0KHQuZ2V0KCJzY29yZSIsIDApIG9yIDApLCBmbG9hdCh0LmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApKSwgcmV2ZXJzZT1UcnVlKQoKICAgIGdvb2QgPSBbXQogICAgYmFkID0gW10KICAgIHJlcXVpcmVkX2NvbmYgPSBfc3RyaWN0ZXJfY29uZmlkZW5jZShwb2xpY3lbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0sIHRpZXJfcnVsZVsibWluX2NvbmZpZGVuY2UiXSkKICAgIHJlcXVpcmVkX3Njb3JlID0gZmxvYXQocG9saWN5WyJhbGVydF90aHJlc2hvbGQiXSkgKyBmbG9hdCh0aWVyX3J1bGVbIm1pbl9zY29yZV9kZWx0YSJdKQogICAgcmVxdWlyZWRfc2NvcmUgPSBtYXgoMC4wLCBtaW4oMTAwLjAsIHJlcXVpcmVkX3Njb3JlKSkKICAgIHdhbGxldF90YXJnZXQgPSAiVzMiIGlmIHRpZXJfa2V5ID09ICJhZ2dyZXNzaXZlIiBlbHNlICgiVzEvVzIiIGlmIHRpZXJfa2V5ID09ICJjb25zZXJ2YXRpdmUiIGVsc2UgIlcyIikKCiAgICBmb3IgdG9rZW4gaW4gc2NvcmVkOgogICAgICAgIHN5bWJvbCA9IHRva2VuLmdldCgic3ltYm9sIikgb3IgIlVOS05PV04iCiAgICAgICAgcmVhc29ucyA9IFtdCiAgICAgICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW4uZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKQogICAgICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgICAgIHZvbF90b19saXEgPSAodm9sdW1lXzI0aCAvIGxpcXVpZGl0eSkgaWYgbGlxdWlkaXR5ID4gMCBlbHNlIDAuMAoKICAgICAgICB0b2tlblsid2FsbGV0X2ZpdCJdID0gd2FsbGV0X3RhcmdldAogICAgICAgIHJpc2tfcGxhbiwgcm90YXRpb25fcGxhbiA9IF93YWxsZXRfZ3VpZGFuY2Uod2FsbGV0X3RhcmdldCkKICAgICAgICB0b2tlblsicmlza19wbGFuIl0gPSByaXNrX3BsYW4KICAgICAgICB0b2tlblsicm90YXRpb25fcGxhbiJdID0gcm90YXRpb25fcGxhbgoKICAgICAgICBpZiBub3QgX3Bhc3Nlc19xdWFsaXR5X2ZpbHRlcnModG9rZW4pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZCgiZmFpbHMgYmFzZSBxdWFsaXR5IGZpbHRlcnMiKQogICAgICAgIGlmIG5vdCBfcGFzc2VzX2V4ZWN1dGlvbl9xdWFsaXR5X2ZpbHRlcnModG9rZW4pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZCgiZmFpbHMgZXhlY3V0aW9uIHF1YWxpdHkgZmlsdGVycyIpCiAgICAgICAgaWYgbm90IF9wYXNzZXNfdGFjdGljYWxfZmlsdGVycyh0b2tlbik6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJmYWlscyB0YWN0aWNhbCBjb25maXJtYXRpb24iKQogICAgICAgIGlmIGxpcXVpZGl0eSA8IGZsb2F0KHRpZXJfcnVsZVsibWluX2xpcXVpZGl0eSJdKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoZiJsaXE8JHtpbnQodGllcl9ydWxlWydtaW5fbGlxdWlkaXR5J10pOix9IikKICAgICAgICBpZiB2b2x1bWVfMjRoIDwgZmxvYXQodGllcl9ydWxlWyJtaW5fdm9sdW1lXzI0aCJdKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoZiJ2b2wyNGg8JHtpbnQodGllcl9ydWxlWydtaW5fdm9sdW1lXzI0aCddKTosfSIpCiAgICAgICAgaWYgY2hhbmdlXzI0aCA8IGZsb2F0KHRpZXJfcnVsZVsibWluX2NoYW5nZV8yNGgiXSk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKGYiMjRoPHt0aWVyX3J1bGVbJ21pbl9jaGFuZ2VfMjRoJ106Ky4xZn0lIikKICAgICAgICBpZiBhYnMoY2hhbmdlXzI0aCkgPiBmbG9hdCh0aWVyX3J1bGVbIm1heF9hYnNfY2hhbmdlXzI0aCJdKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoZiJ8MjRofD57dGllcl9ydWxlWydtYXhfYWJzX2NoYW5nZV8yNGgnXTouMGZ9JSIpCiAgICAgICAgaWYgdm9sX3RvX2xpcSA+IGZsb2F0KHRpZXJfcnVsZVsibWF4X3ZvbF90b19saXEiXSk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJ0dXJub3ZlciBvdmVyaGVhdGVkIikKICAgICAgICBpZiBmbG9hdCh0b2tlbi5nZXQoInNjb3JlIiwgMCkgb3IgMCkgPCByZXF1aXJlZF9zY29yZToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoZiJzY29yZTx7cmVxdWlyZWRfc2NvcmU6LjFmfSIpCiAgICAgICAgaWYgbm90IF9jb25maWRlbmNlX21lZXRzX3J1bGUodG9rZW4uZ2V0KCJjb25maWRlbmNlIiwgIkMiKSwgcmVxdWlyZWRfY29uZik6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKGYiY29uZmlkZW5jZTx7cmVxdWlyZWRfY29uZn0iKQogICAgICAgIGlmIF9pc19zeW1ib2xfb25fY29vbGRvd24oc3ltYm9sLCBjb29sZG93bl9ob3Vycz1wb2xpY3lbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZCgiY29vbGRvd24gYWN0aXZlIikKICAgICAgICBpZiBfYXBwbHlfc3ltYm9sX2NvbnRyb2xzKHN5bWJvbCk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJzeW1ib2wgY29udHJvbCBhY3RpdmUiKQogICAgICAgIGlmIHJlZ2ltZV9ibG9ja2VkIGFuZCBub3QgYm9vbCh0aWVyX3J1bGVbImFsbG93X3Jpc2tfb2ZmIl0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZCgicmVnaW1lIGdhdGUgYmxvY2tlZCIpCiAgICAgICAgaWYgcG9saWN5WyJzdGF0ZSJdIGluIHsiUklTS19PRkYiLCAiRVhUUkVNRV9SSVNLX09GRiJ9IGFuZCBub3QgYm9vbCh0aWVyX3J1bGVbImFsbG93X3Jpc2tfb2ZmIl0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZCgicmlzay1vZmYgc3RhdGUiKQoKICAgICAgICBpZiBub3QgcmVhc29uczoKICAgICAgICAgICAgZ29vZC5hcHBlbmQodG9rZW4pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYmFkLmFwcGVuZCgodG9rZW4sIHJlYXNvbnMpKQoKICAgIHJldHVybiB7CiAgICAgICAgInRva2VucyI6IGxlbihzY29yZWQpLAogICAgICAgICJwb2xpY3kiOiBwb2xpY3ksCiAgICAgICAgInJlZ2ltZSI6IHJlZ2ltZSwKICAgICAgICAiZ29vZCI6IGdvb2RbOm1heCgxLCBsaW1pdF9nb29kKV0sCiAgICAgICAgImJhZCI6IGJhZFs6bWF4KDEsIGxpbWl0X2JhZCldLAogICAgICAgICJyZWdpbWVfYmxvY2tlZCI6IHJlZ2ltZV9ibG9ja2VkLAogICAgICAgICJ0aWVyIjogdGllcl9rZXksCiAgICAgICAgInRpZXJfcnVsZSI6IHRpZXJfcnVsZSwKICAgICAgICAicmlza19zdHlsZSI6IHJpc2tfc3R5bGUsCiAgICB9CgoKZGVmIF9mb3JtYXRfbWFya2V0X25vd19tZXNzYWdlKHNuYXBzaG90OiBkaWN0LCBtb2RlOiBzdHIgPSAiYm90aCIpIC0+IHN0cjoKICAgIHBvbGljeSA9IHNuYXBzaG90WyJwb2xpY3kiXQogICAgcmVnaW1lID0gc25hcHNob3RbInJlZ2ltZSJdCiAgICB0aWVyX3J1bGUgPSBzbmFwc2hvdC5nZXQoInRpZXJfcnVsZSIpIG9yIHt9CiAgICB0aWVyX2xhYmVsID0gdGllcl9ydWxlLmdldCgibGFiZWwiKSBvciBzdHIoc25hcHNob3QuZ2V0KCJ0aWVyIikgb3IgIkJhbGFuY2VkIikudGl0bGUoKQogICAgcmlza19zdHlsZSA9IF9ub3JtYWxpemVfcmlza19zdHlsZShzbmFwc2hvdC5nZXQoInJpc2tfc3R5bGUiKSkKICAgIGhlYWRlciA9ICgKICAgICAgICBmIk1BUktFVCBOT1cgfCB7X21vZGUoKS51cHBlcigpfSB8IHt0aWVyX2xhYmVsfVxuIgogICAgICAgIGYiUmlzayBQcm9maWxlOiB7X3Jpc2tfc3R5bGVfbGFiZWwocmlza19zdHlsZSl9XG4iCiAgICAgICAgZiJTdGF0ZToge3BvbGljeVsnc3RhdGUnXX0gfCBTY29yZSBUaHI6IHtpbnQocG9saWN5WydhbGVydF90aHJlc2hvbGQnXSl9IHwgQ29uZjoge3BvbGljeVsnbWluX2NvbmZpZGVuY2VfdG9fYWxlcnQnXX1cbiIKICAgICAgICBmIlJlZ2ltZToge3JlZ2ltZVsnbGFiZWwnXX0gKHtyZWdpbWVbJ3Njb3JlJ106LjFmfS97cG9saWN5WydyZWdpbWVfbWluX3Njb3JlJ106LjFmfSlcbiIKICAgICAgICBmIlVuaXZlcnNlOiB7c25hcHNob3RbJ3Rva2VucyddfSB0b2tlbnNcbiIKICAgICAgICBmIlRpZXIgR2F0ZXM6IGxpcT49e19mbXRfdXNkX2NvbXBhY3RfbWFpbih0aWVyX3J1bGUuZ2V0KCdtaW5fbGlxdWlkaXR5JykpfSAiCiAgICAgICAgZiJ2b2w+PXtfZm10X3VzZF9jb21wYWN0X21haW4odGllcl9ydWxlLmdldCgnbWluX3ZvbHVtZV8yNGgnKSl9IgogICAgKQoKICAgIGxpbmVzID0gW2hlYWRlcl0KCiAgICBpZiBpbnQoc25hcHNob3QuZ2V0KCJ0b2tlbnMiLCAwKSkgPT0gMDoKICAgICAgICBsaW5lcy5hcHBlbmQoIlxuRGF0YSBmZWVkIHVuYXZhaWxhYmxlIHJpZ2h0IG5vdy4gVHJ5IGFnYWluIGluIDEtMiBtaW51dGVzLiIpCiAgICAgICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCiAgICBpZiBtb2RlIGluIHsiYm90aCIsICJnb29kIn06CiAgICAgICAgbGluZXMuYXBwZW5kKCJcbkdPT0QgQlVZUyBOT1ciKQogICAgICAgIGlmIHNuYXBzaG90WyJnb29kIl06CiAgICAgICAgICAgIGZvciBpZHgsIHRva2VuIGluIGVudW1lcmF0ZShzbmFwc2hvdFsiZ29vZCJdLCBzdGFydD0xKToKICAgICAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICBmIntpZHh9LiAke3Rva2VuLmdldCgnc3ltYm9sJywnVU5LTk9XTicpfSB8IHNjb3JlIHtmbG9hdCh0b2tlbi5nZXQoJ3Njb3JlJywwKSBvciAwKTouMWZ9IHwgIgogICAgICAgICAgICAgICAgICAgIGYie3Rva2VuLmdldCgnY29uZmlkZW5jZScsJ0MnKX0gfCAyNGgge2Zsb2F0KHRva2VuLmdldCgnY2hhbmdlXzI0aCcsMCkgb3IgMCk6Ky4xZn0lIHwgIgogICAgICAgICAgICAgICAgICAgIGYibGlxIHtfZm10X3VzZF9jb21wYWN0X21haW4odG9rZW4uZ2V0KCdsaXF1aWRpdHknKSl9IHwgZml0IHt0b2tlbi5nZXQoJ3dhbGxldF9maXQnLCdXMicpfSIKICAgICAgICAgICAgICAgICkKICAgICAgICBlbHNlOgogICAgICAgICAgICBub3RlID0gIk5vbmUuIE1hcmtldCBpcyBzZWxlY3RpdmUgcmlnaHQgbm93LiIKICAgICAgICAgICAgaWYgc25hcHNob3QuZ2V0KCJyZWdpbWVfYmxvY2tlZCIpOgogICAgICAgICAgICAgICAgbm90ZSA9ICJOb25lLiBSZWdpbWUgZ2F0ZSBpcyBibG9ja2luZyBlbnRyaWVzIHJpZ2h0IG5vdy4iCiAgICAgICAgICAgIGxpbmVzLmFwcGVuZChub3RlKQoKICAgIGlmIG1vZGUgaW4geyJib3RoIiwgImJhZCJ9OgogICAgICAgIGxpbmVzLmFwcGVuZCgiXG5CQUQgQlVZUyBOT1ciKQogICAgICAgIGlmIHNuYXBzaG90WyJiYWQiXToKICAgICAgICAgICAgZm9yIGlkeCwgaXRlbSBpbiBlbnVtZXJhdGUoc25hcHNob3RbImJhZCJdLCBzdGFydD0xKToKICAgICAgICAgICAgICAgIHRva2VuLCByZWFzb25zID0gaXRlbQogICAgICAgICAgICAgICAgcmVhc29uc190ZXh0ID0gIjsgIi5qb2luKHJlYXNvbnNbOjNdKQogICAgICAgICAgICAgICAgbGluZXMuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgIGYie2lkeH0uICR7dG9rZW4uZ2V0KCdzeW1ib2wnLCdVTktOT1dOJyl9IHwgMjRoIHtmbG9hdCh0b2tlbi5nZXQoJ2NoYW5nZV8yNGgnLDApIG9yIDApOisuMWZ9JSB8IHtyZWFzb25zX3RleHR9IgogICAgICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgiTm8gb2J2aW91cyBhdm9pZCBsaXN0IGZyb20gY3VycmVudCB1bml2ZXJzZS4iKQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIF9mb3JtYXRfbWFya2V0X25vd19tdWx0aV90aWVyKG1vZGU6IHN0ciA9ICJib3RoIikgLT4gc3RyOgogICAgc2VjdGlvbnMgPSBbXQogICAgZm9yIHRpZXIgaW4gKCJjb25zZXJ2YXRpdmUiLCAiYmFsYW5jZWQiLCAiYWdncmVzc2l2ZSIpOgogICAgICAgIHNuYXAgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9MywgbGltaXRfYmFkPTMsIHRpZXI9dGllcikKICAgICAgICBzZWN0aW9ucy5hcHBlbmQoX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT1tb2RlKSkKICAgIHJldHVybiAiXG5cbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4iLmpvaW4oc2VjdGlvbnMpCgoKZGVmIF90aWVyX2FyZ19vcl9kZWZhdWx0KGFyZ3MsIGRlZmF1bHQ6IHN0ciA9ICJiYWxhbmNlZCIpOgogICAgaWYgbm90IGFyZ3M6CiAgICAgICAgcmV0dXJuIGRlZmF1bHQKICAgIHJhdyA9IHN0cihhcmdzWzBdKS5zdHJpcCgpLmxvd2VyKCkKICAgIGlmIHJhdyA9PSAiYWxsIjoKICAgICAgICByZXR1cm4gImFsbCIKICAgIHJldHVybiBfbm9ybWFsaXplX21hcmtldF90aWVyKHJhdykKCgpkZWYgX2Zvcm1hdF93YWxsZXQyX21lc3NhZ2UobW9kZTogc3RyID0gImJvdGgiKSAtPiBzdHI6CiAgICBiYXNlID0gX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPTUsIGxpbWl0X2JhZD01LCB0aWVyPSJiYWxhbmNlZCIpCiAgICBzdGF0ZSA9IHN0cigoYmFzZS5nZXQoInBvbGljeSIpIG9yIHt9KS5nZXQoInN0YXRlIikgb3IgIiIpCiAgICBzbmFwID0gYmFzZQogICAgaWYgc3RhdGUgaW4geyJSSVNLX09GRiIsICJFWFRSRU1FX1JJU0tfT0ZGIn06CiAgICAgICAgc25hcCA9IF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZD01LCBsaW1pdF9iYWQ9NSwgdGllcj0iY29uc2VydmF0aXZlIikKICAgIHJldHVybiBfd2FsbGV0X2hlYWRlcigiVzIiKSArICJcblxuIiArIF9mb3JtYXRfbWFya2V0X25vd19tZXNzYWdlKHNuYXAsIG1vZGU9bW9kZSkKCgpkZWYgX2Zvcm1hdF93YWxsZXQzX21lc3NhZ2UobW9kZTogc3RyID0gImJvdGgiKSAtPiBzdHI6CiAgICBzbmFwID0gX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPTUsIGxpbWl0X2JhZD01LCB0aWVyPSJhZ2dyZXNzaXZlIikKICAgIHJvd3MgPSBfYnVpbGRfd2F0Y2hsaXN0X3Jvd3MoKQogICAgbGl2ZV9yb3dzID0gW3IgZm9yIHIgaW4gcm93cyBpZiBib29sKHIuZ2V0KCJoYXNfbGl2ZV9kYXRhIiwgRmFsc2UpKV0KICAgIGdvb2Rfd2F0Y2ggPSBbCiAgICAgICAgciBmb3IgciBpbiBsaXZlX3Jvd3MKICAgICAgICBpZiBzdHIoci5nZXQoInN0YXR1cyIpIG9yICIiKS50aXRsZSgpIGluIHsiTW9tZW50dW0iLCAiUmVjbGFpbSJ9CiAgICAgICAgYW5kIHN0cihyLmdldCgiZmFpbHVyZV9yaXNrIikgb3IgIiIpLnRpdGxlKCkgIT0gIkhpZ2giCiAgICBdWzo0XQogICAgYmFkX3dhdGNoID0gWwogICAgICAgIHIgZm9yIHIgaW4gcm93cwogICAgICAgIGlmIHN0cihyLmdldCgic3RhdHVzIikgb3IgIiIpLnRpdGxlKCkgaW4geyJCcmVha2Rvd24iLCAiSWxsaXF1aWQiLCAiTm9EYXRhIn0KICAgICAgICBvciBzdHIoci5nZXQoImZhaWx1cmVfcmlzayIpIG9yICIiKS50aXRsZSgpID09ICJIaWdoIgogICAgXVs6NF0KCiAgICBsaW5lcyA9IFtfd2FsbGV0X2hlYWRlcigiVzMiKSwgIiJdCiAgICBpZiBtb2RlIGluIHsiYm90aCIsICJnb29kIn06CiAgICAgICAgbGluZXMuYXBwZW5kKCJXMyBXQVRDSExJU1QgT1BQT1JUVU5JVElFUyIpCiAgICAgICAgaWYgZ29vZF93YXRjaDoKICAgICAgICAgICAgZm9yIGlkeCwgciBpbiBlbnVtZXJhdGUoZ29vZF93YXRjaCwgc3RhcnQ9MSk6CiAgICAgICAgICAgICAgICBsaW5lcy5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgZiJ7aWR4fS4gJHtzdHIoci5nZXQoJ3N5bWJvbCcpIG9yICdVTktOT1dOJykudXBwZXIoKX0gfCB7ci5nZXQoJ3N0YXR1cycpfSB8ICIKICAgICAgICAgICAgICAgICAgICBmInVwc2lkZSB7ci5nZXQoJ3Vwc2lkZV9wb3RlbnRpYWwnLCdOL0EnKX0gfCByaXNrIHtyLmdldCgnZmFpbHVyZV9yaXNrJywnTi9BJyl9IHwgIgogICAgICAgICAgICAgICAgICAgIGYiMjRoIHtmbG9hdChyLmdldCgnY2hhbmdlXzI0aCcsMCkgb3IgMCk6Ky4xZn0lIgogICAgICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgiTm8gd2F0Y2hsaXN0IHNldHVwcyB3aXRoIGZhdm9yYWJsZSBhc3ltbWV0cnkgcmlnaHQgbm93LiIpCiAgICAgICAgbGluZXMuYXBwZW5kKCIiKQoKICAgIGlmIG1vZGUgaW4geyJib3RoIiwgImJhZCJ9OgogICAgICAgIGxpbmVzLmFwcGVuZCgiVzMgV0FUQ0hMSVNUIEFWT0lEL0NBVVRJT04iKQogICAgICAgIGlmIGJhZF93YXRjaDoKICAgICAgICAgICAgZm9yIGlkeCwgciBpbiBlbnVtZXJhdGUoYmFkX3dhdGNoLCBzdGFydD0xKToKICAgICAgICAgICAgICAgIHN0YXR1cyA9IHN0cihyLmdldCgic3RhdHVzIikgb3IgIlVua25vd24iKQogICAgICAgICAgICAgICAgcmVhc29uID0gc3RyKHIuZ2V0KCJyZWFzb24iKSBvciAiIikuc3RyaXAoKQogICAgICAgICAgICAgICAgaWYgcmVhc29uOgogICAgICAgICAgICAgICAgICAgIHJlYXNvbiA9IGYiIHwge3JlYXNvbn0iCiAgICAgICAgICAgICAgICBsaW5lcy5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgZiJ7aWR4fS4gJHtzdHIoci5nZXQoJ3N5bWJvbCcpIG9yICdVTktOT1dOJykudXBwZXIoKX0gfCB7c3RhdHVzfSB8ICIKICAgICAgICAgICAgICAgICAgICBmInJpc2sge3IuZ2V0KCdmYWlsdXJlX3Jpc2snLCdOL0EnKX17cmVhc29ufSIKICAgICAgICAgICAgICAgICkKICAgICAgICBlbHNlOgogICAgICAgICAgICBsaW5lcy5hcHBlbmQoIk5vIG1ham9yIHdhdGNobGlzdCBkYW5nZXIgZmxhZ3MgcmlnaHQgbm93LiIpCiAgICAgICAgbGluZXMuYXBwZW5kKCIiKQoKICAgIGlmIG1vZGUgaW4geyJib3RoIiwgImdvb2QifToKICAgICAgICBsaW5lcy5hcHBlbmQoX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT0iZ29vZCIpKQogICAgZWxpZiBtb2RlID09ICJiYWQiOgogICAgICAgIGxpbmVzLmFwcGVuZChfZm9ybWF0X21hcmtldF9ub3dfbWVzc2FnZShzbmFwLCBtb2RlPSJiYWQiKSkKICAgIGVsc2U6CiAgICAgICAgbGluZXMuYXBwZW5kKF9mb3JtYXRfbWFya2V0X25vd19tZXNzYWdlKHNuYXAsIG1vZGU9ImJvdGgiKSkKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKYXN5bmMgZGVmIGNtZF9oZWxwKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJDb21tYW5kczpcbiIKICAgICAgICAiL3N0YXR1cyAtIEVuZ2luZSBoZWFsdGggc25hcHNob3RcbiIKICAgICAgICAiL21vZGUgW3N0cmF0ZWdpY3x0YWN0aWNhbF0gLSBTd2l0Y2ggcnVudGltZSArIHBlcnNpc3QgcHJlc2V0XG4iCiAgICAgICAgIi9yaXNrcHJvZmlsZSBbY2FwaXRhbHxiYWxhbmNlZHxzbmlwZXJdIC0gU2V0IG1hcmtldCBzY2FuIHJpc2sgc3R5bGVcbiIKICAgICAgICAiL3Jpc2sgLSBSaXNrIGdvdmVybm9yIHN0YXRlXG4iCiAgICAgICAgIi9wYXVzZSBbaG91cnNdIC0gUGF1c2UgYWxlcnRzXG4iCiAgICAgICAgIi9yZXN1bWUgLSBDbGVhciBwYXVzZVxuIgogICAgICAgICIvcGVyZm9ybWFuY2UgLSAyNGgvN2QgcGVyZm9ybWFuY2UgcGFuZWxcbiIKICAgICAgICAiL2J1eSA8c3ltYm9sX29yX21pbnQ+IFtlbnRyeV0gLSBTdGFydCB0cmFja2VkIHBvc2l0aW9uIChlbmFibGVzIHNlbGwgYWxlcnRzKVxuIgogICAgICAgICIvc29sZCA8c3ltYm9sX29yX21pbnQ+IFtleGl0XSAtIENsb3NlIHRyYWNrZWQgcG9zaXRpb25cbiIKICAgICAgICAiL3Bvc2l0aW9ucyAtIFNob3cgdHJhY2tlZCBvcGVuIHBvc2l0aW9uc1xuIgogICAgICAgICIvZGlnZXN0IC0gU2VuZCBpbW1lZGlhdGUgc2V0dXAgZGlnZXN0XG4iCiAgICAgICAgIi9tYXJrZXRub3cgW2NvbnNlcnZhdGl2ZXxiYWxhbmNlZHxhZ2dyZXNzaXZlfGFsbF0gLSBHb29kK2JhZCBub3dcbiIKICAgICAgICAiL2dvb2RidXkgW2NvbnNlcnZhdGl2ZXxiYWxhbmNlZHxhZ2dyZXNzaXZlfGFsbF0gLSBHb29kIGJ1eXMgbm93XG4iCiAgICAgICAgIi9iYWRidXkgW2NvbnNlcnZhdGl2ZXxiYWxhbmNlZHxhZ2dyZXNzaXZlfGFsbF0gLSBCYWQgYnV5cyBub3dcbiIKICAgICAgICAiL3dhbGxldDJub3cgLSBXYWxsZXQgMiBnb29kIGJ1eXMgbm93XG4iCiAgICAgICAgIi93YWxsZXQyYmFkIC0gV2FsbGV0IDIgYXZvaWRzIG5vd1xuIgogICAgICAgICIvd2FsbGV0M25vdyAtIFdhbGxldCAzIG9wcG9ydHVuaXRpZXMgbm93XG4iCiAgICAgICAgIi93YWxsZXQzYmFkIC0gV2FsbGV0IDMgZGFuZ2VyIGxpc3Qgbm93XG4iCiAgICAgICAgIi93YWxsZXRwbGFuIC0gV2FsbGV0IGFsbG9jYXRpb24vcmlzayBwbGF5Ym9va1xuIgogICAgICAgICIvcnVubmVyd2F0Y2ggLSBSdW4gZmlyc3QtZGF5IHJ1bm5lciB3YXRjaCBzY2FuIG5vd1xuIgogICAgICAgICIvd2F0Y2hsaXN0IC0gUnVuIG1hbnVhbCB3YXRjaGxpc3Qgc2NhbiBub3dcbiIKICAgICAgICAiL3dhdGNobGlzdHN1bW1hcnkgLSBTZW5kIGZ1bGwgbWFudWFsIHdhdGNobGlzdCBzdW1tYXJ5IG5vd1xuIgogICAgICAgICJBdXRvIGpvYnM6IDMtdGllciBib2FyZCAoNmgpICsgZGFpbHkgcmVjYXAgKyBzZWxsL2V4aXQgc2Nhbm5lciAob25seSB0cmFja2VkIHBvc2l0aW9ucylcbiIKICAgICAgICAiL2hlbHAgLSBUaGlzIG1lbnUiCiAgICApCgoKYXN5bmMgZGVmIGNtZF9zdGF0dXModXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgaGVhbHRoID0gZ2V0X2VuZ2luZV9oZWFsdGhfc25hcHNob3QoKQogICAgcGVyZiA9IGdldF9wZXJmb3JtYW5jZV9zdW1tYXJ5KGxvb2tiYWNrX2hvdXJzPTI0KQogICAgcGF1c2UgPSBnZXRfcmlza19wYXVzZV9zdGF0ZSgpCiAgICBsYXRlc3QgPSBnZXRfbGF0ZXN0X2VuZ2luZV9ldmVudCgpIG9yIHt9CiAgICBibG9ja2VyID0gKAogICAgICAgIGYie2xhdGVzdC5nZXQoJ2RlY2lzaW9uJyl9IHwge2xhdGVzdC5nZXQoJ25vdGVzJywgJycpfSIKICAgICAgICBpZiBsYXRlc3QuZ2V0KCJkZWNpc2lvbiIpCiAgICAgICAgZWxzZSAiTi9BIgogICAgKQogICAgc2VwID0gIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIKICAgIGxlZ2FjeV9zdGF0dXMgPSAiT04iIGlmIExFR0FDWV9SRUNPVkVSWV9FTkFCTEVEIGVsc2UgIk9GRiIKICAgIGxpbmVzID0gWwogICAgICAgIGYiPGI+8J+kliBbU1RBVFVTXTogRU5HSU5FPC9iPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e19jdXJyZW50X21vZGVfdGV4dCgpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflZAgTGFzdCBzY2FuOiAgIHtfZm10X2R0KGhlYWx0aC5nZXQoJ2xhc3Rfc2Nhbl9ydW4nKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OiIExhc3QgYWxlcnQ6ICB7X2ZtdF9kdChoZWFsdGguZ2V0KCdsYXN0X2FsZXJ0JykpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TiiAyNGggc3RhdHM6ICAge3BlcmZbJ3NjYW5zJ119IHNjYW5zIC8ge3BlcmZbJ2FsZXJ0cyddfSBhbGVydHMgKHtwZXJmWydhbGVydF9yYXRlJ106LjFmfSUpPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7ij7ggIFBhdXNlIHVudGlsOiB7X2ZtdF9kdChwYXVzZS5nZXQoJ3BhdXNlX3VudGlsJykpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflI4gTEVHQUNZIFJFQ09WRVJZOiB7bGVnYWN5X3N0YXR1c308L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPiAgIEFnZSDiiaV7TEVHQUNZX1JFQ09WRVJZX01JTl9BR0VfREFZUzouMGZ9ZCB8IExpcSDiiaUke0xFR0FDWV9SRUNPVkVSWV9NSU5fTElRVUlESVRZLzFlNjouMWZ9TSB8IFZvbCDiiaUke0xFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SC8xZTM6LjBmfUs8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7imqEgTGF0ZXN0IGV2ZW50OiB7aHRtbC5lc2NhcGUoc3RyKGJsb2NrZXIpKX08L2NvZGU+IiwKICAgIF0KICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJcbiIuam9pbihsaW5lcyksCiAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICApCgoKYXN5bmMgZGVmIGNtZF9tb2RlKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGlmIG5vdCBjb250ZXh0LmFyZ3M6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICJVc2FnZTogL21vZGUgc3RyYXRlZ2ljIG9yIC9tb2RlIHRhY3RpY2FsXG5cbiIKICAgICAgICAgICAgZiJ7X2N1cnJlbnRfbW9kZV90ZXh0KCl9IgogICAgICAgICkKICAgICAgICByZXR1cm4KCiAgICBtb2RlID0gY29udGV4dC5hcmdzWzBdLnN0cmlwKCkubG93ZXIoKQogICAgaWYgbW9kZSBub3QgaW4gX01PREVfUFJFU0VUUzoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiSW52YWxpZCBtb2RlLiBVc2U6IHN0cmF0ZWdpYyBvciB0YWN0aWNhbCIpCiAgICAgICAgcmV0dXJuCgogICAgX2FwcGx5X21vZGUobW9kZSkKICAgIF9wZXJzaXN0X21vZGUobW9kZSkKICAgIF9yZXNjaGVkdWxlX3J1bl9lbmdpbmVfam9icyhjb250ZXh0LmFwcGxpY2F0aW9uKQogICAgbG9nX3NpZ25hbCgKICAgICAgICB7CiAgICAgICAgICAgICJzeW1ib2wiOiAiRU5HSU5FIiwKICAgICAgICAgICAgImRlY2lzaW9uIjogIk1PREVfU1dJVENIIiwKICAgICAgICAgICAgIm5vdGVzIjogZiJ0ZWxlZ3JhbSBtb2RlIHN3aXRjaCAtPiB7bW9kZX0iLAogICAgICAgIH0KICAgICkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJNb2RlIHN3aXRjaGVkIGFuZCBwZXJzaXN0ZWQuXG5cbiIKICAgICAgICBmIntfY3VycmVudF9tb2RlX3RleHQoKX0iCiAgICApCgoKYXN5bmMgZGVmIGNtZF9yaXNrcHJvZmlsZSh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCgogICAgY3VycmVudCA9IF9ub3JtYWxpemVfcmlza19zdHlsZShfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSkKICAgIGlmIG5vdCBjb250ZXh0LmFyZ3M6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICJVc2FnZTogL3Jpc2twcm9maWxlIGNhcGl0YWwgfCBiYWxhbmNlZCB8IHNuaXBlclxuXG4iCiAgICAgICAgICAgIGYiQ3VycmVudDoge19yaXNrX3N0eWxlX2xhYmVsKGN1cnJlbnQpfSAoe2N1cnJlbnR9KVxuIgogICAgICAgICAgICBmIntfcmlza19zdHlsZV9kZXNjcmlwdGlvbihjdXJyZW50KX0iCiAgICAgICAgKQogICAgICAgIHJldHVybgoKICAgIHJhdyA9IHN0cihjb250ZXh0LmFyZ3NbMF0pLnN0cmlwKCkubG93ZXIoKQogICAgcmVzb2x2ZWQgPSBfUklTS19TVFlMRV9BTElBU0VTLmdldChyYXcpCiAgICBpZiBub3QgcmVzb2x2ZWQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICJJbnZhbGlkIHJpc2sgcHJvZmlsZS4gVXNlOiBjYXBpdGFsLCBiYWxhbmNlZCwgb3Igc25pcGVyLiIKICAgICAgICApCiAgICAgICAgcmV0dXJuCgogICAgX3J1bnRpbWVbInJpc2tfc3R5bGUiXSA9IHJlc29sdmVkCiAgICBfc2V0X2Vudl92YWx1ZXMoeyJSSVNLX1NUWUxFIjogcmVzb2x2ZWR9KQogICAgbG9nX3NpZ25hbCgKICAgICAgICB7CiAgICAgICAgICAgICJzeW1ib2wiOiAiRU5HSU5FIiwKICAgICAgICAgICAgImRlY2lzaW9uIjogIlJJU0tfU1RZTEVfU1dJVENIIiwKICAgICAgICAgICAgIm5vdGVzIjogZiJ0ZWxlZ3JhbSByaXNrIHN0eWxlIHN3aXRjaCAtPiB7cmVzb2x2ZWR9IiwKICAgICAgICB9CiAgICApCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAiUmlzayBwcm9maWxlIHVwZGF0ZWQgYW5kIHBlcnNpc3RlZC5cblxuIgogICAgICAgIGYie19jdXJyZW50X21vZGVfdGV4dCgpfVxuIgogICAgICAgIGYiU3R5bGUgZGV0YWlsOiB7X3Jpc2tfc3R5bGVfZGVzY3JpcHRpb24ocmVzb2x2ZWQpfSIKICAgICkKCgphc3luYyBkZWYgY21kX3BhdXNlKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGhvdXJzID0gNgogICAgaWYgY29udGV4dC5hcmdzOgogICAgICAgIHRyeToKICAgICAgICAgICAgaG91cnMgPSBtYXgoMSwgaW50KGNvbnRleHQuYXJnc1swXSkpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgIHNldF9yaXNrX3BhdXNlKGhvdXJzLCAibWFudWFsX3RlbGVncmFtX3BhdXNlIikKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KGYiQWxlcnRzIHBhdXNlZCBmb3Ige2hvdXJzfWguIikKCgphc3luYyBkZWYgY21kX3Jlc3VtZSh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBjbGVhcl9yaXNrX3BhdXNlKCkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJBbGVydHMgcmVzdW1lZCAocGF1c2UgY2xlYXJlZCkuIikKCgphc3luYyBkZWYgY21kX3Jpc2sodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgcGF1c2UgPSBnZXRfcmlza19wYXVzZV9zdGF0ZSgpCiAgICBzdHJlYWsgPSBnZXRfY29uc2VjdXRpdmVfbG9zaW5nX291dGNvbWVzXzRoKGxpbWl0PTEwMCkKICAgIGFsZXJ0c18yNGggPSBjb3VudF9hbGVydHNfc2luY2UoZGF0ZXRpbWUudXRjbm93KCkgLSB0aW1lZGVsdGEoaG91cnM9MjQpKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgIlJpc2sgUGFuZWxcbiIKICAgICAgICBmIkdvdmVybm9yOiB7J09OJyBpZiBFTkFCTEVfUklTS19HT1ZFUk5PUiBlbHNlICdPRkYnfVxuIgogICAgICAgIGYiQWxlcnRzIDI0aDoge2FsZXJ0c18yNGh9L3tNQVhfQUxFUlRTX1BFUl9EQVl9XG4iCiAgICAgICAgZiJDb25zZWN1dGl2ZSBsb3NpbmcgNGggb3V0Y29tZXM6IHtzdHJlYWt9L3tNQVhfQ09OU0VDVVRJVkVfNEhfTE9TU0VTfVxuIgogICAgICAgIGYiUGF1c2UgdW50aWw6IHtfZm10X2R0KHBhdXNlLmdldCgncGF1c2VfdW50aWwnKSl9XG4iCiAgICAgICAgZiJQYXVzZSByZWFzb246IHtwYXVzZS5nZXQoJ3JlYXNvbicpIG9yICdOL0EnfSIKICAgICkKCgphc3luYyBkZWYgY21kX3BlcmZvcm1hbmNlKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIHBlcmYgPSBnZXRfcGVyZm9ybWFuY2Vfc3VtbWFyeShsb29rYmFja19ob3Vycz0yNCkKICAgIHNpbSA9IGdldF9wb3J0Zm9saW9fc2ltdWxhdGlvbl9tZXRyaWNzKGxvb2tiYWNrX2RheXM9NywgaG9yaXpvbl9ob3Vycz00KQogICAgcXVldWUgPSBnZXRfb3V0Y29tZV9xdWV1ZV9zdGF0cygpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAiUGVyZm9ybWFuY2UgUGFuZWxcbiIKICAgICAgICBmIjI0aCBzY2Fucy9hbGVydHM6IHtwZXJmWydzY2FucyddfS97cGVyZlsnYWxlcnRzJ119ICh7cGVyZlsnYWxlcnRfcmF0ZSddOi4xZn0lKVxuIgogICAgICAgIGYiQXZnL01heCBzY29yZToge3BlcmZbJ2F2Z19zY29yZSddOi4yZn0ve3BlcmZbJ21heF9zY29yZSddOi4yZn1cbiIKICAgICAgICBmIlNpbSA3ZEA0aDogdHJhZGVzPXtzaW1bJ3RyYWRlcyddfSB3aW49e3NpbVsnd2luX3JhdGVfcGN0J106LjFmfSUgIgogICAgICAgIGYiZXhwPXtzaW1bJ2V4cGVjdGFuY3lfcGN0J106LjJmfSUgZGQ9e3NpbVsnbWF4X2RyYXdkb3duX3BjdCddOi4yZn0lXG4iCiAgICAgICAgZiJPdXRjb21lIHF1ZXVlOiBwZW5kaW5nPXtxdWV1ZVsncGVuZGluZyddfSBjb21wbGV0ZT17cXVldWVbJ2NvbXBsZXRlJ119IgogICAgKQoKCmFzeW5jIGRlZiBjbWRfYnV5KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGlmIG5vdCBjb250ZXh0LmFyZ3M6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICJVc2FnZTogL2J1eSA8U1lNQk9MX29yX01JTlQ+IFtlbnRyeV9wcmljZV1cbiIKICAgICAgICAgICAgIkV4YW1wbGU6IC9idXkgUFVNUCAwLjAwNDIiCiAgICAgICAgKQogICAgICAgIHJldHVybgoKICAgIHN5bWJvbCwgbWludCA9IF9wYXJzZV9zeW1ib2xfb3JfbWludChjb250ZXh0LmFyZ3NbMF0pCiAgICBpZiBub3Qgc3ltYm9sIGFuZCBub3QgbWludDoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiSW52YWxpZCBzeW1ib2wvbWludC4gRXhhbXBsZTogL2J1eSBQVU1QIG9yIC9idXkgPG1pbnQ+IikKICAgICAgICByZXR1cm4KCiAgICBlbnRyeV9vdmVycmlkZSA9IE5vbmUKICAgIGlmIGxlbihjb250ZXh0LmFyZ3MpID49IDI6CiAgICAgICAgZW50cnlfb3ZlcnJpZGUgPSBfdHJ5X2Zsb2F0KGNvbnRleHQuYXJnc1sxXSkKICAgICAgICBpZiBlbnRyeV9vdmVycmlkZSBpcyBOb25lIG9yIGVudHJ5X292ZXJyaWRlIDw9IDA6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJJbnZhbGlkIGVudHJ5IHByaWNlLiBFeGFtcGxlOiAvYnV5IFBVTVAgMC4wMDQyIikKICAgICAgICAgICAgcmV0dXJuCgogICAgdG9rZW4gPSBfcmVzb2x2ZV90b2tlbl9mb3JfdHJhY2tpbmcoc3ltYm9sPXN5bWJvbCwgbWludD1taW50KQogICAgaWYgdG9rZW46CiAgICAgICAgc3ltYm9sID0gc3ltYm9sIG9yIHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpIG9yIE5vbmUKICAgICAgICBtaW50ID0gbWludCBvciB0b2tlbi5nZXQoImFkZHJlc3MiKQogICAgICAgIHBhaXJfYWRkcmVzcyA9IHRva2VuLmdldCgicGFpcl9hZGRyZXNzIikKICAgICAgICBsaXZlX3ByaWNlID0gX3RyeV9mbG9hdCh0b2tlbi5nZXQoInByaWNlIikpCiAgICBlbHNlOgogICAgICAgIHBhaXJfYWRkcmVzcyA9IE5vbmUKICAgICAgICBsaXZlX3ByaWNlID0gTm9uZQoKICAgIGlmIG5vdCBzeW1ib2wgYW5kIG1pbnQ6CiAgICAgICAgc3ltYm9sID0gc3RyKG1pbnQpWzoxMF0udXBwZXIoKQogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiQ291bGQgbm90IHJlc29sdmUgc3ltYm9sIGZvciB0cmFja2luZy4gVHJ5IC9idXkgPFNZTUJPTD4gPGVudHJ5X3ByaWNlPi4iKQogICAgICAgIHJldHVybgoKICAgIGVudHJ5X3ByaWNlID0gZW50cnlfb3ZlcnJpZGUgaWYgZW50cnlfb3ZlcnJpZGUgaXMgbm90IE5vbmUgZWxzZSAobGl2ZV9wcmljZSBpZiBsaXZlX3ByaWNlIGFuZCBsaXZlX3ByaWNlID4gMCBlbHNlIDAuMCkKICAgIHJlc3VsdCA9IG9wZW5fbWFudWFsX3Bvc2l0aW9uKAogICAgICAgIHN5bWJvbD1zeW1ib2wsCiAgICAgICAgbWludD1taW50LAogICAgICAgIHBhaXJfYWRkcmVzcz1wYWlyX2FkZHJlc3MsCiAgICAgICAgZW50cnlfcHJpY2U9ZW50cnlfcHJpY2UsCiAgICAgICAgc3RvcF9wcmljZT0oZW50cnlfcHJpY2UgKiAwLjkgaWYgZW50cnlfcHJpY2UgPiAwIGVsc2UgMC4wKSwKICAgICAgICBub3Rlcz0ibWFudWFsX3RlbGVncmFtX2J1eSIsCiAgICApCiAgICBwb3NpdGlvbiA9IHJlc3VsdC5nZXQoInBvc2l0aW9uIikgb3Ige30KICAgIGVudHJ5X291dCA9IF90cnlfZmxvYXQocG9zaXRpb24uZ2V0KCJlbnRyeV9wcmljZSIpKQogICAgbWludF9vdXQgPSBzdHIocG9zaXRpb24uZ2V0KCJtaW50Iikgb3IgbWludCBvciAiIikKCiAgICBpZiByZXN1bHQuZ2V0KCJjcmVhdGVkIik6CiAgICAgICAgbG9nX3NpZ25hbCgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICJtaW50IjogbWludF9vdXQgb3IgTm9uZSwKICAgICAgICAgICAgICAgICJwcmljZSI6IGVudHJ5X291dCwKICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJUUkFDS19QT1NJVElPTl9PUEVORUQiLAogICAgICAgICAgICAgICAgIm5vdGVzIjogIm1hbnVhbF90ZWxlZ3JhbV9idXkiLAogICAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIGVudHJ5X3RleHQgPSBmIntlbnRyeV9vdXQ6LjhmfSIgaWYgZW50cnlfb3V0IGFuZCBlbnRyeV9vdXQgPiAwIGVsc2UgIk4vQSIKICAgICAgICBsaW5lcyA9IFsKICAgICAgICAgICAgIlBvc2l0aW9uIHRyYWNrZWQuIiwKICAgICAgICAgICAgZiJTeW1ib2w6ICR7c3ltYm9sfSIsCiAgICAgICAgICAgIGYiRW50cnk6IHtlbnRyeV90ZXh0fSIsCiAgICAgICAgXQogICAgICAgIGlmIG1pbnRfb3V0OgogICAgICAgICAgICBsaW5lcy5hcHBlbmQoZiJNaW50OiB7bWludF9vdXR9IikKICAgICAgICBsaW5lcy5hcHBlbmQoIlNlbGwgYWxlcnRzIGFyZSBub3cgZW5hYmxlZCBmb3IgdGhpcyBwb3NpdGlvbiBvbmx5LiIpCiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIlxuIi5qb2luKGxpbmVzKSkKICAgICAgICByZXR1cm4KCiAgICBsb2dfc2lnbmFsKAogICAgICAgIHsKICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgIm1pbnQiOiBtaW50X291dCBvciBOb25lLAogICAgICAgICAgICAicHJpY2UiOiBlbnRyeV9vdXQsCiAgICAgICAgICAgICJkZWNpc2lvbiI6ICJUUkFDS19QT1NJVElPTl9BTFJFQURZX09QRU4iLAogICAgICAgICAgICAibm90ZXMiOiAibWFudWFsX3RlbGVncmFtX2J1eV9kdXBsaWNhdGUiLAogICAgICAgIH0KICAgICkKICAgIG9wZW5lZF90cyA9IHBvc2l0aW9uLmdldCgib3BlbmVkX3RzX3V0YyIpIG9yICJOL0EiCiAgICBlbnRyeV90ZXh0ID0gZiJ7ZW50cnlfb3V0Oi44Zn0iIGlmIGVudHJ5X291dCBhbmQgZW50cnlfb3V0ID4gMCBlbHNlICJOL0EiCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAiUG9zaXRpb24gYWxyZWFkeSB0cmFja2VkLlxuIgogICAgICAgIGYiU3ltYm9sOiAke3N5bWJvbH1cbiIKICAgICAgICBmIkVudHJ5OiB7ZW50cnlfdGV4dH1cbiIKICAgICAgICBmIk9wZW5lZDoge29wZW5lZF90c31cbiIKICAgICAgICAiVXNlIC9zb2xkIDxTWU1CT0w+IHdoZW4geW91IGV4aXQuIgogICAgKQoKCmFzeW5jIGRlZiBjbWRfc29sZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBpZiBub3QgY29udGV4dC5hcmdzOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAiVXNhZ2U6IC9zb2xkIDxTWU1CT0xfb3JfTUlOVD4gW2V4aXRfcHJpY2VdXG4iCiAgICAgICAgICAgICJFeGFtcGxlOiAvc29sZCBQVU1QIDAuMDA1MSIKICAgICAgICApCiAgICAgICAgcmV0dXJuCgogICAgc3ltYm9sLCBtaW50ID0gX3BhcnNlX3N5bWJvbF9vcl9taW50KGNvbnRleHQuYXJnc1swXSkKICAgIGlmIG5vdCBzeW1ib2wgYW5kIG5vdCBtaW50OgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJJbnZhbGlkIHN5bWJvbC9taW50LiBFeGFtcGxlOiAvc29sZCBQVU1QIikKICAgICAgICByZXR1cm4KCiAgICBleGl0X3ByaWNlID0gTm9uZQogICAgaWYgbGVuKGNvbnRleHQuYXJncykgPj0gMjoKICAgICAgICBleGl0X3ByaWNlID0gX3RyeV9mbG9hdChjb250ZXh0LmFyZ3NbMV0pCiAgICAgICAgaWYgZXhpdF9wcmljZSBpcyBOb25lIG9yIGV4aXRfcHJpY2UgPD0gMDoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIkludmFsaWQgZXhpdCBwcmljZS4gRXhhbXBsZTogL3NvbGQgUFVNUCAwLjAwNTEiKQogICAgICAgICAgICByZXR1cm4KCiAgICBjbG9zZWQgPSBjbG9zZV9tYW51YWxfcG9zaXRpb24oCiAgICAgICAgc3ltYm9sPXN5bWJvbCwKICAgICAgICBtaW50PW1pbnQsCiAgICAgICAgZXhpdF9wcmljZT1leGl0X3ByaWNlLAogICAgICAgIG5vdGVzPSJtYW51YWxfdGVsZWdyYW1fc29sZCIsCiAgICApCiAgICBsYWJlbCA9IHN5bWJvbCBvciAoc3RyKG1pbnQpWzoxMF0udXBwZXIoKSBpZiBtaW50IGVsc2UgIlVOS05PV04iKQogICAgaWYgY2xvc2VkIDw9IDA6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoZiJObyBvcGVuIHRyYWNrZWQgcG9zaXRpb24gZm91bmQgZm9yIHtsYWJlbH0uIikKICAgICAgICByZXR1cm4KCiAgICBsb2dfc2lnbmFsKAogICAgICAgIHsKICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCBvciBsYWJlbCwKICAgICAgICAgICAgIm1pbnQiOiBtaW50LAogICAgICAgICAgICAicHJpY2UiOiBleGl0X3ByaWNlLAogICAgICAgICAgICAiZGVjaXNpb24iOiAiVFJBQ0tfUE9TSVRJT05fQ0xPU0VEIiwKICAgICAgICAgICAgIm5vdGVzIjogZiJtYW51YWxfdGVsZWdyYW1fc29sZCBjb3VudD17Y2xvc2VkfSIsCiAgICAgICAgfQogICAgKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgZiJDbG9zZWQge2Nsb3NlZH0gdHJhY2tlZCBwb3NpdGlvbihzKSBmb3Ige2xhYmVsfS5cbiIKICAgICAgICAiU2VsbCBhbGVydHMgZm9yIHRoaXMgdG9rZW4gYXJlIG5vdyBkaXNhYmxlZCB1bmxlc3MgeW91IC9idXkgaXQgYWdhaW4uIgogICAgKQoKCmFzeW5jIGRlZiBjbWRfcG9zaXRpb25zKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIHJvd3MgPSBnZXRfb3Blbl9wb3NpdGlvbnMobGltaXQ9MzApCiAgICBpZiBub3Qgcm93czoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIk5vIG9wZW4gdHJhY2tlZCBwb3NpdGlvbnMuXG4iCiAgICAgICAgICAgICJTZWxsIGFsZXJ0cyBhcmUgY3VycmVudGx5IHBhdXNlZCBiZWNhdXNlIG5vdGhpbmcgaXMgbWFya2VkIGFzIGJvdWdodC5cbiIKICAgICAgICAgICAgIlVzZSAvYnV5IDxTWU1CT0w+IFtlbnRyeV9wcmljZV0uIgogICAgICAgICkKICAgICAgICByZXR1cm4KCiAgICBsaW5lcyA9IFsKICAgICAgICAiVHJhY2tlZCBPcGVuIFBvc2l0aW9ucyAoc2VsbCBhbGVydHMgb25seSBmb3IgdGhlc2UpOiIsCiAgICBdCiAgICBmb3IgaWR4LCByb3cgaW4gZW51bWVyYXRlKHJvd3MsIHN0YXJ0PTEpOgogICAgICAgIHN5bWJvbCA9IHN0cihyb3cuZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIpLnVwcGVyKCkKICAgICAgICBlbnRyeSA9IF90cnlfZmxvYXQocm93LmdldCgiZW50cnlfcHJpY2UiKSkKICAgICAgICBlbnRyeV90ZXh0ID0gZiJ7ZW50cnk6LjhmfSIgaWYgZW50cnkgYW5kIGVudHJ5ID4gMCBlbHNlICJOL0EiCiAgICAgICAgb3BlbmVkID0gc3RyKHJvdy5nZXQoIm9wZW5lZF90c191dGMiKSBvciAiTi9BIikKICAgICAgICBsaW5lcy5hcHBlbmQoZiJ7aWR4fS4gJHtzeW1ib2x9IHwgZW50cnkge2VudHJ5X3RleHR9IHwgb3BlbmVkIHtvcGVuZWR9IikKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJcbiIuam9pbihsaW5lcykpCgoKZGVmIF9idWlsZF9kaWdlc3RfbWVzc2FnZShyb3dzOiBsaXN0W2RpY3RdKSAtPiBzdHIgfCBOb25lOgogICAgaWYgbm90IHJvd3M6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHVuaXF1ZSA9IFtdCiAgICBzZWVuID0gc2V0KCkKICAgIGZvciByb3cgaW4gcm93czoKICAgICAgICBzeW1ib2wgPSByb3cuZ2V0KCJzeW1ib2wiKQogICAgICAgIGlmIG5vdCBzeW1ib2wgb3Igc3ltYm9sIGluIHNlZW46CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgc2Vlbi5hZGQoc3ltYm9sKQogICAgICAgIHVuaXF1ZS5hcHBlbmQocm93KQogICAgICAgIGlmIGxlbih1bmlxdWUpID49IFNJR05BTF9ESUdFU1RfTUFYX0lURU1TOgogICAgICAgICAgICBicmVhawogICAgaWYgbm90IHVuaXF1ZToKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGltcG9ydCBodG1sIGFzIF9odG1sCiAgICBkZWYgX2VzYyh2KToKICAgICAgICByZXR1cm4gX2h0bWwuZXNjYXBlKHN0cih2KSkKICAgIHNlcCA9ICLilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEiCiAgICBsaW5lcyA9IFsKICAgICAgICBmIjxiPvCfk6EgW1NJR05BTF06IERJR0VTVDwvYj4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCflZAgTE9PS0JBQ0s6IHtTSUdOQUxfRElHRVNUX0xPT0tCQUNLX0hPVVJTfWg8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk4ogU0VUVVBTOiB7bGVuKHVuaXF1ZSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgXQogICAgZm9yIGlkeCwgcm93IGluIGVudW1lcmF0ZSh1bmlxdWUsIHN0YXJ0PTEpOgogICAgICAgIHNjb3JlID0gZmxvYXQocm93LmdldCgic2NvcmVfdG90YWwiKSBvciAwKQogICAgICAgIGNoZyA9IGZsb2F0KHJvdy5nZXQoImNoYW5nZV8yNGgiKSBvciAwKQogICAgICAgIHJlZ2ltZSA9IHJvdy5nZXQoInJlZ2ltZV9sYWJlbCIpIG9yICJOL0EiCiAgICAgICAgY2hnX3N0ciA9IGYie2NoZzorLjFmfSUiCiAgICAgICAgc3ltID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgIGxpbmVzLmFwcGVuZChmIjxjb2RlPntpZHg6MDJkfS4gJHtfZXNjKHN5bSk6PDl9IHtzY29yZTouMGZ9cHRzIHtjaGdfc3RyOj43fSB7X2VzYyhyZWdpbWUpfTwvY29kZT4iKQogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCgpkZWYgX2Zvcm1hdF9tdWx0aV90aWVyX2dvb2RfYnV5X2J1bGxldGluKHBlcl90aWVyX2xpbWl0OiBpbnQgPSAyKSAtPiBzdHI6CiAgICB0aWVyX29yZGVyID0gKCJjb25zZXJ2YXRpdmUiLCAiYmFsYW5jZWQiLCAiYWdncmVzc2l2ZSIpCiAgICB0aWVyX3ByaW9yaXR5ID0geyJjb25zZXJ2YXRpdmUiOiAwLCAiYmFsYW5jZWQiOiAxLCAiYWdncmVzc2l2ZSI6IDJ9CiAgICB0aWVyX2Rpc3BsYXkgPSB7CiAgICAgICAgImNvbnNlcnZhdGl2ZSI6ICJMb25nLVRlcm0iLAogICAgICAgICJiYWxhbmNlZCI6ICJNaWQtVGVybSIsCiAgICAgICAgImFnZ3Jlc3NpdmUiOiAiU2hvcnQtVGVybSIsCiAgICB9CgogICAgc25hcHNob3RzID0gewogICAgICAgIHRpZXI6IF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZD1tYXgoOCwgcGVyX3RpZXJfbGltaXQgKiAzKSwgbGltaXRfYmFkPTAsIHRpZXI9dGllcikKICAgICAgICBmb3IgdGllciBpbiB0aWVyX29yZGVyCiAgICB9CiAgICBiYXNlX3NuYXAgPSBzbmFwc2hvdHMuZ2V0KCJiYWxhbmNlZCIpIG9yIHNuYXBzaG90cy5nZXQoImNvbnNlcnZhdGl2ZSIpIG9yIHNuYXBzaG90cy5nZXQoImFnZ3Jlc3NpdmUiKSBvciB7fQogICAgcmVnaW1lID0gYmFzZV9zbmFwLmdldCgicmVnaW1lIikgb3Ige30KICAgIHBvbGljeSA9IGJhc2Vfc25hcC5nZXQoInBvbGljeSIpIG9yIHt9CiAgICByZWdpbWVfc2NvcmUgPSBmbG9hdChyZWdpbWUuZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICByZWdpbWVfZmxvb3IgPSBmbG9hdChwb2xpY3kuZ2V0KCJyZWdpbWVfbWluX3Njb3JlIiwgMCkgb3IgMCkKICAgIHNpZ25hbF9hY3Rpb24gPSAiQlVZIiBpZiByZWdpbWVfc2NvcmUgPj0gcmVnaW1lX2Zsb29yIGVsc2UgIldBSVQiCgogICAgYmVzdF9maXRfYnlfc3ltYm9sID0ge30KICAgIGZvciB0aWVyIGluIHRpZXJfb3JkZXI6CiAgICAgICAgc25hcCA9IHNuYXBzaG90cy5nZXQodGllcikgb3Ige30KICAgICAgICBmb3IgdG9rZW4gaW4gc25hcC5nZXQoImdvb2QiKSBvciBbXToKICAgICAgICAgICAgc3ltYm9sID0gc3RyKHRva2VuLmdldCgic3ltYm9sIikgb3IgIlVOS05PV04iKS51cHBlcigpCiAgICAgICAgICAgIHNjb3JlID0gZmxvYXQodG9rZW4uZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICAgICAgICAgIHZvbHVtZSA9IGZsb2F0KHRva2VuLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICAgICAgICAgIGV4aXN0aW5nID0gYmVzdF9maXRfYnlfc3ltYm9sLmdldChzeW1ib2wpCiAgICAgICAgICAgIGlmIG5vdCBleGlzdGluZzoKICAgICAgICAgICAgICAgIGJlc3RfZml0X2J5X3N5bWJvbFtzeW1ib2xdID0geyJ0aWVyIjogdGllciwgInRva2VuIjogdG9rZW59CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgZXhpc3RpbmdfdGllciA9IHN0cihleGlzdGluZy5nZXQoInRpZXIiKSBvciAiYWdncmVzc2l2ZSIpCiAgICAgICAgICAgIGV4aXN0aW5nX3Rva2VuID0gZXhpc3RpbmcuZ2V0KCJ0b2tlbiIpIG9yIHt9CiAgICAgICAgICAgIGV4aXN0aW5nX3Njb3JlID0gZmxvYXQoZXhpc3RpbmdfdG9rZW4uZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICAgICAgICAgIGV4aXN0aW5nX3ZvbHVtZSA9IGZsb2F0KGV4aXN0aW5nX3Rva2VuLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICAgICAgICAgIGlmIHRpZXJfcHJpb3JpdHkuZ2V0KHRpZXIsIDkpIDwgdGllcl9wcmlvcml0eS5nZXQoZXhpc3RpbmdfdGllciwgOSk6CiAgICAgICAgICAgICAgICBiZXN0X2ZpdF9ieV9zeW1ib2xbc3ltYm9sXSA9IHsidGllciI6IHRpZXIsICJ0b2tlbiI6IHRva2VufQogICAgICAgICAgICBlbGlmIHRpZXJfcHJpb3JpdHkuZ2V0KHRpZXIsIDkpID09IHRpZXJfcHJpb3JpdHkuZ2V0KGV4aXN0aW5nX3RpZXIsIDkpOgogICAgICAgICAgICAgICAgaWYgKHNjb3JlLCB2b2x1bWUpID4gKGV4aXN0aW5nX3Njb3JlLCBleGlzdGluZ192b2x1bWUpOgogICAgICAgICAgICAgICAgICAgIGJlc3RfZml0X2J5X3N5bWJvbFtzeW1ib2xdID0geyJ0aWVyIjogdGllciwgInRva2VuIjogdG9rZW59CgogICAgcmFua2VkID0gc29ydGVkKAogICAgICAgIGJlc3RfZml0X2J5X3N5bWJvbC52YWx1ZXMoKSwKICAgICAgICBrZXk9bGFtYmRhIHJvdzogKAogICAgICAgICAgICBmbG9hdCgocm93LmdldCgidG9rZW4iKSBvciB7fSkuZ2V0KCJzY29yZSIsIDApIG9yIDApLAogICAgICAgICAgICBmbG9hdCgocm93LmdldCgidG9rZW4iKSBvciB7fSkuZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCksCiAgICAgICAgKSwKICAgICAgICByZXZlcnNlPVRydWUsCiAgICApCgogICAgc2VwID0gIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIKICAgICMgSWYgcmVnaW1lIHNheXMgQlVZIGJ1dCBubyB0b2tlbiBjbGVhcmVkIHRoZSBnYXRlcywgc2hvdyBXQUlUIOKAlCBubyBjb250cmFkaWN0aW9uCiAgICBpZiBzaWduYWxfYWN0aW9uID09ICJCVVkiIGFuZCBub3QgcmFua2VkOgogICAgICAgIHNpZ25hbF9hY3Rpb24gPSAiV0FJVCIKICAgIGFjdGlvbl9lbW9qaSA9ICLwn5+iIiBpZiBzaWduYWxfYWN0aW9uID09ICJCVVkiIGVsc2UgIvCflLQiCiAgICBwcm9maWxlX2xhYmVsID0gZiJ7X21vZGUoKS51cHBlcigpfSB8IHtfcmlza19zdHlsZV9sYWJlbCgpfSIKCiAgICBpZiBub3QgcmFua2VkOgogICAgICAgIGxpbmVzID0gWwogICAgICAgICAgICBmIjxiPvCfk4ogW0FOQUxZU0lTXTogTUFSS0VUPC9iPiIsCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OLIFBST0ZJTEU6IHtfZXNjX2h0bWxfbWFpbihwcm9maWxlX2xhYmVsKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPnthY3Rpb25fZW1vaml9IFNUQVRVUzoge19lc2NfaHRtbF9tYWluKHNpZ25hbF9hY3Rpb24pfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfjq8gQkVTVCBGSVQ6IFdBSVQ8L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OdIFJFQVNPTjogTm8gcXVhbGlmaWVkIHNldHVwIHJpZ2h0IG5vdzwvY29kZT4iLAogICAgICAgICAgICBmIiIsCiAgICAgICAgICAgIGYiPGk+VGlwOiBVc2UgL2dvb2RidXkgYWxsIGZvciBmdWxsIHRpZXIgYnJlYWtkb3duIG9uIGRlbWFuZC48L2k+IiwKICAgICAgICBdCiAgICBlbHNlOgogICAgICAgIGJlc3QgPSByYW5rZWRbMF0KICAgICAgICB0b2tlbiA9IGJlc3QuZ2V0KCJ0b2tlbiIpIG9yIHt9CiAgICAgICAgdGllciA9IHN0cihiZXN0LmdldCgidGllciIpIG9yICJiYWxhbmNlZCIpCiAgICAgICAgdGVybSA9IHRpZXJfZGlzcGxheS5nZXQodGllciwgIk1pZC1UZXJtIikKICAgICAgICB0b3Bfc3ltYm9sID0gc3RyKHRva2VuLmdldCgic3ltYm9sIikgb3IgIlVOS05PV04iKS51cHBlcigpCiAgICAgICAgc25hcF9mb3JfdGllciA9IHNuYXBzaG90cy5nZXQodGllcikgb3Ige30KICAgICAgICBwb2xpY3lfZm9yX3RpZXIgPSBzbmFwX2Zvcl90aWVyLmdldCgicG9saWN5Iikgb3Ige30KICAgICAgICB0aWVyX3J1bGVfZm9yX3RpZXIgPSBzbmFwX2Zvcl90aWVyLmdldCgidGllcl9ydWxlIikgb3Ige30KICAgICAgICBzY29yZSA9IGZsb2F0KHRva2VuLmdldCgic2NvcmUiLCAwKSBvciAwKQogICAgICAgIGNvbmYgPSBzdHIodG9rZW4uZ2V0KCJjb25maWRlbmNlIikgb3IgIkMiKS51cHBlcigpCiAgICAgICAgY2hnID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkKICAgICAgICBsaXEgPSBfZm10X3VzZF9jb21wYWN0X21haW4odG9rZW4uZ2V0KCJsaXF1aWRpdHkiKSkKICAgICAgICBjYXBfdmFsID0gdG9rZW4uZ2V0KCJtYXJrZXRfY2FwIikgb3IgdG9rZW4uZ2V0KCJmZHYiKQogICAgICAgIGNhcF9kaXNwbGF5ID0gX2ZtdF91c2RfY29tcGFjdF9tYWluKGNhcF92YWwpIGlmIGNhcF92YWwgZWxzZSAiTi9BIgogICAgICAgIHJlcXVpcmVkX2NvbmYgPSBfc3RyaWN0ZXJfY29uZmlkZW5jZSgKICAgICAgICAgICAgc3RyKHBvbGljeV9mb3JfdGllci5nZXQoIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0IiwgIkIiKSksCiAgICAgICAgICAgIHN0cih0aWVyX3J1bGVfZm9yX3RpZXIuZ2V0KCJtaW5fY29uZmlkZW5jZSIsICJCIikpLAogICAgICAgICkKICAgICAgICByZXF1aXJlZF9zY29yZSA9IGZsb2F0KHBvbGljeV9mb3JfdGllci5nZXQoImFsZXJ0X3RocmVzaG9sZCIsIF9ydW50aW1lWyJhbGVydF90aHJlc2hvbGQiXSkgb3IgMCkgKyBmbG9hdCgKICAgICAgICAgICAgdGllcl9ydWxlX2Zvcl90aWVyLmdldCgibWluX3Njb3JlX2RlbHRhIiwgMCkgb3IgMAogICAgICAgICkKICAgICAgICByZXF1aXJlZF9zY29yZSA9IG1heCgwLjAsIG1pbigxMDAuMCwgcmVxdWlyZWRfc2NvcmUpKQoKICAgICAgICBsaW5lcyA9IFsKICAgICAgICAgICAgZiI8Yj7wn5OKIFtBTkFMWVNJU106IE1BUktFVDwvYj4iLAogICAgICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+TiyBQUk9GSUxFOiB7X2VzY19odG1sX21haW4ocHJvZmlsZV9sYWJlbCl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT57YWN0aW9uX2Vtb2ppfSBTVEFUVVM6IHtfZXNjX2h0bWxfbWFpbihzaWduYWxfYWN0aW9uKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn46vIEJFU1QgRklUOiAke19lc2NfaHRtbF9tYWluKHRvcF9zeW1ib2wpfSB8IHtfZXNjX2h0bWxfbWFpbih0ZXJtKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7irZAgUVVBTElUWTogc2NvcmUge3Njb3JlOi4wZn0gKHtfZXNjX2h0bWxfbWFpbihjb25mKX0pIHwgMjRIIHtjaGc6Ky4xZn0lIHwgbGlxIHtfZXNjX2h0bWxfbWFpbihsaXEpfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfkrAgTUFSS0VUQ0FQOiB7X2VzY19odG1sX21haW4oY2FwX2Rpc3BsYXkpfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfk50gUkVBU09OOiBUb3AtcmFua2VkIHF1YWxpZmllZCBzZXR1cCByaWdodCBub3c8L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OPIFJVTEU6IHNjb3JlICZndDs9IHtyZXF1aXJlZF9zY29yZTouMGZ9IGFuZCBncmFkZSAmZ3Q7PSB7X2VzY19odG1sX21haW4ocmVxdWlyZWRfY29uZil9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiIiwKICAgICAgICAgICAgZiI8aT5UaXA6IFVzZSAvZ29vZGJ1eSBhbGwgZm9yIGZ1bGwgdGllciBicmVha2Rvd24gb24gZGVtYW5kLjwvaT4iLAogICAgICAgIF0KCiAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKS5zdHJpcCgpCgoKYXN5bmMgZGVmIHNlbmRfc2lnbmFsX2RpZ2VzdChjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKSAtPiBib29sOgogICAgcm93cyA9IGdldF9yZWNlbnRfc2Nhbl9iZXN0cygKICAgICAgICBsb29rYmFja19ob3Vycz1TSUdOQUxfRElHRVNUX0xPT0tCQUNLX0hPVVJTLAogICAgICAgIGxpbWl0PW1heCgxMCwgU0lHTkFMX0RJR0VTVF9NQVhfSVRFTVMgKiA0KSwKICAgICkKICAgIG1zZyA9IF9idWlsZF9kaWdlc3RfbWVzc2FnZShyb3dzKQogICAgaWYgbm90IG1zZzoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGxhdGVzdF90cyA9IHJvd3NbMF0uZ2V0KCJ0c191dGMiKQogICAgaWYgY29udGV4dC5qb2IgYW5kIF9kaWdlc3Rfc3RhdGUuZ2V0KCJsYXN0X3NlbnRfdHMiKSA9PSBsYXRlc3RfdHM6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgaWYgRFJZX1JVTjoKICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gRGlnZXN0IG5vdCBzZW50LlxuJXMiLCBtc2cpCiAgICBlbHNlOgogICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgICAgIHRleHQ9bXNnLAogICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICAgICAgKQogICAgX2RpZ2VzdF9zdGF0ZVsibGFzdF9zZW50X3RzIl0gPSBsYXRlc3RfdHMKICAgIHJldHVybiBUcnVlCgoKYXN5bmMgZGVmIHNlbmRfZ29vZF9idXlfYnVsbGV0aW4oY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSkgLT4gYm9vbDoKICAgICIiIlVuaWZpZWQgbWFya2V0IGFuYWx5c2lzIGJ1bGxldGluIOKAlCBhbHdheXMgdXNlcyBtdWx0aS10aWVyIGFuYWx5c2lzIGZvcm1hdC4iIiIKICAgIHBlcl90aWVyX2xpbWl0ID0gbWF4KDEsIGludChHT09EX0JVWV9CVUxMRVRJTl9QRVJfVElFUl9NQVhfVE9LRU5TKSkKICAgIG1zZyA9IF9mb3JtYXRfbXVsdGlfdGllcl9nb29kX2J1eV9idWxsZXRpbihwZXJfdGllcl9saW1pdD1wZXJfdGllcl9saW1pdCkKCiAgICAjIEdyYWIgYSBzbmFwc2hvdCBqdXN0IGZvciBsb2dnaW5nIG1ldGFkYXRhLgogICAgdGllciA9IF9ub3JtYWxpemVfbWFya2V0X3RpZXIoR09PRF9CVVlfQlVMTEVUSU5fVElFUikKICAgIHNuYXAgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9MSwgbGltaXRfYmFkPTAsIHRpZXI9dGllcikKCiAgICBkZWNpc2lvbiA9ICJBTkFMWVNJU19CVUxMRVRJTiIKICAgIGlmIERSWV9SVU46CiAgICAgICAgZGVjaXNpb24gPSAiQU5BTFlTSVNfQlVMTEVUSU5fRFJZX1JVTiIKICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gQW5hbHlzaXMgYnVsbGV0aW4gc3VwcHJlc3NlZC5cbiVzIiwgbXNnKQogICAgZWxzZToKICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICB0ZXh0PW1zZywKICAgICAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICkKCiAgICBsb2dfc2lnbmFsKAogICAgICAgIHsKICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAiZGVjaXNpb24iOiBkZWNpc2lvbiwKICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IGZsb2F0KChzbmFwLmdldCgicmVnaW1lIikgb3Ige30pLmdldCgic2NvcmUiKSBvciAwKSwKICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHN0cigoc25hcC5nZXQoInJlZ2ltZSIpIG9yIHt9KS5nZXQoImxhYmVsIikgb3IgIiIpLAogICAgICAgICAgICAibm90ZXMiOiBmInRpZXI9e3RpZXJ9IGdvb2RfY291bnQ9e2xlbihzbmFwLmdldCgnZ29vZCcpIG9yIFtdKX0gdW5pdmVyc2U9e3NuYXAuZ2V0KCd0b2tlbnMnLCAwKX0iLAogICAgICAgIH0KICAgICkKICAgIHJldHVybiBUcnVlCgoKYXN5bmMgZGVmIHJ1bl9zZWxsX3NpZ25hbF9zY2FubmVyKGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUsIHRva2VuczogbGlzdFtkaWN0XSB8IE5vbmUgPSBOb25lKToKICAgIGlmIG5vdCBTRUxMX0FMRVJUU19FTkFCTEVEOgogICAgICAgIHJldHVybgoKICAgIG9wZW5fcG9zaXRpb25zID0gZ2V0X29wZW5fcG9zaXRpb25zKGxpbWl0PTIwMCkKICAgIGlmIG5vdCBvcGVuX3Bvc2l0aW9uczoKICAgICAgICByZXR1cm4KICAgIHRyYWNrZWRfc3ltYm9scyA9IHtzdHIocC5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpIGZvciBwIGluIG9wZW5fcG9zaXRpb25zIGlmIHAuZ2V0KCJzeW1ib2wiKX0KICAgIHRyYWNrZWRfbWludHMgPSB7c3RyKHAuZ2V0KCJtaW50Iikgb3IgIiIpIGZvciBwIGluIG9wZW5fcG9zaXRpb25zIGlmIHAuZ2V0KCJtaW50Iil9CgogICAgbWFya2V0X3Rva2VucyA9IHRva2VucyBpZiB0b2tlbnMgaXMgbm90IE5vbmUgZWxzZSAoZmV0Y2hfbWFya2V0X2RhdGEoKSBvciBbXSkKICAgIGlmIG5vdCBtYXJrZXRfdG9rZW5zOgogICAgICAgIHJldHVybgoKICAgIHJ1bGVzID0gX3NlbGxfc3R5bGVfcnVsZXMoKQogICAgc2VudCA9IDAKICAgIGZvciByYXdfdG9rZW4gaW4gbWFya2V0X3Rva2VuczoKICAgICAgICBpZiBzZW50ID49IGludChydWxlc1sibWF4X3Blcl9jeWNsZSJdKToKICAgICAgICAgICAgYnJlYWsKICAgICAgICB0b2tlbiA9IGRpY3QocmF3X3Rva2VuKQogICAgICAgIHN5bWJvbCA9IHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpCiAgICAgICAgbWludCA9IHN0cih0b2tlbi5nZXQoImFkZHJlc3MiKSBvciAiIikKICAgICAgICBpZiBzeW1ib2wgbm90IGluIHRyYWNrZWRfc3ltYm9scyBhbmQgbWludCBub3QgaW4gdHJhY2tlZF9taW50czoKICAgICAgICAgICAgY29udGludWUKICAgICAgICBpZiBub3Qgc3ltYm9sIG9yIF9zZWxsX3NpZ25hbF9vbl9jb29sZG93bihzeW1ib2wsIGNvb2xkb3duX2hvdXJzPXJ1bGVzWyJjb29sZG93bl9ob3VycyJdKToKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgcmVmcmVzaGVkID0gX3JlZnJlc2hfYWxlcnRfbWFya2V0X3NuYXBzaG90KHRva2VuKQogICAgICAgIGlmIHJlZnJlc2hlZDoKICAgICAgICAgICAgdG9rZW4gPSByZWZyZXNoZWQKCiAgICAgICAgc2lnbmFsID0gX2RldGVjdF9zZWxsX3NpZ25hbCh0b2tlbiwgcnVsZXM9cnVsZXMpCiAgICAgICAgaWYgbm90IHNpZ25hbDoKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgbXNnID0gX2Zvcm1hdF9zZWxsX2FsZXJ0X21lc3NhZ2UodG9rZW4sIHNpZ25hbCwgY29tcGFjdD1UcnVlKQogICAgICAgIGRlY2lzaW9uID0gZiJTRUxMX0FMRVJUX3tzaWduYWxbJ3R5cGUnXX0iCiAgICAgICAgaWYgRFJZX1JVTjoKICAgICAgICAgICAgZGVjaXNpb24gPSAiU0VMTF9BTEVSVF9EUllfUlVOIgogICAgICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gU2VsbCBhbGVydCBzdXBwcmVzc2VkIGZvciAlcyIsIHN5bWJvbCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgICAgICAgICBjaGF0X2lkPWludChURUxFR1JBTV9DSEFUX0lEKSwKICAgICAgICAgICAgICAgIHRleHQ9bXNnLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgICAgICAgICByZXBseV9tYXJrdXA9X2J1aWxkX2FsZXJ0X2tleWJvYXJkKAogICAgICAgICAgICAgICAgICAgIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICB0b2tlbi5nZXQoInBhaXJfYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICAgICApCgogICAgICAgIGxvZ19zaWduYWwoCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgInNjb3JlIjogdG9rZW4uZ2V0KCJzY29yZSIpLAogICAgICAgICAgICAgICAgImxpcXVpZGl0eSI6IHRva2VuLmdldCgibGlxdWlkaXR5IiksCiAgICAgICAgICAgICAgICAidm9sdW1lXzI0aCI6IHRva2VuLmdldCgidm9sdW1lXzI0aCIpLAogICAgICAgICAgICAgICAgInByaWNlIjogdG9rZW4uZ2V0KCJwcmljZSIpLAogICAgICAgICAgICAgICAgImNoYW5nZV8yNGgiOiB0b2tlbi5nZXQoImNoYW5nZV8yNGgiKSwKICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6IGRlY2lzaW9uLAogICAgICAgICAgICAgICAgIm5vdGVzIjogc2lnbmFsLmdldCgicmVhc29uIiksCiAgICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgc2VudCArPSAxCgoKYXN5bmMgZGVmIGNtZF9kaWdlc3QodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgc2VudCA9IGF3YWl0IHNlbmRfc2lnbmFsX2RpZ2VzdChjb250ZXh0KQogICAgaWYgc2VudDoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiRGlnZXN0IHNlbnQuIikKICAgIGVsc2U6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIk5vIG5ldyBzZXR1cHMgZm9yIGRpZ2VzdCByaWdodCBub3cuIikKCgphc3luYyBkZWYgY21kX3J1bm5lcndhdGNoKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IHJ1bl9uZXdfcnVubmVyX3dhdGNoKGNvbnRleHQpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiUnVubmVyIHdhdGNoIHNjYW4gZXhlY3V0ZWQuIikKCgphc3luYyBkZWYgY21kX3dhdGNobGlzdCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBydW5fd2F0Y2hsaXN0X2xhbmUoY29udGV4dCkKICAgIHJvd3MgPSBfYnVpbGRfd2F0Y2hsaXN0X3Jvd3MoKQogICAgbGl2ZSA9IHN1bSgxIGZvciByIGluIHJvd3MgaWYgYm9vbChyLmdldCgiaGFzX2xpdmVfZGF0YSIsIFRydWUpKSkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgIGYiV2F0Y2hsaXN0IHNjYW4gZXhlY3V0ZWQuIENvdmVyYWdlOiB7bGl2ZX0ve2xlbihyb3dzKX0gbGl2ZS4iCiAgICApCgoKYXN5bmMgZGVmIGNtZF93YXRjaGxpc3RzdW1tYXJ5KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IHNlbmRfd2F0Y2hsaXN0X3N1bW1hcnkoY29udGV4dCkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJXYXRjaGxpc3Qgc3VtbWFyeSBzZW50LiIpCgoKYXN5bmMgZGVmIGNtZF9tYXJrZXRub3codXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgdGllciA9IF90aWVyX2FyZ19vcl9kZWZhdWx0KGNvbnRleHQuYXJncywgZGVmYXVsdD0iYmFsYW5jZWQiKQogICAgaWYgdGllciA9PSAiYWxsIjoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X21hcmtldF9ub3dfbXVsdGlfdGllcihtb2RlPSJib3RoIikpCiAgICAgICAgcmV0dXJuCiAgICBzbmFwID0gX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPTUsIGxpbWl0X2JhZD01LCB0aWVyPXRpZXIpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X21hcmtldF9ub3dfbWVzc2FnZShzbmFwLCBtb2RlPSJib3RoIikpCgoKYXN5bmMgZGVmIGNtZF9nb29kYnV5KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIHRpZXIgPSBfdGllcl9hcmdfb3JfZGVmYXVsdChjb250ZXh0LmFyZ3MsIGRlZmF1bHQ9ImJhbGFuY2VkIikKICAgIGlmIHRpZXIgPT0gImFsbCI6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF9tYXJrZXRfbm93X211bHRpX3RpZXIobW9kZT0iZ29vZCIpKQogICAgICAgIHJldHVybgogICAgc25hcCA9IF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZD02LCBsaW1pdF9iYWQ9MywgdGllcj10aWVyKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT0iZ29vZCIpKQoKCmFzeW5jIGRlZiBjbWRfYmFkYnV5KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIHRpZXIgPSBfdGllcl9hcmdfb3JfZGVmYXVsdChjb250ZXh0LmFyZ3MsIGRlZmF1bHQ9ImJhbGFuY2VkIikKICAgIGlmIHRpZXIgPT0gImFsbCI6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF9tYXJrZXRfbm93X211bHRpX3RpZXIobW9kZT0iYmFkIikpCiAgICAgICAgcmV0dXJuCiAgICBzbmFwID0gX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPTMsIGxpbWl0X2JhZD02LCB0aWVyPXRpZXIpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X21hcmtldF9ub3dfbWVzc2FnZShzbmFwLCBtb2RlPSJiYWQiKSkKCgphc3luYyBkZWYgY21kX3dhbGxldDJub3codXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF93YWxsZXQyX21lc3NhZ2UobW9kZT0iZ29vZCIpKQoKCmFzeW5jIGRlZiBjbWRfd2FsbGV0MmJhZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X3dhbGxldDJfbWVzc2FnZShtb2RlPSJiYWQiKSkKCgphc3luYyBkZWYgY21kX3dhbGxldDNub3codXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoX2Zvcm1hdF93YWxsZXQzX21lc3NhZ2UobW9kZT0iZ29vZCIpKQoKCmFzeW5jIGRlZiBjbWRfd2FsbGV0M2JhZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X3dhbGxldDNfbWVzc2FnZShtb2RlPSJiYWQiKSkKCgphc3luYyBkZWYgY21kX3dhbGxldHBsYW4odXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgdGV4dCA9ICgKICAgICAgICAiV0FMTEVUIFBMQVlCT09LXG5cbiIKICAgICAgICBmIntfd2FsbGV0X2hlYWRlcignVzEnKX1cblxuIgogICAgICAgIGYie193YWxsZXRfaGVhZGVyKCdXMicpfVxuXG4iCiAgICAgICAgZiJ7X3dhbGxldF9oZWFkZXIoJ1czJyl9XG5cbiIKICAgICAgICAiVXNlIC93YWxsZXQybm93IC93YWxsZXQyYmFkIC93YWxsZXQzbm93IC93YWxsZXQzYmFkIGZvciBsaXZlIHJvdXRpbmcuIgogICAgKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQodGV4dCkKCgphc3luYyBkZWYgb25fYWxlcnRfYWN0aW9uKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIHF1ZXJ5ID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5CiAgICBpZiBub3QgcXVlcnk6CiAgICAgICAgcmV0dXJuCiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoIlVuYXV0aG9yaXplZCIsIHNob3dfYWxlcnQ9VHJ1ZSkKICAgICAgICByZXR1cm4KCiAgICBkYXRhID0gcXVlcnkuZGF0YSBvciAiIgogICAgaWYgZGF0YS5zdGFydHN3aXRoKCJtdXRlOiIpOgogICAgICAgIHN5bWJvbCA9IGRhdGEuc3BsaXQoIjoiLCAxKVsxXS5zdHJpcCgpLnVwcGVyKClbOjE2XQogICAgICAgIHNldF9zeW1ib2xfY29udHJvbChzeW1ib2w9c3ltYm9sLCBjb250cm9sX3R5cGU9IkNPT0xET1dOIiwgaG91cnM9MjQsIHJlYXNvbj0ibWFudWFsX3RlbGVncmFtX211dGUiKQogICAgICAgIGxvZ19zaWduYWwoeyJzeW1ib2wiOiBzeW1ib2wsICJkZWNpc2lvbiI6ICJURUxFR1JBTV9NVVRFXzI0SCIsICJub3RlcyI6ICJtYW51YWwgbXV0ZSBmcm9tIGJ1dHRvbiJ9KQogICAgICAgIGF3YWl0IHF1ZXJ5LmFuc3dlcihmIntzeW1ib2x9IG11dGVkIDI0aCIsIHNob3dfYWxlcnQ9RmFsc2UpCiAgICBlbGlmIGRhdGEuc3RhcnRzd2l0aCgiYWNrOiIpOgogICAgICAgIHN5bWJvbCA9IGRhdGEuc3BsaXQoIjoiLCAxKVsxXS5zdHJpcCgpLnVwcGVyKClbOjE2XQogICAgICAgIGxvZ19zaWduYWwoeyJzeW1ib2wiOiBzeW1ib2wsICJkZWNpc2lvbiI6ICJBTEVSVF9BQ0siLCAibm90ZXMiOiAidGVsZWdyYW0gYWNrbm93bGVkZ2UifSkKICAgICAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoIkFja25vd2xlZGdlZCIsIHNob3dfYWxlcnQ9RmFsc2UpCiAgICBlbHNlOgogICAgICAgIGF3YWl0IHF1ZXJ5LmFuc3dlcigpCgoKYXN5bmMgZGVmIHJ1bl9uZXdfcnVubmVyX3dhdGNoKGNvbnRleHQpOgogICAgaWYgbm90IE5FV19SVU5ORVJfV0FUQ0hfRU5BQkxFRDoKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBwcmludCgiUnVubmluZyBuZXctcnVubmVyIHdhdGNoLi4uIikKICAgICAgICB0b2tlbnMgPSBmZXRjaF9ydW5uZXJfd2F0Y2hfY2FuZGlkYXRlcygKICAgICAgICAgICAgcXVlcmllcz1ORVdfUlVOTkVSX1NFQVJDSF9RVUVSSUVTLAogICAgICAgICAgICBwYWlyc19wZXJfcXVlcnk9TkVXX1JVTk5FUl9QQUlSU19QRVJfUVVFUlksCiAgICAgICAgICAgIGxpbWl0PU5FV19SVU5ORVJfTUFYX1JFU1VMVFMsCiAgICAgICAgKQogICAgICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiTmV3LXJ1bm5lciB3YXRjaDogbm8gY2FuZGlkYXRlcyBmcm9tIERleFNjcmVlbmVyLiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBjYW5kaWRhdGVzID0gW10KICAgICAgICBmb3IgdG9rZW4gaW4gdG9rZW5zOgogICAgICAgICAgICBlbnJpY2hlZCA9IF9ydW5uZXJfd2F0Y2hfZW5yaWNoKHRva2VuKQogICAgICAgICAgICBpZiBub3QgZW5yaWNoZWQ6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzeW1ib2wgPSBzdHIoZW5yaWNoZWQuZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgICAgICAgICBpZiBfcnVubmVyX3dhdGNoX29uX2Nvb2xkb3duKHN5bWJvbCk6CiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiBlbnJpY2hlZC5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAgICAgInNjb3JlIjogZW5yaWNoZWQuZ2V0KCJ3YXRjaF9zY29yZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiUlVOTkVSX1dBVENIX0NPT0xET1dOX1NLSVAiLAogICAgICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiBmImNvb2xkb3duX2hvdXJzPXtORVdfUlVOTkVSX0NPT0xET1dOX0hPVVJTfSIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgY2FuZGlkYXRlcy5hcHBlbmQoZW5yaWNoZWQpCgogICAgICAgIGlmIG5vdCBjYW5kaWRhdGVzOgogICAgICAgICAgICBwcmludCgiTmV3LXJ1bm5lciB3YXRjaDogbm8gdG9rZW5zIHBhc3NlZCBmaWx0ZXJzLiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBjYW5kaWRhdGVzLnNvcnQoa2V5PWxhbWJkYSB0OiB0LmdldCgid2F0Y2hfc2NvcmUiLCAwKSwgcmV2ZXJzZT1UcnVlKQogICAgICAgIHNlbnQgPSAwCiAgICAgICAgc2VlbiA9IHNldCgpCiAgICAgICAgbWF4X3Blcl9jeWNsZSA9IG1heCgxLCBORVdfUlVOTkVSX01BWF9BTEVSVFNfUEVSX0NZQ0xFKQoKICAgICAgICBmb3IgdG9rZW4gaW4gY2FuZGlkYXRlczoKICAgICAgICAgICAgaWYgc2VudCA+PSBtYXhfcGVyX2N5Y2xlOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgc3ltYm9sID0gc3RyKHRva2VuLmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkKICAgICAgICAgICAgaWYgbm90IHN5bWJvbCBvciBzeW1ib2wgaW4gc2VlbjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHNlZW4uYWRkKHN5bWJvbCkKCiAgICAgICAgICAgIG1zZyA9IGZvcm1hdF9ydW5uZXJfd2F0Y2godG9rZW4sIGNvbXBhY3Q9VHJ1ZSkKICAgICAgICAgICAgZGVjaXNpb24gPSAiUlVOTkVSX1dBVENIX0FMRVJUIgogICAgICAgICAgICBpZiBEUllfUlVOOgogICAgICAgICAgICAgICAgZGVjaXNpb24gPSAiUlVOTkVSX1dBVENIX0RSWV9SVU4iCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gUnVubmVyIHdhdGNoIGFsZXJ0IHN1cHByZXNzZWQgZm9yICVzIiwgc3ltYm9sKQogICAgICAgICAgICBlbGlmIFRFTEVHUkFNX1FVSUVUX01PREUgYW5kIGNvbnRleHQuam9iIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgZGVjaXNpb24gPSAiUlVOTkVSX1dBVENIX1FVSUVUX01PREUiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPV9idWlsZF9hbGVydF9rZXlib2FyZCgKICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgbG9nX3NpZ25hbCgKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgInBhaXJfYWRkcmVzcyI6IHRva2VuLmdldCgicGFpcl9hZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgInNjb3JlIjogdG9rZW4uZ2V0KCJ3YXRjaF9zY29yZSIpLAogICAgICAgICAgICAgICAgICAgICJsaXF1aWRpdHkiOiB0b2tlbi5nZXQoImxpcXVpZGl0eSIpLAogICAgICAgICAgICAgICAgICAgICJ2b2x1bWVfMjRoIjogdG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiksCiAgICAgICAgICAgICAgICAgICAgInByaWNlIjogdG9rZW4uZ2V0KCJwcmljZSIpLAogICAgICAgICAgICAgICAgICAgICJjaGFuZ2VfMjRoIjogdG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiksCiAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogZGVjaXNpb24sCiAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogKAogICAgICAgICAgICAgICAgICAgICAgICBmInJ1bm5lcl93YXRjaCBhZ2VfaD17dG9rZW4uZ2V0KCdhZ2VfaG91cnMnKTouMmZ9ICIKICAgICAgICAgICAgICAgICAgICAgICAgZiJ4X3Byb3h5PXt0b2tlbi5nZXQoJ3hfcHJveHlfbGFiZWwnKX0gbmFycmF0aXZlPXt0b2tlbi5nZXQoJ25hcnJhdGl2ZV9sYWJlbCcpfSIKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIHNlbnQgKz0gMQoKICAgICAgICBpZiBzZW50ID09IDA6CiAgICAgICAgICAgIHByaW50KCJOZXctcnVubmVyIHdhdGNoOiBjYW5kaWRhdGVzIGZvdW5kIGJ1dCBza2lwcGVkIGJ5IGNvb2xkb3duL2NhcHMuIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjOgogICAgICAgIHByaW50KCJSVU5ORVIgV0FUQ0ggRVJST1I6IiwgcmVwcihleGMpKQoKCmFzeW5jIGRlZiBydW5fbGVnYWN5X3JlY292ZXJ5X3NjYW5uZXIoY29udGV4dCk6CiAgICAiIiJTY2FuIGVzdGFibGlzaGVkIFNvbGFuYSBtZW1lY29pbnMgKD45MGQpIHNob3dpbmcgZnJlc2ggcmV2ZXJzYWwgcGF0dGVybnMuIiIiCiAgICBpZiBub3QgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQ6CiAgICAgICAgcmV0dXJuCiAgICB0cnk6CiAgICAgICAgcHJpbnQoIlJ1bm5pbmcgbGVnYWN5IHJlY292ZXJ5IHNjYW4uLi4iKQogICAgICAgICMgVXNlIGJyb2FkIGZldGNoIOKAlCBzY2FucyBmdWxsIGVzdGFibGlzaGVkIFNvbGFuYSB1bml2ZXJzZSwgbm90IGEgaGFyZGNvZGVkIGxpc3QuCiAgICAgICAgIyBDdXN0b20gcXVlcmllcyBmcm9tIC5lbnYgb3ZlcnJpZGUgdGhlIGJ1aWx0LWluIGJyb2FkIHN3ZWVwIGlmIHNldC4KICAgICAgICBjdXN0b21fcXVlcmllcyA9IExFR0FDWV9SRUNPVkVSWV9TRUFSQ0hfUVVFUklFUyBpZiBMRUdBQ1lfUkVDT1ZFUllfU0VBUkNIX1FVRVJJRVMgZWxzZSBOb25lCiAgICAgICAgdG9rZW5zID0gZmV0Y2hfbGVnYWN5X3JlY292ZXJ5X2NhbmRpZGF0ZXMoCiAgICAgICAgICAgIHF1ZXJpZXM9Y3VzdG9tX3F1ZXJpZXMsCiAgICAgICAgICAgIHBhaXJzX3Blcl9xdWVyeT1MRUdBQ1lfUkVDT1ZFUllfUEFJUlNfUEVSX1FVRVJZLAogICAgICAgICAgICBsaW1pdD0zMDAsCiAgICAgICAgKQogICAgICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiTGVnYWN5IHJlY292ZXJ5IHNjYW46IG5vIGNhbmRpZGF0ZXMgZnJvbSBEZXhTY3JlZW5lci4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgIyBHZXQgY3VycmVudCBTT0wgc3RhdHVzIHRvIGVtYmVkIGluIGFsZXJ0CiAgICAgICAgc29sX3Byb3h5ID0gX2NvbXB1dGVfc29sX3JlZ2ltZV9wcm94eSgpCiAgICAgICAgc29sX2NoYW5nZV8yNGggPSBmbG9hdChzb2xfcHJveHkuZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkKICAgICAgICBzb2xfY2hhbmdlXzFoID0gZmxvYXQoc29sX3Byb3h5LmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCkKICAgICAgICBpZiBzb2xfY2hhbmdlXzI0aCA8PSBTT0xfRVhUUkVNRV9PRkZfQ0hBTkdFXzI0SCBvciBzb2xfY2hhbmdlXzFoIDw9IFNPTF9FWFRSRU1FX09GRl9DSEFOR0VfMUg6CiAgICAgICAgICAgIHNvbF9zdGF0dXMgPSAiRVhUUkVNRV9SSVNLX09GRiIKICAgICAgICBlbGlmIHNvbF9jaGFuZ2VfMjRoIDw9IFNPTF9SSVNLX09GRl9DSEFOR0VfMjRIOgogICAgICAgICAgICBzb2xfc3RhdHVzID0gIlJJU0tfT0ZGIgogICAgICAgIGVsaWYgc29sX2NoYW5nZV8yNGggPj0gU09MX1JJU0tfT05fQ0hBTkdFXzI0SDoKICAgICAgICAgICAgc29sX3N0YXR1cyA9ICJSSVNLX09OIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNvbF9zdGF0dXMgPSAiTkVVVFJBTCIKCiAgICAgICAgY2FuZGlkYXRlcyA9IFtdCiAgICAgICAgZm9yIHRva2VuIGluIHRva2VuczoKICAgICAgICAgICAgZW5yaWNoZWQgPSBfZGV0ZWN0X2xlZ2FjeV9yZWNvdmVyeSh0b2tlbikKICAgICAgICAgICAgaWYgbm90IGVucmljaGVkOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc3ltYm9sID0gc3RyKGVucmljaGVkLmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkKICAgICAgICAgICAgaWYgX2xlZ2FjeV9yZWNvdmVyeV9vbl9jb29sZG93bihzeW1ib2wpOgogICAgICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAibWludCI6IGVucmljaGVkLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJMRUdBQ1lfUkVDT1ZFUllfQ09PTERPV05fU0tJUCIsCiAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogZiJjb29sZG93bl9ob3Vycz17TEVHQUNZX1JFQ09WRVJZX0NPT0xET1dOX0hPVVJTfSIsCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZW5yaWNoZWRbInNvbF9zdGF0dXMiXSA9IHNvbF9zdGF0dXMKICAgICAgICAgICAgY2FuZGlkYXRlcy5hcHBlbmQoZW5yaWNoZWQpCgogICAgICAgIGlmIG5vdCBjYW5kaWRhdGVzOgogICAgICAgICAgICBwcmludCgiTGVnYWN5IHJlY292ZXJ5IHNjYW46IG5vIHRva2VucyBwYXNzZWQgZmlsdGVycy4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgIyBTb3J0IGJ5IHZvbHVtZV8yNGggZGVzY2VuZGluZyAobW9zdCBhY3RpdmUgZXN0YWJsaXNoZWQgY29pbnMgZmlyc3QpCiAgICAgICAgY2FuZGlkYXRlcy5zb3J0KGtleT1sYW1iZGEgdDogZmxvYXQodC5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKSwgcmV2ZXJzZT1UcnVlKQogICAgICAgIHNlbnQgPSAwCiAgICAgICAgc2VlbiA9IHNldCgpCiAgICAgICAgbWF4X3Blcl9jeWNsZSA9IG1heCgxLCBMRUdBQ1lfUkVDT1ZFUllfTUFYX0FMRVJUU19QRVJfQ1lDTEUpCgogICAgICAgIGZvciB0b2tlbiBpbiBjYW5kaWRhdGVzOgogICAgICAgICAgICBpZiBzZW50ID49IG1heF9wZXJfY3ljbGU6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBzeW1ib2wgPSBzdHIodG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgICAgICAgICBpZiBub3Qgc3ltYm9sIG9yIHN5bWJvbCBpbiBzZWVuOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc2Vlbi5hZGQoc3ltYm9sKQoKICAgICAgICAgICAgbXNnID0gZm9ybWF0X2xlZ2FjeV9yZWNvdmVyeSh0b2tlbikKICAgICAgICAgICAgZGVjaXNpb24gPSAiTEVHQUNZX1JFQ09WRVJZX0FMRVJUIgogICAgICAgICAgICBpZiBEUllfUlVOOgogICAgICAgICAgICAgICAgZGVjaXNpb24gPSAiTEVHQUNZX1JFQ09WRVJZX0RSWV9SVU4iCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gTGVnYWN5IHJlY292ZXJ5IGFsZXJ0IHN1cHByZXNzZWQgZm9yICVzIiwgc3ltYm9sKQogICAgICAgICAgICBlbGlmIFRFTEVHUkFNX1FVSUVUX01PREUgYW5kIGNvbnRleHQuam9iIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgZGVjaXNpb24gPSAiTEVHQUNZX1JFQ09WRVJZX1FVSUVUX01PREUiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPV9idWlsZF9hbGVydF9rZXlib2FyZCgKICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICJwYWlyX2FkZHJlc3MiOiB0b2tlbi5nZXQoInBhaXJfYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgInNjb3JlIjogMCwKICAgICAgICAgICAgICAgICJsaXF1aWRpdHkiOiB0b2tlbi5nZXQoImxpcXVpZGl0eSIpLAogICAgICAgICAgICAgICAgInZvbHVtZV8yNGgiOiB0b2tlbi5nZXQoInZvbHVtZV8yNGgiKSwKICAgICAgICAgICAgICAgICJwcmljZSI6IHRva2VuLmdldCgicHJpY2UiKSwKICAgICAgICAgICAgICAgICJjaGFuZ2VfMjRoIjogdG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiksCiAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiBkZWNpc2lvbiwKICAgICAgICAgICAgICAgICJub3RlcyI6ICgKICAgICAgICAgICAgICAgICAgICBmImxlZ2FjeV9yZWNvdmVyeSBhZ2VfZD17dG9rZW4uZ2V0KCdhZ2VfZGF5cycsIDApOi4xZn0gIgogICAgICAgICAgICAgICAgICAgIGYicGF0dGVybj17dG9rZW4uZ2V0KCdwYXR0ZXJuX2xhYmVsJyl9IHNvbD17c29sX3N0YXR1c30iCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9KQogICAgICAgICAgICBzZW50ICs9IDEKCiAgICAgICAgaWYgc2VudCA9PSAwOgogICAgICAgICAgICBwcmludCgiTGVnYWN5IHJlY292ZXJ5IHNjYW46IGNhbmRpZGF0ZXMgZm91bmQgYnV0IHNraXBwZWQgYnkgY29vbGRvd24vY2Fwcy4iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGM6CiAgICAgICAgcHJpbnQoIkxFR0FDWSBSRUNPVkVSWSBTQ0FOIEVSUk9SOiIsIHJlcHIoZXhjKSkKCgphc3luYyBkZWYgcnVuX2VuZ2luZShjb250ZXh0KToKICAgIHRyeToKICAgICAgICBwcmludChmIlJ1bm5pbmcge19tb2RlKCl9IHNjYW4uLi4iKQogICAgICAgIHRva2VucyA9IGZldGNoX21hcmtldF9kYXRhKCkKICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAiZGVjaXNpb24iOiAiU0NBTl9SVU4iLAogICAgICAgICAgICAibm90ZXMiOiBmImZldGNoZWRfdG9rZW5zPXtsZW4odG9rZW5zKX0iLAogICAgICAgIH0pCiAgICAgICAgaWYgbm90IHRva2VuczoKICAgICAgICAgICAgcHJpbnQoIk5vIHZhbGlkIHRva2VucyBmb3VuZCAoZmlsdGVycyByZW1vdmVkIGV2ZXJ5dGhpbmcpLiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICByZWdpbWUgPSBfY29tcHV0ZV9yZWdpbWUodG9rZW5zKQogICAgICAgIHNvbF9wcm94eSA9IF9jb21wdXRlX3NvbF9yZWdpbWVfcHJveHkoKQogICAgICAgIHBvbGljeSA9IF9idWlsZF9tYXJrZXRfcG9saWN5KHJlZ2ltZSwgc29sX3Byb3h5KQoKICAgICAgICAjIEV4aXQtcmlzayBhbGVydHMgcnVuIGluZGVwZW5kZW50bHkgb2YgYnV5LWdhdGUgY29uZGl0aW9ucy4KICAgICAgICBhd2FpdCBydW5fc2VsbF9zaWduYWxfc2Nhbm5lcihjb250ZXh0LCB0b2tlbnM9dG9rZW5zKQoKICAgICAgICBpZiBwb2xpY3lbImhhcmRfYmxvY2siXToKICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogIkVOR0lORSIsCiAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiTUFSS0VUX0hBUkRfQkxPQ0siLAogICAgICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAibm90ZXMiOiBwb2xpY3lbImhhcmRfYmxvY2tfcmVhc29uIl0sCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHByaW50KGYiTWFya2V0IGhhcmQgYmxvY2s6IHtwb2xpY3lbJ2hhcmRfYmxvY2tfcmVhc29uJ119IikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGNhbl90cmFkZSwgYmxvY2tfcmVhc29uID0gX3Jpc2tfZ292ZXJub3Jfc3RhdHVzKCkKICAgICAgICBpZiBub3QgY2FuX3RyYWRlOgogICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICJzeW1ib2wiOiAiRU5HSU5FIiwKICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJSSVNLX0dPVkVSTk9SX0JMT0NLIiwKICAgICAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgIm5vdGVzIjogYmxvY2tfcmVhc29uLAogICAgICAgICAgICB9KQogICAgICAgICAgICBwcmludChmIlJpc2sgZ292ZXJub3IgYmxvY2tlZCBhbGVydHM6IHtibG9ja19yZWFzb259IikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGxvZ2dpbmcuaW5mbygKICAgICAgICAgICAgIk1hcmtldCBwb2xpY3k6IHN0YXRlPSVzIHNvbDI0aD0lLjJmJSUgc29sMWg9JS4yZiUlIHRocj0lLjFmIGNvbmY+PSVzIHJlZ2ltZV9taW49JS4xZiAiCiAgICAgICAgICAgICJjeWNsZV9jYXA9JXMgZGF5X2NhcD0lcyBjb29sZG93bl9oPSVzIiwKICAgICAgICAgICAgcG9saWN5WyJzdGF0ZSJdLAogICAgICAgICAgICBmbG9hdChzb2xfcHJveHkuZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCksCiAgICAgICAgICAgIGZsb2F0KHNvbF9wcm94eS5nZXQoImNoYW5nZV8xaCIsIDApIG9yIDApLAogICAgICAgICAgICBmbG9hdChwb2xpY3lbImFsZXJ0X3RocmVzaG9sZCJdKSwKICAgICAgICAgICAgcG9saWN5WyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdLAogICAgICAgICAgICBmbG9hdChwb2xpY3lbInJlZ2ltZV9taW5fc2NvcmUiXSksCiAgICAgICAgICAgIHBvbGljeVsibWF4X2FsZXJ0c19wZXJfY3ljbGUiXSwKICAgICAgICAgICAgcG9saWN5WyJtYXhfYWxlcnRzX3Blcl9kYXkiXSwKICAgICAgICAgICAgcG9saWN5WyJhbGVydF9jb29sZG93bl9ob3VycyJdLAogICAgICAgICkKCiAgICAgICAgYWxlcnRzXzI0aCA9IGNvdW50X2FsZXJ0c19zaW5jZShkYXRldGltZS51dGNub3coKSAtIHRpbWVkZWx0YShob3Vycz0yNCkpCiAgICAgICAgcG9saWN5X2RheV9jYXAgPSBpbnQocG9saWN5WyJtYXhfYWxlcnRzX3Blcl9kYXkiXSkKICAgICAgICBpZiBwb2xpY3lfZGF5X2NhcCA+IDAgYW5kIGFsZXJ0c18yNGggPj0gcG9saWN5X2RheV9jYXA6CiAgICAgICAgICAgIHJlYXNvbiA9IGYiUG9saWN5IGRhaWx5IGNhcCByZWFjaGVkICh7YWxlcnRzXzI0aH0ve3BvbGljeV9kYXlfY2FwfSkgc3RhdGU9e3BvbGljeVsnc3RhdGUnXX0iCiAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIlBPTElDWV9EQUlMWV9DQVBfQkxPQ0siLAogICAgICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAibm90ZXMiOiByZWFzb24sCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHByaW50KGYiUG9saWN5IGJsb2NrZWQgYWxlcnRzOiB7cmVhc29ufSIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBjYW5kaWRhdGVzID0gW10KICAgICAgICBmb3IgdG9rZW4gaW4gdG9rZW5zOgogICAgICAgICAgICBpZiBub3QgdG9rZW4uZ2V0KCJhZGRyZXNzIik6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBub3QgX3Bhc3Nlc19xdWFsaXR5X2ZpbHRlcnModG9rZW4pOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgbm90IF9wYXNzZXNfZXhlY3V0aW9uX3F1YWxpdHlfZmlsdGVycyh0b2tlbik6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBub3QgX3Bhc3Nlc190YWN0aWNhbF9maWx0ZXJzKHRva2VuKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHN5bWJvbCA9IHRva2VuLmdldCgic3ltYm9sIiwgIiIpCiAgICAgICAgICAgIGNvbnRyb2wgPSBfYXBwbHlfc3ltYm9sX2NvbnRyb2xzKHN5bWJvbCkKICAgICAgICAgICAgaWYgY29udHJvbDoKICAgICAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiU1lNQk9MX0NPTlRST0xfU0tJUCIsCiAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogZiJ7Y29udHJvbFsndHlwZSddfSB1bnRpbCB7Y29udHJvbFsndW50aWwnXS5pc29mb3JtYXQoKX0iLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAjIEVucmljaCB3aXRoIEJpcmRFeWUgb3ZlcnZpZXcgZGF0YSAodW5pcXVlIHdhbGxldHMsIHNvY2lhbCwgZXRjLikKICAgICAgICAgICAgdG9rZW4gPSBfZW5yaWNoX3Rva2VuX2Zvcl9zY29yaW5nKHRva2VuKQogICAgICAgICAgICB0b2tlblsiZW5naW5lX3Byb2ZpbGUiXSA9IF9tb2RlKCkKICAgICAgICAgICAgc2NvcmUgPSBjYWxjdWxhdGVfdG9rZW5fc2NvcmUodG9rZW4pCiAgICAgICAgICAgIHRva2VuWyJzY29yZSJdID0gc2NvcmUKICAgICAgICAgICAgdG9rZW5bImNvbmZpZGVuY2UiXSA9IF9jb25maWRlbmNlX2Zyb21fc2NvcmUoc2NvcmUpCiAgICAgICAgICAgIGxvZ2dpbmcuZGVidWcoIlRva2VuICVzIHNjb3JlZCAlLjJmIiwgdG9rZW4uZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpLCBzY29yZSkKCiAgICAgICAgICAgIGlmIHNjb3JlID49IGZsb2F0KHBvbGljeVsiYWxlcnRfdGhyZXNob2xkIl0pIGFuZCBfY29uZmlkZW5jZV9tZWV0c19ydWxlKAogICAgICAgICAgICAgICAgdG9rZW5bImNvbmZpZGVuY2UiXSwKICAgICAgICAgICAgICAgIHBvbGljeVsibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiXSwKICAgICAgICAgICAgKToKICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMuYXBwZW5kKHRva2VuKQoKICAgICAgICByZWdpbWVfbWluID0gZmxvYXQocG9saWN5WyJyZWdpbWVfbWluX3Njb3JlIl0pCiAgICAgICAgaWYgRU5BQkxFX1JFR0lNRV9HQVRFIGFuZCByZWdpbWVbInNjb3JlIl0gPCByZWdpbWVfbWluOgogICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICJzeW1ib2wiOiAiRU5HSU5FIiwKICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJSRUdJTUVfQkxPQ0siLAogICAgICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAibm90ZXMiOiAoCiAgICAgICAgICAgICAgICAgICAgZiJHYXRlIGFjdGl2ZS4gbWluPXtyZWdpbWVfbWlufSwgYnJlYWR0aD17cmVnaW1lWydicmVhZHRoX3BjdCddOi4yZn0sICIKICAgICAgICAgICAgICAgICAgICBmIm1hcmtldF9zdGF0ZT17cG9saWN5WydzdGF0ZSddfSIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHByaW50KAogICAgICAgICAgICAgICAgZiJSZWdpbWUgZ2F0ZSBibG9ja2VkIGFsZXJ0czoge3JlZ2ltZVsnbGFiZWwnXX0gIgogICAgICAgICAgICAgICAgZiIoe3JlZ2ltZVsnc2NvcmUnXTouMWZ9IDwge3JlZ2ltZV9taW59KS4iCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGlmIG5vdCBjYW5kaWRhdGVzOgogICAgICAgICAgICBwcmludChmIk5vIHRva2VucyBtZWV0IHRoZSBzY29yZSB0aHJlc2hvbGQgKHtwb2xpY3lbJ2FsZXJ0X3RocmVzaG9sZCddfSkuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGNhbmRpZGF0ZXMuc29ydChrZXk9bGFtYmRhIHg6IHhbInNjb3JlIl0sIHJldmVyc2U9VHJ1ZSkKICAgICAgICBiZXN0X3Rva2VuID0gY2FuZGlkYXRlc1swXQoKICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgInN5bWJvbCI6IGJlc3RfdG9rZW4uZ2V0KCJzeW1ib2wiKSwKICAgICAgICAgICAgIm1pbnQiOiBiZXN0X3Rva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAic2NvcmUiOiBiZXN0X3Rva2VuLmdldCgic2NvcmUiKSwKICAgICAgICAgICAgImxpcXVpZGl0eSI6IGJlc3RfdG9rZW4uZ2V0KCJsaXF1aWRpdHkiKSwKICAgICAgICAgICAgInZvbHVtZV8yNGgiOiBiZXN0X3Rva2VuLmdldCgidm9sdW1lXzI0aCIpLAogICAgICAgICAgICAicHJpY2UiOiBiZXN0X3Rva2VuLmdldCgicHJpY2UiKSwKICAgICAgICAgICAgImNoYW5nZV8yNGgiOiBiZXN0X3Rva2VuLmdldCgiY2hhbmdlXzI0aCIpLAogICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAiY29udmljdGlvbiI6IF9DT05GSURFTkNFX09SREVSLmdldChiZXN0X3Rva2VuLmdldCgiY29uZmlkZW5jZSIsICJDIiksIDEpLAogICAgICAgICAgICAiZGVjaXNpb24iOiAiU0NBTl9CRVNUIiwKICAgICAgICB9KQogICAgICAgIHBvbGljeV9jeWNsZV9jYXAgPSBtYXgoMSwgaW50KHBvbGljeVsibWF4X2FsZXJ0c19wZXJfY3ljbGUiXSkpCiAgICAgICAgbWF4X2N5Y2xlX2FsZXJ0cyA9IG1heCgxLCBtaW4oTUFYX0FMRVJUU19QRVJfQ1lDTEUsIHBvbGljeV9jeWNsZV9jYXApKQogICAgICAgIG1heF9yYW5rZWQgPSBtYXgoMSwgbWluKEFMRVJUX1RPUF9OLCBwb2xpY3lfY3ljbGVfY2FwKSkKICAgICAgICBhbGVydHNfc2VudCA9IDAKICAgICAgICBzZWVuX3N5bWJvbHMgPSBzZXQoKQoKICAgICAgICBmb3IgdG9rZW4gaW4gY2FuZGlkYXRlczoKICAgICAgICAgICAgaWYgYWxlcnRzX3NlbnQgPj0gbWF4X2N5Y2xlX2FsZXJ0cyBvciBhbGVydHNfc2VudCA+PSBtYXhfcmFua2VkOgogICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIHJlZnJlc2hlZCA9IF9yZWZyZXNoX2FsZXJ0X21hcmtldF9zbmFwc2hvdCh0b2tlbikKICAgICAgICAgICAgaWYgcmVmcmVzaGVkIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogdG9rZW4uZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpLAogICAgICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIkFMRVJUX1NLSVBfTk9fTElWRV9EQVRBIiwKICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiAibGl2ZSByZWZyZXNoIHJlcXVpcmVkIGJ1dCB1bmF2YWlsYWJsZSIsCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgdG9rZW4gPSByZWZyZXNoZWQKCiAgICAgICAgICAgIHN5bWJvbCA9IHRva2VuLmdldCgic3ltYm9sIiwgIlVOS05PV04iKQogICAgICAgICAgICBpZiBzeW1ib2wgaW4gc2Vlbl9zeW1ib2xzOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc2Vlbl9zeW1ib2xzLmFkZChzeW1ib2wpCgogICAgICAgICAgICBpZiBfaXNfc3ltYm9sX29uX2Nvb2xkb3duKHN5bWJvbCwgY29vbGRvd25faG91cnM9cG9saWN5WyJhbGVydF9jb29sZG93bl9ob3VycyJdKToKICAgICAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAic2NvcmUiOiB0b2tlbi5nZXQoInNjb3JlIiksCiAgICAgICAgICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgICAgICJjb252aWN0aW9uIjogX0NPTkZJREVOQ0VfT1JERVIuZ2V0KHRva2VuLmdldCgiY29uZmlkZW5jZSIsICJDIiksIDEpLAogICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJDT09MRE9XTl9TS0lQIiwKICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiBmImNvb2xkb3duX2hvdXJzPXtwb2xpY3lbJ2FsZXJ0X2Nvb2xkb3duX2hvdXJzJ119IHN0YXRlPXtwb2xpY3lbJ3N0YXRlJ119IiwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzeW1ib2xfZGFpbHlfYWxlcnRzID0gY291bnRfYWxlcnRzX3NpbmNlKAogICAgICAgICAgICAgICAgZGF0ZXRpbWUudXRjbm93KCkgLSB0aW1lZGVsdGEoaG91cnM9MjQpLAogICAgICAgICAgICAgICAgc3ltYm9sPXN5bWJvbCwKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBFTkFCTEVfUklTS19HT1ZFUk5PUgogICAgICAgICAgICAgICAgYW5kIE1BWF9BTEVSVFNfUEVSX1NZTUJPTF9QRVJfREFZID4gMAogICAgICAgICAgICAgICAgYW5kIHN5bWJvbF9kYWlseV9hbGVydHMgPj0gTUFYX0FMRVJUU19QRVJfU1lNQk9MX1BFUl9EQVkKICAgICAgICAgICAgKToKICAgICAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAic2NvcmUiOiB0b2tlbi5nZXQoInNjb3JlIiksCiAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIlNZTUJPTF9EQUlMWV9DQVBfU0tJUCIsCiAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogZiJkYWlseV9jYXA9e01BWF9BTEVSVFNfUEVSX1NZTUJPTF9QRVJfREFZfSIsCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGNoYW5nZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgICAgICAgICB0cmVuZCA9ICJVcHRyZW5kIiBpZiBjaGFuZ2VfMjRoID49IDAgZWxzZSAiUHVsbGJhY2siCiAgICAgICAgICAgIGVudHJ5X3R5cGUgPSAiTW9tZW50dW0gY29udGludWF0aW9uIiBpZiBjaGFuZ2VfMjRoID49IDAgZWxzZSAiRGlwIHJlY292ZXJ5IHNldHVwIgogICAgICAgICAgICB3YWxsZXRfZml0ID0gX3dhbGxldF9maXRfZm9yX21haW5fdG9rZW4odG9rZW4sIHJlZ2ltZSwgcG9saWN5KQogICAgICAgICAgICByaXNrX3BsYW4sIHJvdGF0aW9uX3BsYW4gPSBfd2FsbGV0X2d1aWRhbmNlKHdhbGxldF9maXQpCiAgICAgICAgICAgIHRva2VuX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgInNjb3JlIjogdG9rZW4uZ2V0KCJzY29yZSIpLAogICAgICAgICAgICAgICAgInByaWNlIjogdG9rZW4uZ2V0KCJwcmljZSIpLAogICAgICAgICAgICAgICAgImxpcXVpZGl0eSI6IHRva2VuLmdldCgibGlxdWlkaXR5IiksCiAgICAgICAgICAgICAgICAidm9sdW1lXzI0aCI6IHRva2VuLmdldCgidm9sdW1lXzI0aCIpLAogICAgICAgICAgICAgICAgIm1hcmtldF9jYXAiOiB0b2tlbi5nZXQoIm1hcmtldF9jYXAiKSwKICAgICAgICAgICAgICAgICJmZHYiOiB0b2tlbi5nZXQoImZkdiIpLAogICAgICAgICAgICAgICAgImhvbGRlcnMiOiBfaG9sZGVyc19mb3JfYWxlcnQodG9rZW4pLAogICAgICAgICAgICAgICAgInRyZW5kIjogdHJlbmQsCiAgICAgICAgICAgICAgICAiZW50cnlfdHlwZSI6IGVudHJ5X3R5cGUsCiAgICAgICAgICAgICAgICAiY29uZmlkZW5jZSI6IHRva2VuLmdldCgiY29uZmlkZW5jZSIsICJDIiksCiAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgInByb2ZpbGUiOiBfbW9kZSgpLAogICAgICAgICAgICAgICAgImNoYW5nZV8yNGgiOiBjaGFuZ2VfMjRoLAogICAgICAgICAgICAgICAgInJzaSI6IHRva2VuLmdldCgicnNpIiksCiAgICAgICAgICAgICAgICAibWFjZF9oaXN0IjogdG9rZW4uZ2V0KCJtYWNkX2hpc3QiKSwKICAgICAgICAgICAgICAgICJ3YWxsZXRfZml0Ijogd2FsbGV0X2ZpdCwKICAgICAgICAgICAgICAgICJyaXNrX3BsYW4iOiByaXNrX3BsYW4sCiAgICAgICAgICAgICAgICAicm90YXRpb25fcGxhbiI6IHJvdGF0aW9uX3BsYW4sCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIG5vdCBfcGFzc2VzX2xpdmVfcHVzaF9nYXRlKHRva2VuLCBwb2xpY3kpOgogICAgICAgICAgICAgICAgcmVxdWlyZWRfc2NvcmUgPSBmbG9hdChwb2xpY3kuZ2V0KCJhbGVydF90aHJlc2hvbGQiLCBfcnVudGltZVsiYWxlcnRfdGhyZXNob2xkIl0pIG9yIDApICsgbWF4KAogICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgaW50KFRFTEVHUkFNX1BVU0hfTUlOX1NDT1JFX0RFTFRBKSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGxvZ19zaWduYWwoCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICAgICAic2NvcmUiOiB0b2tlbi5nZXQoInNjb3JlIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJBTEVSVF9TVVBQUkVTU0VEX05PSVNFX0dBVEUiLAogICAgICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmInNjb3JlPj17cmVxdWlyZWRfc2NvcmU6LjFmfSBjb25mPj17VEVMRUdSQU1fUFVTSF9NSU5fQ09ORklERU5DRX0gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiJnb3Qgc2NvcmU9e2Zsb2F0KHRva2VuLmdldCgnc2NvcmUnLCAwKSBvciAwKTouMWZ9IGNvbmY9e3Rva2VuLmdldCgnY29uZmlkZW5jZScsICdDJyl9IgogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBtc2cgPSBmb3JtYXRfc2lnbmFsKHRva2VuX2RhdGEsIGNvbXBhY3Q9VHJ1ZSkKCiAgICAgICAgICAgIGRlY2lzaW9uID0gIkFMRVJUIgogICAgICAgICAgICBpZiBEUllfUlVOOgogICAgICAgICAgICAgICAgZGVjaXNpb24gPSAiQUxFUlRfRFJZX1JVTiIKICAgICAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiRFJZX1JVTiBlbmFibGVkLiBUZWxlZ3JhbSBhbGVydCBzdXBwcmVzc2VkIGZvciAlcyIsIHN5bWJvbCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICAgICAgICAgICAgICBjaGF0X2lkPWludChURUxFR1JBTV9DSEFUX0lEKSwKICAgICAgICAgICAgICAgICAgICB0ZXh0PW1zZywKICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgICAgICAgICByZXBseV9tYXJrdXA9X2J1aWxkX2FsZXJ0X2tleWJvYXJkKAogICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbi5nZXQoInBhaXJfYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgInNjb3JlIjogdG9rZW4uZ2V0KCJzY29yZSIpLAogICAgICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAiY29udmljdGlvbiI6IF9DT05GSURFTkNFX09SREVSLmdldCh0b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpLCAxKSwKICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6IGRlY2lzaW9uLAogICAgICAgICAgICB9KQoKICAgICAgICAgICAgaWYgT1VUQ09NRV9UUkFDS0lOR19FTkFCTEVEOgogICAgICAgICAgICAgICAgZW50cnlfcHJpY2UgPSBmbG9hdCh0b2tlbi5nZXQoInByaWNlIikgb3IgMCkKICAgICAgICAgICAgICAgIGlmIGVudHJ5X3ByaWNlID4gMDoKICAgICAgICAgICAgICAgICAgICBxdWV1ZV9hbGVydF9vdXRjb21lKHsKICAgICAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAgICAgImVudHJ5X3ByaWNlIjogZW50cnlfcHJpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICJzY29yZSI6IHRva2VuLmdldCgic2NvcmUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbmZpZGVuY2UiOiB0b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpLAogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICBhbGVydHNfc2VudCArPSAxCgogICAgICAgIGlmIGFsZXJ0c19zZW50ID09IDA6CiAgICAgICAgICAgIHByaW50KCJDYW5kaWRhdGVzIGZvdW5kIGJ1dCBza2lwcGVkIGJ5IGNvb2xkb3duL2NhcHMuIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjOgogICAgICAgIHByaW50KCJFTkdJTkUgRVJST1I6IiwgcmVwcihleGMpKQoKCmRlZiBtYWluKCk6CiAgICBfcmVxdWlyZV9lbnYoKQogICAgaW5pdF9kYigpCiAgICBfbG9hZF93YXRjaGxpc3Rfc3RhdGUoKQogICAgbG9jayA9IFNpbmdsZXRvblByb2Nlc3NMb2NrKFBST0NFU1NfTE9DS19GSUxFKQogICAgaWYgbm90IGxvY2suYWNxdWlyZSgpOgogICAgICAgIGxvZ2dpbmcuZXJyb3IoIkFub3RoZXIgZW5naW5lIGluc3RhbmNlIGlzIHJ1bm5pbmcuIEV4aXRpbmcgKGxvY2s6ICVzKS4iLCBQUk9DRVNTX0xPQ0tfRklMRSkKICAgICAgICByZXR1cm4KCiAgICBzZWxsX3J1bGVzID0gX3NlbGxfc3R5bGVfcnVsZXMoKQogICAgbG9nZ2luZy5pbmZvKAogICAgICAgICJTdGFydHVwIGNvbmZpZzogRU5HSU5FX1BST0ZJTEU9JXMgUklTS19TVFlMRT0lcyBBTEVSVF9USFJFU0hPTEQ9JXMgTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQ9JXMgIgogICAgICAgICJFTkFCTEVfUkVHSU1FX0dBVEU9JXMgUkVHSU1FX01JTl9TQ09SRT0lcyBEUllfUlVOPSVzICIKICAgICAgICAiV0VFS0xZX1RVTklOR19FTkFCTEVEPSVzIFdFRUtMWV9UVU5JTkdfREFZX1VUQz0lcyBXRUVLTFlfVFVOSU5HX0hPVVJfVVRDPSVzICIKICAgICAgICAiT1VUQ09NRV9UUkFDS0lOR19FTkFCTEVEPSVzIE9VVENPTUVfRVZBTF9JTlRFUlZBTF9TRUNPTkRTPSVzICIKICAgICAgICAiQUxFUlRfVE9QX049JXMgTUFYX0FMRVJUU19QRVJfQ1lDTEU9JXMgQUxFUlRfQ09PTERPV05fSE9VUlM9JXMgIgogICAgICAgICJFTkFCTEVfUklTS19HT1ZFUk5PUj0lcyBHTE9CQUxfVFJBRElOR19QQVVTRT0lcyBNQVhfQUxFUlRTX1BFUl9EQVk9JXMgIgogICAgICAgICJNQVhfQUxFUlRTX1BFUl9TWU1CT0xfUEVSX0RBWT0lcyBNQVhfQ09OU0VDVVRJVkVfNEhfTE9TU0VTPSVzICIKICAgICAgICAiTE9TU19TVFJFQUtfTE9PS0JBQ0tfSE9VUlM9JXMgRU5BQkxFX0VYRUNVVElPTl9RVUFMSVRZX0ZJTFRFUlM9JXMgIgogICAgICAgICJUQUNUSUNBTF9FTkFCTEVfUkVBTF9URUNITklDQUxTPSVzIFRBQ1RJQ0FMX1JFUVVJUkVfVEVDSE5JQ0FMX0NPTkZJUk1BVElPTj0lcyAiCiAgICAgICAgIlRBQ1RJQ0FMX09ITENWX1RZUEU9JXMgVEFDVElDQUxfUlNJX1JBTkdFPSVzLSVzIFRBQ1RJQ0FMX01BQ0RfSElTVF9NSU49JXMgIgogICAgICAgICJBTEVSVF9EQVRBX1JFRlJFU0hfRU5BQkxFRD0lcyBBTEVSVF9SRVFVSVJFX1JFRlJFU0hfU1VDQ0VTUz0lcyBBTEVSVF9EQVRBX0RSSUZUX1dBUk5fUENUPSVzICIKICAgICAgICAiQUxFUlRfSElERV9VTlZFUklGSUVEX0hPTERFUlM9JXMgRU5BQkxFX1NPTF9SRUdJTUVfTEFZRVI9JXMgIgogICAgICAgICJCRUFSSVNIX0FMRVJUX1RIUkVTSE9MRD0lcyBCRUFSSVNIX01JTl9DT05GSURFTkNFX1RPX0FMRVJUPSVzICIKICAgICAgICAiQkVBUklTSF9NQVhfQUxFUlRTX1BFUl9DWUNMRT0lcyBCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0RBWT0lcyAiCiAgICAgICAgIkJFQVJJU0hfQUxFUlRfQ09PTERPV05fSE9VUlM9JXMgRU5BQkxFX0VYVFJFTUVfUklTS19IQVJEX0JMT0NLPSVzICIKICAgICAgICAiTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVEPSVzIE5FV19SVU5ORVJfU0NBTl9JTlRFUlZBTF9TRUNPTkRTPSVzICIKICAgICAgICAiTkVXX1JVTk5FUl9NSU5fTUFSS0VUX0NBUD0lcyBORVdfUlVOTkVSX01BWF9BR0VfSE9VUlM9JXMgIgogICAgICAgICJORVdfUlVOTkVSX01JTl9WT0xVTUVfMjRIPSVzIE5FV19SVU5ORVJfTUlOX0xJUVVJRElUWT0lcyAiCiAgICAgICAgIk5FV19SVU5ORVJfTUlOX0FMRVJUX1NDT1JFPSVzIE5FV19SVU5ORVJfQ09PTERPV05fSE9VUlM9JXMgIgogICAgICAgICJXQVRDSExJU1RfTEFORV9FTkFCTEVEPSVzIFdBVENITElTVF9FTlRSSUVTPSVzIFdBVENITElTVF9TQ0FOX0lOVEVSVkFMX1NFQ09ORFM9JXMgIgogICAgICAgICJXQVRDSExJU1RfTUFYX0FMRVJUU19QRVJfQ1lDTEU9JXMgV0FUQ0hMSVNUX0FMRVJUX0NPT0xET1dOX0hPVVJTPSVzICIKICAgICAgICAiV0FUQ0hMSVNUX0FMRVJUX09OX1NUQVRVU19DSEFOR0U9JXMgV0FUQ0hMSVNUX0FMRVJUX1NUQVRVU0VTPSVzICIKICAgICAgICAiV0FUQ0hMSVNUX1NVTU1BUllfRU5BQkxFRD0lcyBXQVRDSExJU1RfU1VNTUFSWV9IT1VSX1VUQz0lcyAiCiAgICAgICAgIkFOQUxZU0lTX0JVTExFVElOX0VOQUJMRUQ9JXMgQU5BTFlTSVNfQlVMTEVUSU5fSU5URVJWQUw9JXMgIgogICAgICAgICJTRUxMX0FMRVJUU19FTkFCTEVEPSVzIFNFTExfQUxFUlRfTUFYX1BFUl9DWUNMRT0lcyBTRUxMX0FMRVJUX0NPT0xET1dOX0hPVVJTPSVzICIKICAgICAgICAiU0VMTF9FRkZFQ1RJVkVfTUFYX1BFUl9DWUNMRT0lcyBTRUxMX0VGRkVDVElWRV9DT09MRE9XTl9IT1VSUz0lcyAiCiAgICAgICAgIkxFR0FDWV9SRUNPVkVSWV9FTkFCTEVEPSVzIExFR0FDWV9SRUNPVkVSWV9TQ0FOX0lOVEVSVkFMX1NFQ09ORFM9JXMgIgogICAgICAgICJMRUdBQ1lfUkVDT1ZFUllfTUlOX0FHRV9EQVlTPSVzIExFR0FDWV9SRUNPVkVSWV9NSU5fTElRVUlESVRZPSVzICIKICAgICAgICAiTEVHQUNZX1JFQ09WRVJZX01JTl9WT0xVTUVfMjRIPSVzIExFR0FDWV9SRUNPVkVSWV9NQVhfQUxFUlRTX1BFUl9DWUNMRT0lcyAiCiAgICAgICAgIkxFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9IT1VSUz0lcyIsCiAgICAgICAgX21vZGUoKSwKICAgICAgICBfbm9ybWFsaXplX3Jpc2tfc3R5bGUoX3J1bnRpbWUuZ2V0KCJyaXNrX3N0eWxlIikpLAogICAgICAgIF9ydW50aW1lWyJhbGVydF90aHJlc2hvbGQiXSwKICAgICAgICBfcnVudGltZVsibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiXSwKICAgICAgICBFTkFCTEVfUkVHSU1FX0dBVEUsCiAgICAgICAgX3J1bnRpbWVbInJlZ2ltZV9taW5fc2NvcmUiXSwKICAgICAgICBEUllfUlVOLAogICAgICAgIFdFRUtMWV9UVU5JTkdfRU5BQkxFRCwKICAgICAgICBXRUVLTFlfVFVOSU5HX0RBWV9VVEMsCiAgICAgICAgV0VFS0xZX1RVTklOR19IT1VSX1VUQywKICAgICAgICBPVVRDT01FX1RSQUNLSU5HX0VOQUJMRUQsCiAgICAgICAgT1VUQ09NRV9FVkFMX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAgICAgQUxFUlRfVE9QX04sCiAgICAgICAgTUFYX0FMRVJUU19QRVJfQ1lDTEUsCiAgICAgICAgX3J1bnRpbWVbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0sCiAgICAgICAgRU5BQkxFX1JJU0tfR09WRVJOT1IsCiAgICAgICAgR0xPQkFMX1RSQURJTkdfUEFVU0UsCiAgICAgICAgTUFYX0FMRVJUU19QRVJfREFZLAogICAgICAgIE1BWF9BTEVSVFNfUEVSX1NZTUJPTF9QRVJfREFZLAogICAgICAgIE1BWF9DT05TRUNVVElWRV80SF9MT1NTRVMsCiAgICAgICAgTE9TU19TVFJFQUtfTE9PS0JBQ0tfSE9VUlMsCiAgICAgICAgRU5BQkxFX0VYRUNVVElPTl9RVUFMSVRZX0ZJTFRFUlMsCiAgICAgICAgVEFDVElDQUxfRU5BQkxFX1JFQUxfVEVDSE5JQ0FMUywKICAgICAgICBUQUNUSUNBTF9SRVFVSVJFX1RFQ0hOSUNBTF9DT05GSVJNQVRJT04sCiAgICAgICAgVEFDVElDQUxfT0hMQ1ZfVFlQRSwKICAgICAgICBUQUNUSUNBTF9SU0lfTUlOLAogICAgICAgIFRBQ1RJQ0FMX1JTSV9NQVgsCiAgICAgICAgVEFDVElDQUxfTUFDRF9ISVNUX01JTiwKICAgICAgICBBTEVSVF9EQVRBX1JFRlJFU0hfRU5BQkxFRCwKICAgICAgICBBTEVSVF9SRVFVSVJFX1JFRlJFU0hfU1VDQ0VTUywKICAgICAgICBBTEVSVF9EQVRBX0RSSUZUX1dBUk5fUENULAogICAgICAgIEFMRVJUX0hJREVfVU5WRVJJRklFRF9IT0xERVJTLAogICAgICAgIEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSLAogICAgICAgIEJFQVJJU0hfQUxFUlRfVEhSRVNIT0xELAogICAgICAgIEJFQVJJU0hfTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICAgICAgQkVBUklTSF9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgICAgICBCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0RBWSwKICAgICAgICBCRUFSSVNIX0FMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgICAgIEVOQUJMRV9FWFRSRU1FX1JJU0tfSEFSRF9CTE9DSywKICAgICAgICBORVdfUlVOTkVSX1dBVENIX0VOQUJMRUQsCiAgICAgICAgTkVXX1JVTk5FUl9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAgICAgTkVXX1JVTk5FUl9NSU5fTUFSS0VUX0NBUCwKICAgICAgICBORVdfUlVOTkVSX01BWF9BR0VfSE9VUlMsCiAgICAgICAgTkVXX1JVTk5FUl9NSU5fVk9MVU1FXzI0SCwKICAgICAgICBORVdfUlVOTkVSX01JTl9MSVFVSURJVFksCiAgICAgICAgTkVXX1JVTk5FUl9NSU5fQUxFUlRfU0NPUkUsCiAgICAgICAgTkVXX1JVTk5FUl9DT09MRE9XTl9IT1VSUywKICAgICAgICBXQVRDSExJU1RfTEFORV9FTkFCTEVELAogICAgICAgIGxlbihXQVRDSExJU1RfRU5UUklFUyksCiAgICAgICAgV0FUQ0hMSVNUX1NDQU5fSU5URVJWQUxfU0VDT05EUywKICAgICAgICBXQVRDSExJU1RfTUFYX0FMRVJUU19QRVJfQ1lDTEUsCiAgICAgICAgV0FUQ0hMSVNUX0FMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgICAgIFdBVENITElTVF9BTEVSVF9PTl9TVEFUVVNfQ0hBTkdFLAogICAgICAgICIsIi5qb2luKFdBVENITElTVF9BTEVSVF9TVEFUVVNFUyksCiAgICAgICAgV0FUQ0hMSVNUX1NVTU1BUllfRU5BQkxFRCwKICAgICAgICBXQVRDSExJU1RfU1VNTUFSWV9IT1VSX1VUQywKICAgICAgICBHT09EX0JVWV9CVUxMRVRJTl9FTkFCTEVELAogICAgICAgIEdPT0RfQlVZX0JVTExFVElOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAgICAgU0VMTF9BTEVSVFNfRU5BQkxFRCwKICAgICAgICBTRUxMX0FMRVJUX01BWF9QRVJfQ1lDTEUsCiAgICAgICAgU0VMTF9BTEVSVF9DT09MRE9XTl9IT1VSUywKICAgICAgICBzZWxsX3J1bGVzWyJtYXhfcGVyX2N5Y2xlIl0sCiAgICAgICAgc2VsbF9ydWxlc1siY29vbGRvd25faG91cnMiXSwKICAgICAgICBMRUdBQ1lfUkVDT1ZFUllfRU5BQkxFRCwKICAgICAgICBMRUdBQ1lfUkVDT1ZFUllfU0NBTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVMsCiAgICAgICAgTEVHQUNZX1JFQ09WRVJZX01JTl9MSVFVSURJVFksCiAgICAgICAgTEVHQUNZX1JFQ09WRVJZX01JTl9WT0xVTUVfMjRILAogICAgICAgIExFR0FDWV9SRUNPVkVSWV9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgICAgICBMRUdBQ1lfUkVDT1ZFUllfQ09PTERPV05fSE9VUlMsCiAgICApCiAgICB0cnk6CiAgICAgICAgZ2xvYmFsIF9hcHBfcmVmCiAgICAgICAgYXBwID0gQXBwbGljYXRpb25CdWlsZGVyKCkudG9rZW4oVEVMRUdSQU1fVE9LRU4pLmJ1aWxkKCkKICAgICAgICBfYXBwX3JlZiA9IGFwcAoKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImhlbHAiLCBjbWRfaGVscCkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzdGF0dXMiLCBjbWRfc3RhdHVzKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIm1vZGUiLCBjbWRfbW9kZSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJyaXNrcHJvZmlsZSIsIGNtZF9yaXNrcHJvZmlsZSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJyaXNrIiwgY21kX3Jpc2spKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigicGF1c2UiLCBjbWRfcGF1c2UpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigicmVzdW1lIiwgY21kX3Jlc3VtZSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJwZXJmb3JtYW5jZSIsIGNtZF9wZXJmb3JtYW5jZSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJidXkiLCBjbWRfYnV5KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInNvbGQiLCBjbWRfc29sZCkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJwb3NpdGlvbnMiLCBjbWRfcG9zaXRpb25zKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImRpZ2VzdCIsIGNtZF9kaWdlc3QpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigibWFya2V0bm93IiwgY21kX21hcmtldG5vdykpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJnb29kYnV5IiwgY21kX2dvb2RidXkpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiYmFkYnV5IiwgY21kX2JhZGJ1eSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ3YWxsZXQybm93IiwgY21kX3dhbGxldDJub3cpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigid2FsbGV0MmJhZCIsIGNtZF93YWxsZXQyYmFkKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIndhbGxldDNub3ciLCBjbWRfd2FsbGV0M25vdykpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ3YWxsZXQzYmFkIiwgY21kX3dhbGxldDNiYWQpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigid2FsbGV0cGxhbiIsIGNtZF93YWxsZXRwbGFuKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInJ1bm5lcndhdGNoIiwgY21kX3J1bm5lcndhdGNoKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIndhdGNobGlzdCIsIGNtZF93YXRjaGxpc3QpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigid2F0Y2hsaXN0c3VtbWFyeSIsIGNtZF93YXRjaGxpc3RzdW1tYXJ5KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ2FsbGJhY2tRdWVyeUhhbmRsZXIob25fYWxlcnRfYWN0aW9uLCBwYXR0ZXJuPXIiXihtdXRlfGFjayk6IikpCgogICAgICAgIGFwcC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgICAgIHJ1bl9lbmdpbmUsCiAgICAgICAgICAgIHdoZW49MSwKICAgICAgICAgICAgbmFtZT0icnVuX2VuZ2luZV9ib290IiwKICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDMwfSwKICAgICAgICApCiAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKAogICAgICAgICAgICBydW5fZW5naW5lLAogICAgICAgICAgICBpbnRlcnZhbD1pbnQoX3J1bnRpbWVbInNjYW5faW50ZXJ2YWxfc2Vjb25kcyJdKSwKICAgICAgICAgICAgZmlyc3Q9aW50KF9ydW50aW1lWyJzY2FuX2ludGVydmFsX3NlY29uZHMiXSksCiAgICAgICAgICAgIG5hbWU9InJ1bl9lbmdpbmVfY3ljbGUiLAogICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMzAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICkKICAgICAgICBpZiBORVdfUlVOTkVSX1dBVENIX0VOQUJMRUQ6CiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgICAgICAgICBydW5fbmV3X3J1bm5lcl93YXRjaCwKICAgICAgICAgICAgICAgIHdoZW49MTUsCiAgICAgICAgICAgICAgICBuYW1lPSJydW5uZXJfd2F0Y2hfYm9vdCIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogNjB9LAogICAgICAgICAgICApCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX3JlcGVhdGluZygKICAgICAgICAgICAgICAgIHJ1bl9uZXdfcnVubmVyX3dhdGNoLAogICAgICAgICAgICAgICAgaW50ZXJ2YWw9bWF4KDMwMCwgaW50KE5FV19SVU5ORVJfU0NBTl9JTlRFUlZBTF9TRUNPTkRTKSksCiAgICAgICAgICAgICAgICBmaXJzdD1tYXgoMzAwLCBpbnQoTkVXX1JVTk5FUl9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMpKSwKICAgICAgICAgICAgICAgIG5hbWU9InJ1bm5lcl93YXRjaF9jeWNsZSIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMTIwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICAgICAgICAgKQogICAgICAgIGlmIExFR0FDWV9SRUNPVkVSWV9FTkFCTEVEOgogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgICAgICAgICAgcnVuX2xlZ2FjeV9yZWNvdmVyeV9zY2FubmVyLAogICAgICAgICAgICAgICAgd2hlbj0zNSwKICAgICAgICAgICAgICAgIG5hbWU9ImxlZ2FjeV9yZWNvdmVyeV9ib290IiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiA2MH0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKAogICAgICAgICAgICAgICAgcnVuX2xlZ2FjeV9yZWNvdmVyeV9zY2FubmVyLAogICAgICAgICAgICAgICAgaW50ZXJ2YWw9bWF4KDMwMCwgaW50KExFR0FDWV9SRUNPVkVSWV9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMpKSwKICAgICAgICAgICAgICAgIGZpcnN0PW1heCgzMDAsIGludChMRUdBQ1lfUkVDT1ZFUllfU0NBTl9JTlRFUlZBTF9TRUNPTkRTKSksCiAgICAgICAgICAgICAgICBuYW1lPSJsZWdhY3lfcmVjb3ZlcnlfY3ljbGUiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDEyMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBXQVRDSExJU1RfTEFORV9FTkFCTEVEIGFuZCBXQVRDSExJU1RfRU5UUklFUzoKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICAgICAgICAgIHJ1bl93YXRjaGxpc3RfbGFuZSwKICAgICAgICAgICAgICAgIHdoZW49MjUsCiAgICAgICAgICAgICAgICBuYW1lPSJ3YXRjaGxpc3RfYm9vdCIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogNjB9LAogICAgICAgICAgICApCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX3JlcGVhdGluZygKICAgICAgICAgICAgICAgIHJ1bl93YXRjaGxpc3RfbGFuZSwKICAgICAgICAgICAgICAgIGludGVydmFsPW1heCgzMDAsIGludChXQVRDSExJU1RfU0NBTl9JTlRFUlZBTF9TRUNPTkRTKSksCiAgICAgICAgICAgICAgICBmaXJzdD1tYXgoMzAwLCBpbnQoV0FUQ0hMSVNUX1NDQU5fSU5URVJWQUxfU0VDT05EUykpLAogICAgICAgICAgICAgICAgbmFtZT0id2F0Y2hsaXN0X2N5Y2xlIiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAxMjAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCiAgICAgICAgaWYgT1VUQ09NRV9UUkFDS0lOR19FTkFCTEVEOgogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgICAgICAgICBydW5fb3V0Y29tZV9ldmFsdWF0b3IsCiAgICAgICAgICAgICAgICBpbnRlcnZhbD1PVVRDT01FX0VWQUxfSU5URVJWQUxfU0VDT05EUywKICAgICAgICAgICAgICAgIGZpcnN0PU9VVENPTUVfRVZBTF9JTlRFUlZBTF9TRUNPTkRTLAogICAgICAgICAgICAgICAgbmFtZT0ib3V0Y29tZV9ldmFsdWF0b3IiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDEyMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBTSUdOQUxfRElHRVNUX0VOQUJMRUQ6CiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX3JlcGVhdGluZygKICAgICAgICAgICAgICAgIHNlbmRfc2lnbmFsX2RpZ2VzdCwKICAgICAgICAgICAgICAgIGludGVydmFsPVNJR05BTF9ESUdFU1RfSU5URVJWQUxfU0VDT05EUywKICAgICAgICAgICAgICAgIGZpcnN0PVNJR05BTF9ESUdFU1RfSU5URVJWQUxfU0VDT05EUywKICAgICAgICAgICAgICAgIG5hbWU9InNpZ25hbF9kaWdlc3QiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDEyMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBHT09EX0JVWV9CVUxMRVRJTl9FTkFCTEVEOgogICAgICAgICAgICBidWxsZXRpbl9pbnRlcnZhbCA9IG1heCg5MDAsIGludChHT09EX0JVWV9CVUxMRVRJTl9JTlRFUlZBTF9TRUNPTkRTKSkKICAgICAgICAgICAgYnVsbGV0aW5fYm9vdCA9IG1heCgxNSwgbWluKGludChHT09EX0JVWV9CVUxMRVRJTl9CT09UX1NFQ09ORFMpLCBidWxsZXRpbl9pbnRlcnZhbCkpCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgICAgICAgICBzZW5kX2dvb2RfYnV5X2J1bGxldGluLAogICAgICAgICAgICAgICAgd2hlbj1idWxsZXRpbl9ib290LAogICAgICAgICAgICAgICAgbmFtZT0iZ29vZF9idXlfYnVsbGV0aW5fYm9vdCIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMTIwfSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgICAgICAgICBzZW5kX2dvb2RfYnV5X2J1bGxldGluLAogICAgICAgICAgICAgICAgaW50ZXJ2YWw9YnVsbGV0aW5faW50ZXJ2YWwsCiAgICAgICAgICAgICAgICBmaXJzdD1idWxsZXRpbl9pbnRlcnZhbCwKICAgICAgICAgICAgICAgIG5hbWU9Imdvb2RfYnV5X2J1bGxldGluIiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAzMDAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCgogICAgICAgIGlmIERBSUxZX1NVTU1BUllfRU5BQkxFRDoKICAgICAgICAgICAgc3VtbWFyeV9ob3VyID0gbWF4KDAsIG1pbigyMywgREFJTFlfU1VNTUFSWV9IT1VSX1VUQykpCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX2RhaWx5KAogICAgICAgICAgICAgICAgc2VuZF9kYWlseV9zdW1tYXJ5LAogICAgICAgICAgICAgICAgdGltZT10aW1lKGhvdXI9c3VtbWFyeV9ob3VyLCBtaW51dGU9MCwgdHppbmZvPXRpbWV6b25lLnV0YyksCiAgICAgICAgICAgICAgICBuYW1lPSJkYWlseV9zdW1tYXJ5IiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAxODAwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICAgICAgICAgKQogICAgICAgIGlmIFdFRUtMWV9UVU5JTkdfRU5BQkxFRDoKICAgICAgICAgICAgd2Vla2x5X2hvdXIgPSBtYXgoMCwgbWluKDIzLCBXRUVLTFlfVFVOSU5HX0hPVVJfVVRDKSkKICAgICAgICAgICAgd2Vla2x5X2RheSA9IF9EQVlfVE9fV0VFS0RBWS5nZXQoV0VFS0xZX1RVTklOR19EQVlfVVRDLCA2KQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9kYWlseSgKICAgICAgICAgICAgICAgIHNlbmRfd2Vla2x5X3R1bmluZ19yZXBvcnQsCiAgICAgICAgICAgICAgICB0aW1lPXRpbWUoaG91cj13ZWVrbHlfaG91ciwgbWludXRlPTUsIHR6aW5mbz10aW1lem9uZS51dGMpLAogICAgICAgICAgICAgICAgZGF5cz0od2Vla2x5X2RheSwpLAogICAgICAgICAgICAgICAgbmFtZT0id2Vla2x5X3R1bmluZyIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMzYwMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBXQVRDSExJU1RfU1VNTUFSWV9FTkFCTEVEIGFuZCBXQVRDSExJU1RfTEFORV9FTkFCTEVEIGFuZCBXQVRDSExJU1RfRU5UUklFUzoKICAgICAgICAgICAgd2F0Y2hfc3VtbWFyeV9ob3VyID0gbWF4KDAsIG1pbigyMywgV0FUQ0hMSVNUX1NVTU1BUllfSE9VUl9VVEMpKQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9kYWlseSgKICAgICAgICAgICAgICAgIHNlbmRfd2F0Y2hsaXN0X3N1bW1hcnksCiAgICAgICAgICAgICAgICB0aW1lPXRpbWUoaG91cj13YXRjaF9zdW1tYXJ5X2hvdXIsIG1pbnV0ZT0xMCwgdHppbmZvPXRpbWV6b25lLnV0YyksCiAgICAgICAgICAgICAgICBuYW1lPSJ3YXRjaGxpc3Rfc3VtbWFyeSIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMTgwMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKCiAgICAgICAgcHJpbnQoIkVuZ2luZSBzdGFydGVkLi4uIikKICAgICAgICBhcHAucnVuX3BvbGxpbmcoKQogICAgZmluYWxseToKICAgICAgICBsb2NrLnJlbGVhc2UoKQoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCkK',
}
for path, b64 in FILES.items():
    content = base64.b64decode(b64)
    try:
        ast.parse(content)
        print(f"  {path} syntax OK - {len(content):,} chars")
    except SyntaxError as e:
        print(f"  SYNTAX ERROR in {path}: {e}")
        sys.exit(1)
    with open(path, "wb") as f:
        f.write(content)
    print(f"  Written: {path}")
print("")
print("Deploy complete.")
