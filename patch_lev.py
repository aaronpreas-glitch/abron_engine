#!/usr/bin/env python3
import base64, ast, sys

FILES = {
    '/root/memecoin_engine/main.py': 'aW1wb3J0IGxvZ2dpbmcKaW1wb3J0IGpzb24KaW1wb3J0IGh0bWwKaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUgYXMgdGltZV9tb2R1bGUKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lLCB0aW1lZGVsdGEsIHRpbWV6b25lCmZyb20gbG9nZ2luZy5oYW5kbGVycyBpbXBvcnQgUm90YXRpbmdGaWxlSGFuZGxlcgoKZnJvbSB0ZWxlZ3JhbSBpbXBvcnQgQ29weVRleHRCdXR0b24sIElubGluZUtleWJvYXJkQnV0dG9uLCBJbmxpbmVLZXlib2FyZE1hcmt1cCwgVXBkYXRlCmZyb20gdGVsZWdyYW0uZXh0IGltcG9ydCAoCiAgICBBcHBsaWNhdGlvbkJ1aWxkZXIsCiAgICBDYWxsYmFja1F1ZXJ5SGFuZGxlciwKICAgIENvbW1hbmRIYW5kbGVyLAogICAgQ29udGV4dFR5cGVzLAopCgpmcm9tIGNvbmZpZyBpbXBvcnQgKAogICAgRU5HSU5FX1BST0ZJTEUsCiAgICBBTEVSVF9USFJFU0hPTEQsCiAgICBBTEVSVF9UT1BfTiwKICAgIEFMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgQUxFUlRfREFUQV9EUklGVF9XQVJOX1BDVCwKICAgIEFMRVJUX0RBVEFfUkVGUkVTSF9FTkFCTEVELAogICAgQUxFUlRfSElERV9VTlZFUklGSUVEX0hPTERFUlMsCiAgICBBTEVSVF9SRVFVSVJFX1JFRlJFU0hfU1VDQ0VTUywKICAgIEJFQVJJU0hfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICBCRUFSSVNIX0FMRVJUX1RIUkVTSE9MRCwKICAgIEJFQVJJU0hfTUFYX0FMRVJUU19QRVJfQ1lDTEUsCiAgICBCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0RBWSwKICAgIEJFQVJJU0hfTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICBCRUFSSVNIX1JFR0lNRV9NSU5fU0NPUkUsCiAgICBDT05GSURFTkNFX01JTl9BLAogICAgQ09ORklERU5DRV9NSU5fQiwKICAgIERBSUxZX1NVTU1BUllfRU5BQkxFRCwKICAgIERBSUxZX1NVTU1BUllfSE9VUl9VVEMsCiAgICBEUllfUlVOLAogICAgRU5BQkxFX1JFR0lNRV9HQVRFLAogICAgRU5BQkxFX0VYRUNVVElPTl9RVUFMSVRZX0ZJTFRFUlMsCiAgICBFTkFCTEVfRVhUUkVNRV9SSVNLX0hBUkRfQkxPQ0ssCiAgICBFTkFCTEVfUklTS19HT1ZFUk5PUiwKICAgIEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSLAogICAgR0xPQkFMX1RSQURJTkdfUEFVU0UsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9CT09UX1NFQ09ORFMsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9FTkFCTEVELAogICAgR09PRF9CVVlfQlVMTEVUSU5fSU5URVJWQUxfU0VDT05EUywKICAgIEdPT0RfQlVZX0JVTExFVElOX1BFUl9USUVSX01BWF9UT0tFTlMsCiAgICBHT09EX0JVWV9CVUxMRVRJTl9USUVSLAogICAgTE9HX0JBQ0tVUF9DT1VOVCwKICAgIExPR19KU09OX0VOQUJMRUQsCiAgICBMT0dfSlNPTl9QQVRILAogICAgTE9HX01BWF9CWVRFUywKICAgIExPU1NfU1RSRUFLX1BBVVNFX0hPVVJTLAogICAgTE9TU19TVFJFQUtfTE9PS0JBQ0tfSE9VUlMsCiAgICBNQVhfQUJTX0NIQU5HRV8yNEgsCiAgICBNQVhfQUxFUlRTX1BFUl9EQVksCiAgICBNQVhfQUxFUlRTX1BFUl9TWU1CT0xfUEVSX0RBWSwKICAgIE1BWF9BTExPV0VEX0RSQVdET1dOXzI0SCwKICAgIE1BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgTUFYX0NPTlNFQ1VUSVZFXzRIX0xPU1NFUywKICAgIE1BWF9WT0xfVE9fTElRX1JBVElPLAogICAgTUlOX0xJUVVJRElUWV9QRVJfSE9MREVSLAogICAgTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICBNSU5fSE9MREVSUywKICAgIE1JTl9MSVFVSURJVFksCiAgICBNSU5fUFJJQ0VfVVNELAogICAgTUlOX1ZPTF9UT19MSVFfUkFUSU8sCiAgICBNSU5fVk9MVU1FXzI0SCwKICAgIE5FV19SVU5ORVJfQ09PTERPV05fSE9VUlMsCiAgICBORVdfUlVOTkVSX01BWF9BR0VfSE9VUlMsCiAgICBORVdfUlVOTkVSX01BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgTkVXX1JVTk5FUl9NQVhfUkVTVUxUUywKICAgIE5FV19SVU5ORVJfTUlOX0FMRVJUX1NDT1JFLAogICAgTkVXX1JVTk5FUl9NSU5fQ0hBTkdFXzI0SCwKICAgIE5FV19SVU5ORVJfTUlOX0xJUVVJRElUWSwKICAgIE5FV19SVU5ORVJfTUlOX01BUktFVF9DQVAsCiAgICBORVdfUlVOTkVSX01JTl9UWE5TX0gxLAogICAgTkVXX1JVTk5FUl9NSU5fVk9MVU1FXzI0SCwKICAgIE5FV19SVU5ORVJfTkFSUkFUSVZFX0tFWVdPUkRTLAogICAgTkVXX1JVTk5FUl9QQUlSU19QRVJfUVVFUlksCiAgICBORVdfUlVOTkVSX1JFUVVJUkVfU09DSUFMX0xJTktTLAogICAgTkVXX1JVTk5FUl9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICBORVdfUlVOTkVSX1NFQVJDSF9RVUVSSUVTLAogICAgTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVELAogICAgT1VUQ09NRV9FVkFMX0JBVENIX1NJWkUsCiAgICBPVVRDT01FX0VWQUxfSU5URVJWQUxfU0VDT05EUywKICAgIE9VVENPTUVfVFJBQ0tJTkdfRU5BQkxFRCwKICAgIFBST0NFU1NfTE9DS19GSUxFLAogICAgUkVHSU1FX01JTl9TQ09SRSwKICAgIFJJU0tfU1RZTEUsCiAgICBTQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICBTRUxMX0FMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgU0VMTF9BTEVSVF9NQVhfUEVSX0NZQ0xFLAogICAgU0VMTF9BTEVSVFNfRU5BQkxFRCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfQUJTX0NIQU5HRV8xSCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfQUJTX0NIQU5HRV82SCwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfVFhOU19IMSwKICAgIFNFTExfQ09OU09MSURBVElPTl9NQVhfVk9MX1RPX0xJUSwKICAgIFNFTExfQ09OU09MSURBVElPTl9NSU5fQ0hBTkdFXzI0SCwKICAgIFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfMUgsCiAgICBTRUxMX0hZUEVfRkFERV9NQVhfQ0hBTkdFXzI0SCwKICAgIFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfNkgsCiAgICBTRUxMX0hZUEVfRkFERV9NQVhfVk9MX1RPX0xJUSwKICAgIFNJR05BTF9ESUdFU1RfRU5BQkxFRCwKICAgIFNJR05BTF9ESUdFU1RfSU5URVJWQUxfU0VDT05EUywKICAgIFNJR05BTF9ESUdFU1RfTE9PS0JBQ0tfSE9VUlMsCiAgICBTSUdOQUxfRElHRVNUX01BWF9JVEVNUywKICAgIFNPTF9CUkVBRFRIX01JTl9GT1JfUklTS19PTiwKICAgIFNPTF9FWFRSRU1FX09GRl9DSEFOR0VfMUgsCiAgICBTT0xfRVhUUkVNRV9PRkZfQ0hBTkdFXzI0SCwKICAgIFNPTF9SRUdJTUVfUVVFUlksCiAgICBTT0xfUklTS19PRkZfQ0hBTkdFXzI0SCwKICAgIFNPTF9SSVNLX09OX0NIQU5HRV8yNEgsCiAgICBURUxFR1JBTV9DSEFUX0lELAogICAgVEVMRUdSQU1fQUNUSU9OX0JVVFRPTlNfRU5BQkxFRCwKICAgIFRFTEVHUkFNX1RPS0VOLAogICAgVEVMRUdSQU1fUVVJRVRfTU9ERSwKICAgIFRFTEVHUkFNX1BVU0hfTUlOX0NPTkZJREVOQ0UsCiAgICBURUxFR1JBTV9QVVNIX01JTl9TQ09SRV9ERUxUQSwKICAgIFRFTEVHUkFNX1BVU0hfU1RST05HX09OTFksCiAgICBXQVRDSExJU1RfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICBXQVRDSExJU1RfQUxFUlRfT05fU1RBVFVTX0NIQU5HRSwKICAgIFdBVENITElTVF9BTEVSVF9TVEFUVVNFUywKICAgIFdBVENITElTVF9FTlRSSUVTLAogICAgV0FUQ0hMSVNUX0xBTkVfRU5BQkxFRCwKICAgIFdBVENITElTVF9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgIFdBVENITElTVF9NSU5fTElRVUlESVRZLAogICAgV0FUQ0hMSVNUX01JTl9WT0xVTUVfMjRILAogICAgV0FUQ0hMSVNUX1NDQU5fSU5URVJWQUxfU0VDT05EUywKICAgIFdBVENITElTVF9TVU1NQVJZX0VOQUJMRUQsCiAgICBXQVRDSExJU1RfU1VNTUFSWV9IT1VSX1VUQywKICAgIFdFRUtMWV9UVU5JTkdfREFZX1VUQywKICAgIFdFRUtMWV9UVU5JTkdfRU5BQkxFRCwKICAgIFdFRUtMWV9UVU5JTkdfSE9VUl9VVEMsCiAgICBXRUVLTFlfVFVOSU5HX0xPT0tCQUNLX0RBWVMsCiAgICBXRUVLTFlfVFVOSU5HX01JTl9PVVRDT01FU180SCwKICAgIFNZTUJPTF9CTEFDS0xJU1RfQVZHXzI0SF9QQ1QsCiAgICBTWU1CT0xfQkxBQ0tMSVNUX0hPVVJTLAogICAgU1lNQk9MX0JMQUNLTElTVF9NSU5fU0FNUExFUywKICAgIFNZTUJPTF9DT05UUk9MX0VOQUJMRUQsCiAgICBTWU1CT0xfQ09PTERPV05fSE9VUlMsCiAgICBTWU1CT0xfTE9TU19TVFJFQUtfVFJJR0dFUiwKICAgIFRBQ1RJQ0FMX01BWF9MQVNUX1RSQURFX0FHRV9NSU5VVEVTLAogICAgVEFDVElDQUxfRU5BQkxFX1JFQUxfVEVDSE5JQ0FMUywKICAgIFRBQ1RJQ0FMX01BQ0RfSElTVF9NSU4sCiAgICBUQUNUSUNBTF9PSExDVl9MT09LQkFDS19IT1VSUywKICAgIFRBQ1RJQ0FMX09ITENWX1RZUEUsCiAgICBUQUNUSUNBTF9SRVFVSVJFX1RFQ0hOSUNBTF9DT05GSVJNQVRJT04sCiAgICBUQUNUSUNBTF9SU0lfTUFYLAogICAgVEFDVElDQUxfUlNJX01JTiwKICAgIFRBQ1RJQ0FMX1JTSV9QRVJJT0QsCiAgICBUQUNUSUNBTF9URUNIX0NBQ0hFX1NFQ09ORFMsCiAgICBUQUNUSUNBTF9NSU5fTU9NRU5UVU1fQ0hBTkdFXzFILAogICAgVEFDVElDQUxfTUlOX1ZPTF9UT19MSVFfUkFUSU8sCiAgICBUQUNUSUNBTF9QVUxMQkFDS19NQVhfUENULAogICAgVEFDVElDQUxfUFVMTEJBQ0tfTUlOX1BDVCwKICAgIFRBQ1RJQ0FMX1RSRU5EX01JTl9DSEFOR0VfMjRILAogICAgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQsCiAgICBMRUdBQ1lfUkVDT1ZFUllfU0NBTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgTEVHQUNZX1JFQ09WRVJZX1NFQVJDSF9RVUVSSUVTLAogICAgTEVHQUNZX1JFQ09WRVJZX1BBSVJTX1BFUl9RVUVSWSwKICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVMsCiAgICBMRUdBQ1lfUkVDT1ZFUllfTUlOX0xJUVVJRElUWSwKICAgIExFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SCwKICAgIExFR0FDWV9SRUNPVkVSWV9WT0xVTUVfU1BJS0VfTVVMVElQTElFUiwKICAgIExFR0FDWV9SRUNPVkVSWV9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgIExFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9IT1VSUywKKQpmcm9tIGRhdGEuYmlyZGV5ZSBpbXBvcnQgKAogICAgZmV0Y2hfYmlyZGV5ZV9vaGxjdiwKICAgIGZldGNoX2JpcmRleWVfcHJpY2UsCiAgICBmZXRjaF9iaXJkZXllX3Rva2VuX292ZXJ2aWV3LAopCmZyb20gZGF0YS5kZXhzY3JlZW5lciBpbXBvcnQgKAogICAgZmV0Y2hfbGVnYWN5X3JlY292ZXJ5X2NhbmRpZGF0ZXMsCiAgICBmZXRjaF9ydW5uZXJfd2F0Y2hfY2FuZGlkYXRlcywKICAgIGZldGNoX3NvbF9tYXJrZXRfcHJveHksCiAgICBmZXRjaF90b2tlbl9zbmFwc2hvdCBhcyBmZXRjaF9kZXhzY3JlZW5lcl90b2tlbl9zbmFwc2hvdCwKKQpmcm9tIGRhdGEubWFya2V0X2RhdGEgaW1wb3J0IGZldGNoX21hcmtldF9kYXRhCmZyb20gc2NvcmluZyBpbXBvcnQgY2FsY3VsYXRlX3Rva2VuX3Njb3JlCmZyb20gdXRpbHMubWV0cmljcyBpbXBvcnQgY2xvc2VzLCBtYWNkLCByc2kKZnJvbSB1dGlscy5kYiBpbXBvcnQgKAogICAgY2xvc2VfbWFudWFsX3Bvc2l0aW9uLAogICAgY2xlYXJfcmlza19wYXVzZSwKICAgIGNvdW50X2FsZXJ0c19zaW5jZSwKICAgIGdldF9hY3RpdmVfc3ltYm9sX2NvbnRyb2wsCiAgICBnZXRfYWxlcnRfb3V0Y29tZV9yZWNhcCwKICAgIGdldF9jb25zZWN1dGl2ZV9sb3Npbmdfb3V0Y29tZXNfNGgsCiAgICBnZXRfZW5naW5lX2hlYWx0aF9zbmFwc2hvdCwKICAgIGdldF9sYXN0X2FsZXJ0X3RpbWVzdGFtcCwKICAgIGdldF9sYXRlc3RfNGhfb3V0Y29tZV90aW1lc3RhbXAsCiAgICBnZXRfbGF0ZXN0X2VuZ2luZV9ldmVudCwKICAgIGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sLAogICAgZ2V0X291dGNvbWVfcXVldWVfc3RhdHMsCiAgICBnZXRfb3Blbl9wb3NpdGlvbnMsCiAgICBnZXRfcGVuZGluZ19hbGVydF9vdXRjb21lcywKICAgIGdldF9wZXJmb3JtYW5jZV9zdW1tYXJ5LAogICAgZ2V0X3BvcnRmb2xpb19zaW11bGF0aW9uX21ldHJpY3MsCiAgICBnZXRfcmVjZW50X3NjYW5fYmVzdHMsCiAgICBnZXRfcmlza19wYXVzZV9zdGF0ZSwKICAgIGdldF9zeW1ib2xfb3V0Y29tZV9zdGF0cywKICAgIGdldF93ZWVrbHlfdHVuaW5nX3JlcG9ydCwKICAgIGluaXRfZGIsCiAgICBsb2dfc2lnbmFsLAogICAgbWFya19hbGVydF9vdXRjb21lX2NvbXBsZXRlLAogICAgbWFya19hbGVydF9vdXRjb21lX2Vycm9yLAogICAgb3Blbl9tYW51YWxfcG9zaXRpb24sCiAgICBxdWV1ZV9hbGVydF9vdXRjb21lLAogICAgc2V0X3Jpc2tfcGF1c2UsCiAgICBzZXRfc3ltYm9sX2NvbnRyb2wsCiAgICB1cGRhdGVfYWxlcnRfb3V0Y29tZV9ob3Jpem9uLAopCmZyb20gdXRpbHMuZm9ybWF0IGltcG9ydCAoCiAgICBmb3JtYXRfbGVnYWN5X3JlY292ZXJ5LAogICAgZm9ybWF0X3J1bm5lcl93YXRjaCwKICAgIGZvcm1hdF9zaWduYWwsCiAgICBmb3JtYXRfd2F0Y2hsaXN0X3NpZ25hbCwKICAgIGZvcm1hdF93YXRjaGxpc3Rfc3VtbWFyeSwKKQpmcm9tIHV0aWxzLnNpbmdsZXRvbiBpbXBvcnQgU2luZ2xldG9uUHJvY2Vzc0xvY2sKZnJvbSBqdXBpdGVyX3BlcnBzIGltcG9ydCAoCiAgICBmZXRjaF9qdXBpdGVyX3Bvc2l0aW9uLAogICAgZmV0Y2hfc29sX3ByaWNlLAogICAgZmV0Y2hfc29sX3ZvbGF0aWxpdHlfMzBkLAogICAgY2hlY2tfYWxlcnRzLAogICAgY2hlY2tfbW9udGhseV9yZW1pbmRlciwKICAgIGNhbGNfbGV2ZXJhZ2VfcmVjb21tZW5kYXRpb24sCiAgICBjYWxjX3ByaWNlX3pvbmVzLAogICAgZm9ybWF0X2xldl9kYXNoYm9hcmQsCiAgICBmb3JtYXRfbGV2X3N0YXR1cywKICAgIGZvcm1hdF93aGF0X2lmLAogICAgZm9ybWF0X21vbnRobHlfcmVtaW5kZXIsCiAgICBmb3JtYXRfbGV2ZXJhZ2VfcmVjLAogICAgZm9ybWF0X3ByaWNlX3pvbmVzLAogICAgUFJJQ0VfVEFSR0VUUywKICAgIFBSSUNFX1pPTkVfTEVWRUxTLAogICAgQ0hFQ0tfSU5URVJWQUxfU0VDT05EUywKICAgIE1PTlRITFlfQUREX1VTRCwKKQoKY2xhc3MgX01heExldmVsRmlsdGVyKGxvZ2dpbmcuRmlsdGVyKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBtYXhfbGV2ZWwpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQogICAgICAgIHNlbGYubWF4X2xldmVsID0gbWF4X2xldmVsCgogICAgZGVmIGZpbHRlcihzZWxmLCByZWNvcmQpOgogICAgICAgIHJldHVybiByZWNvcmQubGV2ZWxubyA8PSBzZWxmLm1heF9sZXZlbAoKCmNsYXNzIF9Kc29uRm9ybWF0dGVyKGxvZ2dpbmcuRm9ybWF0dGVyKToKICAgIGRlZiBmb3JtYXQoc2VsZiwgcmVjb3JkKToKICAgICAgICBwYXlsb2FkID0gewogICAgICAgICAgICAidHMiOiBkYXRldGltZS51dGNub3coKS5pc29mb3JtYXQoKSArICJaIiwKICAgICAgICAgICAgImxldmVsIjogcmVjb3JkLmxldmVsbmFtZSwKICAgICAgICAgICAgImxvZ2dlciI6IHJlY29yZC5uYW1lLAogICAgICAgICAgICAibXNnIjogcmVjb3JkLmdldE1lc3NhZ2UoKSwKICAgICAgICB9CiAgICAgICAgaWYgcmVjb3JkLmV4Y19pbmZvOgogICAgICAgICAgICBwYXlsb2FkWyJleGMiXSA9IHNlbGYuZm9ybWF0RXhjZXB0aW9uKHJlY29yZC5leGNfaW5mbykKICAgICAgICByZXR1cm4ganNvbi5kdW1wcyhwYXlsb2FkLCBzZXBhcmF0b3JzPSgiLCIsICI6IikpCgoKX3Jvb3RfbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoKQpfcm9vdF9sb2dnZXIuc2V0TGV2ZWwobG9nZ2luZy5JTkZPKQpfcm9vdF9sb2dnZXIuaGFuZGxlcnMuY2xlYXIoKQoKX3N0ZG91dF9oYW5kbGVyID0gbG9nZ2luZy5TdHJlYW1IYW5kbGVyKHN5cy5zdGRvdXQpCl9zdGRvdXRfaGFuZGxlci5zZXRMZXZlbChsb2dnaW5nLkRFQlVHKQpfc3Rkb3V0X2hhbmRsZXIuYWRkRmlsdGVyKF9NYXhMZXZlbEZpbHRlcihsb2dnaW5nLklORk8pKQoKX3N0ZGVycl9oYW5kbGVyID0gbG9nZ2luZy5TdHJlYW1IYW5kbGVyKHN5cy5zdGRlcnIpCl9zdGRlcnJfaGFuZGxlci5zZXRMZXZlbChsb2dnaW5nLldBUk5JTkcpCgpfZm9ybWF0dGVyID0gbG9nZ2luZy5Gb3JtYXR0ZXIoIiUobGV2ZWxuYW1lKXM6JShuYW1lKXM6JShtZXNzYWdlKXMiKQpfc3Rkb3V0X2hhbmRsZXIuc2V0Rm9ybWF0dGVyKF9mb3JtYXR0ZXIpCl9zdGRlcnJfaGFuZGxlci5zZXRGb3JtYXR0ZXIoX2Zvcm1hdHRlcikKCl9yb290X2xvZ2dlci5hZGRIYW5kbGVyKF9zdGRvdXRfaGFuZGxlcikKX3Jvb3RfbG9nZ2VyLmFkZEhhbmRsZXIoX3N0ZGVycl9oYW5kbGVyKQoKaWYgTE9HX0pTT05fRU5BQkxFRDoKICAgIG9zLm1ha2VkaXJzKG9zLnBhdGguZGlybmFtZShMT0dfSlNPTl9QQVRIKSBvciAiLiIsIGV4aXN0X29rPVRydWUpCiAgICBfanNvbl9oYW5kbGVyID0gUm90YXRpbmdGaWxlSGFuZGxlcigKICAgICAgICBMT0dfSlNPTl9QQVRILAogICAgICAgIG1heEJ5dGVzPUxPR19NQVhfQllURVMsCiAgICAgICAgYmFja3VwQ291bnQ9TE9HX0JBQ0tVUF9DT1VOVCwKICAgICkKICAgIF9qc29uX2hhbmRsZXIuc2V0TGV2ZWwobG9nZ2luZy5JTkZPKQogICAgX2pzb25faGFuZGxlci5zZXRGb3JtYXR0ZXIoX0pzb25Gb3JtYXR0ZXIoKSkKICAgIF9yb290X2xvZ2dlci5hZGRIYW5kbGVyKF9qc29uX2hhbmRsZXIpCgpsb2dnaW5nLmdldExvZ2dlcigiaHR0cHgiKS5zZXRMZXZlbChsb2dnaW5nLldBUk5JTkcpCmxvZ2dpbmcuZ2V0TG9nZ2VyKCJodHRwY29yZSIpLnNldExldmVsKGxvZ2dpbmcuV0FSTklORykKbG9nZ2luZy5nZXRMb2dnZXIoInRlbGVncmFtLnZlbmRvci5wdGJfdXJsbGliMy51cmxsaWIzIikuc2V0TGV2ZWwobG9nZ2luZy5XQVJOSU5HKQoKX3RhY3RpY2FsX3RlY2hfY2FjaGUgPSB7fQpfYmlyZGV5ZV9lbnJpY2htZW50X2NhY2hlID0ge30KCl9DT05GSURFTkNFX09SREVSID0geyJDIjogMSwgIkIiOiAyLCAiQSI6IDN9CgoKZGVmIF9lbnJpY2hfdG9rZW5fZm9yX3Njb3JpbmcodG9rZW4pOgogICAgIiIiCiAgICBFbnJpY2ggdG9rZW4gd2l0aCBCaXJkRXllIHRva2VuX292ZXJ2aWV3IGRhdGEgYmVmb3JlIHNjb3JpbmcuCiAgICBUaGUgbmV3IHNjb3JpbmcgbW9kZWwgbmVlZHMgdW5pcXVlIHdhbGxldCBtZXRyaWNzIGFuZCBzb2NpYWwgZGF0YS4KICAgIFJldHVybnMgZW5yaWNoZWQgdG9rZW4gZGljdC4KICAgICIiIgogICAgYWRkcmVzcyA9IHRva2VuLmdldCgiYWRkcmVzcyIpCiAgICBpZiBub3QgYWRkcmVzczoKICAgICAgICByZXR1cm4gdG9rZW4KCiAgICAjIENoZWNrIGNhY2hlIGZpcnN0ICg1bWluIFRUTCA9IHNjYW4gaW50ZXJ2YWwsIGF2b2lkcyBBUEkgc3BhbSkKICAgICMgVW5pcXVlIHdhbGxldCBkYXRhIGRvZXNuJ3QgY2hhbmdlIGRyYXN0aWNhbGx5IHNlY29uZC10by1zZWNvbmQKICAgIGNhY2hlX2tleSA9IGFkZHJlc3MKICAgIG5vdyA9IHRpbWVfbW9kdWxlLnRpbWUoKQogICAgY2FjaGVfdHRsID0gMzAwICAjIDUgbWludXRlcwoKICAgIGlmIGNhY2hlX2tleSBpbiBfYmlyZGV5ZV9lbnJpY2htZW50X2NhY2hlOgogICAgICAgIGNhY2hlZF9kYXRhLCBjYWNoZWRfdHMgPSBfYmlyZGV5ZV9lbnJpY2htZW50X2NhY2hlW2NhY2hlX2tleV0KICAgICAgICBpZiBub3cgLSBjYWNoZWRfdHMgPCBjYWNoZV90dGw6CiAgICAgICAgICAgIGVucmljaGVkID0gZGljdCh0b2tlbikKICAgICAgICAgICAgZW5yaWNoZWQudXBkYXRlKGNhY2hlZF9kYXRhKQogICAgICAgICAgICByZXR1cm4gZW5yaWNoZWQKCiAgICAjIEZldGNoIGZyZXNoIGRhdGEgZnJvbSBCaXJkRXllCiAgICBvdmVydmlld19kYXRhID0gZmV0Y2hfYmlyZGV5ZV90b2tlbl9vdmVydmlldyhhZGRyZXNzKQogICAgaWYgb3ZlcnZpZXdfZGF0YToKICAgICAgICBfYmlyZGV5ZV9lbnJpY2htZW50X2NhY2hlW2NhY2hlX2tleV0gPSAob3ZlcnZpZXdfZGF0YSwgbm93KQogICAgICAgIGVucmljaGVkID0gZGljdCh0b2tlbikKICAgICAgICBlbnJpY2hlZC51cGRhdGUob3ZlcnZpZXdfZGF0YSkKICAgICAgICByZXR1cm4gZW5yaWNoZWQKCiAgICByZXR1cm4gdG9rZW4KX0RBWV9UT19XRUVLREFZID0geyJNT04iOiAwLCAiVFVFIjogMSwgIldFRCI6IDIsICJUSFUiOiAzLCAiRlJJIjogNCwgIlNBVCI6IDUsICJTVU4iOiA2fQpfUFJPSkVDVF9ST09UID0gUGF0aChfX2ZpbGVfXykucmVzb2x2ZSgpLnBhcmVudApfRU5WX1BBVEggPSBfUFJPSkVDVF9ST09UIC8gIi5lbnYiCl9XQVRDSExJU1RfU1RBVEVfUEFUSCA9IF9QUk9KRUNUX1JPT1QgLyAiZGF0YV9zdG9yYWdlIiAvICJ3YXRjaGxpc3Rfc3RhdGUuanNvbiIKX0FMTE9XRURfQ0hBVF9JRCA9IGludChURUxFR1JBTV9DSEFUX0lEKQpfYXBwX3JlZiA9IE5vbmUKX2RpZ2VzdF9zdGF0ZSA9IHsibGFzdF9zZW50X3RzIjogTm9uZX0KX3dhdGNobGlzdF9zdGF0ZSA9IHsic3RhdHVzZXMiOiB7fX0KX1NFTExfQUxFUlRfRVhDTFVERURfU1lNQk9MUyA9IHsiVVNEQyIsICJVU0RUIiwgIlVTRFMiLCAiVVNEMSIsICJEQUkiLCAiU09MIiwgIldTT0wifQoKX01PREVfUFJFU0VUUyA9IHsKICAgICJzdHJhdGVnaWMiOiB7CiAgICAgICAgInByb2ZpbGUiOiAic3RyYXRlZ2ljIiwKICAgICAgICAic2Nhbl9pbnRlcnZhbF9zZWNvbmRzIjogMzYwMCwKICAgICAgICAibWluX2xpcXVpZGl0eSI6IDFfMDAwXzAwMC4wLAogICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDMwMF8wMDAuMCwKICAgICAgICAiYWxlcnRfY29vbGRvd25faG91cnMiOiAxMiwKICAgICAgICAiYWxlcnRfdGhyZXNob2xkIjogODAsCiAgICAgICAgIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0IjogIkEiLAogICAgICAgICJyZWdpbWVfbWluX3Njb3JlIjogNDUsCiAgICB9LAogICAgInRhY3RpY2FsIjogewogICAgICAgICJwcm9maWxlIjogInRhY3RpY2FsIiwKICAgICAgICAic2Nhbl9pbnRlcnZhbF9zZWNvbmRzIjogMTgwMCwKICAgICAgICAibWluX2xpcXVpZGl0eSI6IDUwMF8wMDAuMCwKICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiAyMDBfMDAwLjAsCiAgICAgICAgImFsZXJ0X2Nvb2xkb3duX2hvdXJzIjogNiwKICAgICAgICAiYWxlcnRfdGhyZXNob2xkIjogNzAsCiAgICAgICAgIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0IjogIkIiLAogICAgICAgICJyZWdpbWVfbWluX3Njb3JlIjogMTUsCiAgICB9LAp9CgpfUklTS19TVFlMRV9BTElBU0VTID0gewogICAgImNhcGl0YWwiOiAiY2FwaXRhbCIsCiAgICAiY2FwaXRhbC1wcmVzZXJ2YXRpb24iOiAiY2FwaXRhbCIsCiAgICAicHJlc2VydmF0aW9uIjogImNhcGl0YWwiLAogICAgInNhZmUiOiAiY2FwaXRhbCIsCiAgICAiYmFsYW5jZWQiOiAiYmFsYW5jZWQiLAogICAgImJhbGFuY2UiOiAiYmFsYW5jZWQiLAogICAgInNuaXBlciI6ICJzbmlwZXIiLAogICAgImhpZ2gtYmV0YSI6ICJzbmlwZXIiLAogICAgImFnZ3Jlc3NpdmUiOiAic25pcGVyIiwKfQoKX1JJU0tfU1RZTEVfTEFCRUxTID0gewogICAgImNhcGl0YWwiOiAiQ2FwaXRhbCBQcmVzZXJ2YXRpb24iLAogICAgImJhbGFuY2VkIjogIkJhbGFuY2VkIiwKICAgICJzbmlwZXIiOiAiU25pcGVyIiwKfQoKX1JJU0tfU1RZTEVfREVTQ1JJUFRJT05TID0gewogICAgImNhcGl0YWwiOiAiRGVmZW5zaXZlOiBzdHJpY3RlciBsaXF1aWRpdHkvdm9sdW1lIGFuZCB0aWdodGVyIHZvbGF0aWxpdHkgbGltaXRzLiIsCiAgICAiYmFsYW5jZWQiOiAiRGVmYXVsdDogbW9kZXJhdGUgZmlsdGVycyBmb3Igc3RlYWR5IG9wcG9ydHVuaXR5IGZsb3cuIiwKICAgICJzbmlwZXIiOiAiSGlnaC1iZXRhOiB3aWRlciBnYXRlcyBmb3IgZmFzdGVyLCByaXNraWVyIHNldHVwcy4iLAp9CgpfTUFSS0VUX1RJRVJfUlVMRVMgPSB7CiAgICAiY29uc2VydmF0aXZlIjogewogICAgICAgICJsYWJlbCI6ICJMb25nLVRlcm0iLAogICAgICAgICJtaW5fY29uZmlkZW5jZSI6ICJBIiwKICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogNi4wLAogICAgICAgICJtaW5fbGlxdWlkaXR5IjogMV81MDBfMDAwLjAsCiAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogNjAwXzAwMC4wLAogICAgICAgICJtaW5fY2hhbmdlXzI0aCI6IDEuNSwKICAgICAgICAibWF4X2Fic19jaGFuZ2VfMjRoIjogMzAuMCwKICAgICAgICAibWF4X3ZvbF90b19saXEiOiAxLjIsCiAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogRmFsc2UsCiAgICB9LAogICAgImJhbGFuY2VkIjogewogICAgICAgICJsYWJlbCI6ICJNaWQtVGVybSIsCiAgICAgICAgIm1pbl9jb25maWRlbmNlIjogIkIiLAogICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiAwLjAsCiAgICAgICAgIm1pbl9saXF1aWRpdHkiOiA3MDBfMDAwLjAsCiAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogMjUwXzAwMC4wLAogICAgICAgICJtaW5fY2hhbmdlXzI0aCI6IDAuNSwKICAgICAgICAibWF4X2Fic19jaGFuZ2VfMjRoIjogNDUuMCwKICAgICAgICAibWF4X3ZvbF90b19saXEiOiAxLjgsCiAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogVHJ1ZSwKICAgIH0sCiAgICAiYWdncmVzc2l2ZSI6IHsKICAgICAgICAibGFiZWwiOiAiU2hvcnQtVGVybSIsCiAgICAgICAgIm1pbl9jb25maWRlbmNlIjogIkIiLAogICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiAtNi4wLAogICAgICAgICJtaW5fbGlxdWlkaXR5IjogMjUwXzAwMC4wLAogICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDEyMF8wMDAuMCwKICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAtMi4wLAogICAgICAgICJtYXhfYWJzX2NoYW5nZV8yNGgiOiA3MC4wLAogICAgICAgICJtYXhfdm9sX3RvX2xpcSI6IDIuOCwKICAgICAgICAiYWxsb3dfcmlza19vZmYiOiBUcnVlLAogICAgfSwKfQoKX1JJU0tfU1RZTEVfVElFUl9PVkVSUklERVMgPSB7CiAgICAiY2FwaXRhbCI6IHsKICAgICAgICAiY29uc2VydmF0aXZlIjogewogICAgICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogOC4wLAogICAgICAgICAgICAibWluX2xpcXVpZGl0eSI6IDJfMDAwXzAwMC4wLAogICAgICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiA4MDBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fY2hhbmdlXzI0aCI6IDIuNSwKICAgICAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDI0LjAsCiAgICAgICAgICAgICJtYXhfdm9sX3RvX2xpcSI6IDEuMCwKICAgICAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogRmFsc2UsCiAgICAgICAgfSwKICAgICAgICAiYmFsYW5jZWQiOiB7CiAgICAgICAgICAgICJtaW5fY29uZmlkZW5jZSI6ICJBIiwKICAgICAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IDQuMCwKICAgICAgICAgICAgIm1pbl9saXF1aWRpdHkiOiAxXzEwMF8wMDAuMCwKICAgICAgICAgICAgIm1pbl92b2x1bWVfMjRoIjogNDUwXzAwMC4wLAogICAgICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAxLjAsCiAgICAgICAgICAgICJtYXhfYWJzX2NoYW5nZV8yNGgiOiAzNS4wLAogICAgICAgICAgICAibWF4X3ZvbF90b19saXEiOiAxLjQsCiAgICAgICAgICAgICJhbGxvd19yaXNrX29mZiI6IEZhbHNlLAogICAgICAgIH0sCiAgICAgICAgImFnZ3Jlc3NpdmUiOiB7CiAgICAgICAgICAgICJtaW5fY29uZmlkZW5jZSI6ICJCIiwKICAgICAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IDAuMCwKICAgICAgICAgICAgIm1pbl9saXF1aWRpdHkiOiA2MDBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDI0MF8wMDAuMCwKICAgICAgICAgICAgIm1pbl9jaGFuZ2VfMjRoIjogMC4wLAogICAgICAgICAgICAibWF4X2Fic19jaGFuZ2VfMjRoIjogNTAuMCwKICAgICAgICAgICAgIm1heF92b2xfdG9fbGlxIjogMS44LAogICAgICAgICAgICAiYWxsb3dfcmlza19vZmYiOiBGYWxzZSwKICAgICAgICB9LAogICAgfSwKICAgICJiYWxhbmNlZCI6IHt9LAogICAgInNuaXBlciI6IHsKICAgICAgICAiY29uc2VydmF0aXZlIjogewogICAgICAgICAgICAibWluX3Njb3JlX2RlbHRhIjogNC4wLAogICAgICAgICAgICAibWluX2xpcXVpZGl0eSI6IDFfMTAwXzAwMC4wLAogICAgICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiA0MjBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fY2hhbmdlXzI0aCI6IDEuMCwKICAgICAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDM2LjAsCiAgICAgICAgICAgICJtYXhfdm9sX3RvX2xpcSI6IDEuNSwKICAgICAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogRmFsc2UsCiAgICAgICAgfSwKICAgICAgICAiYmFsYW5jZWQiOiB7CiAgICAgICAgICAgICJtaW5fY29uZmlkZW5jZSI6ICJCIiwKICAgICAgICAgICAgIm1pbl9zY29yZV9kZWx0YSI6IC0yLjAsCiAgICAgICAgICAgICJtaW5fbGlxdWlkaXR5IjogNTAwXzAwMC4wLAogICAgICAgICAgICAibWluX3ZvbHVtZV8yNGgiOiAxODBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fY2hhbmdlXzI0aCI6IDAuMCwKICAgICAgICAgICAgIm1heF9hYnNfY2hhbmdlXzI0aCI6IDU1LjAsCiAgICAgICAgICAgICJtYXhfdm9sX3RvX2xpcSI6IDIuMiwKICAgICAgICAgICAgImFsbG93X3Jpc2tfb2ZmIjogVHJ1ZSwKICAgICAgICB9LAogICAgICAgICJhZ2dyZXNzaXZlIjogewogICAgICAgICAgICAibWluX2NvbmZpZGVuY2UiOiAiQiIsCiAgICAgICAgICAgICJtaW5fc2NvcmVfZGVsdGEiOiAtMTAuMCwKICAgICAgICAgICAgIm1pbl9saXF1aWRpdHkiOiAxODBfMDAwLjAsCiAgICAgICAgICAgICJtaW5fdm9sdW1lXzI0aCI6IDkwXzAwMC4wLAogICAgICAgICAgICAibWluX2NoYW5nZV8yNGgiOiAtNC4wLAogICAgICAgICAgICAibWF4X2Fic19jaGFuZ2VfMjRoIjogODAuMCwKICAgICAgICAgICAgIm1heF92b2xfdG9fbGlxIjogMy4yLAogICAgICAgICAgICAiYWxsb3dfcmlza19vZmYiOiBUcnVlLAogICAgICAgIH0sCiAgICB9LAp9CgpfV0FMTEVUX1BMQVlCT09LID0gewogICAgIlcxIjogewogICAgICAgICJuYW1lIjogIkNvcmUgTG9uZy1UZXJtIiwKICAgICAgICAicG9zaXRpb25faGludCI6ICJzaXplIDgtMTUlIG1heCwgc2NhbGUtaW4gb25seSIsCiAgICAgICAgInJpc2tfcGxhbiI6ICJTb2Z0IHN0b3Agb24gdGhlc2lzIGJyZWFrOyBhdm9pZCBpbXB1bHNlIGV4aXRzIiwKICAgICAgICAicm90YXRpb25fcGxhbiI6ICJQcmltYXJ5IGRlc3RpbmF0aW9uIGZvciBoYXJ2ZXN0ZWQgcHJvZml0cyIsCiAgICB9LAogICAgIlcyIjogewogICAgICAgICJuYW1lIjogIlF1YWxpdHkgU3dpbmciLAogICAgICAgICJwb3NpdGlvbl9oaW50IjogInNpemUgNC04JSBtYXgiLAogICAgICAgICJyaXNrX3BsYW4iOiAiSGFyZCBTTCAtOCUgfCBUUCArMTIvKzI1IHwgdHJhaWwgMTAlIiwKICAgICAgICAicm90YXRpb25fcGxhbiI6ICJSb3RhdGUgNDAtNjAlIHdpbnMgdG8gVzEvc3Rha2luZy9VU0RDIiwKICAgIH0sCiAgICAiVzMiOiB7CiAgICAgICAgIm5hbWUiOiAiVGFjdGljYWwvRGVnZW4iLAogICAgICAgICJwb3NpdGlvbl9oaW50IjogInNpemUgMS0zJSBtYXgiLAogICAgICAgICJyaXNrX3BsYW4iOiAiSGFyZCBTTCAtMTIlIHwgc2NhbGUgYXQgKzE1LyszMC8rNTAiLAogICAgICAgICJyb3RhdGlvbl9wbGFuIjogIlJvdGF0ZSA2MC04MCUgd2lucyB0byBXMS9XMiBvciBVU0RDIiwKICAgIH0sCn0KCl9ydW50aW1lID0gewogICAgInByb2ZpbGUiOiBFTkdJTkVfUFJPRklMRSBpZiBFTkdJTkVfUFJPRklMRSBpbiBfTU9ERV9QUkVTRVRTIGVsc2UgInN0cmF0ZWdpYyIsCiAgICAicmlza19zdHlsZSI6IF9SSVNLX1NUWUxFX0FMSUFTRVMuZ2V0KHN0cihSSVNLX1NUWUxFIG9yICIiKS5sb3dlcigpLCAiYmFsYW5jZWQiKSwKICAgICJzY2FuX2ludGVydmFsX3NlY29uZHMiOiBTQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAibWluX2xpcXVpZGl0eSI6IGZsb2F0KE1JTl9MSVFVSURJVFkpLAogICAgIm1pbl92b2x1bWVfMjRoIjogZmxvYXQoTUlOX1ZPTFVNRV8yNEgpLAogICAgImFsZXJ0X2Nvb2xkb3duX2hvdXJzIjogQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICAiYWxlcnRfdGhyZXNob2xkIjogQUxFUlRfVEhSRVNIT0xELAogICAgIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0IjogTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICAicmVnaW1lX21pbl9zY29yZSI6IFJFR0lNRV9NSU5fU0NPUkUsCn0KCgpkZWYgX21vZGUoKSAtPiBzdHI6CiAgICByZXR1cm4gc3RyKF9ydW50aW1lWyJwcm9maWxlIl0pLmxvd2VyKCkKCgpkZWYgX25vcm1hbGl6ZV9yaXNrX3N0eWxlKHJhdzogc3RyIHwgTm9uZSkgLT4gc3RyOgogICAgcmV0dXJuIF9SSVNLX1NUWUxFX0FMSUFTRVMuZ2V0KHN0cihyYXcgb3IgIiIpLnN0cmlwKCkubG93ZXIoKSwgImJhbGFuY2VkIikKCgpkZWYgX3Jpc2tfc3R5bGVfbGFiZWwoc3R5bGU6IHN0ciB8IE5vbmUgPSBOb25lKSAtPiBzdHI6CiAgICBub3JtYWxpemVkID0gX25vcm1hbGl6ZV9yaXNrX3N0eWxlKHN0eWxlIG9yIF9ydW50aW1lLmdldCgicmlza19zdHlsZSIpKQogICAgcmV0dXJuIF9SSVNLX1NUWUxFX0xBQkVMUy5nZXQobm9ybWFsaXplZCwgIkJhbGFuY2VkIikKCgpkZWYgX3Jpc2tfc3R5bGVfZGVzY3JpcHRpb24oc3R5bGU6IHN0ciB8IE5vbmUgPSBOb25lKSAtPiBzdHI6CiAgICBub3JtYWxpemVkID0gX25vcm1hbGl6ZV9yaXNrX3N0eWxlKHN0eWxlIG9yIF9ydW50aW1lLmdldCgicmlza19zdHlsZSIpKQogICAgcmV0dXJuIF9SSVNLX1NUWUxFX0RFU0NSSVBUSU9OUy5nZXQoCiAgICAgICAgbm9ybWFsaXplZCwKICAgICAgICAiRGVmYXVsdDogbW9kZXJhdGUgZmlsdGVycyBmb3Igc3RlYWR5IG9wcG9ydHVuaXR5IGZsb3cuIiwKICAgICkKCgpkZWYgX21hcmtldF90aWVyX3J1bGUodGllcl9rZXk6IHN0cikgLT4gZGljdDoKICAgIHRpZXIgPSBfbm9ybWFsaXplX21hcmtldF90aWVyKHRpZXJfa2V5KQogICAgYmFzZSA9IGRpY3QoX01BUktFVF9USUVSX1JVTEVTW3RpZXJdKQogICAgc3R5bGUgPSBfbm9ybWFsaXplX3Jpc2tfc3R5bGUoX3J1bnRpbWUuZ2V0KCJyaXNrX3N0eWxlIikpCiAgICBvdmVycmlkZXMgPSBfUklTS19TVFlMRV9USUVSX09WRVJSSURFUy5nZXQoc3R5bGUsIHt9KS5nZXQodGllciwge30pCiAgICBpZiBvdmVycmlkZXM6CiAgICAgICAgYmFzZS51cGRhdGUob3ZlcnJpZGVzKQogICAgcmV0dXJuIGJhc2UKCgpkZWYgX2lzX2F1dGhvcml6ZWQodXBkYXRlOiBVcGRhdGUpIC0+IGJvb2w6CiAgICBjaGF0ID0gdXBkYXRlLmVmZmVjdGl2ZV9jaGF0CiAgICByZXR1cm4gYm9vbChjaGF0IGFuZCBjaGF0LmlkID09IF9BTExPV0VEX0NIQVRfSUQpCgoKZGVmIF9zZXRfZW52X3ZhbHVlcyh2YWx1ZXM6IGRpY3Rbc3RyLCBzdHJdKToKICAgIGV4aXN0aW5nID0gX0VOVl9QQVRILnJlYWRfdGV4dCgpLnNwbGl0bGluZXMoKSBpZiBfRU5WX1BBVEguZXhpc3RzKCkgZWxzZSBbXQogICAgb3V0cHV0ID0gW10KICAgIHNlZW4gPSBzZXQoKQoKICAgIGZvciBsaW5lIGluIGV4aXN0aW5nOgogICAgICAgIHN0cmlwcGVkID0gbGluZS5zdHJpcCgpCiAgICAgICAgcmVwbGFjZWQgPSBGYWxzZQogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHZhbHVlcy5pdGVtcygpOgogICAgICAgICAgICBpZiBzdHJpcHBlZC5zdGFydHN3aXRoKGYie2tleX09Iik6CiAgICAgICAgICAgICAgICBpZiBrZXkgbm90IGluIHNlZW46CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LmFwcGVuZChmIntrZXl9PXt2YWx1ZX0iKQogICAgICAgICAgICAgICAgICAgIHNlZW4uYWRkKGtleSkKICAgICAgICAgICAgICAgIHJlcGxhY2VkID0gVHJ1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBpZiBub3QgcmVwbGFjZWQ6CiAgICAgICAgICAgIG91dHB1dC5hcHBlbmQobGluZSkKCiAgICBmb3Iga2V5LCB2YWx1ZSBpbiB2YWx1ZXMuaXRlbXMoKToKICAgICAgICBpZiBrZXkgbm90IGluIHNlZW46CiAgICAgICAgICAgIG91dHB1dC5hcHBlbmQoZiJ7a2V5fT17dmFsdWV9IikKCiAgICBfRU5WX1BBVEgud3JpdGVfdGV4dCgiXG4iLmpvaW4ob3V0cHV0KS5yc3RyaXAoKSArICJcbiIpCgoKZGVmIF9hcHBseV9tb2RlKG1vZGU6IHN0cik6CiAgICBtb2RlID0gbW9kZS5sb3dlcigpCiAgICBpZiBtb2RlIG5vdCBpbiBfTU9ERV9QUkVTRVRTOgogICAgICAgIHJldHVybgogICAgX3J1bnRpbWUudXBkYXRlKF9NT0RFX1BSRVNFVFNbbW9kZV0pCgoKZGVmIF9wZXJzaXN0X21vZGUobW9kZTogc3RyKToKICAgIHByZXNldCA9IF9NT0RFX1BSRVNFVFNbbW9kZV0KICAgIF9zZXRfZW52X3ZhbHVlcygKICAgICAgICB7CiAgICAgICAgICAgICJFTkdJTkVfUFJPRklMRSI6IHByZXNldFsicHJvZmlsZSJdLAogICAgICAgICAgICAiU0NBTl9JTlRFUlZBTF9TRUNPTkRTIjogc3RyKHByZXNldFsic2Nhbl9pbnRlcnZhbF9zZWNvbmRzIl0pLAogICAgICAgICAgICAiTUlOX0xJUVVJRElUWSI6IHN0cihpbnQocHJlc2V0WyJtaW5fbGlxdWlkaXR5Il0pKSwKICAgICAgICAgICAgIk1JTl9WT0xVTUVfMjRIIjogc3RyKGludChwcmVzZXRbIm1pbl92b2x1bWVfMjRoIl0pKSwKICAgICAgICAgICAgIkFMRVJUX0NPT0xET1dOX0hPVVJTIjogc3RyKHByZXNldFsiYWxlcnRfY29vbGRvd25faG91cnMiXSksCiAgICAgICAgICAgICJBTEVSVF9USFJFU0hPTEQiOiBzdHIocHJlc2V0WyJhbGVydF90aHJlc2hvbGQiXSksCiAgICAgICAgICAgICJNSU5fQ09ORklERU5DRV9UT19BTEVSVCI6IHN0cihwcmVzZXRbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0pLAogICAgICAgICAgICAiUkVHSU1FX01JTl9TQ09SRSI6IHN0cihwcmVzZXRbInJlZ2ltZV9taW5fc2NvcmUiXSksCiAgICAgICAgfQogICAgKQoKCmRlZiBfZm10X2R0KGR0KToKICAgIGlmIG5vdCBkdDoKICAgICAgICByZXR1cm4gIk4vQSIKICAgIHJldHVybiBkdC5zdHJmdGltZSgiJVktJW0tJWQgJUg6JU06JVMgVVRDIikKCgpkZWYgX3RyeV9mbG9hdCh2YWx1ZSk6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIGZsb2F0KHZhbHVlKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiBOb25lCgoKZGVmIF9wYXJzZV9zeW1ib2xfb3JfbWludChyYXc6IHN0cik6CiAgICB0b2tlbiA9IHN0cihyYXcgb3IgIiIpLnN0cmlwKCkKICAgIGlmIG5vdCB0b2tlbjoKICAgICAgICByZXR1cm4gTm9uZSwgTm9uZQogICAgdG9rZW4gPSB0b2tlbi5sc3RyaXAoIiQiKQogICAgaWYgbGVuKHRva2VuKSA+PSAzMjoKICAgICAgICByZXR1cm4gTm9uZSwgdG9rZW4KICAgIHN5bWJvbCA9ICIiLmpvaW4oY2ggZm9yIGNoIGluIHRva2VuLnVwcGVyKCkgaWYgY2guaXNhbG51bSgpKVs6MTZdCiAgICBpZiBub3Qgc3ltYm9sOgogICAgICAgIHJldHVybiBOb25lLCBOb25lCiAgICByZXR1cm4gc3ltYm9sLCBOb25lCgoKZGVmIF9yZXNvbHZlX3Rva2VuX2Zvcl90cmFja2luZyhzeW1ib2w6IHN0ciB8IE5vbmUsIG1pbnQ6IHN0ciB8IE5vbmUpOgogICAgaWYgbWludDoKICAgICAgICBzbmFwID0gZmV0Y2hfZGV4c2NyZWVuZXJfdG9rZW5fc25hcHNob3QobWludCkKICAgICAgICBpZiBzbmFwOgogICAgICAgICAgICByZXR1cm4gc25hcAogICAgaWYgc3ltYm9sOgogICAgICAgIGNhbmRpZGF0ZXMgPSBmZXRjaF9ydW5uZXJfd2F0Y2hfY2FuZGlkYXRlcygKICAgICAgICAgICAgcXVlcmllcz1bc3ltYm9sXSwKICAgICAgICAgICAgcGFpcnNfcGVyX3F1ZXJ5PTE2LAogICAgICAgICAgICBsaW1pdD01MCwKICAgICAgICApCiAgICAgICAgaWYgY2FuZGlkYXRlczoKICAgICAgICAgICAgZXhhY3QgPSBbdCBmb3IgdCBpbiBjYW5kaWRhdGVzIGlmIHN0cih0LmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkgPT0gc3ltYm9sXQogICAgICAgICAgICBwb29sID0gZXhhY3Qgb3IgY2FuZGlkYXRlcwogICAgICAgICAgICBwb29sLnNvcnQoa2V5PWxhbWJkYSB0OiAoZmxvYXQodC5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApLCBmbG9hdCh0LmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApKSwgcmV2ZXJzZT1UcnVlKQogICAgICAgICAgICByZXR1cm4gcG9vbFswXQogICAgcmV0dXJuIE5vbmUKCgpkZWYgX2J1aWxkX2FsZXJ0X2tleWJvYXJkKHN5bWJvbDogc3RyLCBtaW50OiBzdHIgfCBOb25lLCBwYWlyX2FkZHJlc3M6IHN0ciB8IE5vbmUgPSBOb25lKToKICAgIGlmIG5vdCBURUxFR1JBTV9BQ1RJT05fQlVUVE9OU19FTkFCTEVEOgogICAgICAgIHJldHVybiBOb25lCiAgICBpZiBub3Qgc3ltYm9sOgogICAgICAgIHN5bWJvbCA9ICJVTktOT1dOIgogICAgcm93cyA9IFtdCiAgICBtaW50X3RleHQgPSBzdHIobWludCBvciAiIikuc3RyaXAoKQogICAgZGV4c2NyZWVuZXJfdGFyZ2V0ID0gcGFpcl9hZGRyZXNzIG9yIG1pbnQKICAgIGlmIGRleHNjcmVlbmVyX3RhcmdldDoKICAgICAgICBmaXJzdF9yb3cgPSBbCiAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCJEZXhTY3JlZW5lciIsIHVybD1mImh0dHBzOi8vZGV4c2NyZWVuZXIuY29tL3NvbGFuYS97ZGV4c2NyZWVuZXJfdGFyZ2V0fSIpLAogICAgICAgIF0KICAgICAgICBpZiBtaW50X3RleHQ6CiAgICAgICAgICAgIGZpcnN0X3Jvdy5hcHBlbmQoCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigKICAgICAgICAgICAgICAgICAgICAiQ29weSBDQSIsCiAgICAgICAgICAgICAgICAgICAgY29weV90ZXh0PUNvcHlUZXh0QnV0dG9uKHRleHQ9bWludF90ZXh0KSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgIHJvd3MuYXBwZW5kKGZpcnN0X3JvdykKICAgIGlmIG1pbnRfdGV4dDoKICAgICAgICByb3dzLmFwcGVuZCgKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIlNvbHNjYW4iLCB1cmw9ZiJodHRwczovL3NvbHNjYW4uaW8vdG9rZW4ve21pbnRfdGV4dH0iKSwKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCJSdWdDaGVjayIsIHVybD1mImh0dHBzOi8vcnVnY2hlY2sueHl6L3Rva2Vucy97bWludF90ZXh0fSIpLAogICAgICAgICAgICBdCiAgICAgICAgKQogICAgaWYgbm90IHJvd3M6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHJldHVybiBJbmxpbmVLZXlib2FyZE1hcmt1cChyb3dzKQoKCmRlZiBfcmVzY2hlZHVsZV9ydW5fZW5naW5lX2pvYnMoYXBwbGljYXRpb24pOgogICAgaW50ZXJ2YWwgPSBpbnQoX3J1bnRpbWVbInNjYW5faW50ZXJ2YWxfc2Vjb25kcyJdKQogICAgZm9yIGpvYiBpbiBhcHBsaWNhdGlvbi5qb2JfcXVldWUuZ2V0X2pvYnNfYnlfbmFtZSgicnVuX2VuZ2luZV9jeWNsZSIpOgogICAgICAgIGpvYi5zY2hlZHVsZV9yZW1vdmFsKCkKICAgIGZvciBqb2IgaW4gYXBwbGljYXRpb24uam9iX3F1ZXVlLmdldF9qb2JzX2J5X25hbWUoInJ1bl9lbmdpbmVfYm9vdCIpOgogICAgICAgIGpvYi5zY2hlZHVsZV9yZW1vdmFsKCkKCiAgICBhcHBsaWNhdGlvbi5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgcnVuX2VuZ2luZSwKICAgICAgICB3aGVuPTIsCiAgICAgICAgbmFtZT0icnVuX2VuZ2luZV9ib290IiwKICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMzB9LAogICAgKQogICAgYXBwbGljYXRpb24uam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgcnVuX2VuZ2luZSwKICAgICAgICBpbnRlcnZhbD1pbnRlcnZhbCwKICAgICAgICBmaXJzdD1pbnRlcnZhbCwKICAgICAgICBuYW1lPSJydW5fZW5naW5lX2N5Y2xlIiwKICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMzAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgKQoKCmRlZiBfcmVxdWlyZV9lbnYoKToKICAgIGlmIG5vdCBURUxFR1JBTV9UT0tFTjoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCLinYwgVEVMRUdSQU1fVE9LRU4gbWlzc2luZyBpbiAuZW52IikKICAgIGlmIG5vdCBURUxFR1JBTV9DSEFUX0lEOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIuKdjCBURUxFR1JBTV9DSEFUX0lEIG1pc3NpbmcgaW4gLmVudiIpCiAgICBpZiBub3Qgc3RyKFRFTEVHUkFNX0NIQVRfSUQpLmlzZGlnaXQoKToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCLinYwgVEVMRUdSQU1fQ0hBVF9JRCBtdXN0IGJlIG51bWVyaWMgKGV4YW1wbGU6IDE4ODc2NzgwMjMpIikKCgpkZWYgX3RvX2ludF9vcl9ub25lKHZhbHVlKToKICAgIGlmIHZhbHVlIGluIChOb25lLCAiIiwgIk4vQSIpOgogICAgICAgIHJldHVybiBOb25lCiAgICB0cnk6CiAgICAgICAgcmV0dXJuIGludChmbG9hdCh2YWx1ZSkpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIE5vbmUKCgpkZWYgX3Bhc3Nlc19xdWFsaXR5X2ZpbHRlcnModG9rZW4pOgogICAgIiIiCiAgICBCYXNpYyBxdWFsaXR5IGZpbHRlcnMgdG8gZXhjbHVkZSBqdW5rL2lsbGlxdWlkIHRva2Vucy4KICAgIEZvY3VzOiBtaW5pbXVtIHN0YW5kYXJkcywgbm90IGVudHJ5IHRpbWluZy4KICAgICIiIgogICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW4uZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKQogICAgdm9sdW1lXzI0aCA9IGZsb2F0KHRva2VuLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICBjaGFuZ2VfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkKICAgIGhvbGRlcnMgPSBfdG9faW50X29yX25vbmUodG9rZW4uZ2V0KCJob2xkZXJzIikpCgogICAgIyBNaW5pbXVtIGxpcXVpZGl0eS92b2x1bWUgc3RhbmRhcmRzCiAgICBpZiBsaXF1aWRpdHkgPCBmbG9hdChfcnVudGltZVsibWluX2xpcXVpZGl0eSJdKToKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGlmIHZvbHVtZV8yNGggPCBmbG9hdChfcnVudGltZVsibWluX3ZvbHVtZV8yNGgiXSk6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgIyBOb3QgYWxyZWFkeSBkdW1waW5nIGhhcmQKICAgIGlmIGNoYW5nZV8yNGggPD0gTUFYX0FMTE9XRURfRFJBV0RPV05fMjRIOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgTWluaW11bSBob2xkZXIgYmFzZQogICAgaWYgaG9sZGVycyBpcyBub3QgTm9uZSBhbmQgaG9sZGVycyA8IE1JTl9IT0xERVJTOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgRUFSTFkgRU5UUlkgTE9HSUM6IEF2b2lkIGxhdGUgcHVtcHMKICAgICMgSWYgMjRoIGNoYW5nZSBpcyB0b28gZXh0cmVtZSwgd2UncmUgbGF0ZSB0byB0aGUgcGFydHkKICAgIGlmIGNoYW5nZV8yNGggPiAxMDA6ICAjIEFscmVhZHkgMngrIGluIDI0aCA9IHRvbyBsYXRlCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgIyBJZiBob2xkZXJzIGFyZSBwcmVzZW50LCBjaGVjayBmb3IgaGVhbHRoeSBncm93dGggdnMgcHVtcCAmIGR1bXAKICAgIHV3XzFoID0gdG9rZW4uZ2V0KCJ1bmlxdWVXYWxsZXQxaCIpCiAgICB1d18xaF9jaGFuZ2UgPSB0b2tlbi5nZXQoInVuaXF1ZVdhbGxldDFoQ2hhbmdlUGVyY2VudCIpCgogICAgIyBJZiBob2xkZXJzIGFyZSByYXBpZGx5IGV4aXRpbmcgKG5lZ2F0aXZlIGdyb3d0aCksIHNraXAKICAgIGlmIHV3XzFoX2NoYW5nZSBpcyBub3QgTm9uZSBhbmQgdXdfMWhfY2hhbmdlIDwgLTE1OgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgSWYgd2UgaGF2ZSB2ZXJ5IGxvdyBob2xkZXIgY291bnQgd2l0aCBtYXNzaXZlIHByaWNlIHB1bXAgPSBsaWtlbHkgYm90IGZhcm0KICAgIGlmIHV3XzFoIGlzIG5vdCBOb25lIGFuZCB1d18xaCA8IDMwIGFuZCBjaGFuZ2VfMjRoID4gNTA6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgcmV0dXJuIFRydWUKCgpkZWYgX3Bhc3Nlc19leGVjdXRpb25fcXVhbGl0eV9maWx0ZXJzKHRva2VuKToKICAgICIiIgogICAgQWR2YW5jZWQgZmlsdGVycyBmb2N1c2VkIG9uIGV4ZWN1dGlvbiBxdWFsaXR5IGFuZCBlYXJseS1zdGFnZSBkZXRlY3Rpb24uCiAgICBHb2FsOiBjYXRjaCBtb21lbnR1bSBFQVJMWSwgbm90IGFmdGVyIHBhcmFib2xpYyBtb3Zlcy4KICAgICIiIgogICAgaWYgbm90IEVOQUJMRV9FWEVDVVRJT05fUVVBTElUWV9GSUxURVJTOgogICAgICAgIHJldHVybiBUcnVlCgogICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW4uZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKQogICAgdm9sdW1lXzI0aCA9IGZsb2F0KHRva2VuLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICBwcmljZSA9IGZsb2F0KHRva2VuLmdldCgicHJpY2UiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBjaGFuZ2VfMWggPSB0b2tlbi5nZXQoImNoYW5nZV8xaCIpIG9yIHRva2VuLmdldCgicHJpY2VDaGFuZ2UxaFBlcmNlbnQiKQogICAgY2hhbmdlXzRoID0gdG9rZW4uZ2V0KCJjaGFuZ2VfNGgiKSBvciB0b2tlbi5nZXQoInByaWNlQ2hhbmdlNGhQZXJjZW50IikKICAgIGhvbGRlcnMgPSBfdG9faW50X29yX25vbmUodG9rZW4uZ2V0KCJob2xkZXJzIikpCgogICAgIyBQcmljZSBtdXN0IGJlIHRyYWRlYWJsZQogICAgaWYgcHJpY2UgPCBNSU5fUFJJQ0VfVVNEOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgQXZvaWQgcGFyYWJvbGljIGxhdGUgcHVtcHMKICAgIGlmIGFicyhjaGFuZ2VfMjRoKSA+IE1BWF9BQlNfQ0hBTkdFXzI0SDoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIFZvbHVtZS9saXF1aWRpdHkgcmF0aW8gbXVzdCBiZSBoZWFsdGh5IChub3Qgb3ZlcmhlYXRlZCwgbm90IGRlYWQpCiAgICB2b2xfdG9fbGlxID0gKHZvbHVtZV8yNGggLyBsaXF1aWRpdHkpIGlmIGxpcXVpZGl0eSA+IDAgZWxzZSAwCiAgICBpZiB2b2xfdG9fbGlxIDwgTUlOX1ZPTF9UT19MSVFfUkFUSU8gb3Igdm9sX3RvX2xpcSA+IE1BWF9WT0xfVE9fTElRX1JBVElPOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgTGlxdWlkaXR5IHBlciBob2xkZXIgY29uY2VudHJhdGlvbiBjaGVjawogICAgaWYgaG9sZGVycyBhbmQgaG9sZGVycyA+IDA6CiAgICAgICAgbGlxX3Blcl9ob2xkZXIgPSBsaXF1aWRpdHkgLyBob2xkZXJzCiAgICAgICAgaWYgbGlxX3Blcl9ob2xkZXIgPCBNSU5fTElRVUlESVRZX1BFUl9IT0xERVI6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgRUFSTFkgRU5UUlkgRU5IQU5DRU1FTlQ6IExvb2sgZm9yIGFjY2VsZXJhdGlvbiBwYXR0ZXJucwogICAgIyBCZXN0IHNpZ25hbDogNGggdHJlbmQgKyAxaCBhY2NlbGVyYXRpb24gKG5vdCBsYXRlIHB1bXApCiAgICBpZiBjaGFuZ2VfNGggaXMgbm90IE5vbmUgYW5kIGNoYW5nZV8xaCBpcyBub3QgTm9uZToKICAgICAgICAjIElmIDRoIGlzIHN0cm9uZ2x5IHBvc2l0aXZlIGJ1dCAxaCBpcyBkdW1waW5nID0gdG9wIHNpZ25hbCwgc2tpcAogICAgICAgIGlmIGNoYW5nZV80aCA+IDEwIGFuZCBjaGFuZ2VfMWggPCAtNToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgICMgSWYgMjRoIGlzIHBhcmFib2xpYyBidXQgc2hvcnQtdGVybSBpcyBmYWRpbmcgPSBsYXRlLCBza2lwCiAgICAgICAgaWYgY2hhbmdlXzI0aCA+IDUwIGFuZCBjaGFuZ2VfNGggPCA1OgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAjIENoZWNrIGhvbGRlciBtb21lbnR1bSBmb3IgcXVhbGl0eQogICAgdXdfMWhfY2hhbmdlID0gdG9rZW4uZ2V0KCJ1bmlxdWVXYWxsZXQxaENoYW5nZVBlcmNlbnQiKQogICAgdXdfNGhfY2hhbmdlID0gdG9rZW4uZ2V0KCJ1bmlxdWVXYWxsZXQ0aENoYW5nZVBlcmNlbnQiKQoKICAgICMgSWYgaG9sZGVycyBhcmUgYWNjZWxlcmF0aW5nIG91dCAobmVnYXRpdmUgZ3Jvd3RoKSwgc2tpcAogICAgaWYgdXdfMWhfY2hhbmdlIGlzIG5vdCBOb25lIGFuZCB1d18xaF9jaGFuZ2UgPCAtMjA6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgIyBJZiA0aCBob2xkZXIgdHJlbmQgaXMgbmVnYXRpdmUgd2hpbGUgcHJpY2UgaXMgcHVtcGluZyA9IGRpc3RyaWJ1dGlvbgogICAgaWYgdXdfNGhfY2hhbmdlIGlzIG5vdCBOb25lIGFuZCBjaGFuZ2VfMjRoID4gMjAgYW5kIHV3XzRoX2NoYW5nZSA8IC0xMDoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICByZXR1cm4gVHJ1ZQoKCmRlZiBfcGFzc2VzX3RhY3RpY2FsX2ZpbHRlcnModG9rZW4pOgogICAgaWYgX21vZGUoKSAhPSAidGFjdGljYWwiOgogICAgICAgIHJldHVybiBUcnVlCgogICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW4uZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKQogICAgdm9sdW1lXzI0aCA9IGZsb2F0KHRva2VuLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICBjaGFuZ2VfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkKICAgIGNoYW5nZV8xaF9yYXcgPSB0b2tlbi5nZXQoImNoYW5nZV8xaCIpCiAgICBjaGFuZ2VfNmhfcmF3ID0gdG9rZW4uZ2V0KCJjaGFuZ2VfNmgiKQogICAgY2hhbmdlXzFoID0gZmxvYXQoY2hhbmdlXzFoX3JhdykgaWYgaXNpbnN0YW5jZShjaGFuZ2VfMWhfcmF3LCAoaW50LCBmbG9hdCkpIGVsc2UgTm9uZQogICAgY2hhbmdlXzZoID0gZmxvYXQoY2hhbmdlXzZoX3JhdykgaWYgaXNpbnN0YW5jZShjaGFuZ2VfNmhfcmF3LCAoaW50LCBmbG9hdCkpIGVsc2UgTm9uZQoKICAgIGlmIGxpcXVpZGl0eSA8PSAwIG9yIHZvbHVtZV8yNGggPD0gMDoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICB2b2xfdG9fbGlxID0gdm9sdW1lXzI0aCAvIGxpcXVpZGl0eQogICAgaWYgdm9sX3RvX2xpcSA8IFRBQ1RJQ0FMX01JTl9WT0xfVE9fTElRX1JBVElPOgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIHB1bGxiYWNrX3BjdCA9IGFicyhjaGFuZ2VfMjRoKSBpZiBjaGFuZ2VfMjRoIDwgMCBlbHNlIDAuMAogICAgaW5fcHVsbGJhY2tfem9uZSA9IFRBQ1RJQ0FMX1BVTExCQUNLX01JTl9QQ1QgPD0gcHVsbGJhY2tfcGN0IDw9IFRBQ1RJQ0FMX1BVTExCQUNLX01BWF9QQ1QKCiAgICBtb21lbnR1bV9vayA9IGNoYW5nZV8yNGggPj0gVEFDVElDQUxfVFJFTkRfTUlOX0NIQU5HRV8yNEgKICAgIGlmIGNoYW5nZV8xaCBpcyBub3QgTm9uZToKICAgICAgICBtb21lbnR1bV9vayA9IG1vbWVudHVtX29rIGFuZCBjaGFuZ2VfMWggPj0gVEFDVElDQUxfTUlOX01PTUVOVFVNX0NIQU5HRV8xSAogICAgZWxpZiBjaGFuZ2VfNmggaXMgbm90IE5vbmU6CiAgICAgICAgbW9tZW50dW1fb2sgPSBtb21lbnR1bV9vayBhbmQgY2hhbmdlXzZoID4gMAoKICAgIHN1cHBvcnRfYm91bmNlX29rID0gaW5fcHVsbGJhY2tfem9uZSBhbmQgKAogICAgICAgIChjaGFuZ2VfMWggaXMgbm90IE5vbmUgYW5kIGNoYW5nZV8xaCA+PSAwKQogICAgICAgIG9yIChjaGFuZ2VfNmggaXMgbm90IE5vbmUgYW5kIGNoYW5nZV82aCA+PSAwKQogICAgICAgIG9yIChjaGFuZ2VfMWggaXMgTm9uZSBhbmQgY2hhbmdlXzZoIGlzIE5vbmUpCiAgICApCgogICAgaWYgbm90IChtb21lbnR1bV9vayBvciBzdXBwb3J0X2JvdW5jZV9vayk6CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgbGFzdF90cmFkZV91bml4ID0gX3RvX2ludF9vcl9ub25lKHRva2VuLmdldCgibGFzdF90cmFkZV91bml4IikpCiAgICBpZiBsYXN0X3RyYWRlX3VuaXg6CiAgICAgICAgYWdlX21pbnV0ZXMgPSAoZGF0ZXRpbWUudXRjbm93KCkgLSBkYXRldGltZS51dGNmcm9tdGltZXN0YW1wKGxhc3RfdHJhZGVfdW5peCkpLnRvdGFsX3NlY29uZHMoKSAvIDYwLjAKICAgICAgICBpZiBhZ2VfbWludXRlcyA+IFRBQ1RJQ0FMX01BWF9MQVNUX1RSQURFX0FHRV9NSU5VVEVTOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICB0ZWNoID0gX2dldF90YWN0aWNhbF90ZWNobmljYWxzKHRva2VuKQogICAgaWYgdGVjaDoKICAgICAgICB0b2tlbi51cGRhdGUodGVjaCkKICAgICAgICByc2lfb2sgPSBUQUNUSUNBTF9SU0lfTUlOIDw9IHRlY2hbInJzaSJdIDw9IFRBQ1RJQ0FMX1JTSV9NQVgKICAgICAgICBtYWNkX29rID0gKAogICAgICAgICAgICB0ZWNoWyJtYWNkX2hpc3QiXSA+PSBUQUNUSUNBTF9NQUNEX0hJU1RfTUlOCiAgICAgICAgICAgIGFuZCB0ZWNoWyJtYWNkX2xpbmUiXSA+PSB0ZWNoWyJtYWNkX3NpZ25hbCJdCiAgICAgICAgKQogICAgICAgIGlmIG5vdCAocnNpX29rIGFuZCBtYWNkX29rKToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBlbGlmIFRBQ1RJQ0FMX0VOQUJMRV9SRUFMX1RFQ0hOSUNBTFMgYW5kIFRBQ1RJQ0FMX1JFUVVJUkVfVEVDSE5JQ0FMX0NPTkZJUk1BVElPTjoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICByZXR1cm4gVHJ1ZQoKCmRlZiBfcGN0X2RyaWZ0KG9sZF92YWx1ZSwgbmV3X3ZhbHVlKToKICAgIHRyeToKICAgICAgICBvbGRfbiA9IGZsb2F0KG9sZF92YWx1ZSkKICAgICAgICBuZXdfbiA9IGZsb2F0KG5ld192YWx1ZSkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gTm9uZQogICAgaWYgb2xkX24gPD0gMCBvciBuZXdfbiA8PSAwOgogICAgICAgIHJldHVybiBOb25lCiAgICByZXR1cm4gYWJzKG5ld19uIC0gb2xkX24pIC8gb2xkX24gKiAxMDAuMAoKCmRlZiBfcmVmcmVzaF9hbGVydF9tYXJrZXRfc25hcHNob3QodG9rZW46IGRpY3QpOgogICAgaWYgbm90IEFMRVJUX0RBVEFfUkVGUkVTSF9FTkFCTEVEOgogICAgICAgIHJldHVybiB0b2tlbgoKICAgIGFkZHJlc3MgPSB0b2tlbi5nZXQoImFkZHJlc3MiKQogICAgaWYgbm90IGFkZHJlc3M6CiAgICAgICAgcmV0dXJuIHRva2VuCgogICAgc25hcHNob3QgPSBmZXRjaF9kZXhzY3JlZW5lcl90b2tlbl9zbmFwc2hvdChhZGRyZXNzKQogICAgaWYgbm90IHNuYXBzaG90OgogICAgICAgIGlmIEFMRVJUX1JFUVVJUkVfUkVGUkVTSF9TVUNDRVNTOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIHJldHVybiB0b2tlbgoKICAgIG1lcmdlZCA9IGRpY3QodG9rZW4pCiAgICBmb3IgZmllbGQgaW4gKCJsaXF1aWRpdHkiLCAidm9sdW1lXzI0aCIsICJwcmljZSIsICJjaGFuZ2VfMjRoIiwgImNoYW5nZV82aCIsICJjaGFuZ2VfMWgiLCAibWFya2V0X2NhcCIsICJmZHYiKToKICAgICAgICBzbmFwX3ZhbHVlID0gc25hcHNob3QuZ2V0KGZpZWxkKQogICAgICAgIGlmIHNuYXBfdmFsdWUgaXMgTm9uZToKICAgICAgICAgICAgY29udGludWUKICAgICAgICBkcmlmdCA9IF9wY3RfZHJpZnQodG9rZW4uZ2V0KGZpZWxkKSwgc25hcF92YWx1ZSkKICAgICAgICBpZiBkcmlmdCBpcyBub3QgTm9uZSBhbmQgZHJpZnQgPj0gQUxFUlRfREFUQV9EUklGVF9XQVJOX1BDVDoKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKAogICAgICAgICAgICAgICAgIkFsZXJ0IGRhdGEgZHJpZnQgYWRqdXN0ZWQgZm9yICVzIGZpZWxkPSVzIG9sZD0lLjRmIG5ldz0lLjRmIGRyaWZ0PSUuMWYlJSIsCiAgICAgICAgICAgICAgICB0b2tlbi5nZXQoInN5bWJvbCIsICJVTktOT1dOIiksCiAgICAgICAgICAgICAgICBmaWVsZCwKICAgICAgICAgICAgICAgIGZsb2F0KHRva2VuLmdldChmaWVsZCkgb3IgMCksCiAgICAgICAgICAgICAgICBmbG9hdChzbmFwX3ZhbHVlIG9yIDApLAogICAgICAgICAgICAgICAgZHJpZnQsCiAgICAgICAgICAgICkKICAgICAgICBtZXJnZWRbZmllbGRdID0gc25hcF92YWx1ZQoKICAgIGlmIHNuYXBzaG90LmdldCgicGFpcl9hZGRyZXNzIik6CiAgICAgICAgbWVyZ2VkWyJwYWlyX2FkZHJlc3MiXSA9IHNuYXBzaG90WyJwYWlyX2FkZHJlc3MiXQoKICAgICMgRGV4IGxpdmUgc25hcHNob3QgY3VycmVudGx5IGRvZXMgbm90IHByb3ZpZGUgaG9sZGVyIGNvdW50OyBtYXJrIGFzIHVudmVyaWZpZWQuCiAgICBtZXJnZWRbImhvbGRlcnNfdmVyaWZpZWQiXSA9IGJvb2woc25hcHNob3QuZ2V0KCJob2xkZXJzIikpCiAgICBpZiBtZXJnZWRbImhvbGRlcnNfdmVyaWZpZWQiXToKICAgICAgICBtZXJnZWRbImhvbGRlcnMiXSA9IHNuYXBzaG90LmdldCgiaG9sZGVycyIpCgogICAgbWVyZ2VkWyJzb3VyY2UiXSA9ICJkZXhzY3JlZW5lcl9saXZlIgogICAgcmV0dXJuIG1lcmdlZAoKCmRlZiBfaG9sZGVyc19mb3JfYWxlcnQodG9rZW46IGRpY3QpOgogICAgaG9sZGVycyA9IHRva2VuLmdldCgiaG9sZGVycyIpCiAgICBpZiBub3QgQUxFUlRfSElERV9VTlZFUklGSUVEX0hPTERFUlM6CiAgICAgICAgcmV0dXJuIGhvbGRlcnMKICAgIGlmIHRva2VuLmdldCgiaG9sZGVyc192ZXJpZmllZCIpOgogICAgICAgIHJldHVybiBob2xkZXJzCiAgICByZXR1cm4gIk4vQSIKCgpkZWYgX2dldF90YWN0aWNhbF90ZWNobmljYWxzKHRva2VuKToKICAgIGlmIF9tb2RlKCkgIT0gInRhY3RpY2FsIiBvciBub3QgVEFDVElDQUxfRU5BQkxFX1JFQUxfVEVDSE5JQ0FMUzoKICAgICAgICByZXR1cm4ge30KICAgIGFkZHJlc3MgPSB0b2tlbi5nZXQoImFkZHJlc3MiKQogICAgaWYgbm90IGFkZHJlc3M6CiAgICAgICAgcmV0dXJuIHt9CgogICAgbm93X3RzID0gaW50KHRpbWVfbW9kdWxlLnRpbWUoKSkKICAgIGNhY2hlZCA9IF90YWN0aWNhbF90ZWNoX2NhY2hlLmdldChhZGRyZXNzKQogICAgaWYgY2FjaGVkIGFuZCBub3dfdHMgLSBjYWNoZWRbInRzIl0gPD0gVEFDVElDQUxfVEVDSF9DQUNIRV9TRUNPTkRTOgogICAgICAgIHJldHVybiBjYWNoZWRbImRhdGEiXQoKICAgIGNhbmRsZXMgPSBmZXRjaF9iaXJkZXllX29obGN2KAogICAgICAgIGFkZHJlc3M9YWRkcmVzcywKICAgICAgICBjYW5kbGVfdHlwZT1UQUNUSUNBTF9PSExDVl9UWVBFLAogICAgICAgIGxvb2tiYWNrX2hvdXJzPVRBQ1RJQ0FMX09ITENWX0xPT0tCQUNLX0hPVVJTLAogICAgKQogICAgY2xvc2VfdmFsdWVzID0gY2xvc2VzKGNhbmRsZXMpCiAgICBpZiBsZW4oY2xvc2VfdmFsdWVzKSA8IG1heCgzNSwgVEFDVElDQUxfUlNJX1BFUklPRCArIDIpOgogICAgICAgIHJldHVybiB7fQoKICAgIHJzaV92YWx1ZSA9IHJzaShjbG9zZV92YWx1ZXMsIHBlcmlvZD1UQUNUSUNBTF9SU0lfUEVSSU9EKQogICAgbWFjZF92YWx1ZSA9IG1hY2QoY2xvc2VfdmFsdWVzKQogICAgaWYgcnNpX3ZhbHVlIGlzIE5vbmUgb3Igbm90IG1hY2RfdmFsdWU6CiAgICAgICAgcmV0dXJuIHt9CgogICAgc25hcHNob3QgPSB7CiAgICAgICAgInJzaSI6IGZsb2F0KHJzaV92YWx1ZSksCiAgICAgICAgIm1hY2RfbGluZSI6IGZsb2F0KG1hY2RfdmFsdWVbIm1hY2RfbGluZSJdKSwKICAgICAgICAibWFjZF9zaWduYWwiOiBmbG9hdChtYWNkX3ZhbHVlWyJtYWNkX3NpZ25hbCJdKSwKICAgICAgICAibWFjZF9oaXN0IjogZmxvYXQobWFjZF92YWx1ZVsibWFjZF9oaXN0Il0pLAogICAgfQogICAgX3RhY3RpY2FsX3RlY2hfY2FjaGVbYWRkcmVzc10gPSB7InRzIjogbm93X3RzLCAiZGF0YSI6IHNuYXBzaG90fQogICAgcmV0dXJuIHNuYXBzaG90CgoKZGVmIF9jb25maWRlbmNlX2Zyb21fc2NvcmUoc2NvcmUpOgogICAgaWYgc2NvcmUgPj0gQ09ORklERU5DRV9NSU5fQToKICAgICAgICByZXR1cm4gIkEiCiAgICBpZiBzY29yZSA+PSBDT05GSURFTkNFX01JTl9COgogICAgICAgIHJldHVybiAiQiIKICAgIHJldHVybiAiQyIKCgpkZWYgX2NvbmZpZGVuY2VfbWVldHNfcnVsZShjb25maWRlbmNlLCBtaW5pbXVtKToKICAgIG1pbmltdW1fcmF3ID0gc3RyKG1pbmltdW0gb3IgIkIiKS51cHBlcigpCiAgICBtaW5pbXVtX25vcm0gPSBtaW5pbXVtX3JhdyBpZiBtaW5pbXVtX3JhdyBpbiBfQ09ORklERU5DRV9PUkRFUiBlbHNlICJCIgogICAgcmV0dXJuIF9DT05GSURFTkNFX09SREVSLmdldChjb25maWRlbmNlLCAwKSA+PSBfQ09ORklERU5DRV9PUkRFUlttaW5pbXVtX25vcm1dCgoKZGVmIF9jb25maWRlbmNlX21lZXRzX2FsZXJ0X3J1bGUoY29uZmlkZW5jZSk6CiAgICByZXR1cm4gX2NvbmZpZGVuY2VfbWVldHNfcnVsZShjb25maWRlbmNlLCBfcnVudGltZVsibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiXSkKCgpkZWYgX2lzX3N5bWJvbF9vbl9jb29sZG93bihzeW1ib2w6IHN0ciwgY29vbGRvd25faG91cnM6IGludCB8IGZsb2F0IHwgTm9uZSA9IE5vbmUpIC0+IGJvb2w6CiAgICBpZiBub3Qgc3ltYm9sOgogICAgICAgIHJldHVybiBGYWxzZQogICAgbGFzdF9hbGVydF90cyA9IGdldF9sYXN0X2FsZXJ0X3RpbWVzdGFtcChzeW1ib2wpCiAgICBpZiBub3QgbGFzdF9hbGVydF90czoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGVmZmVjdGl2ZV9ob3VycyA9IGludChjb29sZG93bl9ob3VycyBpZiBjb29sZG93bl9ob3VycyBpcyBub3QgTm9uZSBlbHNlIF9ydW50aW1lWyJhbGVydF9jb29sZG93bl9ob3VycyJdKQogICAgcmV0dXJuIChkYXRldGltZS51dGNub3coKSAtIGxhc3RfYWxlcnRfdHMpIDwgdGltZWRlbHRhKGhvdXJzPWVmZmVjdGl2ZV9ob3VycykKCgpkZWYgX2FwcGx5X3N5bWJvbF9jb250cm9scyhzeW1ib2w6IHN0cik6CiAgICBpZiBub3QgU1lNQk9MX0NPTlRST0xfRU5BQkxFRCBvciBub3Qgc3ltYm9sOgogICAgICAgIHJldHVybiBOb25lCiAgICByZXR1cm4gZ2V0X2FjdGl2ZV9zeW1ib2xfY29udHJvbChzeW1ib2wpCgoKZGVmIF9yaXNrX2dvdmVybm9yX3N0YXR1cygpIC0+IHR1cGxlW2Jvb2wsIHN0cl06CiAgICBpZiBHTE9CQUxfVFJBRElOR19QQVVTRToKICAgICAgICByZXR1cm4gRmFsc2UsICJHTE9CQUxfVFJBRElOR19QQVVTRSBlbmFibGVkIgogICAgaWYgbm90IEVOQUJMRV9SSVNLX0dPVkVSTk9SOgogICAgICAgIHJldHVybiBUcnVlLCAiIgoKICAgIG5vdyA9IGRhdGV0aW1lLnV0Y25vdygpCiAgICBwYXVzZV9zdGF0ZSA9IGdldF9yaXNrX3BhdXNlX3N0YXRlKCkKICAgIHBhdXNlX3VudGlsID0gcGF1c2Vfc3RhdGUuZ2V0KCJwYXVzZV91bnRpbCIpCiAgICBpZiBwYXVzZV91bnRpbCBhbmQgcGF1c2VfdW50aWwgPiBub3c6CiAgICAgICAgcmV0dXJuIEZhbHNlLCBmIlJpc2sgcGF1c2UgYWN0aXZlIHVudGlsIHtwYXVzZV91bnRpbC5pc29mb3JtYXQoKX0iCiAgICBpZiBwYXVzZV91bnRpbCBhbmQgcGF1c2VfdW50aWwgPD0gbm93OgogICAgICAgIGNsZWFyX3Jpc2tfcGF1c2UoKQoKICAgIHN0cmVhayA9IGdldF9jb25zZWN1dGl2ZV9sb3Npbmdfb3V0Y29tZXNfNGgobGltaXQ9MTAwKQogICAgbGF0ZXN0XzRoX291dGNvbWUgPSBnZXRfbGF0ZXN0XzRoX291dGNvbWVfdGltZXN0YW1wKCkKICAgIHJlY2VudF9vdXRjb21lX3dpbmRvdyA9IG5vdyAtIHRpbWVkZWx0YShob3Vycz1MT1NTX1NUUkVBS19MT09LQkFDS19IT1VSUykKICAgIGlmICgKICAgICAgICBzdHJlYWsgPj0gTUFYX0NPTlNFQ1VUSVZFXzRIX0xPU1NFUwogICAgICAgIGFuZCBsYXRlc3RfNGhfb3V0Y29tZQogICAgICAgIGFuZCBsYXRlc3RfNGhfb3V0Y29tZSA+PSByZWNlbnRfb3V0Y29tZV93aW5kb3cKICAgICk6CiAgICAgICAgcmVhc29uID0gZiJMb3NzIHN0cmVhayB7c3RyZWFrfSA+PSB7TUFYX0NPTlNFQ1VUSVZFXzRIX0xPU1NFU30iCiAgICAgICAgc2V0X3Jpc2tfcGF1c2UoTE9TU19TVFJFQUtfUEFVU0VfSE9VUlMsIHJlYXNvbikKICAgICAgICByZXR1cm4gRmFsc2UsIHJlYXNvbgoKICAgIGFsZXJ0c18yNGggPSBjb3VudF9hbGVydHNfc2luY2UoZGF0ZXRpbWUudXRjbm93KCkgLSB0aW1lZGVsdGEoaG91cnM9MjQpKQogICAgaWYgTUFYX0FMRVJUU19QRVJfREFZID4gMCBhbmQgYWxlcnRzXzI0aCA+PSBNQVhfQUxFUlRTX1BFUl9EQVk6CiAgICAgICAgcmV0dXJuIEZhbHNlLCBmIkRhaWx5IGFsZXJ0IGNhcCByZWFjaGVkICh7YWxlcnRzXzI0aH0ve01BWF9BTEVSVFNfUEVSX0RBWX0pIgoKICAgIHJldHVybiBUcnVlLCAiIgoKCmRlZiBfY29tcHV0ZV9yZWdpbWUodG9rZW5zKToKICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgcmV0dXJuIHsic2NvcmUiOiAwLjAsICJsYWJlbCI6ICJSSVNLX09GRiIsICJicmVhZHRoX3BjdCI6IDAuMCwgImF2Z19jaGFuZ2VfMjRoIjogMC4wfQoKICAgIGNoYW5nZXMgPSBbZmxvYXQodC5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKSBmb3IgdCBpbiB0b2tlbnNdCiAgICBwb3NpdGl2ZXMgPSBzdW0oMSBmb3IgeCBpbiBjaGFuZ2VzIGlmIHggPiAwKQogICAgYnJlYWR0aF9wY3QgPSBwb3NpdGl2ZXMgLyBsZW4oY2hhbmdlcykKICAgIGF2Z19jaGFuZ2UgPSBzdW0oY2hhbmdlcykgLyBsZW4oY2hhbmdlcykKCiAgICAjIEJsZW5kIGRpcmVjdGlvbmFsIGJyZWFkdGggYW5kIG1lYW4gY2hhbmdlIGludG8gYSAwLTEwMCByZWdpbWUgc2NvcmUuCiAgICByZWdpbWVfc2NvcmUgPSA1MC4wICsgKGF2Z19jaGFuZ2UgKiAyLjApICsgKChicmVhZHRoX3BjdCAtIDAuNSkgKiA0MC4wKQogICAgcmVnaW1lX3Njb3JlID0gbWF4KDAuMCwgbWluKDEwMC4wLCByZWdpbWVfc2NvcmUpKQoKICAgIGlmIHJlZ2ltZV9zY29yZSA+PSA2NToKICAgICAgICBsYWJlbCA9ICJSSVNLX09OIgogICAgZWxpZiByZWdpbWVfc2NvcmUgPj0gNDU6CiAgICAgICAgbGFiZWwgPSAiTkVVVFJBTCIKICAgIGVsc2U6CiAgICAgICAgbGFiZWwgPSAiUklTS19PRkYiCgogICAgcmV0dXJuIHsKICAgICAgICAic2NvcmUiOiByZWdpbWVfc2NvcmUsCiAgICAgICAgImxhYmVsIjogbGFiZWwsCiAgICAgICAgImJyZWFkdGhfcGN0IjogYnJlYWR0aF9wY3QsCiAgICAgICAgImF2Z19jaGFuZ2VfMjRoIjogYXZnX2NoYW5nZSwKICAgIH0KCgpkZWYgX2NvbXB1dGVfc29sX3JlZ2ltZV9wcm94eSgpOgogICAgaWYgbm90IEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSOgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJlbmFibGVkIjogRmFsc2UsCiAgICAgICAgICAgICJhdmFpbGFibGUiOiBGYWxzZSwKICAgICAgICAgICAgInN5bWJvbCI6ICJTT0wiLAogICAgICAgICAgICAiY2hhbmdlXzI0aCI6IDAuMCwKICAgICAgICAgICAgImNoYW5nZV8xaCI6IDAuMCwKICAgICAgICAgICAgInBhaXJfYWRkcmVzcyI6IE5vbmUsCiAgICAgICAgICAgICJsaXF1aWRpdHkiOiAwLjAsCiAgICAgICAgfQoKICAgIHNuYXBzaG90ID0gZmV0Y2hfc29sX21hcmtldF9wcm94eShTT0xfUkVHSU1FX1FVRVJZKQogICAgaWYgbm90IHNuYXBzaG90OgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJlbmFibGVkIjogVHJ1ZSwKICAgICAgICAgICAgImF2YWlsYWJsZSI6IEZhbHNlLAogICAgICAgICAgICAic3ltYm9sIjogIlNPTCIsCiAgICAgICAgICAgICJjaGFuZ2VfMjRoIjogMC4wLAogICAgICAgICAgICAiY2hhbmdlXzFoIjogMC4wLAogICAgICAgICAgICAicGFpcl9hZGRyZXNzIjogTm9uZSwKICAgICAgICAgICAgImxpcXVpZGl0eSI6IDAuMCwKICAgICAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICAiZW5hYmxlZCI6IFRydWUsCiAgICAgICAgImF2YWlsYWJsZSI6IFRydWUsCiAgICAgICAgInN5bWJvbCI6IHNuYXBzaG90LmdldCgic3ltYm9sIikgb3IgIlNPTCIsCiAgICAgICAgImNoYW5nZV8yNGgiOiBmbG9hdChzbmFwc2hvdC5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKSwKICAgICAgICAiY2hhbmdlXzFoIjogZmxvYXQoc25hcHNob3QuZ2V0KCJjaGFuZ2VfMWgiLCAwKSBvciAwKSwKICAgICAgICAicGFpcl9hZGRyZXNzIjogc25hcHNob3QuZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAibGlxdWlkaXR5IjogZmxvYXQoc25hcHNob3QuZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKSwKICAgIH0KCgpkZWYgX2J1aWxkX21hcmtldF9wb2xpY3kocmVnaW1lLCBzb2xfcHJveHkpOgogICAgcG9saWN5ID0gewogICAgICAgICJzdGF0ZSI6IHJlZ2ltZS5nZXQoImxhYmVsIiwgIk5FVVRSQUwiKSwKICAgICAgICAiYWxlcnRfdGhyZXNob2xkIjogZmxvYXQoX3J1bnRpbWVbImFsZXJ0X3RocmVzaG9sZCJdKSwKICAgICAgICAibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiOiBzdHIoX3J1bnRpbWVbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0pLnVwcGVyKCksCiAgICAgICAgInJlZ2ltZV9taW5fc2NvcmUiOiBmbG9hdChfcnVudGltZVsicmVnaW1lX21pbl9zY29yZSJdKSwKICAgICAgICAibWF4X2FsZXJ0c19wZXJfY3ljbGUiOiBtYXgoMSwgaW50KE1BWF9BTEVSVFNfUEVSX0NZQ0xFKSksCiAgICAgICAgIm1heF9hbGVydHNfcGVyX2RheSI6IGludChNQVhfQUxFUlRTX1BFUl9EQVkpLAogICAgICAgICJhbGVydF9jb29sZG93bl9ob3VycyI6IGludChfcnVudGltZVsiYWxlcnRfY29vbGRvd25faG91cnMiXSksCiAgICAgICAgImhhcmRfYmxvY2siOiBGYWxzZSwKICAgICAgICAiaGFyZF9ibG9ja19yZWFzb24iOiAiIiwKICAgIH0KCiAgICBpZiBub3QgRU5BQkxFX1NPTF9SRUdJTUVfTEFZRVI6CiAgICAgICAgcG9saWN5WyJzdGF0ZSJdID0gcmVnaW1lLmdldCgibGFiZWwiLCAiTkVVVFJBTCIpCiAgICAgICAgcmV0dXJuIHBvbGljeQoKICAgIHNvbF9jaGFuZ2VfMjRoID0gZmxvYXQoc29sX3Byb3h5LmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICBzb2xfY2hhbmdlXzFoID0gZmxvYXQoc29sX3Byb3h5LmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCkKICAgIGJyZWFkdGggPSBmbG9hdChyZWdpbWUuZ2V0KCJicmVhZHRoX3BjdCIsIDApIG9yIDApCiAgICByZWdpbWVfc2NvcmUgPSBmbG9hdChyZWdpbWUuZ2V0KCJzY29yZSIsIDApIG9yIDApCgogICAgaWYgKAogICAgICAgIHNvbF9jaGFuZ2VfMjRoIDw9IFNPTF9FWFRSRU1FX09GRl9DSEFOR0VfMjRICiAgICAgICAgb3Igc29sX2NoYW5nZV8xaCA8PSBTT0xfRVhUUkVNRV9PRkZfQ0hBTkdFXzFICiAgICApOgogICAgICAgIHN0YXRlID0gIkVYVFJFTUVfUklTS19PRkYiCiAgICBlbGlmIHNvbF9jaGFuZ2VfMjRoIDw9IFNPTF9SSVNLX09GRl9DSEFOR0VfMjRIIG9yIHJlZ2ltZS5nZXQoImxhYmVsIikgPT0gIlJJU0tfT0ZGIjoKICAgICAgICBzdGF0ZSA9ICJSSVNLX09GRiIKICAgIGVsaWYgKAogICAgICAgIHNvbF9jaGFuZ2VfMjRoID49IFNPTF9SSVNLX09OX0NIQU5HRV8yNEgKICAgICAgICBhbmQgYnJlYWR0aCA+PSBTT0xfQlJFQURUSF9NSU5fRk9SX1JJU0tfT04KICAgICAgICBhbmQgcmVnaW1lX3Njb3JlID49IDQ1CiAgICApOgogICAgICAgIHN0YXRlID0gIlJJU0tfT04iCiAgICBlbHNlOgogICAgICAgIHN0YXRlID0gIk5FVVRSQUwiCgogICAgcG9saWN5WyJzdGF0ZSJdID0gc3RhdGUKCiAgICBpZiBzdGF0ZSBpbiB7IlJJU0tfT0ZGIiwgIkVYVFJFTUVfUklTS19PRkYifToKICAgICAgICBwb2xpY3lbImFsZXJ0X3RocmVzaG9sZCJdID0gbWF4KHBvbGljeVsiYWxlcnRfdGhyZXNob2xkIl0sIGZsb2F0KEJFQVJJU0hfQUxFUlRfVEhSRVNIT0xEKSkKICAgICAgICBwb2xpY3lbInJlZ2ltZV9taW5fc2NvcmUiXSA9IG1heChwb2xpY3lbInJlZ2ltZV9taW5fc2NvcmUiXSwgZmxvYXQoQkVBUklTSF9SRUdJTUVfTUlOX1NDT1JFKSkKCiAgICAgICAgYmVhcmlzaF9jb25mID0gc3RyKEJFQVJJU0hfTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQpLnVwcGVyKCkKICAgICAgICBpZiBiZWFyaXNoX2NvbmYgbm90IGluIF9DT05GSURFTkNFX09SREVSOgogICAgICAgICAgICBiZWFyaXNoX2NvbmYgPSAiQSIKICAgICAgICBwb2xpY3lbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0gPSBiZWFyaXNoX2NvbmYKCiAgICAgICAgYmVhcmlzaF9jeWNsZV9jYXAgPSBtYXgoMSwgaW50KEJFQVJJU0hfTUFYX0FMRVJUU19QRVJfQ1lDTEUpKQogICAgICAgIHBvbGljeVsibWF4X2FsZXJ0c19wZXJfY3ljbGUiXSA9IG1pbihwb2xpY3lbIm1heF9hbGVydHNfcGVyX2N5Y2xlIl0sIGJlYXJpc2hfY3ljbGVfY2FwKQoKICAgICAgICBiZWFyaXNoX2RhaWx5X2NhcCA9IGludChCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0RBWSkKICAgICAgICBpZiBiZWFyaXNoX2RhaWx5X2NhcCA+IDA6CiAgICAgICAgICAgIGlmIHBvbGljeVsibWF4X2FsZXJ0c19wZXJfZGF5Il0gPiAwOgogICAgICAgICAgICAgICAgcG9saWN5WyJtYXhfYWxlcnRzX3Blcl9kYXkiXSA9IG1pbihwb2xpY3lbIm1heF9hbGVydHNfcGVyX2RheSJdLCBiZWFyaXNoX2RhaWx5X2NhcCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBvbGljeVsibWF4X2FsZXJ0c19wZXJfZGF5Il0gPSBiZWFyaXNoX2RhaWx5X2NhcAoKICAgICAgICBwb2xpY3lbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0gPSBtYXgocG9saWN5WyJhbGVydF9jb29sZG93bl9ob3VycyJdLCBpbnQoQkVBUklTSF9BTEVSVF9DT09MRE9XTl9IT1VSUykpCgogICAgaWYgc3RhdGUgPT0gIkVYVFJFTUVfUklTS19PRkYiIGFuZCBFTkFCTEVfRVhUUkVNRV9SSVNLX0hBUkRfQkxPQ0s6CiAgICAgICAgcG9saWN5WyJoYXJkX2Jsb2NrIl0gPSBUcnVlCiAgICAgICAgcG9saWN5WyJoYXJkX2Jsb2NrX3JlYXNvbiJdID0gKAogICAgICAgICAgICBmIkVYVFJFTUVfUklTS19PRkYgc29sMjRoPXtzb2xfY2hhbmdlXzI0aDouMmZ9JSBzb2wxaD17c29sX2NoYW5nZV8xaDouMmZ9JSIKICAgICAgICApCgogICAgcmV0dXJuIHBvbGljeQoKCmRlZiBfcGFzc2VzX2xpdmVfcHVzaF9nYXRlKHRva2VuOiBkaWN0LCBwb2xpY3k6IGRpY3QpIC0+IGJvb2w6CiAgICBpZiBub3QgVEVMRUdSQU1fUFVTSF9TVFJPTkdfT05MWToKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGNvbmYgPSBzdHIodG9rZW4uZ2V0KCJjb25maWRlbmNlIikgb3IgIkMiKS51cHBlcigpCiAgICBtaW5fY29uZiA9IHN0cihURUxFR1JBTV9QVVNIX01JTl9DT05GSURFTkNFIG9yICJBIikudXBwZXIoKQogICAgaWYgbWluX2NvbmYgbm90IGluIF9DT05GSURFTkNFX09SREVSOgogICAgICAgIG1pbl9jb25mID0gIkEiCiAgICBpZiBfQ09ORklERU5DRV9PUkRFUi5nZXQoY29uZiwgMSkgPCBfQ09ORklERU5DRV9PUkRFUlttaW5fY29uZl06CiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgc2NvcmUgPSBmbG9hdCh0b2tlbi5nZXQoInNjb3JlIiwgMCkgb3IgMCkKICAgIGJhc2VfdGhyZXNob2xkID0gZmxvYXQocG9saWN5LmdldCgiYWxlcnRfdGhyZXNob2xkIiwgX3J1bnRpbWVbImFsZXJ0X3RocmVzaG9sZCJdKSBvciAwKQogICAgcmVxdWlyZWRfc2NvcmUgPSBiYXNlX3RocmVzaG9sZCArIG1heCgwLCBpbnQoVEVMRUdSQU1fUFVTSF9NSU5fU0NPUkVfREVMVEEpKQogICAgcmV0dXJuIHNjb3JlID49IHJlcXVpcmVkX3Njb3JlCgoKZGVmIF9wYWlyX2FnZV9ob3VycyhwYWlyX2NyZWF0ZWRfYXQpOgogICAgaWYgcGFpcl9jcmVhdGVkX2F0IGlzIE5vbmU6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHRyeToKICAgICAgICB0cyA9IGZsb2F0KHBhaXJfY3JlYXRlZF9hdCkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gTm9uZQogICAgaWYgdHMgPD0gMDoKICAgICAgICByZXR1cm4gTm9uZQogICAgIyBEZXhTY3JlZW5lciBtYXkgcHJvdmlkZSBtaWxsaXNlY29uZHMuCiAgICBpZiB0cyA+IDFfMDAwXzAwMF8wMDBfMDAwOgogICAgICAgIHRzID0gdHMgLyAxMDAwLjAKICAgIHRyeToKICAgICAgICBjcmVhdGVkID0gZGF0ZXRpbWUudXRjZnJvbXRpbWVzdGFtcCh0cykKICAgIGV4Y2VwdCAoT3ZlcmZsb3dFcnJvciwgT1NFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGFnZSA9IChkYXRldGltZS51dGNub3coKSAtIGNyZWF0ZWQpLnRvdGFsX3NlY29uZHMoKSAvIDM2MDAuMAogICAgaWYgYWdlIDwgMDoKICAgICAgICByZXR1cm4gTm9uZQogICAgcmV0dXJuIGFnZQoKCmRlZiBfcnVubmVyX25hcnJhdGl2ZV9sYWJlbCh0b2tlbik6CiAgICB0ZXh0ID0gZiJ7dG9rZW4uZ2V0KCdzeW1ib2wnLCAnJyl9IHt0b2tlbi5nZXQoJ25hbWUnLCAnJyl9IHt0b2tlbi5nZXQoJ2Rlc2NyaXB0aW9uJywgJycpfSIubG93ZXIoKQogICAgaGl0cyA9IFtrdyBmb3Iga3cgaW4gTkVXX1JVTk5FUl9OQVJSQVRJVkVfS0VZV09SRFMgaWYga3cgYW5kIGt3IGluIHRleHRdCiAgICBzb2NpYWxfbGlua3MgPSBpbnQodG9rZW4uZ2V0KCJzb2NpYWxfbGlua3MiKSBvciAwKQogICAgaWYgbGVuKGhpdHMpID49IDIgYW5kIHNvY2lhbF9saW5rcyA+IDA6CiAgICAgICAgcmV0dXJuICJTdHJvbmciLCBsZW4oaGl0cykKICAgIGlmIGxlbihoaXRzKSA+PSAxIG9yIHNvY2lhbF9saW5rcyA+IDA6CiAgICAgICAgcmV0dXJuICJEZXZlbG9waW5nIiwgbGVuKGhpdHMpCiAgICByZXR1cm4gIldlYWsiLCBsZW4oaGl0cykKCgpkZWYgX3J1bm5lcl94X3Byb3h5X2xhYmVsKHRva2VuKToKICAgIHR4bnNfaDEgPSBpbnQodG9rZW4uZ2V0KCJ0eG5zX2gxIikgb3IgMCkKICAgIHNvY2lhbF9saW5rcyA9IGludCh0b2tlbi5nZXQoInNvY2lhbF9saW5rcyIpIG9yIDApCiAgICBib29zdHNfYWN0aXZlID0gaW50KHRva2VuLmdldCgiYm9vc3RzX2FjdGl2ZSIpIG9yIDApCiAgICBpZiB0eG5zX2gxID49IG1heCgyNTAsIE5FV19SVU5ORVJfTUlOX1RYTlNfSDEgKiAyKSBvciAoc29jaWFsX2xpbmtzID4gMSBhbmQgYm9vc3RzX2FjdGl2ZSA+IDApOgogICAgICAgIHJldHVybiAiSGlnaCIKICAgIGlmIHR4bnNfaDEgPj0gTkVXX1JVTk5FUl9NSU5fVFhOU19IMToKICAgICAgICByZXR1cm4gIk1lZGl1bSIKICAgIHJldHVybiAiTG93IgoKCmRlZiBfcnVubmVyX3dhdGNoX2VucmljaCh0b2tlbik6CiAgICBhZ2VfaG91cnMgPSBfcGFpcl9hZ2VfaG91cnModG9rZW4uZ2V0KCJwYWlyX2NyZWF0ZWRfYXQiKSkKICAgIGlmIGFnZV9ob3VycyBpcyBOb25lIG9yIGFnZV9ob3VycyA+IE5FV19SVU5ORVJfTUFYX0FHRV9IT1VSUzoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIG1hcmtldF9jYXAgPSB0b2tlbi5nZXQoIm1hcmtldF9jYXAiKQogICAgZmR2ID0gdG9rZW4uZ2V0KCJmZHYiKQogICAgY2FwX3ZhbHVlID0gbWFya2V0X2NhcCBpZiBpc2luc3RhbmNlKG1hcmtldF9jYXAsIChpbnQsIGZsb2F0KSkgYW5kIG1hcmtldF9jYXAgPiAwIGVsc2UgZmR2CiAgICBpZiBub3QgaXNpbnN0YW5jZShjYXBfdmFsdWUsIChpbnQsIGZsb2F0KSkgb3IgY2FwX3ZhbHVlIDwgTkVXX1JVTk5FUl9NSU5fTUFSS0VUX0NBUDoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICB0eG5zX2gxID0gaW50KHRva2VuLmdldCgidHhuc19oMSIpIG9yIDApCiAgICBzb2NpYWxfbGlua3MgPSBpbnQodG9rZW4uZ2V0KCJzb2NpYWxfbGlua3MiKSBvciAwKQogICAgYm9vc3RzX2FjdGl2ZSA9IGludCh0b2tlbi5nZXQoImJvb3N0c19hY3RpdmUiKSBvciAwKQoKICAgIGlmIGxpcXVpZGl0eSA8IE5FV19SVU5ORVJfTUlOX0xJUVVJRElUWToKICAgICAgICByZXR1cm4gTm9uZQogICAgaWYgdm9sdW1lXzI0aCA8IE5FV19SVU5ORVJfTUlOX1ZPTFVNRV8yNEg6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIGNoYW5nZV8yNGggPCBORVdfUlVOTkVSX01JTl9DSEFOR0VfMjRIOgogICAgICAgIHJldHVybiBOb25lCiAgICBpZiB0eG5zX2gxIDwgTkVXX1JVTk5FUl9NSU5fVFhOU19IMToKICAgICAgICByZXR1cm4gTm9uZQogICAgaWYgTkVXX1JVTk5FUl9SRVFVSVJFX1NPQ0lBTF9MSU5LUyBhbmQgc29jaWFsX2xpbmtzIDw9IDA6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBuYXJyYXRpdmVfbGFiZWwsIGtleXdvcmRfaGl0cyA9IF9ydW5uZXJfbmFycmF0aXZlX2xhYmVsKHRva2VuKQogICAgeF9wcm94eV9sYWJlbCA9IF9ydW5uZXJfeF9wcm94eV9sYWJlbCh0b2tlbikKCiAgICB3YXRjaF9zY29yZSA9IDAuMAogICAgd2F0Y2hfc2NvcmUgKz0gMjAuMCAgIyBmaXJzdC1kYXkgYWdlIGNvbmRpdGlvbiBwYXNzZWQKICAgIHdhdGNoX3Njb3JlICs9IDIwLjAgaWYgY2FwX3ZhbHVlID49IE5FV19SVU5ORVJfTUlOX01BUktFVF9DQVAgZWxzZSAwLjAKICAgIHdhdGNoX3Njb3JlICs9IDIwLjAgaWYgdm9sdW1lXzI0aCA+PSBORVdfUlVOTkVSX01JTl9WT0xVTUVfMjRIIGVsc2UgMC4wCiAgICB3YXRjaF9zY29yZSArPSAxNS4wIGlmIGxpcXVpZGl0eSA+PSBORVdfUlVOTkVSX01JTl9MSVFVSURJVFkgZWxzZSAwLjAKICAgIHdhdGNoX3Njb3JlICs9IG1pbigxNS4wLCAodHhuc19oMSAvIG1heCgxLCBORVdfUlVOTkVSX01JTl9UWE5TX0gxKSkgKiAxNS4wKQogICAgd2F0Y2hfc2NvcmUgKz0gbWluKDUuMCwga2V5d29yZF9oaXRzICogMi41KQogICAgd2F0Y2hfc2NvcmUgKz0gNS4wIGlmIHNvY2lhbF9saW5rcyA+IDAgZWxzZSAwLjAKICAgIHdhdGNoX3Njb3JlICs9IDMuMCBpZiBib29zdHNfYWN0aXZlID4gMCBlbHNlIDAuMAogICAgd2F0Y2hfc2NvcmUgPSBtaW4oMTAwLjAsIHdhdGNoX3Njb3JlKQogICAgaWYgd2F0Y2hfc2NvcmUgPCBORVdfUlVOTkVSX01JTl9BTEVSVF9TQ09SRToKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGVucmljaGVkID0gZGljdCh0b2tlbikKICAgIHJpc2tfcGxhbiwgcm90YXRpb25fcGxhbiA9IF93YWxsZXRfZ3VpZGFuY2UoIlczIikKICAgIGVucmljaGVkLnVwZGF0ZSgKICAgICAgICB7CiAgICAgICAgICAgICJhZ2VfaG91cnMiOiBhZ2VfaG91cnMsCiAgICAgICAgICAgICJ3YXRjaF9zY29yZSI6IHdhdGNoX3Njb3JlLAogICAgICAgICAgICAieF9wcm94eV9sYWJlbCI6IHhfcHJveHlfbGFiZWwsCiAgICAgICAgICAgICJuYXJyYXRpdmVfbGFiZWwiOiBuYXJyYXRpdmVfbGFiZWwsCiAgICAgICAgICAgICJ3YWxsZXRfZml0IjogIlczIiwKICAgICAgICAgICAgInJpc2tfcGxhbiI6IHJpc2tfcGxhbiwKICAgICAgICAgICAgInJvdGF0aW9uX3BsYW4iOiByb3RhdGlvbl9wbGFuLAogICAgICAgICAgICAibm90ZSI6ICJXYXRjaGxpc3Qtb25seSBhbGVydC4gRWFybHkgcnVubmVyIHRvIG1vbml0b3IsIG5vdCBhIGJ1eSBzaWduYWwuIiwKICAgICAgICB9CiAgICApCiAgICByZXR1cm4gZW5yaWNoZWQKCgpkZWYgX3J1bm5lcl93YXRjaF9vbl9jb29sZG93bihzeW1ib2w6IHN0cikgLT4gYm9vbDoKICAgIGlmIG5vdCBzeW1ib2w6CiAgICAgICAgcmV0dXJuIFRydWUKICAgIGxhc3Rfc2VudCA9IGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sKAogICAgICAgIHN5bWJvbCwKICAgICAgICBbIlJVTk5FUl9XQVRDSF9BTEVSVCIsICJSVU5ORVJfV0FUQ0hfRFJZX1JVTiJdLAogICAgKQogICAgaWYgbm90IGxhc3Rfc2VudDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiAoZGF0ZXRpbWUudXRjbm93KCkgLSBsYXN0X3NlbnQpIDwgdGltZWRlbHRhKGhvdXJzPU5FV19SVU5ORVJfQ09PTERPV05fSE9VUlMpCgoKIyDilIDilIAgTEVHQUNZIFJFQ09WRVJZIGhlbHBlcnMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACgpfUkVWRVJTQUxfUEFUVEVSTlMgPSB7ImZhbGxpbmdfd2VkZ2UiLCAiZG91YmxlX2JvdHRvbSIsICJjdXBfaGFuZGxlIiwgImN1cF9hbmRfaGFuZGxlIiwgInJldmVyc2FsIn0KCgpkZWYgX2RldGVjdF9sZWdhY3lfcmVjb3ZlcnkodG9rZW46IGRpY3QpIC0+IGRpY3QgfCBOb25lOgogICAgIiIiCiAgICBSZXR1cm5zIGFuIGVucmljaGVkIHRva2VuIGRpY3QgaWYgaXQgcGFzc2VzIGFsbCBMRUdBQ1kgUkVDT1ZFUlkgY3JpdGVyaWEsCiAgICBvciBOb25lIGlmIGl0IGZhaWxzIGFueSBmaWx0ZXIuCgogICAgQ3JpdGVyaWE6CiAgICAgIC0gYWdlID49IExFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVMgKGRlZmF1bHQgOTAgZGF5cykKICAgICAgLSBsaXF1aWRpdHkgPj0gTEVHQUNZX1JFQ09WRVJZX01JTl9MSVFVSURJVFkgKGRlZmF1bHQgJDFNKQogICAgICAtIHZvbHVtZV8yNGggPj0gTEVHQUNZX1JFQ09WRVJZX01JTl9WT0xVTUVfMjRIIChkZWZhdWx0ICQ1MDBLKQogICAgICAtIHZvbHVtZSBzcGlrZTogdHhuc19oMSA+PSBMRUdBQ1lfUkVDT1ZFUllfVk9MVU1FX1NQSUtFX01VTFRJUExJRVIgw5cgKHR4bnNfaDI0LzI0KQogICAgICAtIHJldmVyc2FsLXR5cGUgcGF0dGVybiAoZmFsbGluZyB3ZWRnZSAvIGRvdWJsZSBib3R0b20gLyBjdXAgJiBoYW5kbGUpCiAgICAgICAgaW5mZXJyZWQgZnJvbSBwcmljZSBhY3Rpb24gd2hlbiBubyBleHBsaWNpdCBwYXR0ZXJuIGZpZWxkIHByZXNlbnQKICAgICIiIgogICAgYWdlX2hvdXJzID0gX3BhaXJfYWdlX2hvdXJzKHRva2VuLmdldCgicGFpcl9jcmVhdGVkX2F0IikpCiAgICBtaW5fYWdlX2hvdXJzID0gTEVHQUNZX1JFQ09WRVJZX01JTl9BR0VfREFZUyAqIDI0LjAKICAgIGlmIGFnZV9ob3VycyBpcyBOb25lIG9yIGFnZV9ob3VycyA8IG1pbl9hZ2VfaG91cnM6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICBpZiBsaXF1aWRpdHkgPCBMRUdBQ1lfUkVDT1ZFUllfTUlOX0xJUVVJRElUWToKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgaWYgdm9sdW1lXzI0aCA8IExFR0FDWV9SRUNPVkVSWV9NSU5fVk9MVU1FXzI0SDoKICAgICAgICByZXR1cm4gTm9uZQoKICAgICMgVm9sdW1lIHNwaWtlOiBjb21wYXJlIGxhc3QtaG91ciB0eG4gcmF0ZSB2cyAyNGggYXZlcmFnZSByYXRlCiAgICB0eG5zX2gxID0gZmxvYXQodG9rZW4uZ2V0KCJ0eG5zX2gxIiwgMCkgb3IgMCkKICAgIHR4bnNfaDI0ID0gZmxvYXQodG9rZW4uZ2V0KCJ0eG5zX2gyNCIsIDApIG9yIDApCiAgICBhdmdfaG91cmx5ID0gdHhuc19oMjQgLyAyNC4wIGlmIHR4bnNfaDI0ID4gMCBlbHNlIDAuMAogICAgaGFzX3ZvbHVtZV9zcGlrZSA9IGF2Z19ob3VybHkgPiAwIGFuZCB0eG5zX2gxID49IExFR0FDWV9SRUNPVkVSWV9WT0xVTUVfU1BJS0VfTVVMVElQTElFUiAqIGF2Z19ob3VybHkKCiAgICAjIFJldmVyc2FsIHBhdHRlcm4gZGV0ZWN0aW9uCiAgICBwYXR0ZXJuX3NldHVwID0gdG9rZW4uZ2V0KCJwYXR0ZXJuX3NldHVwIikKICAgIGV4cGxpY2l0X3BhdHRlcm4gPSAiIgogICAgaWYgaXNpbnN0YW5jZShwYXR0ZXJuX3NldHVwLCBkaWN0KToKICAgICAgICBleHBsaWNpdF9wYXR0ZXJuID0gc3RyKHBhdHRlcm5fc2V0dXAuZ2V0KCJwYXR0ZXJuIiwgIiIpIG9yICIiKS5sb3dlcigpLnJlcGxhY2UoIiAiLCAiXyIpCiAgICBlbGlmIGlzaW5zdGFuY2UocGF0dGVybl9zZXR1cCwgc3RyKToKICAgICAgICBleHBsaWNpdF9wYXR0ZXJuID0gcGF0dGVybl9zZXR1cC5sb3dlcigpLnJlcGxhY2UoIiAiLCAiXyIpCgogICAgaGFzX3JldmVyc2FsX3BhdHRlcm4gPSBleHBsaWNpdF9wYXR0ZXJuIGluIF9SRVZFUlNBTF9QQVRURVJOUwoKICAgICMgSW5mZXIgcmV2ZXJzYWwgZnJvbSBwcmljZSBhY3Rpb24gd2hlbiBubyBleHBsaWNpdCBwYXR0ZXJuOgogICAgIyBBIGRlY2xpbmluZyAyNGggYnV0IHBvc2l0aXZlIG9yIHJlY292ZXJpbmcgMWggc3VnZ2VzdHMgcG90ZW50aWFsIHJldmVyc2FsIGJhc2UKICAgIGlmIG5vdCBoYXNfcmV2ZXJzYWxfcGF0dGVybjoKICAgICAgICBjaGFuZ2VfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkKICAgICAgICBjaGFuZ2VfMWggPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8xaCIsIDApIG9yIDApCiAgICAgICAgY2hhbmdlXzZoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfNmgiLCAwKSBvciAwKQogICAgICAgICMgRG91YmxlLWJvdHRvbSAvIGZhbGxpbmctd2VkZ2UgcHJveHk6IGNvaW4gd2FzIGRvd24gMjRoIGJ1dCAxaCBpcyByZWNvdmVyaW5nCiAgICAgICAgaWYgLTQwLjAgPCBjaGFuZ2VfMjRoIDwgLTUuMCBhbmQgY2hhbmdlXzFoID4gMS41OgogICAgICAgICAgICBoYXNfcmV2ZXJzYWxfcGF0dGVybiA9IFRydWUKICAgICAgICAgICAgZXhwbGljaXRfcGF0dGVybiA9ICJkb3VibGVfYm90dG9tIgogICAgICAgICMgQ3VwLWFuZC1oYW5kbGUgcHJveHk6IG1vZGVzdCAyNGggZGVjbGluZSBidXQgNmggYW5kIDFoIGJvdGggcmVjb3ZlcmluZwogICAgICAgIGVsaWYgLTIwLjAgPCBjaGFuZ2VfMjRoIDwgMCBhbmQgY2hhbmdlXzZoID4gMCBhbmQgY2hhbmdlXzFoID4gMC41OgogICAgICAgICAgICBoYXNfcmV2ZXJzYWxfcGF0dGVybiA9IFRydWUKICAgICAgICAgICAgZXhwbGljaXRfcGF0dGVybiA9ICJjdXBfaGFuZGxlIgoKICAgIGlmIG5vdCBoYXNfcmV2ZXJzYWxfcGF0dGVybjoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGlmIG5vdCBoYXNfdm9sdW1lX3NwaWtlOgogICAgICAgIHJldHVybiBOb25lCgogICAgIyBNYXAgaW50ZXJuYWwgcGF0dGVybiBrZXkgdG8gaHVtYW4gbGFiZWwKICAgIF9wYXR0ZXJuX2xhYmVscyA9IHsKICAgICAgICAiZmFsbGluZ193ZWRnZSI6ICJGYWxsaW5nIFdlZGdlIiwKICAgICAgICAiZG91YmxlX2JvdHRvbSI6ICJEb3VibGUgQm90dG9tIiwKICAgICAgICAiY3VwX2hhbmRsZSI6ICJDdXAgJiBIYW5kbGUiLAogICAgICAgICJjdXBfYW5kX2hhbmRsZSI6ICJDdXAgJiBIYW5kbGUiLAogICAgICAgICJyZXZlcnNhbCI6ICJSZXZlcnNhbCIsCiAgICB9CiAgICBwYXR0ZXJuX2xhYmVsID0gX3BhdHRlcm5fbGFiZWxzLmdldChleHBsaWNpdF9wYXR0ZXJuLCAiUmV2ZXJzYWwiKQogICAgcGF0dGVybl9zdGF0dXMgPSAiQ29uZmlybWVkIiBpZiB0eG5zX2gxID49IGF2Z19ob3VybHkgKiAzIGVsc2UgIkZvcm1pbmciCiAgICBhZ2VfZGF5cyA9IGFnZV9ob3VycyAvIDI0LjAKCiAgICByZXR1cm4gewogICAgICAgICoqdG9rZW4sCiAgICAgICAgImFnZV9kYXlzIjogYWdlX2RheXMsCiAgICAgICAgInBhdHRlcm5fbGFiZWwiOiBwYXR0ZXJuX2xhYmVsLAogICAgICAgICJwYXR0ZXJuX3N0YXR1cyI6IHBhdHRlcm5fc3RhdHVzLAogICAgfQoKCmRlZiBfbGVnYWN5X3JlY292ZXJ5X29uX2Nvb2xkb3duKHN5bWJvbDogc3RyKSAtPiBib29sOgogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gVHJ1ZQogICAgbGFzdF9zZW50ID0gZ2V0X2xhc3RfZGVjaXNpb25fdGltZXN0YW1wX2Zvcl9zeW1ib2woCiAgICAgICAgc3ltYm9sLAogICAgICAgIFsiTEVHQUNZX1JFQ09WRVJZX0FMRVJUIiwgIkxFR0FDWV9SRUNPVkVSWV9EUllfUlVOIl0sCiAgICApCiAgICBpZiBub3QgbGFzdF9zZW50OgogICAgICAgIHJldHVybiBGYWxzZQogICAgcmV0dXJuIChkYXRldGltZS51dGNub3coKSAtIGxhc3Rfc2VudCkgPCB0aW1lZGVsdGEoaG91cnM9TEVHQUNZX1JFQ09WRVJZX0NPT0xET1dOX0hPVVJTKQoKCmRlZiBfbG9hZF93YXRjaGxpc3Rfc3RhdGUoKToKICAgIGdsb2JhbCBfd2F0Y2hsaXN0X3N0YXRlCiAgICBpZiBub3QgX1dBVENITElTVF9TVEFURV9QQVRILmV4aXN0cygpOgogICAgICAgIF93YXRjaGxpc3Rfc3RhdGUgPSB7InN0YXR1c2VzIjoge319CiAgICAgICAgcmV0dXJuCiAgICB0cnk6CiAgICAgICAgcmF3ID0ganNvbi5sb2FkcyhfV0FUQ0hMSVNUX1NUQVRFX1BBVEgucmVhZF90ZXh0KCkpCiAgICAgICAgc3RhdHVzZXMgPSByYXcuZ2V0KCJzdGF0dXNlcyIpCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uoc3RhdHVzZXMsIGRpY3QpOgogICAgICAgICAgICBzdGF0dXNlcyA9IHt9CiAgICAgICAgX3dhdGNobGlzdF9zdGF0ZSA9IHsic3RhdHVzZXMiOiB7c3RyKGspLnVwcGVyKCk6IHN0cih2KSBmb3IgaywgdiBpbiBzdGF0dXNlcy5pdGVtcygpfX0KICAgIGV4Y2VwdCAoVmFsdWVFcnJvciwgT1NFcnJvcik6CiAgICAgICAgX3dhdGNobGlzdF9zdGF0ZSA9IHsic3RhdHVzZXMiOiB7fX0KCgpkZWYgX3NhdmVfd2F0Y2hsaXN0X3N0YXRlKCk6CiAgICB0cnk6CiAgICAgICAgX1dBVENITElTVF9TVEFURV9QQVRILnBhcmVudC5ta2RpcihwYXJlbnRzPVRydWUsIGV4aXN0X29rPVRydWUpCiAgICAgICAgX1dBVENITElTVF9TVEFURV9QQVRILndyaXRlX3RleHQoanNvbi5kdW1wcyhfd2F0Y2hsaXN0X3N0YXRlLCBpbmRlbnQ9MikpCiAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICBsb2dnaW5nLndhcm5pbmcoIkZhaWxlZCB0byBwZXJzaXN0IHdhdGNobGlzdCBzdGF0ZSBhdCAlcyIsIF9XQVRDSExJU1RfU1RBVEVfUEFUSCkKCgpkZWYgX3dhdGNobGlzdF9zdGF0dXNfZm9yX3Rva2VuKHRva2VuOiBkaWN0KToKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzFoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMWgiLCAwKSBvciAwKQogICAgY2hhbmdlXzZoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfNmgiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICB2b2xfdG9fbGlxID0gKHZvbHVtZV8yNGggLyBsaXF1aWRpdHkpIGlmIGxpcXVpZGl0eSA+IDAgZWxzZSAwLjAKCiAgICBpZiBsaXF1aWRpdHkgPCBXQVRDSExJU1RfTUlOX0xJUVVJRElUWSBvciB2b2x1bWVfMjRoIDwgV0FUQ0hMSVNUX01JTl9WT0xVTUVfMjRIOgogICAgICAgIHJldHVybiAiSWxsaXF1aWQiLCAoCiAgICAgICAgICAgIGYiTGlxdWlkaXR5L3ZvbHVtZSBiZWxvdyB3YXRjaCBmbG9vciAiCiAgICAgICAgICAgIGYiKCR7V0FUQ0hMSVNUX01JTl9MSVFVSURJVFk6LC4wZn0vJHtXQVRDSExJU1RfTUlOX1ZPTFVNRV8yNEg6LC4wZn0pLiIKICAgICAgICApCgogICAgaWYgY2hhbmdlXzI0aCA+PSAxMiBhbmQgY2hhbmdlXzZoID49IDQgYW5kIGNoYW5nZV8xaCA+PSAxIGFuZCB2b2xfdG9fbGlxID49IDAuMzU6CiAgICAgICAgcmV0dXJuICJNb21lbnR1bSIsICJNdWx0aS10aW1lZnJhbWUgc3RyZW5ndGggd2l0aCBzdXN0YWluZWQgdHVybm92ZXIuIgogICAgaWYgY2hhbmdlXzI0aCA+PSAyIGFuZCBjaGFuZ2VfNmggPD0gLTIgYW5kIGNoYW5nZV8xaCA+PSAwLjggYW5kIHZvbF90b19saXEgPj0gMC4yMDoKICAgICAgICByZXR1cm4gIlJlY2xhaW0iLCAiU2hvcnQtdGVybSByZWNsYWltIGFmdGVyIHB1bGxiYWNrOyBidXllcnMgc3RlcHBpbmcgYmFjayBpbi4iCiAgICBpZiBjaGFuZ2VfMWggPD0gLTIuNSBhbmQgY2hhbmdlXzZoIDw9IC02OgogICAgICAgIHJldHVybiAiQnJlYWtkb3duIiwgIkRvd25zaWRlIHByZXNzdXJlIGFjY2VsZXJhdGluZzsgc3RydWN0dXJlIGxpa2VseSB3ZWFrZW5pbmcuIgogICAgaWYgYWJzKGNoYW5nZV8xaCkgPD0gMS4yIGFuZCBhYnMoY2hhbmdlXzZoKSA8PSA0IGFuZCBhYnMoY2hhbmdlXzI0aCkgPD0gMTI6CiAgICAgICAgcmV0dXJuICJSYW5nZSIsICJSYW5nZS1ib3VuZCBjb25kaXRpb25zIHdpdGggbm8gY29uZmlybWVkIGJyZWFrLiIKICAgIHJldHVybiAiVm9sYXRpbGUiLCAiTWl4ZWQgdGFwZTsgbW9tZW50dW0gYW5kIG1lYW4tcmV2ZXJzaW9uIHNpZ25hbHMgY29uZmxpY3QuIgoKCmRlZiBfd2F0Y2hsaXN0X29wcG9ydHVuaXR5X3RhZ3ModG9rZW46IGRpY3QsIHN0YXR1czogc3RyKToKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzFoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMWgiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICB0eG5zX2gxID0gaW50KHRva2VuLmdldCgidHhuc19oMSIpIG9yIDApCiAgICB2b2xfdG9fbGlxID0gKHZvbHVtZV8yNGggLyBsaXF1aWRpdHkpIGlmIGxpcXVpZGl0eSA+IDAgZWxzZSAwLjAKCiAgICB1cHNpZGVfcG9pbnRzID0gMC4wCiAgICByaXNrX3BvaW50cyA9IDAuMAogICAgcyA9IHN0cihzdGF0dXMgb3IgIiIpLnRpdGxlKCkKCiAgICBpZiBzID09ICJNb21lbnR1bSI6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAyLjAKICAgIGVsaWYgcyA9PSAiUmVjbGFpbSI6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAxLjUKICAgIGVsaWYgcyA9PSAiQnJlYWtkb3duIjoKICAgICAgICByaXNrX3BvaW50cyArPSAyLjUKICAgIGVsaWYgcyA9PSAiSWxsaXF1aWQiOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDMuMAogICAgZWxpZiBzID09ICJWb2xhdGlsZSI6CiAgICAgICAgcmlza19wb2ludHMgKz0gMS41CgogICAgaWYgY2hhbmdlXzI0aCA+PSAxMjoKICAgICAgICB1cHNpZGVfcG9pbnRzICs9IDIuMAogICAgZWxpZiBjaGFuZ2VfMjRoID49IDU6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAxLjAKICAgIGVsaWYgY2hhbmdlXzI0aCA8PSAtMTA6CiAgICAgICAgcmlza19wb2ludHMgKz0gMS41CgogICAgaWYgY2hhbmdlXzFoID49IDEuMDoKICAgICAgICB1cHNpZGVfcG9pbnRzICs9IDEuMAogICAgZWxpZiBjaGFuZ2VfMWggPD0gLTIuMDoKICAgICAgICByaXNrX3BvaW50cyArPSAxLjIKCiAgICBpZiB0eG5zX2gxID49IDMwMDoKICAgICAgICB1cHNpZGVfcG9pbnRzICs9IDEuMAogICAgZWxpZiB0eG5zX2gxID49IDE1MDoKICAgICAgICB1cHNpZGVfcG9pbnRzICs9IDAuNQoKICAgIGlmIGxpcXVpZGl0eSA+PSA3NTBfMDAwOgogICAgICAgIHVwc2lkZV9wb2ludHMgKz0gMS4wCiAgICBlbGlmIGxpcXVpZGl0eSA8IDI1MF8wMDA6CiAgICAgICAgcmlza19wb2ludHMgKz0gMS4yCgogICAgaWYgdm9sdW1lXzI0aCA+PSAxXzUwMF8wMDA6CiAgICAgICAgdXBzaWRlX3BvaW50cyArPSAxLjAKCiAgICBpZiB2b2xfdG9fbGlxID4gMi4wOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuNQogICAgZWxpZiB2b2xfdG9fbGlxID4gMS4wOgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuMAoKICAgIGlmIGFicyhjaGFuZ2VfMjRoKSA+IDM1OgogICAgICAgIHJpc2tfcG9pbnRzICs9IDEuMAoKICAgIGlmIHVwc2lkZV9wb2ludHMgPj0gNS4wOgogICAgICAgIHVwc2lkZV9sYWJlbCA9ICJIaWdoIgogICAgZWxpZiB1cHNpZGVfcG9pbnRzID49IDMuMDoKICAgICAgICB1cHNpZGVfbGFiZWwgPSAiTWVkaXVtIgogICAgZWxzZToKICAgICAgICB1cHNpZGVfbGFiZWwgPSAiTG93IgoKICAgIGlmIHJpc2tfcG9pbnRzID49IDQuNToKICAgICAgICByaXNrX2xhYmVsID0gIkhpZ2giCiAgICBlbGlmIHJpc2tfcG9pbnRzID49IDIuNToKICAgICAgICByaXNrX2xhYmVsID0gIk1lZGl1bSIKICAgIGVsc2U6CiAgICAgICAgcmlza19sYWJlbCA9ICJMb3ciCgogICAgcmV0dXJuIHVwc2lkZV9sYWJlbCwgcmlza19sYWJlbAoKCmRlZiBfd2FsbGV0X2ZpdF9mb3JfbWFpbl90b2tlbih0b2tlbjogZGljdCwgcmVnaW1lOiBkaWN0LCBwb2xpY3k6IGRpY3QpIC0+IHN0cjoKICAgIHNjb3JlID0gZmxvYXQodG9rZW4uZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICBjb25maWRlbmNlID0gc3RyKHRva2VuLmdldCgiY29uZmlkZW5jZSIsICJDIikpLnVwcGVyKCkKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgY2hhbmdlXzI0aCA9IGFicyhmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKSkKICAgIHJlZ2ltZV9zY29yZSA9IGZsb2F0KHJlZ2ltZS5nZXQoInNjb3JlIiwgMCkgb3IgMCkKICAgIHN0YXRlID0gc3RyKHBvbGljeS5nZXQoInN0YXRlIikgb3IgIiIpCgogICAgaWYgKAogICAgICAgIGNvbmZpZGVuY2UgPT0gIkEiCiAgICAgICAgYW5kIHNjb3JlID49IG1heCg4OC4wLCBmbG9hdChwb2xpY3kuZ2V0KCJhbGVydF90aHJlc2hvbGQiLCA3MCkpICsgNi4wKQogICAgICAgIGFuZCBsaXF1aWRpdHkgPj0gMl8wMDBfMDAwCiAgICAgICAgYW5kIHZvbHVtZV8yNGggPj0gMV8yMDBfMDAwCiAgICAgICAgYW5kIGNoYW5nZV8yNGggPD0gMjUKICAgICAgICBhbmQgcmVnaW1lX3Njb3JlID49IDU1CiAgICAgICAgYW5kIHN0YXRlIGluIHsiUklTS19PTiIsICJORVVUUkFMIn0KICAgICk6CiAgICAgICAgcmV0dXJuICJXMS9XMiIKCiAgICBpZiAoCiAgICAgICAgX2NvbmZpZGVuY2VfbWVldHNfcnVsZShjb25maWRlbmNlLCAiQSIpCiAgICAgICAgYW5kIHNjb3JlID49IGZsb2F0KHBvbGljeS5nZXQoImFsZXJ0X3RocmVzaG9sZCIsIDcwKSkKICAgICAgICBhbmQgbGlxdWlkaXR5ID49IDcwMF8wMDAKICAgICAgICBhbmQgdm9sdW1lXzI0aCA+PSAyNTBfMDAwCiAgICApOgogICAgICAgIHJldHVybiAiVzIiCgogICAgcmV0dXJuICJXMyIKCgpkZWYgX3dhbGxldF9ndWlkYW5jZSh3YWxsZXRfZml0OiBzdHIpOgogICAgZml0ID0gc3RyKHdhbGxldF9maXQgb3IgIlcyIikudXBwZXIoKQogICAgaWYgZml0ID09ICJXMS9XMiI6CiAgICAgICAgcmlzayA9ICJUaWVyZWQgZW50cmllcyB8IGF2b2lkIGNoYXNpbmcgPjE1JSBjYW5kbGVzIHwgdGhlc2lzIHN0b3Agb25seSIKICAgICAgICByb3RhdGlvbiA9ICJUYWtlIHBhcnRpYWxzIGludG8gVzEgc3Rha2luZy9VU0RDIHdoaWxlIHByZXNlcnZpbmcgY29yZSIKICAgICAgICByZXR1cm4gcmlzaywgcm90YXRpb24KICAgIGlmIGZpdCA9PSAiVzIiOgogICAgICAgIHBiID0gX1dBTExFVF9QTEFZQk9PS1siVzIiXQogICAgICAgIHJldHVybiBwYlsicmlza19wbGFuIl0sIHBiWyJyb3RhdGlvbl9wbGFuIl0KICAgIHBiID0gX1dBTExFVF9QTEFZQk9PS1siVzMiXQogICAgcmV0dXJuIHBiWyJyaXNrX3BsYW4iXSwgcGJbInJvdGF0aW9uX3BsYW4iXQoKCmRlZiBfd2FsbGV0X2hlYWRlcih3YWxsZXRfaWQ6IHN0cikgLT4gc3RyOgogICAgcGIgPSBfV0FMTEVUX1BMQVlCT09LLmdldCh3YWxsZXRfaWQsIF9XQUxMRVRfUExBWUJPT0tbIlcyIl0pCiAgICByZXR1cm4gKAogICAgICAgIGYie3dhbGxldF9pZH0gfCB7cGJbJ25hbWUnXX1cbiIKICAgICAgICBmIlBvc2l0aW9uOiB7cGJbJ3Bvc2l0aW9uX2hpbnQnXX1cbiIKICAgICAgICBmIlJpc2s6IHtwYlsncmlza19wbGFuJ119XG4iCiAgICAgICAgZiJSb3RhdGlvbjoge3BiWydyb3RhdGlvbl9wbGFuJ119IgogICAgKQoKCmRlZiBfd2F0Y2hsaXN0X29uX2Nvb2xkb3duKHN5bWJvbDogc3RyKSAtPiBib29sOgogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIGxhc3Rfc2VudCA9IGdldF9sYXN0X2RlY2lzaW9uX3RpbWVzdGFtcF9mb3Jfc3ltYm9sKAogICAgICAgIHN5bWJvbCwKICAgICAgICBbIldBVENITElTVF9BTEVSVCIsICJXQVRDSExJU1RfQUxFUlRfRFJZX1JVTiJdLAogICAgKQogICAgaWYgbm90IGxhc3Rfc2VudDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiAoZGF0ZXRpbWUudXRjbm93KCkgLSBsYXN0X3NlbnQpIDwgdGltZWRlbHRhKGhvdXJzPVdBVENITElTVF9BTEVSVF9DT09MRE9XTl9IT1VSUykKCgpkZWYgX2J1aWxkX3dhdGNobGlzdF9yb3dzKCk6CiAgICBpbXBvcnQgdGltZSBhcyBfdGltZQogICAgcm93cyA9IFtdCiAgICBpZiBub3QgV0FUQ0hMSVNUX0VOVFJJRVM6CiAgICAgICAgcmV0dXJuIHJvd3MKCiAgICBmb3IgZW50cnkgaW4gV0FUQ0hMSVNUX0VOVFJJRVM6CiAgICAgICAgY29uZmlndXJlZF9zeW1ib2wgPSBzdHIoZW50cnkuZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgICAgIGFkZHJlc3MgPSBzdHIoZW50cnkuZ2V0KCJhZGRyZXNzIikgb3IgIiIpLnN0cmlwKCkKICAgICAgICBpZiBub3QgYWRkcmVzczoKICAgICAgICAgICAgY29udGludWUKICAgICAgICBzeW1ib2wgPSBjb25maWd1cmVkX3N5bWJvbCBvciAiVU5LTk9XTiIKICAgICAgICBwcmV2aW91c19zdGF0dXMgPSBzdHIoX3dhdGNobGlzdF9zdGF0ZS5nZXQoInN0YXR1c2VzIiwge30pLmdldChzeW1ib2wpIG9yICIiKQoKICAgICAgICBfdGltZS5zbGVlcCgwLjM1KQogICAgICAgIHNuYXBzaG90ID0gZmV0Y2hfZGV4c2NyZWVuZXJfdG9rZW5fc25hcHNob3QoYWRkcmVzcykKICAgICAgICBpZiBub3Qgc25hcHNob3Q6CiAgICAgICAgICAgIHJpc2tfcGxhbiwgcm90YXRpb25fcGxhbiA9IF93YWxsZXRfZ3VpZGFuY2UoIlczIikKICAgICAgICAgICAgcm93cy5hcHBlbmQoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAiYWRkcmVzcyI6IGFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyI6IHByZXZpb3VzX3N0YXR1cyBvciAiTm9EYXRhIiwKICAgICAgICAgICAgICAgICAgICAicmVhc29uIjogKAogICAgICAgICAgICAgICAgICAgICAgICAiTGl2ZSBkYXRhIHVuYXZhaWxhYmxlOyBzaG93aW5nIGxhc3Qga25vd24gc3RhdHVzLiIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcHJldmlvdXNfc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgIk5vIGxpdmUgRGV4U2NyZWVuZXIgcGFpciBmb3VuZC4iCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAiZWxpZ2libGUiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiaGFzX2xpdmVfZGF0YSI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJ3YWxsZXRfZml0IjogIlczIiwKICAgICAgICAgICAgICAgICAgICAicmlza19wbGFuIjogcmlza19wbGFuLAogICAgICAgICAgICAgICAgICAgICJyb3RhdGlvbl9wbGFuIjogcm90YXRpb25fcGxhbiwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICByb3cgPSBkaWN0KHNuYXBzaG90KQogICAgICAgIGlmIGNvbmZpZ3VyZWRfc3ltYm9sIGFuZCBjb25maWd1cmVkX3N5bWJvbCAhPSAiV0FUQ0giOgogICAgICAgICAgICByb3dbInN5bWJvbCJdID0gY29uZmlndXJlZF9zeW1ib2wKICAgICAgICBzdGF0dXMsIHJlYXNvbiA9IF93YXRjaGxpc3Rfc3RhdHVzX2Zvcl90b2tlbihyb3cpCiAgICAgICAgdXBzaWRlLCByaXNrID0gX3dhdGNobGlzdF9vcHBvcnR1bml0eV90YWdzKHJvdywgc3RhdHVzKQogICAgICAgIHJvd1sic3RhdHVzIl0gPSBzdGF0dXMKICAgICAgICByb3dbInJlYXNvbiJdID0gcmVhc29uCiAgICAgICAgcm93WyJ1cHNpZGVfcG90ZW50aWFsIl0gPSB1cHNpZGUKICAgICAgICByb3dbImZhaWx1cmVfcmlzayJdID0gcmlzawogICAgICAgIHJvd1siZWxpZ2libGUiXSA9IHN0YXR1cyAhPSAiSWxsaXF1aWQiCiAgICAgICAgcm93WyJoYXNfbGl2ZV9kYXRhIl0gPSBUcnVlCiAgICAgICAgcm93WyJ3YWxsZXRfZml0Il0gPSAiVzMiCiAgICAgICAgcmlza19wbGFuLCByb3RhdGlvbl9wbGFuID0gX3dhbGxldF9ndWlkYW5jZSgiVzMiKQogICAgICAgIHJvd1sicmlza19wbGFuIl0gPSByaXNrX3BsYW4KICAgICAgICByb3dbInJvdGF0aW9uX3BsYW4iXSA9IHJvdGF0aW9uX3BsYW4KICAgICAgICByb3dzLmFwcGVuZChyb3cpCgogICAgcmV0dXJuIHJvd3MKCgphc3luYyBkZWYgc2VuZF93YXRjaGxpc3Rfc3VtbWFyeShjb250ZXh0KToKICAgIHJvd3MgPSBfYnVpbGRfd2F0Y2hsaXN0X3Jvd3MoKQogICAgaWYgbm90IHJvd3M6CiAgICAgICAgcmV0dXJuCiAgICBtZXNzYWdlID0gZm9ybWF0X3dhdGNobGlzdF9zdW1tYXJ5KHJvd3MpCiAgICBpZiBEUllfUlVOOgogICAgICAgIGxvZ2dpbmcuaW5mbygiRFJZX1JVTiBlbmFibGVkLiBXYXRjaGxpc3Qgc3VtbWFyeSBub3Qgc2VudC5cbiVzIiwgbWVzc2FnZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICBjaGF0X2lkPWludChURUxFR1JBTV9DSEFUX0lEKSwKICAgICAgICB0ZXh0PW1lc3NhZ2UsCiAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICApCiAgICBsb2dfc2lnbmFsKAogICAgICAgIHsKICAgICAgICAgICAgInN5bWJvbCI6ICJXQVRDSExJU1QiLAogICAgICAgICAgICAiZGVjaXNpb24iOiAiV0FUQ0hMSVNUX1NVTU1BUlkiLAogICAgICAgICAgICAibm90ZXMiOiBmInJvd3M9e2xlbihyb3dzKX0iLAogICAgICAgIH0KICAgICkKCgphc3luYyBkZWYgcnVuX3dhdGNobGlzdF9sYW5lKGNvbnRleHQpOgogICAgaWYgbm90IFdBVENITElTVF9MQU5FX0VOQUJMRUQgb3Igbm90IFdBVENITElTVF9FTlRSSUVTOgogICAgICAgIHJldHVybgogICAgdHJ5OgogICAgICAgIHByaW50KCJSdW5uaW5nIHdhdGNobGlzdCBsYW5lIHNjYW4uLi4iKQogICAgICAgIHJvd3MgPSBfYnVpbGRfd2F0Y2hsaXN0X3Jvd3MoKQogICAgICAgIGlmIG5vdCByb3dzOgogICAgICAgICAgICBwcmludCgiV2F0Y2hsaXN0IGxhbmU6IG5vIHJvd3MuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHJvd3Muc29ydCgKICAgICAgICAgICAga2V5PWxhbWJkYSByOiAoCiAgICAgICAgICAgICAgICBzdHIoci5nZXQoInN0YXR1cyIsICIiKSkgbm90IGluIHNldChXQVRDSExJU1RfQUxFUlRfU1RBVFVTRVMpLAogICAgICAgICAgICAgICAgLShmbG9hdChyLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApKSwKICAgICAgICAgICAgKQogICAgICAgICkKCiAgICAgICAgYWxlcnRzX3NlbnQgPSAwCiAgICAgICAgbWF4X3Blcl9jeWNsZSA9IG1heCgxLCBXQVRDSExJU1RfTUFYX0FMRVJUU19QRVJfQ1lDTEUpCiAgICAgICAgbm9fZGF0YV9jb3VudCA9IDAKCiAgICAgICAgZm9yIHJvdyBpbiByb3dzOgogICAgICAgICAgICBzeW1ib2wgPSBzdHIocm93LmdldCgic3ltYm9sIikgb3IgIlVOS05PV04iKS51cHBlcigpCiAgICAgICAgICAgIHN0YXR1cyA9IHN0cihyb3cuZ2V0KCJzdGF0dXMiKSBvciAiVW5rbm93biIpLnRpdGxlKCkKICAgICAgICAgICAgaGFzX2xpdmVfZGF0YSA9IGJvb2wocm93LmdldCgiaGFzX2xpdmVfZGF0YSIsIFRydWUpKQogICAgICAgICAgICBpZiBub3QgaGFzX2xpdmVfZGF0YToKICAgICAgICAgICAgICAgIG5vX2RhdGFfY291bnQgKz0gMQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgcHJldmlvdXNfc3RhdHVzID0gc3RyKF93YXRjaGxpc3Rfc3RhdGUuZ2V0KCJzdGF0dXNlcyIsIHt9KS5nZXQoc3ltYm9sKSBvciAiIikKICAgICAgICAgICAgY2hhbmdlZCA9IHByZXZpb3VzX3N0YXR1cyAhPSBzdGF0dXMKICAgICAgICAgICAgX3dhdGNobGlzdF9zdGF0ZS5zZXRkZWZhdWx0KCJzdGF0dXNlcyIsIHt9KVtzeW1ib2xdID0gc3RhdHVzCgogICAgICAgICAgICBpZiBzdGF0dXMgbm90IGluIFdBVENITElTVF9BTEVSVF9TVEFUVVNFUzoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIG5vdCByb3cuZ2V0KCJlbGlnaWJsZSIsIEZhbHNlKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIFdBVENITElTVF9BTEVSVF9PTl9TVEFUVVNfQ0hBTkdFIGFuZCBub3QgY2hhbmdlZDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIF93YXRjaGxpc3Rfb25fY29vbGRvd24oc3ltYm9sKToKICAgICAgICAgICAgICAgIGxvZ19zaWduYWwoCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICAibWludCI6IHJvdy5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIldBVENITElTVF9DT09MRE9XTl9TS0lQIiwKICAgICAgICAgICAgICAgICAgICAgICAgIm5vdGVzIjogZiJzdGF0dXM9e3N0YXR1c30gY29vbGRvd25faD17V0FUQ0hMSVNUX0FMRVJUX0NPT0xET1dOX0hPVVJTfSIsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgYWxlcnRzX3NlbnQgPj0gbWF4X3Blcl9jeWNsZToKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICBtc2cgPSBmb3JtYXRfd2F0Y2hsaXN0X3NpZ25hbChyb3csIGNvbXBhY3Q9VHJ1ZSkKICAgICAgICAgICAgZGVjaXNpb24gPSAiV0FUQ0hMSVNUX0FMRVJUIgogICAgICAgICAgICBpZiBEUllfUlVOOgogICAgICAgICAgICAgICAgZGVjaXNpb24gPSAiV0FUQ0hMSVNUX0FMRVJUX0RSWV9SVU4iCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gV2F0Y2hsaXN0IGFsZXJ0IHN1cHByZXNzZWQgZm9yICVzIiwgc3ltYm9sKQogICAgICAgICAgICBlbGlmIFRFTEVHUkFNX1FVSUVUX01PREUgYW5kIGNvbnRleHQuam9iIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgZGVjaXNpb24gPSAiV0FUQ0hMSVNUX0FMRVJUX1FVSUVUX01PREUiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgICAgICAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPV9idWlsZF9hbGVydF9rZXlib2FyZCgKICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICByb3cuZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5nZXQoInBhaXJfYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiByb3cuZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgInBhaXJfYWRkcmVzcyI6IHJvdy5nZXQoInBhaXJfYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJsaXF1aWRpdHkiOiByb3cuZ2V0KCJsaXF1aWRpdHkiKSwKICAgICAgICAgICAgICAgICAgICAidm9sdW1lXzI0aCI6IHJvdy5nZXQoInZvbHVtZV8yNGgiKSwKICAgICAgICAgICAgICAgICAgICAicHJpY2UiOiByb3cuZ2V0KCJwcmljZSIpLAogICAgICAgICAgICAgICAgICAgICJjaGFuZ2VfMjRoIjogcm93LmdldCgiY2hhbmdlXzI0aCIpLAogICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6IGRlY2lzaW9uLAogICAgICAgICAgICAgICAgICAgICJub3RlcyI6IGYic3RhdHVzPXtzdGF0dXN9IHJlYXNvbj17cm93LmdldCgncmVhc29uJywgJycpfSIsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgYWxlcnRzX3NlbnQgKz0gMQoKICAgICAgICBfc2F2ZV93YXRjaGxpc3Rfc3RhdGUoKQogICAgICAgIGlmIG5vX2RhdGFfY291bnQ6CiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiV2F0Y2hsaXN0IGxhbmU6IGxpdmUgZGF0YSB1bmF2YWlsYWJsZSBmb3IgJWQgdG9rZW4ocykgdGhpcyBjeWNsZS4iLCBub19kYXRhX2NvdW50KQogICAgICAgIGlmIGFsZXJ0c19zZW50ID09IDA6CiAgICAgICAgICAgIHByaW50KCJXYXRjaGxpc3QgbGFuZTogbm8gc3RhdHVzLWNoYW5nZSBhbGVydHMgdGhpcyBjeWNsZS4iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGM6CiAgICAgICAgcHJpbnQoIldBVENITElTVCBMQU5FIEVSUk9SOiIsIHJlcHIoZXhjKSkKCgpkZWYgX2Zvcm1hdF9kYWlseV9zdW1tYXJ5KHN1bW1hcnksIG91dGNvbWVfcmVjYXA9Tm9uZSk6CiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgdG9wX3N5bWJvbHMgPSBzdW1tYXJ5LmdldCgidG9wX2FsZXJ0X3N5bWJvbHMiLCBbXSkKICAgIHRvcF9saW5lID0gIiwgIi5qb2luKGYiJHtyb3dbJ3N5bWJvbCddfSh7cm93WydhbGVydHMnXX0pIiBmb3Igcm93IGluIHRvcF9zeW1ib2xzKSBpZiB0b3Bfc3ltYm9scyBlbHNlICJOb25lIgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5OFIFtTSUdOQUxdOiBEQUlMWSBTVU1NQVJZPC9iPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+VkCBXSU5ET1c6IDI0SDwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+UjSBTQ0FOUzoge19lc2NfaHRtbF9tYWluKHN0cihzdW1tYXJ5WydzY2FucyddKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5qoIEFMRVJUUzoge19lc2NfaHRtbF9tYWluKHN0cihzdW1tYXJ5WydhbGVydHMnXSkpfSAoe3N1bW1hcnlbJ2FsZXJ0X3JhdGUnXTouMWZ9JSByYXRlKTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+4q2QIEFWRyBTQ09SRToge3N1bW1hcnlbJ2F2Z19zY29yZSddOi4yZn0gfCBNQVg6IHtzdW1tYXJ5WydtYXhfc2NvcmUnXTouMmZ9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn4+GIFRPUDoge19lc2NfaHRtbF9tYWluKHRvcF9saW5lKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OLIFJFQ0FQICgyNEgpPC9jb2RlPiIsCiAgICBdCiAgICByZWNhcF9yb3dzID0gb3V0Y29tZV9yZWNhcCBvciBbXQogICAgaWYgcmVjYXBfcm93czoKICAgICAgICBmb3IgaWR4LCByb3cgaW4gZW51bWVyYXRlKHJlY2FwX3Jvd3NbOjZdLCBzdGFydD0xKToKICAgICAgICAgICAgc3ltYm9sID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgICAgICBhbGVydHMgPSBpbnQocm93LmdldCgiYWxlcnRzIikgb3IgMCkKICAgICAgICAgICAgYXZnXzRoID0gcm93LmdldCgiYXZnXzRoIikKICAgICAgICAgICAgbl80aCA9IGludChyb3cuZ2V0KCJuXzRoIikgb3IgMCkKICAgICAgICAgICAgd2luc180aCA9IGludChyb3cuZ2V0KCJ3aW5zXzRoIikgb3IgMCkKICAgICAgICAgICAgYXZnXzRoX3RleHQgPSBmIntmbG9hdChhdmdfNGgpOisuMmZ9JSIgaWYgYXZnXzRoIGlzIG5vdCBOb25lIGVsc2UgIk4vQSIKICAgICAgICAgICAgd2luX3JhdGVfdGV4dCA9IGYieyh3aW5zXzRoIC8gbl80aCAqIDEwMC4wKTouMGZ9JSIgaWYgbl80aCA+IDAgZWxzZSAiTi9BIgogICAgICAgICAgICByZXN1bHRfZW1vamkgPSAi4pyFIiBpZiBhdmdfNGggaXMgbm90IE5vbmUgYW5kIGZsb2F0KGF2Z180aCkgPiAwIGVsc2UgIuKdjCIKICAgICAgICAgICAgbGluZXMuYXBwZW5kKAogICAgICAgICAgICAgICAgZiI8Y29kZT57cmVzdWx0X2Vtb2ppfSB7aWR4fS4gJHtfZXNjX2h0bWxfbWFpbihzeW1ib2wpfSB8IHthbGVydHN9IGFsZXJ0cyB8IDRoIHtfZXNjX2h0bWxfbWFpbihhdmdfNGhfdGV4dCl9IHwgd2luIHtfZXNjX2h0bWxfbWFpbih3aW5fcmF0ZV90ZXh0KX0gKHt3aW5zXzRofS97bl80aH0pPC9jb2RlPiIKICAgICAgICAgICAgKQogICAgZWxzZToKICAgICAgICBsaW5lcy5hcHBlbmQoZiI8Y29kZT7imqogTm8gZXZhbHVhdGVkIG91dGNvbWVzIHlldC48L2NvZGU+IikKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIF9mb3JtYXRfd2Vla2x5X3R1bmluZ19yZXBvcnQocmVwb3J0KToKICAgIHNlcCA9ICLilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEiCiAgICBjdXJyZW50ID0gcmVwb3J0WyJjdXJyZW50Il0KICAgIHJlY29tbWVuZGVkID0gcmVwb3J0WyJyZWNvbW1lbmRlZCJdCiAgICByZWFzb25zID0gW3N0cihyKSBmb3IgciBpbiByZXBvcnRbInJlYXNvbnMiXV0KICAgIHBmID0gcmVwb3J0LmdldCgicG9ydGZvbGlvXzRoIiwge30pCiAgICBvcHRpbWl6ZXIgPSByZXBvcnQuZ2V0KCJvcHRpbWl6ZXIiKQoKICAgIGUgPSBfZXNjX2h0bWxfbWFpbgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5OKIFtTSUdOQUxdOiBXRUVLTFkgVFVOSU5HPC9iPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+VkCBXSU5ET1c6IDdEPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5SNIFNDQU5TOiB7ZShzdHIocmVwb3J0WydzY2FuX3J1bnMnXSkpfSB8IEJFU1Q6IHtlKHN0cihyZXBvcnRbJ3NjYW5fYmVzdCddKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5qoIEFMRVJUUzoge2Uoc3RyKHJlcG9ydFsnYWxlcnRzJ10pKX0gKHtyZXBvcnRbJ2FsZXJ0X3JhdGUnXTouMWZ9JSByYXRlKSB8IEJMT0NLOiB7cmVwb3J0WydibG9ja19yYXRlJ106LjFmfSU8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKtkCBTQ09SRVMgUDUwLzc1LzkwOiB7cmVwb3J0WydwNTBfc2NvcmUnXTouMGZ9L3tyZXBvcnRbJ3A3NV9zY29yZSddOi4wZn0ve3JlcG9ydFsncDkwX3Njb3JlJ106LjBmfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk4ggRURHRTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+ICAxSDogIHtyZXBvcnRbJ2F2Z19yZXR1cm5fMWgnXTorLjJmfSUgfCB3aW4ge3JlcG9ydFsnd2lucmF0ZV8xaCddOi4wZn0lIHwgbj17cmVwb3J0WydvdXRjb21lc18xaF9jb3VudCddfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+ICA0SDogIHtyZXBvcnRbJ2F2Z19yZXR1cm5fNGgnXTorLjJmfSUgfCB3aW4ge3JlcG9ydFsnd2lucmF0ZV80aCddOi4wZn0lIHwgbj17cmVwb3J0WydvdXRjb21lc180aF9jb3VudCddfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+ICAyNEg6IHtyZXBvcnRbJ2F2Z19yZXR1cm5fMjRoJ106Ky4yZn0lIHwgd2luIHtyZXBvcnRbJ3dpbnJhdGVfMjRoJ106LjBmfSUgfCBuPXtyZXBvcnRbJ291dGNvbWVzXzI0aF9jb3VudCddfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+nriBTSU0gNEg6IHtwZi5nZXQoJ3RyYWRlcycsIDApfSB0cmFkZXMgfCBleHAge3BmLmdldCgnZXhwZWN0YW5jeV9wY3QnLCAwKTouMmZ9JSB8IEREIHtwZi5nZXQoJ21heF9kcmF3ZG93bl9wY3QnLCAwKTouMmZ9JTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKame+4jyBTRVRUSU5HUzwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+ICBDVVJSRU5UIOKGkiB0aHIge2Uoc3RyKGN1cnJlbnRbJ2FsZXJ0X3RocmVzaG9sZCddKSl9IHwgcmVnIHtlKHN0cihjdXJyZW50WydyZWdpbWVfbWluX3Njb3JlJ10pKX0gfCBjb25mIHtlKHN0cihjdXJyZW50WydtaW5fY29uZmlkZW5jZV90b19hbGVydCddKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT4gIE5FVyAgICAg4oaSIHRociB7ZShzdHIocmVjb21tZW5kZWRbJ2FsZXJ0X3RocmVzaG9sZCddKSl9IHwgcmVnIHtlKHN0cihyZWNvbW1lbmRlZFsncmVnaW1lX21pbl9zY29yZSddKSl9IHwgY29uZiB7ZShzdHIocmVjb21tZW5kZWRbJ21pbl9jb25maWRlbmNlX3RvX2FsZXJ0J10pKX08L2NvZGU+IiwKICAgIF0KICAgIGlmIG9wdGltaXplcjoKICAgICAgICBsaW5lcy5hcHBlbmQoCiAgICAgICAgICAgIGYiPGNvZGU+8J+UpyBPUFQ6IHRociB7ZShzdHIob3B0aW1pemVyWydhbGVydF90aHJlc2hvbGQnXSkpfSByZWcge2Uoc3RyKG9wdGltaXplclsncmVnaW1lX21pbl9zY29yZSddKSl9IGNvbmYge2Uoc3RyKG9wdGltaXplclsnbWluX2NvbmZpZGVuY2VfdG9fYWxlcnQnXSkpfSBuPXtlKHN0cihvcHRpbWl6ZXJbJ3NhbXBsZXMnXSkpfTwvY29kZT4iCiAgICAgICAgKQogICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+e3NlcH08L2NvZGU+IikKICAgIGxpbmVzLmFwcGVuZChmIjxjb2RlPvCfk50gUkFUSU9OQUxFPC9jb2RlPiIpCiAgICBmb3IgcmVhc29uIGluIChyZWFzb25zWzo0XSBpZiByZWFzb25zIGVsc2UgWyJObyByYXRpb25hbGUgYXZhaWxhYmxlIl0pOgogICAgICAgIGxpbmVzLmFwcGVuZChmIjxjb2RlPiAg4oCiIHtlKHJlYXNvbil9PC9jb2RlPiIpCiAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKQoKCmFzeW5jIGRlZiBzZW5kX2RhaWx5X3N1bW1hcnkoY29udGV4dCk6CiAgICBzdW1tYXJ5ID0gZ2V0X3BlcmZvcm1hbmNlX3N1bW1hcnkobG9va2JhY2tfaG91cnM9MjQpCiAgICByZWNhcCA9IGdldF9hbGVydF9vdXRjb21lX3JlY2FwKGxvb2tiYWNrX2hvdXJzPTI0LCBsaW1pdD04KQogICAgbWVzc2FnZSA9IF9mb3JtYXRfZGFpbHlfc3VtbWFyeShzdW1tYXJ5LCBvdXRjb21lX3JlY2FwPXJlY2FwKQogICAgaWYgRFJZX1JVTjoKICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gRGFpbHkgc3VtbWFyeSBub3Qgc2VudC5cbiVzIiwgbWVzc2FnZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICBjaGF0X2lkPWludChURUxFR1JBTV9DSEFUX0lEKSwKICAgICAgICB0ZXh0PW1lc3NhZ2UsCiAgICAgICAgcGFyc2VfbW9kZT0iSFRNTCIsCiAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICApCgoKYXN5bmMgZGVmIHNlbmRfd2Vla2x5X3R1bmluZ19yZXBvcnQoY29udGV4dCk6CiAgICByZXBvcnQgPSBnZXRfd2Vla2x5X3R1bmluZ19yZXBvcnQoCiAgICAgICAgbG9va2JhY2tfZGF5cz1XRUVLTFlfVFVOSU5HX0xPT0tCQUNLX0RBWVMsCiAgICAgICAgY3VycmVudF9hbGVydF90aHJlc2hvbGQ9QUxFUlRfVEhSRVNIT0xELAogICAgICAgIGN1cnJlbnRfcmVnaW1lX21pbl9zY29yZT1SRUdJTUVfTUlOX1NDT1JFLAogICAgICAgIGN1cnJlbnRfbWluX2NvbmZpZGVuY2VfdG9fYWxlcnQ9TUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQsCiAgICAgICAgbWluX291dGNvbWVzXzRoPVdFRUtMWV9UVU5JTkdfTUlOX09VVENPTUVTXzRILAogICAgKQogICAgbWVzc2FnZSA9IF9mb3JtYXRfd2Vla2x5X3R1bmluZ19yZXBvcnQocmVwb3J0KQogICAgaWYgRFJZX1JVTjoKICAgICAgICBsb2dnaW5nLmluZm8oIkRSWV9SVU4gZW5hYmxlZC4gV2Vla2x5IHR1bmluZyByZXBvcnQgbm90IHNlbnQuXG4lcyIsIG1lc3NhZ2UpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoCiAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgdGV4dD1tZXNzYWdlLAogICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgKQoKCmRlZiBfdXBkYXRlX3N5bWJvbF9jb250cm9sX2Zyb21fb3V0Y29tZXMoc3ltYm9sOiBzdHIpOgogICAgaWYgbm90IFNZTUJPTF9DT05UUk9MX0VOQUJMRUQgb3Igbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4KICAgIHN0YXRzID0gZ2V0X3N5bWJvbF9vdXRjb21lX3N0YXRzKHN5bWJvbCwgbG9va2JhY2tfZGF5cz0zMCkKICAgIHJldHVybnNfNGggPSBzdGF0cy5nZXQoInJldHVybnNfNGgiLCBbXSkKICAgIHJldHVybnNfMjRoID0gc3RhdHMuZ2V0KCJyZXR1cm5zXzI0aCIsIFtdKQogICAgYXZnXzI0aCA9IGZsb2F0KHN0YXRzLmdldCgiYXZnXzI0aCIsIDApIG9yIDApCgogICAgaWYgbGVuKHJldHVybnNfMjRoKSA+PSBTWU1CT0xfQkxBQ0tMSVNUX01JTl9TQU1QTEVTIGFuZCBhdmdfMjRoIDw9IFNZTUJPTF9CTEFDS0xJU1RfQVZHXzI0SF9QQ1Q6CiAgICAgICAgc2V0X3N5bWJvbF9jb250cm9sKAogICAgICAgICAgICBzeW1ib2w9c3ltYm9sLAogICAgICAgICAgICBjb250cm9sX3R5cGU9IkJMQUNLTElTVCIsCiAgICAgICAgICAgIGhvdXJzPVNZTUJPTF9CTEFDS0xJU1RfSE9VUlMsCiAgICAgICAgICAgIHJlYXNvbj1mIjI0aCBhdmcge2F2Z18yNGg6LjJmfSUgPD0ge1NZTUJPTF9CTEFDS0xJU1RfQVZHXzI0SF9QQ1Q6LjJmfSUiLAogICAgICAgICkKICAgICAgICByZXR1cm4KCiAgICB0cmlnZ2VyID0gbWF4KDEsIFNZTUJPTF9MT1NTX1NUUkVBS19UUklHR0VSKQogICAgaWYgbGVuKHJldHVybnNfNGgpID49IHRyaWdnZXIgYW5kIGFsbChyZXQgPCAwIGZvciByZXQgaW4gcmV0dXJuc180aFs6dHJpZ2dlcl0pOgogICAgICAgIHNldF9zeW1ib2xfY29udHJvbCgKICAgICAgICAgICAgc3ltYm9sPXN5bWJvbCwKICAgICAgICAgICAgY29udHJvbF90eXBlPSJDT09MRE9XTiIsCiAgICAgICAgICAgIGhvdXJzPVNZTUJPTF9DT09MRE9XTl9IT1VSUywKICAgICAgICAgICAgcmVhc29uPWYie3RyaWdnZXJ9IGNvbnNlY3V0aXZlIG5lZ2F0aXZlIDRoIG91dGNvbWVzIiwKICAgICAgICApCgoKYXN5bmMgZGVmIHJ1bl9vdXRjb21lX2V2YWx1YXRvcihjb250ZXh0KToKICAgIGlmIG5vdCBPVVRDT01FX1RSQUNLSU5HX0VOQUJMRUQ6CiAgICAgICAgcmV0dXJuCgogICAgcm93cyA9IGdldF9wZW5kaW5nX2FsZXJ0X291dGNvbWVzKGxpbWl0PU9VVENPTUVfRVZBTF9CQVRDSF9TSVpFKQogICAgaWYgbm90IHJvd3M6CiAgICAgICAgcmV0dXJuCgogICAgIyBPUFRJTUlaQVRJT046IEZldGNoIG1hcmtldCBkYXRhIG9uY2UgaW5zdGVhZCBvZiBwZXItdG9rZW4gQVBJIGNhbGxzCiAgICAjIFRoaXMgZHJhbWF0aWNhbGx5IHJlZHVjZXMgQmlyZEV5ZSBBUEkgcHJlc3N1cmUKICAgIG1hcmtldF90b2tlbnMgPSBmZXRjaF9tYXJrZXRfZGF0YSgpIG9yIFtdCiAgICBwcmljZV9ieV9taW50ID0gewogICAgICAgIHN0cih0LmdldCgiYWRkcmVzcyIpIG9yICIiKTogZmxvYXQodC5nZXQoInByaWNlIiwgMCkgb3IgMCkKICAgICAgICBmb3IgdCBpbiBtYXJrZXRfdG9rZW5zCiAgICAgICAgaWYgdC5nZXQoImFkZHJlc3MiKSBhbmQgdC5nZXQoInByaWNlIikKICAgIH0KCiAgICBub3cgPSBkYXRldGltZS51dGNub3coKQogICAgdXBkYXRlZCA9IDAKICAgIHRvdWNoZWRfc3ltYm9scyA9IHNldCgpCiAgICBmb3Igcm93IGluIHJvd3M6CiAgICAgICAgb3V0Y29tZV9pZCA9IGludChyb3dbImlkIl0pCiAgICAgICAgbWludCA9IHJvdy5nZXQoIm1pbnQiKQogICAgICAgIGVudHJ5X3ByaWNlID0gZmxvYXQocm93LmdldCgiZW50cnlfcHJpY2UiKSBvciAwKQogICAgICAgIGlmIG5vdCBtaW50IG9yIGVudHJ5X3ByaWNlIDw9IDA6CiAgICAgICAgICAgIG1hcmtfYWxlcnRfb3V0Y29tZV9jb21wbGV0ZShvdXRjb21lX2lkKQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNyZWF0ZWQgPSBkYXRldGltZS5mcm9taXNvZm9ybWF0KHJvd1siY3JlYXRlZF90c191dGMiXSkKICAgICAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgICAgIG1hcmtfYWxlcnRfb3V0Y29tZV9lcnJvcihvdXRjb21lX2lkLCAiaW52YWxpZF9jcmVhdGVkX3RzIikKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgYWdlID0gbm93IC0gY3JlYXRlZAogICAgICAgIGR1ZV9ob3Jpem9ucyA9IFtdCiAgICAgICAgaWYgcm93LmdldCgicmV0dXJuXzFoX3BjdCIpIGlzIE5vbmUgYW5kIGFnZSA+PSB0aW1lZGVsdGEoaG91cnM9MSk6CiAgICAgICAgICAgIGR1ZV9ob3Jpem9ucy5hcHBlbmQoMSkKICAgICAgICBpZiByb3cuZ2V0KCJyZXR1cm5fNGhfcGN0IikgaXMgTm9uZSBhbmQgYWdlID49IHRpbWVkZWx0YShob3Vycz00KToKICAgICAgICAgICAgZHVlX2hvcml6b25zLmFwcGVuZCg0KQogICAgICAgIGlmIHJvdy5nZXQoInJldHVybl8yNGhfcGN0IikgaXMgTm9uZSBhbmQgYWdlID49IHRpbWVkZWx0YShob3Vycz0yNCk6CiAgICAgICAgICAgIGR1ZV9ob3Jpem9ucy5hcHBlbmQoMjQpCiAgICAgICAgaWYgbm90IGR1ZV9ob3Jpem9uczoKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgIyBUcnkgdG8gZ2V0IHByaWNlIGZyb20gbWFya2V0IGRhdGEgZmlyc3QgKGJhdGNoZWQsIGVmZmljaWVudCkKICAgICAgICBjdXJyZW50X3ByaWNlID0gcHJpY2VfYnlfbWludC5nZXQobWludCkKCiAgICAgICAgIyBGYWxsYmFjayB0byBpbmRpdmlkdWFsIGZldGNoIG9ubHkgaWYgbm90IGluIG1hcmtldCBkYXRhCiAgICAgICAgaWYgY3VycmVudF9wcmljZSBpcyBOb25lIG9yIGN1cnJlbnRfcHJpY2UgPD0gMDoKICAgICAgICAgICAgY3VycmVudF9wcmljZSA9IGZldGNoX2JpcmRleWVfcHJpY2UobWludCkKICAgICAgICAgICAgaWYgY3VycmVudF9wcmljZSBpcyBOb25lIG9yIGZsb2F0KGN1cnJlbnRfcHJpY2UpIDw9IDA6CiAgICAgICAgICAgICAgICBtYXJrX2FsZXJ0X291dGNvbWVfZXJyb3Iob3V0Y29tZV9pZCwgInByaWNlX3VuYXZhaWxhYmxlIikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIHJldF9wY3QgPSAoKGZsb2F0KGN1cnJlbnRfcHJpY2UpIC0gZW50cnlfcHJpY2UpIC8gZW50cnlfcHJpY2UpICogMTAwLjAKICAgICAgICBmb3IgaG9yaXpvbiBpbiBkdWVfaG9yaXpvbnM6CiAgICAgICAgICAgIHVwZGF0ZV9hbGVydF9vdXRjb21lX2hvcml6b24ob3V0Y29tZV9pZCwgaG9yaXpvbiwgcmV0X3BjdCkKICAgICAgICAgICAgdXBkYXRlZCArPSAxCiAgICAgICAgICAgIGlmIHJvdy5nZXQoInN5bWJvbCIpOgogICAgICAgICAgICAgICAgdG91Y2hlZF9zeW1ib2xzLmFkZChzdHIocm93LmdldCgic3ltYm9sIikpKQoKICAgIGZvciBzeW1ib2wgaW4gdG91Y2hlZF9zeW1ib2xzOgogICAgICAgIF91cGRhdGVfc3ltYm9sX2NvbnRyb2xfZnJvbV9vdXRjb21lcyhzeW1ib2wpCgogICAgaWYgdXBkYXRlZDoKICAgICAgICBsb2dnaW5nLmluZm8oIk91dGNvbWUgZXZhbHVhdG9yIHVwZGF0ZWQgJWQgaG9yaXpvbiByZXN1bHQocykiLCB1cGRhdGVkKQoKCmFzeW5jIGRlZiBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGU6IFVwZGF0ZSk6CiAgICBtc2cgPSB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UKICAgIGlmIG1zZzoKICAgICAgICBhd2FpdCBtc2cucmVwbHlfdGV4dCgiVW5hdXRob3JpemVkIGNoYXQuIikKCgpkZWYgX2N1cnJlbnRfbW9kZV90ZXh0KCk6CiAgICBzZWxsX3J1bGVzID0gX3NlbGxfc3R5bGVfcnVsZXMoKQogICAgcmV0dXJuICgKICAgICAgICBmIk1vZGU6IHtfbW9kZSgpfVxuIgogICAgICAgIGYiUmlzayBwcm9maWxlOiB7X3Jpc2tfc3R5bGVfbGFiZWwoKX0gKHtfbm9ybWFsaXplX3Jpc2tfc3R5bGUoX3J1bnRpbWUuZ2V0KCdyaXNrX3N0eWxlJykpfSlcbiIKICAgICAgICBmIlNjYW4gaW50ZXJ2YWw6IHtfcnVudGltZVsnc2Nhbl9pbnRlcnZhbF9zZWNvbmRzJ119c1xuIgogICAgICAgIGYiVGhyZXNob2xkOiB7X3J1bnRpbWVbJ2FsZXJ0X3RocmVzaG9sZCddfSB8IENvbmZpZGVuY2U6IHtfcnVudGltZVsnbWluX2NvbmZpZGVuY2VfdG9fYWxlcnQnXX1cbiIKICAgICAgICBmIlJlZ2ltZSBtaW46IHtfcnVudGltZVsncmVnaW1lX21pbl9zY29yZSddfVxuIgogICAgICAgIGYiTWluIGxpcS92b2wyNGg6ICR7aW50KF9ydW50aW1lWydtaW5fbGlxdWlkaXR5J10pOix9IC8gJHtpbnQoX3J1bnRpbWVbJ21pbl92b2x1bWVfMjRoJ10pOix9XG4iCiAgICAgICAgZiJDb29sZG93bjoge19ydW50aW1lWydhbGVydF9jb29sZG93bl9ob3VycyddfWhcbiIKICAgICAgICBmIlNPTCByZWdpbWUgbGF5ZXI6IHsnT04nIGlmIEVOQUJMRV9TT0xfUkVHSU1FX0xBWUVSIGVsc2UgJ09GRid9XG4iCiAgICAgICAgZiJOZXcgcnVubmVyIHdhdGNoOiB7J09OJyBpZiBORVdfUlVOTkVSX1dBVENIX0VOQUJMRUQgZWxzZSAnT0ZGJ31cbiIKICAgICAgICBmIkxlZ2FjeSByZWNvdmVyeSBzY2FuOiB7J09OJyBpZiBMRUdBQ1lfUkVDT1ZFUllfRU5BQkxFRCBlbHNlICdPRkYnfSAiCiAgICAgICAgZiIoYWdlPj17TEVHQUNZX1JFQ09WRVJZX01JTl9BR0VfREFZUzouMGZ9ZCwgbGlxPiR7TEVHQUNZX1JFQ09WRVJZX01JTl9MSVFVSURJVFkvMWU2Oi4xZn1NLCB2b2w+JHtMRUdBQ1lfUkVDT1ZFUllfTUlOX1ZPTFVNRV8yNEgvMWUzOi4wZn1LKVxuIgogICAgICAgIGYiTWFudWFsIHdhdGNobGlzdCBsYW5lOiB7J09OJyBpZiBXQVRDSExJU1RfTEFORV9FTkFCTEVEIGFuZCBib29sKFdBVENITElTVF9FTlRSSUVTKSBlbHNlICdPRkYnfVxuIgogICAgICAgIGYiQW5hbHlzaXMgYnVsbGV0aW46IHsnT04nIGlmIEdPT0RfQlVZX0JVTExFVElOX0VOQUJMRUQgZWxzZSAnT0ZGJ30gKHtHT09EX0JVWV9CVUxMRVRJTl9JTlRFUlZBTF9TRUNPTkRTfXMpXG4iCiAgICAgICAgZiJRdWlldCBtb2RlOiB7J09OJyBpZiBURUxFR1JBTV9RVUlFVF9NT0RFIGVsc2UgJ09GRid9XG4iCiAgICAgICAgZiJMaXZlIHB1c2ggZ2F0ZTogeydTVFJPTkctT05MWScgaWYgVEVMRUdSQU1fUFVTSF9TVFJPTkdfT05MWSBlbHNlICdPRkYnfSAiCiAgICAgICAgZiIoK3tURUxFR1JBTV9QVVNIX01JTl9TQ09SRV9ERUxUQX0sIGNvbmY+PXtURUxFR1JBTV9QVVNIX01JTl9DT05GSURFTkNFfSlcbiIKICAgICAgICBmIlNlbGwvZXhpdCBzY2FubmVyOiB7J09OJyBpZiBTRUxMX0FMRVJUU19FTkFCTEVEIGVsc2UgJ09GRid9ICIKICAgICAgICBmIihtYXgvY3ljbGU9e3NlbGxfcnVsZXNbJ21heF9wZXJfY3ljbGUnXX0sIGNvb2xkb3duPXtzZWxsX3J1bGVzWydjb29sZG93bl9ob3VycyddfWgpIgogICAgKQoKCmRlZiBfZm10X3VzZF9jb21wYWN0X21haW4odmFsdWUpOgogICAgdHJ5OgogICAgICAgIG4gPSBmbG9hdCh2YWx1ZSkKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKICAgIGFic19uID0gYWJzKG4pCiAgICBpZiBhYnNfbiA+PSAxXzAwMF8wMDBfMDAwOgogICAgICAgIHJldHVybiBmIiR7bi8xXzAwMF8wMDBfMDAwOi4yZn1CIgogICAgaWYgYWJzX24gPj0gMV8wMDBfMDAwOgogICAgICAgIHJldHVybiBmIiR7bi8xXzAwMF8wMDA6LjJmfU0iCiAgICBpZiBhYnNfbiA+PSAxXzAwMDoKICAgICAgICByZXR1cm4gZiIke24vMV8wMDA6LjFmfUsiCiAgICByZXR1cm4gZiIke246LjBmfSIKCgpkZWYgX2ZtdF9wY3RfbWFpbih2YWx1ZSk6CiAgICB0cnk6CiAgICAgICAgbnVtYmVyID0gZmxvYXQodmFsdWUpCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICBzaWduID0gIisiIGlmIG51bWJlciA+IDAgZWxzZSAiIgogICAgcmV0dXJuIGYie3NpZ259e251bWJlcjouMWZ9JSIKCgpkZWYgX2ZtdF9pbnRfbWFpbih2YWx1ZSk6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIGYie2ludChmbG9hdCh2YWx1ZSkpOix9IgogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiAiTi9BIgoKCmRlZiBfZXNjX2h0bWxfbWFpbih2YWx1ZSk6CiAgICByZXR1cm4gaHRtbC5lc2NhcGUoc3RyKHZhbHVlKSkKCgpkZWYgX3JlbmRlcl9wcmVfbWFpbihyb3dzKToKICAgIGxpbmVzID0gW3N0cihyb3cgb3IgIiIpIGZvciByb3cgaW4gcm93c10KICAgIGlmIG5vdCBsaW5lczoKICAgICAgICByZXR1cm4gIiIKICAgIHBhbmVsX3dpZHRoID0gX1BBTkVMX1dJRFRIX01BSU4KICAgIHdyYXBwZWQgPSBbXQogICAgZm9yIGxpbmUgaW4gbGluZXM6CiAgICAgICAgd3JhcHBlZC5leHRlbmQoX3dyYXBfdGV4dF9tYWluKGxpbmUsIHBhbmVsX3dpZHRoKSkKICAgIHJldHVybiAiXG4iLmpvaW4oZiI8Y29kZT57X2VzY19odG1sX21haW4obGluZSl9PC9jb2RlPiIgZm9yIGxpbmUgaW4gd3JhcHBlZCkKCgpfUEFORUxfV0lEVEhfTUFJTiA9IDQyCgoKZGVmIF90cmltX3RleHRfbWFpbih2YWx1ZSwgbWF4X2xlbik6CiAgICB0ZXh0ID0gc3RyKHZhbHVlIG9yICIiKQogICAgaWYgbWF4X2xlbiA8PSAwOgogICAgICAgIHJldHVybiB0ZXh0CiAgICByZXR1cm4gdGV4dAoKCmRlZiBfd3JhcF90ZXh0X21haW4odmFsdWUsIG1heF9sZW4pOgogICAgdGV4dCA9IHN0cih2YWx1ZSBvciAiIikKICAgIGlmIG1heF9sZW4gPD0gMCBvciBsZW4odGV4dCkgPD0gbWF4X2xlbjoKICAgICAgICByZXR1cm4gW3RleHRdCiAgICBvdXQgPSBbXQogICAgcmVtYWluaW5nID0gdGV4dAogICAgd2hpbGUgbGVuKHJlbWFpbmluZykgPiBtYXhfbGVuOgogICAgICAgIGN1dCA9IHJlbWFpbmluZy5yZmluZCgiICIsIDAsIG1heF9sZW4gKyAxKQogICAgICAgIGlmIGN1dCA8PSAwOgogICAgICAgICAgICBjdXQgPSBtYXhfbGVuCiAgICAgICAgb3V0LmFwcGVuZChyZW1haW5pbmdbOmN1dF0ucnN0cmlwKCkpCiAgICAgICAgcmVtYWluaW5nID0gcmVtYWluaW5nW2N1dDpdLmxzdHJpcCgpCiAgICBvdXQuYXBwZW5kKHJlbWFpbmluZykKICAgIHJldHVybiBvdXQKCgpkZWYgX2t2X21haW4obGFiZWwsIHZhbHVlLCB3aWR0aDogaW50ID0gX1BBTkVMX1dJRFRIX01BSU4pOgogICAga2V5ID0gc3RyKGxhYmVsIG9yICIiKS51cHBlcigpWzo5XQogICAgbGluZSA9IGYie2tleTo8OX0gfCB7dmFsdWV9IgogICAgcmV0dXJuIF90cmltX3RleHRfbWFpbihsaW5lLCB3aWR0aCkKCgpkZWYgX2hlYWRlcl9ibG9ja19tYWluKHRhZzogc3RyLCByb3dzPU5vbmUsIHdpZHRoOiBpbnQgPSBfUEFORUxfV0lEVEhfTUFJTikgLT4gc3RyOgogICAgaGVhZGVyX3Jvd3MgPSBbCiAgICAgICAgZiI8Yj57X2VzY19odG1sX21haW4odGFnKX08L2I+IiwKICAgICAgICBmIjxjb2RlPnsnLScgKiBtaW4oMzAsIHdpZHRoKX08L2NvZGU+IiwKICAgIF0KICAgIGZvciByb3cgaW4gKHJvd3Mgb3IgW10pOgogICAgICAgIHRleHQgPSBfdHJpbV90ZXh0X21haW4oc3RyKHJvdyBvciAiIiksIHdpZHRoKQogICAgICAgIGhlYWRlcl9yb3dzLmFwcGVuZChmIjxjb2RlPntfZXNjX2h0bWxfbWFpbih0ZXh0KX08L2NvZGU+IikKICAgIHJldHVybiAiXG4iLmpvaW4oaGVhZGVyX3Jvd3MpCgoKZGVmIF9wcmlvcml0eV9mcm9tX3Njb3JlX21haW4oc2NvcmUpOgogICAgdHJ5OgogICAgICAgIHMgPSBmbG9hdChzY29yZSBvciAwKQogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiAiUDMiCiAgICBpZiBzID49IDkwOgogICAgICAgIHJldHVybiAiUDEiCiAgICBpZiBzID49IDgwOgogICAgICAgIHJldHVybiAiUDIiCiAgICByZXR1cm4gIlAzIgoKCmRlZiBfZ29vZF9idXlfcmVhc29uKHRva2VuOiBkaWN0KSAtPiBzdHI6CiAgICBjaGFuZ2VfMjRoID0gZmxvYXQodG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiwgMCkgb3IgMCkKICAgIGxpcXVpZGl0eSA9IGZsb2F0KHRva2VuLmdldCgibGlxdWlkaXR5IiwgMCkgb3IgMCkKICAgIHZvbHVtZV8yNGggPSBmbG9hdCh0b2tlbi5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKQogICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMC4wCiAgICBpZiBjaGFuZ2VfMjRoID49IDEyIGFuZCB2b2xfdG9fbGlxID49IDAuNjoKICAgICAgICByZXR1cm4gIlN0cm9uZyB0cmVuZCArIHN0cm9uZyBwYXJ0aWNpcGF0aW9uIgogICAgaWYgY2hhbmdlXzI0aCA+PSA1IGFuZCB2b2xfdG9fbGlxID49IDAuMzU6CiAgICAgICAgcmV0dXJuICJNb21lbnR1bSBjb25maXJtZWQgKyBoZWFsdGh5IHR1cm5vdmVyIgogICAgaWYgY2hhbmdlXzI0aCA+PSAwOgogICAgICAgIHJldHVybiAiQ29uc3RydWN0aXZlIHN0cnVjdHVyZSArIGFjY2VwdGFibGUgbGlxdWlkaXR5IgogICAgcmV0dXJuICJQdWxsYmFjayBzZXR1cCB3aXRoIHN0aWxsLXZhbGlkIGxpcXVpZGl0eSIKCgpkZWYgX3NlbGxfc3R5bGVfcnVsZXMoc3R5bGU6IHN0ciB8IE5vbmUgPSBOb25lKSAtPiBkaWN0OgogICAgcmlza19zdHlsZSA9IF9ub3JtYWxpemVfcmlza19zdHlsZShzdHlsZSBvciBfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSkKICAgIGJhc2UgPSB7CiAgICAgICAgInN0eWxlIjogcmlza19zdHlsZSwKICAgICAgICAibWF4X3Blcl9jeWNsZSI6IG1heCgxLCBpbnQoU0VMTF9BTEVSVF9NQVhfUEVSX0NZQ0xFKSksCiAgICAgICAgImNvb2xkb3duX2hvdXJzIjogbWF4KDEsIGludChTRUxMX0FMRVJUX0NPT0xET1dOX0hPVVJTKSksCiAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzFoIjogZmxvYXQoU0VMTF9IWVBFX0ZBREVfTUFYX0NIQU5HRV8xSCksCiAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzZoIjogZmxvYXQoU0VMTF9IWVBFX0ZBREVfTUFYX0NIQU5HRV82SCksCiAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzI0aCI6IGZsb2F0KFNFTExfSFlQRV9GQURFX01BWF9DSEFOR0VfMjRIKSwKICAgICAgICAiaHlwZV9mYWRlX21heF92b2xfdG9fbGlxIjogZmxvYXQoU0VMTF9IWVBFX0ZBREVfTUFYX1ZPTF9UT19MSVEpLAogICAgICAgICJjb25zb2xpZGF0aW9uX21pbl9jaGFuZ2VfMjRoIjogZmxvYXQoU0VMTF9DT05TT0xJREFUSU9OX01JTl9DSEFOR0VfMjRIKSwKICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfYWJzX2NoYW5nZV8xaCI6IGZsb2F0KFNFTExfQ09OU09MSURBVElPTl9NQVhfQUJTX0NIQU5HRV8xSCksCiAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfNmgiOiBmbG9hdChTRUxMX0NPTlNPTElEQVRJT05fTUFYX0FCU19DSEFOR0VfNkgpLAogICAgICAgICJjb25zb2xpZGF0aW9uX21heF92b2xfdG9fbGlxIjogZmxvYXQoU0VMTF9DT05TT0xJREFUSU9OX01BWF9WT0xfVE9fTElRKSwKICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfdHhuc19oMSI6IGludChTRUxMX0NPTlNPTElEQVRJT05fTUFYX1RYTlNfSDEpLAogICAgfQoKICAgIGlmIHJpc2tfc3R5bGUgPT0gImNhcGl0YWwiOgogICAgICAgIGJhc2UudXBkYXRlKAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibWF4X3Blcl9jeWNsZSI6IG1heCgxLCBiYXNlWyJtYXhfcGVyX2N5Y2xlIl0gKyAxKSwKICAgICAgICAgICAgICAgICJjb29sZG93bl9ob3VycyI6IG1heCgxLCBpbnQocm91bmQoYmFzZVsiY29vbGRvd25faG91cnMiXSAqIDAuNzUpKSksCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF9jaGFuZ2VfMWgiOiBiYXNlWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8xaCJdICogMC42LAogICAgICAgICAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzZoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfNmgiXSAqIDAuNiwKICAgICAgICAgICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8yNGgiOiBiYXNlWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8yNGgiXSAqIDAuNiwKICAgICAgICAgICAgICAgICJoeXBlX2ZhZGVfbWF4X3ZvbF90b19saXEiOiBiYXNlWyJoeXBlX2ZhZGVfbWF4X3ZvbF90b19saXEiXSAqIDEuNCwKICAgICAgICAgICAgICAgICJjb25zb2xpZGF0aW9uX21pbl9jaGFuZ2VfMjRoIjogYmFzZVsiY29uc29saWRhdGlvbl9taW5fY2hhbmdlXzI0aCJdICogMC43LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfMWgiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzFoIl0gKiAxLjM1LAogICAgICAgICAgICAgICAgImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfNmgiOiBiYXNlWyJjb25zb2xpZGF0aW9uX21heF9hYnNfY2hhbmdlXzZoIl0gKiAxLjMsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfdm9sX3RvX2xpcSI6IGJhc2VbImNvbnNvbGlkYXRpb25fbWF4X3ZvbF90b19saXEiXSAqIDEuMywKICAgICAgICAgICAgICAgICJjb25zb2xpZGF0aW9uX21heF90eG5zX2gxIjogaW50KGJhc2VbImNvbnNvbGlkYXRpb25fbWF4X3R4bnNfaDEiXSAqIDEuMzUpLAogICAgICAgICAgICB9CiAgICAgICAgKQogICAgZWxpZiByaXNrX3N0eWxlID09ICJzbmlwZXIiOgogICAgICAgIGJhc2UudXBkYXRlKAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibWF4X3Blcl9jeWNsZSI6IG1heCgxLCBiYXNlWyJtYXhfcGVyX2N5Y2xlIl0gLSAxKSwKICAgICAgICAgICAgICAgICJjb29sZG93bl9ob3VycyI6IG1heCgxLCBpbnQocm91bmQoYmFzZVsiY29vbGRvd25faG91cnMiXSAqIDEuMjUpKSksCiAgICAgICAgICAgICAgICAiaHlwZV9mYWRlX21heF9jaGFuZ2VfMWgiOiBiYXNlWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8xaCJdICogMS42LAogICAgICAgICAgICAgICAgImh5cGVfZmFkZV9tYXhfY2hhbmdlXzZoIjogYmFzZVsiaHlwZV9mYWRlX21heF9jaGFuZ2VfNmgiXSAqIDEuNiwKICAgICAgICAgICAgICAgICJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8yNGgiOiBiYXNlWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV8yNGgiXSAqIDEuNiwKICAgICAgICAgICAgICAgICJoeXBlX2ZhZGVfbWF4X3ZvbF90b19saXEiOiBiYXNlWyJoeXBlX2ZhZGVfbWF4X3ZvbF90b19saXEiXSAqIDAuNzUsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9taW5fY2hhbmdlXzI0aCI6IGJhc2VbImNvbnNvbGlkYXRpb25fbWluX2NoYW5nZV8yNGgiXSAqIDEuMzUsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfYWJzX2NoYW5nZV8xaCI6IGJhc2VbImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfMWgiXSAqIDAuNzUsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfYWJzX2NoYW5nZV82aCI6IGJhc2VbImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfNmgiXSAqIDAuNzUsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfdm9sX3RvX2xpcSI6IGJhc2VbImNvbnNvbGlkYXRpb25fbWF4X3ZvbF90b19saXEiXSAqIDAuNzUsCiAgICAgICAgICAgICAgICAiY29uc29saWRhdGlvbl9tYXhfdHhuc19oMSI6IGludChiYXNlWyJjb25zb2xpZGF0aW9uX21heF90eG5zX2gxIl0gKiAwLjc1KSwKICAgICAgICAgICAgfQogICAgICAgICkKCiAgICByZXR1cm4gYmFzZQoKCmRlZiBfc2VsbF9zaWduYWxfb25fY29vbGRvd24oc3ltYm9sOiBzdHIsIGNvb2xkb3duX2hvdXJzOiBpbnQgfCBmbG9hdCB8IE5vbmUgPSBOb25lKSAtPiBib29sOgogICAgaWYgbm90IHN5bWJvbDoKICAgICAgICByZXR1cm4gVHJ1ZQogICAgbGFzdF9zZW50ID0gZ2V0X2xhc3RfZGVjaXNpb25fdGltZXN0YW1wX2Zvcl9zeW1ib2woCiAgICAgICAgc3ltYm9sLAogICAgICAgIFsKICAgICAgICAgICAgIlNFTExfQUxFUlRfSFlQRV9GQURFIiwKICAgICAgICAgICAgIlNFTExfQUxFUlRfQ09OU09MSURBVElPTiIsCiAgICAgICAgICAgICJTRUxMX0FMRVJUX0RSWV9SVU4iLAogICAgICAgIF0sCiAgICApCiAgICBpZiBub3QgbGFzdF9zZW50OgogICAgICAgIHJldHVybiBGYWxzZQogICAgZWZmZWN0aXZlX2Nvb2xkb3duID0gY29vbGRvd25faG91cnMgaWYgY29vbGRvd25faG91cnMgaXMgbm90IE5vbmUgZWxzZSBTRUxMX0FMRVJUX0NPT0xET1dOX0hPVVJTCiAgICByZXR1cm4gKGRhdGV0aW1lLnV0Y25vdygpIC0gbGFzdF9zZW50KSA8IHRpbWVkZWx0YShob3Vycz1tYXgoMSwgZWZmZWN0aXZlX2Nvb2xkb3duKSkKCgpkZWYgX2RldGVjdF9zZWxsX3NpZ25hbCh0b2tlbjogZGljdCwgcnVsZXM6IGRpY3QgfCBOb25lID0gTm9uZSk6CiAgICAiIiIKICAgIERldGVjdCBleGl0IHNpZ25hbHMgdXNpbmcgcmVhbCBtYXJrZXQgc3RydWN0dXJlIGFuZCBmbG93IGFuYWx5c2lzLgogICAgUHJpb3JpdGl6ZWQgYnkgc2V2ZXJpdHk6IHN0cnVjdHVyZSBicmVhayA+IGxpcXVpZGl0eSBkcmFpbiA+IGhvbGRlciBleG9kdXMgPiBoeXBlIGZhZGUgPiBjb25zb2xpZGF0aW9uCiAgICAiIiIKICAgIHN5bWJvbCA9IHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpCiAgICBpZiBub3Qgc3ltYm9sIG9yIHN5bWJvbCBpbiBfU0VMTF9BTEVSVF9FWENMVURFRF9TWU1CT0xTOgogICAgICAgIHJldHVybiBOb25lCgogICAgbGlxdWlkaXR5ID0gZmxvYXQodG9rZW4uZ2V0KCJsaXF1aWRpdHkiLCAwKSBvciAwKQogICAgdm9sdW1lXzI0aCA9IGZsb2F0KHRva2VuLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICBpZiBsaXF1aWRpdHkgPD0gMCBvciB2b2x1bWVfMjRoIDw9IDA6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHZvbF90b19saXEgPSB2b2x1bWVfMjRoIC8gbGlxdWlkaXR5CiAgICBydWxlcyA9IHJ1bGVzIG9yIF9zZWxsX3N0eWxlX3J1bGVzKCkKCiAgICBjaGFuZ2VfMWggPSB0b2tlbi5nZXQoImNoYW5nZV8xaCIpIG9yIHRva2VuLmdldCgicHJpY2VDaGFuZ2UxaFBlcmNlbnQiKQogICAgY2hhbmdlXzRoID0gdG9rZW4uZ2V0KCJjaGFuZ2VfNGgiKSBvciB0b2tlbi5nZXQoInByaWNlQ2hhbmdlNGhQZXJjZW50IikKICAgIGNoYW5nZV82aCA9IHRva2VuLmdldCgiY2hhbmdlXzZoIikgb3IgdG9rZW4uZ2V0KCJwcmljZUNoYW5nZTZoUGVyY2VudCIpCiAgICBjaGFuZ2VfMjRoID0gdG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIikKICAgIGMxID0gZmxvYXQoY2hhbmdlXzFoKSBpZiBpc2luc3RhbmNlKGNoYW5nZV8xaCwgKGludCwgZmxvYXQpKSBlbHNlIE5vbmUKICAgIGM0ID0gZmxvYXQoY2hhbmdlXzRoKSBpZiBpc2luc3RhbmNlKGNoYW5nZV80aCwgKGludCwgZmxvYXQpKSBlbHNlIE5vbmUKICAgIGM2ID0gZmxvYXQoY2hhbmdlXzZoKSBpZiBpc2luc3RhbmNlKGNoYW5nZV82aCwgKGludCwgZmxvYXQpKSBlbHNlIE5vbmUKICAgIGMyNCA9IGZsb2F0KGNoYW5nZV8yNGgpIGlmIGlzaW5zdGFuY2UoY2hhbmdlXzI0aCwgKGludCwgZmxvYXQpKSBlbHNlIDAuMAogICAgdHhuc19oMSA9IGludChmbG9hdCh0b2tlbi5nZXQoInR4bnNfaDEiKSBvciAwKSkKCiAgICAjIEdldCBob2xkZXIgbW9tZW50dW0gZGF0YQogICAgdXdfMWhfY2hhbmdlID0gdG9rZW4uZ2V0KCJ1bmlxdWVXYWxsZXQxaENoYW5nZVBlcmNlbnQiKQogICAgdXdfNGhfY2hhbmdlID0gdG9rZW4uZ2V0KCJ1bmlxdWVXYWxsZXQ0aENoYW5nZVBlcmNlbnQiKQoKICAgICMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACiAgICAjIDEuIFNUUlVDVFVSRSBCUkVBSyAoaGlnaGVzdCBwcmlvcml0eSkKICAgICMgUHJpY2UgYnJlYWtpbmcgZG93biBoYXJkIGFjcm9zcyBtdWx0aXBsZSB0aW1lZnJhbWVzID0gc3RydWN0dXJhbCBmYWlsdXJlCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgaWYgYzEgaXMgbm90IE5vbmUgYW5kIGM0IGlzIG5vdCBOb25lOgogICAgICAgIGlmIGMxIDwgLTggYW5kIGM0IDwgLTE1OgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInR5cGUiOiAiU1RSVUNUVVJFX0JSRUFLIiwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJTdHJ1Y3R1cmUgQnJlYWsiLAogICAgICAgICAgICAgICAgImFjdGlvbiI6ICJFWElUIE5PVyAtIHN0cnVjdHVyZSBmYWlsZWQiLAogICAgICAgICAgICAgICAgInN0eWxlIjogcnVsZXNbInN0eWxlIl0sCiAgICAgICAgICAgICAgICAicmVhc29uIjogKAogICAgICAgICAgICAgICAgICAgIGYiTXVsdGktdGltZWZyYW1lIGJyZWFrZG93bjogMWgge2MxOisuMWZ9JSwgNGgge2M0OisuMWZ9JS4gIgogICAgICAgICAgICAgICAgICAgIGYiUHJpY2Ugc3VwcG9ydCBoYXMgZmFpbGVkLiIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0KCiAgICAjIFNoYXJwIGR1bXAgd2l0aCBhY2NlbGVyYXRpbmcgZG93bnNpZGUgPSBjYXNjYWRlIGZvcm1pbmcKICAgIGlmIGMxIGlzIG5vdCBOb25lIGFuZCBjNiBpcyBub3QgTm9uZToKICAgICAgICBpZiBjMSA8IC0xMCBhbmQgYzYgPCAtMjAgYW5kIGMxIDwgYzYgLyAyOgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInR5cGUiOiAiU1RSVUNUVVJFX0JSRUFLIiwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJTdHJ1Y3R1cmUgQnJlYWsiLAogICAgICAgICAgICAgICAgImFjdGlvbiI6ICJFWElUIE5PVyAtIGNhc2NhZGUgZm9ybWluZyIsCiAgICAgICAgICAgICAgICAic3R5bGUiOiBydWxlc1sic3R5bGUiXSwKICAgICAgICAgICAgICAgICJyZWFzb24iOiAoCiAgICAgICAgICAgICAgICAgICAgZiJBY2NlbGVyYXRpbmcgZHVtcDogMWgge2MxOisuMWZ9JSwgNmgge2M2OisuMWZ9JS4gIgogICAgICAgICAgICAgICAgICAgIGYiRG93bnNpZGUgbW9tZW50dW0gYWNjZWxlcmF0aW5nLiIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0KCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgIyAyLiBMSVFVSURJVFkgRFJBSU4KICAgICMgVm9sdW1lL2xpcXVpZGl0eSByYXRpbyBjb2xsYXBzaW5nID0gY2FuJ3QgZXhpdCB3aXRob3V0IHNsaXBwYWdlCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgaWYgdm9sX3RvX2xpcSA8IDAuMDU6ICAjIFZvbHVtZSBkcm9wcGVkIHRvIDUlIG9mIGxpcXVpZGl0eSA9IGRyaWVkIHVwCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInR5cGUiOiAiTElRVUlESVRZX0RSQUlOIiwKICAgICAgICAgICAgInRpdGxlIjogIkxpcXVpZGl0eSBEcmFpbiIsCiAgICAgICAgICAgICJhY3Rpb24iOiAiRVhJVCBBU0FQIC0gbWFya2V0IGRyeWluZyB1cCIsCiAgICAgICAgICAgICJzdHlsZSI6IHJ1bGVzWyJzdHlsZSJdLAogICAgICAgICAgICAicmVhc29uIjogKAogICAgICAgICAgICAgICAgZiJWb2x1bWUgY29sbGFwc2VkIHRvIHt2b2xfdG9fbGlxOi4zZn14IGxpcXVpZGl0eS4gIgogICAgICAgICAgICAgICAgZiJNYXJrZXQgZGVwdGggZXZhcG9yYXRpbmcgLSBleGl0IGJlZm9yZSBzbGlwcGFnZSBzcGlrZXMuIgogICAgICAgICAgICApLAogICAgICAgIH0KCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgIyAzLiBIT0xERVIgRVhPRFVTCiAgICAjIFVuaXF1ZSB3YWxsZXRzIHJhcGlkbHkgZXhpdGluZyA9IGRpc3RyaWJ1dGlvbiBwaGFzZQogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKICAgIGlmIHV3XzFoX2NoYW5nZSBpcyBub3QgTm9uZSBhbmQgdXdfNGhfY2hhbmdlIGlzIG5vdCBOb25lOgogICAgICAgIGlmIHV3XzFoX2NoYW5nZSA8IC0yNSBhbmQgdXdfNGhfY2hhbmdlIDwgLTIwOgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInR5cGUiOiAiSE9MREVSX0VYT0RVUyIsCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiSG9sZGVyIEV4b2R1cyIsCiAgICAgICAgICAgICAgICAiYWN0aW9uIjogIkVYSVQgLSBzbWFydCBtb25leSBsZWF2aW5nIiwKICAgICAgICAgICAgICAgICJzdHlsZSI6IHJ1bGVzWyJzdHlsZSJdLAogICAgICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgICAgICBmIkhvbGRlciBleG9kdXM6IDFoIHdhbGxldHMge3V3XzFoX2NoYW5nZTorLjFmfSUsIDRoIHt1d180aF9jaGFuZ2U6Ky4xZn0lLiAiCiAgICAgICAgICAgICAgICAgICAgZiJTbWFydCBtb25leSBpcyBleGl0aW5nIGVuIG1hc3NlLiIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0KCiAgICAjIEhvbGRlcnMgZXhpdGluZyB3aGlsZSBwcmljZSBzdGlsbCBob2xkaW5nID0gZGlzdHJpYnV0aW9uIGJlZm9yZSBkdW1wCiAgICBpZiB1d18xaF9jaGFuZ2UgaXMgbm90IE5vbmUgYW5kIGMxIGlzIG5vdCBOb25lOgogICAgICAgIGlmIHV3XzFoX2NoYW5nZSA8IC0yMCBhbmQgYzEgPiAtNToKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIkhPTERFUl9FWE9EVVMiLAogICAgICAgICAgICAgICAgInRpdGxlIjogIkhvbGRlciBFeG9kdXMiLAogICAgICAgICAgICAgICAgImFjdGlvbiI6ICJFWElUIC0gZGlzdHJpYnV0aW9uIHBoYXNlIiwKICAgICAgICAgICAgICAgICJzdHlsZSI6IHJ1bGVzWyJzdHlsZSJdLAogICAgICAgICAgICAgICAgInJlYXNvbiI6ICgKICAgICAgICAgICAgICAgICAgICBmIkhvbGRlcnMgZXhpdGluZyAoe3V3XzFoX2NoYW5nZTorLjFmfSUpIHdoaWxlIHByaWNlIHN0aWxsIHtjMTorLjFmfSUuICIKICAgICAgICAgICAgICAgICAgICBmIkRpc3RyaWJ1dGlvbiBwaGFzZSAtIGR1bXAgaW5jb21pbmcuIgogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgfQoKICAgICMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACiAgICAjIDQuIEhZUEUgRkFERSAob3JpZ2luYWwgbG9naWMsIG5vdyBsb3dlciBwcmlvcml0eSkKICAgICMgTW9tZW50dW0gcm9sbGVkIG92ZXIgKyBwYXJ0aWNpcGF0aW9uIGZhZGVkCiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgaWYgYzEgaXMgbm90IE5vbmUgYW5kIGM2IGlzIG5vdCBOb25lOgogICAgICAgIGlmICgKICAgICAgICAgICAgYzEgPD0gcnVsZXNbImh5cGVfZmFkZV9tYXhfY2hhbmdlXzFoIl0KICAgICAgICAgICAgYW5kIGM2IDw9IHJ1bGVzWyJoeXBlX2ZhZGVfbWF4X2NoYW5nZV82aCJdCiAgICAgICAgICAgIGFuZCB2b2xfdG9fbGlxIDw9IHJ1bGVzWyJoeXBlX2ZhZGVfbWF4X3ZvbF90b19saXEiXQogICAgICAgICkgb3IgKAogICAgICAgICAgICBjMjQgPD0gcnVsZXNbImh5cGVfZmFkZV9tYXhfY2hhbmdlXzI0aCJdCiAgICAgICAgICAgIGFuZCB2b2xfdG9fbGlxIDw9IHJ1bGVzWyJoeXBlX2ZhZGVfbWF4X3ZvbF90b19saXEiXQogICAgICAgICk6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJIWVBFX0ZBREUiLAogICAgICAgICAgICAgICAgInRpdGxlIjogIkh5cGUgRmFkZSIsCiAgICAgICAgICAgICAgICAiYWN0aW9uIjogIkJhZCBidXkgLyBkZS1yaXNrIG5vdyIsCiAgICAgICAgICAgICAgICAic3R5bGUiOiBydWxlc1sic3R5bGUiXSwKICAgICAgICAgICAgICAgICJyZWFzb24iOiAoCiAgICAgICAgICAgICAgICAgICAgZiJNb21lbnR1bSByb2xsZWQgb3ZlciAoMWgge2MxOisuMWZ9JSwgNmgge2M2OisuMWZ9JSkgYW5kIHBhcnRpY2lwYXRpb24gZmFkZWQgIgogICAgICAgICAgICAgICAgICAgIGYiKHZvbC9saXEge3ZvbF90b19saXE6LjJmfSkuIgogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgfQoKICAgICMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACiAgICAjIDUuIENPTlNPTElEQVRJT04gKGxvd2VzdCBwcmlvcml0eSAtIG5vdCBhbHdheXMgYmFkKQogICAgIyBUb2tlbiByYW4gYnV0IGlzIHN0YWxsaW5nIHdpdGggY29vbGluZyBmbG93CiAgICAjIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAogICAgaWYgYzEgaXMgbm90IE5vbmUgYW5kIGM2IGlzIG5vdCBOb25lOgogICAgICAgIGlmICgKICAgICAgICAgICAgYzI0ID49IHJ1bGVzWyJjb25zb2xpZGF0aW9uX21pbl9jaGFuZ2VfMjRoIl0KICAgICAgICAgICAgYW5kIGFicyhjMSkgPD0gcnVsZXNbImNvbnNvbGlkYXRpb25fbWF4X2Fic19jaGFuZ2VfMWgiXQogICAgICAgICAgICBhbmQgYWJzKGM2KSA8PSBydWxlc1siY29uc29saWRhdGlvbl9tYXhfYWJzX2NoYW5nZV82aCJdCiAgICAgICAgICAgIGFuZCB2b2xfdG9fbGlxIDw9IHJ1bGVzWyJjb25zb2xpZGF0aW9uX21heF92b2xfdG9fbGlxIl0KICAgICAgICAgICAgYW5kIHR4bnNfaDEgPD0gcnVsZXNbImNvbnNvbGlkYXRpb25fbWF4X3R4bnNfaDEiXQogICAgICAgICk6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJDT05TT0xJREFUSU9OIiwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJQb3N0LVJ1biBDb25zb2xpZGF0aW9uIiwKICAgICAgICAgICAgICAgICJhY3Rpb24iOiAiVGFrZSBwcm9maXQgLyB0aWdodGVuIHJpc2siLAogICAgICAgICAgICAgICAgInN0eWxlIjogcnVsZXNbInN0eWxlIl0sCiAgICAgICAgICAgICAgICAicmVhc29uIjogKAogICAgICAgICAgICAgICAgICAgIGYiVG9rZW4gcmFuICh7YzI0OisuMWZ9JSAyNGgpIGJ1dCBpcyBzdGFsbGluZyAoMWgge2MxOisuMWZ9JSwgNmgge2M2OisuMWZ9JSkgIgogICAgICAgICAgICAgICAgICAgIGYid2l0aCBjb29saW5nIGZsb3cgKHR4bnMgMWgge3R4bnNfaDF9LCB2b2wvbGlxIHt2b2xfdG9fbGlxOi4yZn0pLiIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0KCiAgICByZXR1cm4gTm9uZQoKCmRlZiBfZm9ybWF0X3NlbGxfYWxlcnRfbWVzc2FnZSh0b2tlbjogZGljdCwgc2lnbmFsOiBkaWN0LCBjb21wYWN0OiBib29sID0gVHJ1ZSkgLT4gc3RyOgogICAgaW1wb3J0IGh0bWwgYXMgX2h0bWwKICAgIGRlZiBfZXNjKHYpOgogICAgICAgIHJldHVybiBfaHRtbC5lc2NhcGUoc3RyKHYpKQogICAgc2VwID0gIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIKICAgIHN5bWJvbCA9IHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgbWFya2V0X2NhcCA9IHRva2VuLmdldCgibWFya2V0X2NhcCIpCiAgICBmZHYgPSB0b2tlbi5nZXQoImZkdiIpCiAgICBjYXBfdmFsdWUgPSBtYXJrZXRfY2FwIGlmIGlzaW5zdGFuY2UobWFya2V0X2NhcCwgKGludCwgZmxvYXQpKSBhbmQgbWFya2V0X2NhcCA+IDAgZWxzZSBmZHYKICAgIG1vdmVfMjQgPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgcHJpb3JpdHkgPSAiUDEiIGlmIG1vdmVfMjQgPD0gLTEwIGVsc2UgKCJQMiIgaWYgbW92ZV8yNCA8PSAtNSBlbHNlICJQMyIpCiAgICBwcmlvcml0eV9lbW9qaSA9ICLwn5S0IiBpZiBwcmlvcml0eSA9PSAiUDEiIGVsc2UgKCLwn5+gIiBpZiBwcmlvcml0eSA9PSAiUDIiIGVsc2UgIvCfn6EiKQogICAgYWN0aW9uID0gc3RyKHNpZ25hbC5nZXQoImFjdGlvbiIpIG9yICJEZS1yaXNrIikKICAgIHJlYXNvbiA9IHN0cihzaWduYWwuZ2V0KCJyZWFzb24iKSBvciAiRmxvdyBkZXRlcmlvcmF0aW9uIGRldGVjdGVkLiIpCiAgICBzaWduYWxfdGl0bGUgPSBzdHIoc2lnbmFsLmdldCgidGl0bGUiKSBvciAiRXhpdCBXYXJuaW5nIikKICAgIHByaWNlX2xpbmUgPSBmIntfZm10X3VzZF9jb21wYWN0X21haW4odG9rZW4uZ2V0KCdwcmljZScpKX0gfCAyNEgge19mbXRfcGN0X21haW4odG9rZW4uZ2V0KCdjaGFuZ2VfMjRoJykpfSIKCiAgICBsaW5lcyA9IFsKICAgICAgICBmIjxiPvCfmqggW1NJR05BTF06IFNFTEwgLyBFWElUPC9iPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+OryBDT0lOOiAke19lc2Moc3ltYm9sKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk4ogUFJPRklMRToge19lc2MoX21vZGUoKS51cHBlcigpKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntwcmlvcml0eV9lbW9qaX0gUFJJT1JJVFk6IHtfZXNjKHByaW9yaXR5KX0g4oCUIHtfZXNjKHNpZ25hbF90aXRsZSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KwIE1BUktFVENBUDoge19lc2MoX2ZtdF91c2RfY29tcGFjdF9tYWluKGNhcF92YWx1ZSkpfSB8IDI0SCB7X2VzYyhfZm10X3BjdF9tYWluKHRva2VuLmdldCgnY2hhbmdlXzI0aCcpKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KnIExJUVVJRElUWToge19lc2MoX2ZtdF91c2RfY29tcGFjdF9tYWluKHRva2VuLmdldCgnbGlxdWlkaXR5JykpKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5S0IFNJR05BTDoge19lc2MoYWN0aW9uLnVwcGVyKCkpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TnSBSRUFTT046IHtfZXNjKHJlYXNvbil9PC9jb2RlPiIsCiAgICBdCiAgICBpZiBub3QgY29tcGFjdDoKICAgICAgICBsaW5lcyArPSBbCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5qrIElOVkFMSUQ6IE1vbWVudHVtICsgdm9sdW1lIHJlY292ZXJ5PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+UhCBEQVRBOiBMaXZlIHJlZnJlc2ggb24gYWxlcnQgc2VuZDwvY29kZT4iLAogICAgICAgIF0KICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIF9ub3JtYWxpemVfbWFya2V0X3RpZXIocmF3OiBzdHIgfCBOb25lKSAtPiBzdHI6CiAgICB2YWx1ZSA9IHN0cihyYXcgb3IgImJhbGFuY2VkIikuc3RyaXAoKS5sb3dlcigpCiAgICBhbGlhc2VzID0gewogICAgICAgICJjIjogImNvbnNlcnZhdGl2ZSIsCiAgICAgICAgImNvbnMiOiAiY29uc2VydmF0aXZlIiwKICAgICAgICAiY29uc2VydmF0aXZlIjogImNvbnNlcnZhdGl2ZSIsCiAgICAgICAgImIiOiAiYmFsYW5jZWQiLAogICAgICAgICJiYWwiOiAiYmFsYW5jZWQiLAogICAgICAgICJiYWxhbmNlZCI6ICJiYWxhbmNlZCIsCiAgICAgICAgImEiOiAiYWdncmVzc2l2ZSIsCiAgICAgICAgImFnZyI6ICJhZ2dyZXNzaXZlIiwKICAgICAgICAiYWdncmVzc2l2ZSI6ICJhZ2dyZXNzaXZlIiwKICAgIH0KICAgIHJldHVybiBhbGlhc2VzLmdldCh2YWx1ZSwgImJhbGFuY2VkIikKCgpkZWYgX3N0cmljdGVyX2NvbmZpZGVuY2UobWluX2E6IHN0ciwgbWluX2I6IHN0cikgLT4gc3RyOgogICAgYSA9IHN0cihtaW5fYSBvciAiQiIpLnVwcGVyKCkKICAgIGIgPSBzdHIobWluX2Igb3IgIkIiKS51cHBlcigpCiAgICBpZiBhIG5vdCBpbiBfQ09ORklERU5DRV9PUkRFUjoKICAgICAgICBhID0gIkIiCiAgICBpZiBiIG5vdCBpbiBfQ09ORklERU5DRV9PUkRFUjoKICAgICAgICBiID0gIkIiCiAgICByZXR1cm4gYSBpZiBfQ09ORklERU5DRV9PUkRFUlthXSA+PSBfQ09ORklERU5DRV9PUkRFUltiXSBlbHNlIGIKCgpkZWYgX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kOiBpbnQgPSA1LCBsaW1pdF9iYWQ6IGludCA9IDUsIHRpZXI6IHN0ciA9ICJiYWxhbmNlZCIpIC0+IGRpY3Q6CiAgICB0aWVyX2tleSA9IF9ub3JtYWxpemVfbWFya2V0X3RpZXIodGllcikKICAgIHRpZXJfcnVsZSA9IF9tYXJrZXRfdGllcl9ydWxlKHRpZXJfa2V5KQogICAgcmlza19zdHlsZSA9IF9ub3JtYWxpemVfcmlza19zdHlsZShfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSkKICAgIHRva2VucyA9IGZldGNoX21hcmtldF9kYXRhKCkgb3IgW10KICAgIHJlZ2ltZSA9IF9jb21wdXRlX3JlZ2ltZSh0b2tlbnMpCiAgICBzb2xfcHJveHkgPSBfY29tcHV0ZV9zb2xfcmVnaW1lX3Byb3h5KCkKICAgIHBvbGljeSA9IF9idWlsZF9tYXJrZXRfcG9saWN5KHJlZ2ltZSwgc29sX3Byb3h5KQoKICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInRva2VucyI6IDAsCiAgICAgICAgICAgICJwb2xpY3kiOiBwb2xpY3ksCiAgICAgICAgICAgICJyZWdpbWUiOiByZWdpbWUsCiAgICAgICAgICAgICJnb29kIjogW10sCiAgICAgICAgICAgICJiYWQiOiBbXSwKICAgICAgICAgICAgInJlZ2ltZV9ibG9ja2VkIjogRmFsc2UsCiAgICAgICAgICAgICJ0aWVyIjogdGllcl9rZXksCiAgICAgICAgICAgICJ0aWVyX3J1bGUiOiB0aWVyX3J1bGUsCiAgICAgICAgICAgICJyaXNrX3N0eWxlIjogcmlza19zdHlsZSwKICAgICAgICB9CgogICAgcmVnaW1lX21pbiA9IGZsb2F0KHBvbGljeVsicmVnaW1lX21pbl9zY29yZSJdKQogICAgcmVnaW1lX2Jsb2NrZWQgPSBFTkFCTEVfUkVHSU1FX0dBVEUgYW5kIHJlZ2ltZVsic2NvcmUiXSA8IHJlZ2ltZV9taW4KCiAgICBzY29yZWQgPSBbXQogICAgZm9yIHRva2VuIGluIHRva2VuczoKICAgICAgICBpZiBub3QgdG9rZW4uZ2V0KCJhZGRyZXNzIik6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgIyBFbnJpY2ggd2l0aCBCaXJkRXllIG92ZXJ2aWV3IGRhdGEgKHVuaXF1ZSB3YWxsZXRzLCBzb2NpYWwsIGV0Yy4pCiAgICAgICAgdG9rZW4gPSBfZW5yaWNoX3Rva2VuX2Zvcl9zY29yaW5nKHRva2VuKQogICAgICAgIHRva2VuWyJlbmdpbmVfcHJvZmlsZSJdID0gX21vZGUoKQogICAgICAgIHNjb3JlID0gY2FsY3VsYXRlX3Rva2VuX3Njb3JlKHRva2VuKQogICAgICAgIGNvbmZpZGVuY2UgPSBfY29uZmlkZW5jZV9mcm9tX3Njb3JlKHNjb3JlKQogICAgICAgIHRva2VuWyJzY29yZSJdID0gc2NvcmUKICAgICAgICB0b2tlblsiY29uZmlkZW5jZSJdID0gY29uZmlkZW5jZQogICAgICAgIHNjb3JlZC5hcHBlbmQodG9rZW4pCgogICAgc2NvcmVkLnNvcnQoa2V5PWxhbWJkYSB0OiAoZmxvYXQodC5nZXQoInNjb3JlIiwgMCkgb3IgMCksIGZsb2F0KHQuZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkpLCByZXZlcnNlPVRydWUpCgogICAgZ29vZCA9IFtdCiAgICBiYWQgPSBbXQogICAgcmVxdWlyZWRfY29uZiA9IF9zdHJpY3Rlcl9jb25maWRlbmNlKHBvbGljeVsibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiXSwgdGllcl9ydWxlWyJtaW5fY29uZmlkZW5jZSJdKQogICAgcmVxdWlyZWRfc2NvcmUgPSBmbG9hdChwb2xpY3lbImFsZXJ0X3RocmVzaG9sZCJdKSArIGZsb2F0KHRpZXJfcnVsZVsibWluX3Njb3JlX2RlbHRhIl0pCiAgICByZXF1aXJlZF9zY29yZSA9IG1heCgwLjAsIG1pbigxMDAuMCwgcmVxdWlyZWRfc2NvcmUpKQogICAgd2FsbGV0X3RhcmdldCA9ICJXMyIgaWYgdGllcl9rZXkgPT0gImFnZ3Jlc3NpdmUiIGVsc2UgKCJXMS9XMiIgaWYgdGllcl9rZXkgPT0gImNvbnNlcnZhdGl2ZSIgZWxzZSAiVzIiKQoKICAgIGZvciB0b2tlbiBpbiBzY29yZWQ6CiAgICAgICAgc3ltYm9sID0gdG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIKICAgICAgICByZWFzb25zID0gW10KICAgICAgICBsaXF1aWRpdHkgPSBmbG9hdCh0b2tlbi5nZXQoImxpcXVpZGl0eSIsIDApIG9yIDApCiAgICAgICAgdm9sdW1lXzI0aCA9IGZsb2F0KHRva2VuLmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApCiAgICAgICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICAgICAgdm9sX3RvX2xpcSA9ICh2b2x1bWVfMjRoIC8gbGlxdWlkaXR5KSBpZiBsaXF1aWRpdHkgPiAwIGVsc2UgMC4wCgogICAgICAgIHRva2VuWyJ3YWxsZXRfZml0Il0gPSB3YWxsZXRfdGFyZ2V0CiAgICAgICAgcmlza19wbGFuLCByb3RhdGlvbl9wbGFuID0gX3dhbGxldF9ndWlkYW5jZSh3YWxsZXRfdGFyZ2V0KQogICAgICAgIHRva2VuWyJyaXNrX3BsYW4iXSA9IHJpc2tfcGxhbgogICAgICAgIHRva2VuWyJyb3RhdGlvbl9wbGFuIl0gPSByb3RhdGlvbl9wbGFuCgogICAgICAgIGlmIG5vdCBfcGFzc2VzX3F1YWxpdHlfZmlsdGVycyh0b2tlbik6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJmYWlscyBiYXNlIHF1YWxpdHkgZmlsdGVycyIpCiAgICAgICAgaWYgbm90IF9wYXNzZXNfZXhlY3V0aW9uX3F1YWxpdHlfZmlsdGVycyh0b2tlbik6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJmYWlscyBleGVjdXRpb24gcXVhbGl0eSBmaWx0ZXJzIikKICAgICAgICBpZiBub3QgX3Bhc3Nlc190YWN0aWNhbF9maWx0ZXJzKHRva2VuKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoImZhaWxzIHRhY3RpY2FsIGNvbmZpcm1hdGlvbiIpCiAgICAgICAgaWYgbGlxdWlkaXR5IDwgZmxvYXQodGllcl9ydWxlWyJtaW5fbGlxdWlkaXR5Il0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmImxpcTwke2ludCh0aWVyX3J1bGVbJ21pbl9saXF1aWRpdHknXSk6LH0iKQogICAgICAgIGlmIHZvbHVtZV8yNGggPCBmbG9hdCh0aWVyX3J1bGVbIm1pbl92b2x1bWVfMjRoIl0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmInZvbDI0aDwke2ludCh0aWVyX3J1bGVbJ21pbl92b2x1bWVfMjRoJ10pOix9IikKICAgICAgICBpZiBjaGFuZ2VfMjRoIDwgZmxvYXQodGllcl9ydWxlWyJtaW5fY2hhbmdlXzI0aCJdKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoZiIyNGg8e3RpZXJfcnVsZVsnbWluX2NoYW5nZV8yNGgnXTorLjFmfSUiKQogICAgICAgIGlmIGFicyhjaGFuZ2VfMjRoKSA+IGZsb2F0KHRpZXJfcnVsZVsibWF4X2Fic19jaGFuZ2VfMjRoIl0pOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmInwyNGh8Pnt0aWVyX3J1bGVbJ21heF9hYnNfY2hhbmdlXzI0aCddOi4wZn0lIikKICAgICAgICBpZiB2b2xfdG9fbGlxID4gZmxvYXQodGllcl9ydWxlWyJtYXhfdm9sX3RvX2xpcSJdKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoInR1cm5vdmVyIG92ZXJoZWF0ZWQiKQogICAgICAgIGlmIGZsb2F0KHRva2VuLmdldCgic2NvcmUiLCAwKSBvciAwKSA8IHJlcXVpcmVkX3Njb3JlOgogICAgICAgICAgICByZWFzb25zLmFwcGVuZChmInNjb3JlPHtyZXF1aXJlZF9zY29yZTouMWZ9IikKICAgICAgICBpZiBub3QgX2NvbmZpZGVuY2VfbWVldHNfcnVsZSh0b2tlbi5nZXQoImNvbmZpZGVuY2UiLCAiQyIpLCByZXF1aXJlZF9jb25mKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoZiJjb25maWRlbmNlPHtyZXF1aXJlZF9jb25mfSIpCiAgICAgICAgaWYgX2lzX3N5bWJvbF9vbl9jb29sZG93bihzeW1ib2wsIGNvb2xkb3duX2hvdXJzPXBvbGljeVsiYWxlcnRfY29vbGRvd25faG91cnMiXSk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJjb29sZG93biBhY3RpdmUiKQogICAgICAgIGlmIF9hcHBseV9zeW1ib2xfY29udHJvbHMoc3ltYm9sKToKICAgICAgICAgICAgcmVhc29ucy5hcHBlbmQoInN5bWJvbCBjb250cm9sIGFjdGl2ZSIpCiAgICAgICAgaWYgcmVnaW1lX2Jsb2NrZWQgYW5kIG5vdCBib29sKHRpZXJfcnVsZVsiYWxsb3dfcmlza19vZmYiXSk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJyZWdpbWUgZ2F0ZSBibG9ja2VkIikKICAgICAgICBpZiBwb2xpY3lbInN0YXRlIl0gaW4geyJSSVNLX09GRiIsICJFWFRSRU1FX1JJU0tfT0ZGIn0gYW5kIG5vdCBib29sKHRpZXJfcnVsZVsiYWxsb3dfcmlza19vZmYiXSk6CiAgICAgICAgICAgIHJlYXNvbnMuYXBwZW5kKCJyaXNrLW9mZiBzdGF0ZSIpCgogICAgICAgIGlmIG5vdCByZWFzb25zOgogICAgICAgICAgICBnb29kLmFwcGVuZCh0b2tlbikKICAgICAgICBlbHNlOgogICAgICAgICAgICBiYWQuYXBwZW5kKCh0b2tlbiwgcmVhc29ucykpCgogICAgcmV0dXJuIHsKICAgICAgICAidG9rZW5zIjogbGVuKHNjb3JlZCksCiAgICAgICAgInBvbGljeSI6IHBvbGljeSwKICAgICAgICAicmVnaW1lIjogcmVnaW1lLAogICAgICAgICJnb29kIjogZ29vZFs6bWF4KDEsIGxpbWl0X2dvb2QpXSwKICAgICAgICAiYmFkIjogYmFkWzptYXgoMSwgbGltaXRfYmFkKV0sCiAgICAgICAgInJlZ2ltZV9ibG9ja2VkIjogcmVnaW1lX2Jsb2NrZWQsCiAgICAgICAgInRpZXIiOiB0aWVyX2tleSwKICAgICAgICAidGllcl9ydWxlIjogdGllcl9ydWxlLAogICAgICAgICJyaXNrX3N0eWxlIjogcmlza19zdHlsZSwKICAgIH0KCgpkZWYgX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcHNob3Q6IGRpY3QsIG1vZGU6IHN0ciA9ICJib3RoIikgLT4gc3RyOgogICAgcG9saWN5ID0gc25hcHNob3RbInBvbGljeSJdCiAgICByZWdpbWUgPSBzbmFwc2hvdFsicmVnaW1lIl0KICAgIHRpZXJfcnVsZSA9IHNuYXBzaG90LmdldCgidGllcl9ydWxlIikgb3Ige30KICAgIHRpZXJfbGFiZWwgPSB0aWVyX3J1bGUuZ2V0KCJsYWJlbCIpIG9yIHN0cihzbmFwc2hvdC5nZXQoInRpZXIiKSBvciAiQmFsYW5jZWQiKS50aXRsZSgpCiAgICByaXNrX3N0eWxlID0gX25vcm1hbGl6ZV9yaXNrX3N0eWxlKHNuYXBzaG90LmdldCgicmlza19zdHlsZSIpKQogICAgaGVhZGVyID0gKAogICAgICAgIGYiTUFSS0VUIE5PVyB8IHtfbW9kZSgpLnVwcGVyKCl9IHwge3RpZXJfbGFiZWx9XG4iCiAgICAgICAgZiJSaXNrIFByb2ZpbGU6IHtfcmlza19zdHlsZV9sYWJlbChyaXNrX3N0eWxlKX1cbiIKICAgICAgICBmIlN0YXRlOiB7cG9saWN5WydzdGF0ZSddfSB8IFNjb3JlIFRocjoge2ludChwb2xpY3lbJ2FsZXJ0X3RocmVzaG9sZCddKX0gfCBDb25mOiB7cG9saWN5WydtaW5fY29uZmlkZW5jZV90b19hbGVydCddfVxuIgogICAgICAgIGYiUmVnaW1lOiB7cmVnaW1lWydsYWJlbCddfSAoe3JlZ2ltZVsnc2NvcmUnXTouMWZ9L3twb2xpY3lbJ3JlZ2ltZV9taW5fc2NvcmUnXTouMWZ9KVxuIgogICAgICAgIGYiVW5pdmVyc2U6IHtzbmFwc2hvdFsndG9rZW5zJ119IHRva2Vuc1xuIgogICAgICAgIGYiVGllciBHYXRlczogbGlxPj17X2ZtdF91c2RfY29tcGFjdF9tYWluKHRpZXJfcnVsZS5nZXQoJ21pbl9saXF1aWRpdHknKSl9ICIKICAgICAgICBmInZvbD49e19mbXRfdXNkX2NvbXBhY3RfbWFpbih0aWVyX3J1bGUuZ2V0KCdtaW5fdm9sdW1lXzI0aCcpKX0iCiAgICApCgogICAgbGluZXMgPSBbaGVhZGVyXQoKICAgIGlmIGludChzbmFwc2hvdC5nZXQoInRva2VucyIsIDApKSA9PSAwOgogICAgICAgIGxpbmVzLmFwcGVuZCgiXG5EYXRhIGZlZWQgdW5hdmFpbGFibGUgcmlnaHQgbm93LiBUcnkgYWdhaW4gaW4gMS0yIG1pbnV0ZXMuIikKICAgICAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKQoKICAgIGlmIG1vZGUgaW4geyJib3RoIiwgImdvb2QifToKICAgICAgICBsaW5lcy5hcHBlbmQoIlxuR09PRCBCVVlTIE5PVyIpCiAgICAgICAgaWYgc25hcHNob3RbImdvb2QiXToKICAgICAgICAgICAgZm9yIGlkeCwgdG9rZW4gaW4gZW51bWVyYXRlKHNuYXBzaG90WyJnb29kIl0sIHN0YXJ0PTEpOgogICAgICAgICAgICAgICAgbGluZXMuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgIGYie2lkeH0uICR7dG9rZW4uZ2V0KCdzeW1ib2wnLCdVTktOT1dOJyl9IHwgc2NvcmUge2Zsb2F0KHRva2VuLmdldCgnc2NvcmUnLDApIG9yIDApOi4xZn0gfCAiCiAgICAgICAgICAgICAgICAgICAgZiJ7dG9rZW4uZ2V0KCdjb25maWRlbmNlJywnQycpfSB8IDI0aCB7ZmxvYXQodG9rZW4uZ2V0KCdjaGFuZ2VfMjRoJywwKSBvciAwKTorLjFmfSUgfCAiCiAgICAgICAgICAgICAgICAgICAgZiJsaXEge19mbXRfdXNkX2NvbXBhY3RfbWFpbih0b2tlbi5nZXQoJ2xpcXVpZGl0eScpKX0gfCBmaXQge3Rva2VuLmdldCgnd2FsbGV0X2ZpdCcsJ1cyJyl9IgogICAgICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vdGUgPSAiTm9uZS4gTWFya2V0IGlzIHNlbGVjdGl2ZSByaWdodCBub3cuIgogICAgICAgICAgICBpZiBzbmFwc2hvdC5nZXQoInJlZ2ltZV9ibG9ja2VkIik6CiAgICAgICAgICAgICAgICBub3RlID0gIk5vbmUuIFJlZ2ltZSBnYXRlIGlzIGJsb2NraW5nIGVudHJpZXMgcmlnaHQgbm93LiIKICAgICAgICAgICAgbGluZXMuYXBwZW5kKG5vdGUpCgogICAgaWYgbW9kZSBpbiB7ImJvdGgiLCAiYmFkIn06CiAgICAgICAgbGluZXMuYXBwZW5kKCJcbkJBRCBCVVlTIE5PVyIpCiAgICAgICAgaWYgc25hcHNob3RbImJhZCJdOgogICAgICAgICAgICBmb3IgaWR4LCBpdGVtIGluIGVudW1lcmF0ZShzbmFwc2hvdFsiYmFkIl0sIHN0YXJ0PTEpOgogICAgICAgICAgICAgICAgdG9rZW4sIHJlYXNvbnMgPSBpdGVtCiAgICAgICAgICAgICAgICByZWFzb25zX3RleHQgPSAiOyAiLmpvaW4ocmVhc29uc1s6M10pCiAgICAgICAgICAgICAgICBsaW5lcy5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgZiJ7aWR4fS4gJHt0b2tlbi5nZXQoJ3N5bWJvbCcsJ1VOS05PV04nKX0gfCAyNGgge2Zsb2F0KHRva2VuLmdldCgnY2hhbmdlXzI0aCcsMCkgb3IgMCk6Ky4xZn0lIHwge3JlYXNvbnNfdGV4dH0iCiAgICAgICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGluZXMuYXBwZW5kKCJObyBvYnZpb3VzIGF2b2lkIGxpc3QgZnJvbSBjdXJyZW50IHVuaXZlcnNlLiIpCgogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCgpkZWYgX2Zvcm1hdF9tYXJrZXRfbm93X211bHRpX3RpZXIobW9kZTogc3RyID0gImJvdGgiKSAtPiBzdHI6CiAgICBzZWN0aW9ucyA9IFtdCiAgICBmb3IgdGllciBpbiAoImNvbnNlcnZhdGl2ZSIsICJiYWxhbmNlZCIsICJhZ2dyZXNzaXZlIik6CiAgICAgICAgc25hcCA9IF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZD0zLCBsaW1pdF9iYWQ9MywgdGllcj10aWVyKQogICAgICAgIHNlY3Rpb25zLmFwcGVuZChfZm9ybWF0X21hcmtldF9ub3dfbWVzc2FnZShzbmFwLCBtb2RlPW1vZGUpKQogICAgcmV0dXJuICJcblxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiIuam9pbihzZWN0aW9ucykKCgpkZWYgX3RpZXJfYXJnX29yX2RlZmF1bHQoYXJncywgZGVmYXVsdDogc3RyID0gImJhbGFuY2VkIik6CiAgICBpZiBub3QgYXJnczoKICAgICAgICByZXR1cm4gZGVmYXVsdAogICAgcmF3ID0gc3RyKGFyZ3NbMF0pLnN0cmlwKCkubG93ZXIoKQogICAgaWYgcmF3ID09ICJhbGwiOgogICAgICAgIHJldHVybiAiYWxsIgogICAgcmV0dXJuIF9ub3JtYWxpemVfbWFya2V0X3RpZXIocmF3KQoKCmRlZiBfZm9ybWF0X3dhbGxldDJfbWVzc2FnZShtb2RlOiBzdHIgPSAiYm90aCIpIC0+IHN0cjoKICAgIGJhc2UgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9NSwgbGltaXRfYmFkPTUsIHRpZXI9ImJhbGFuY2VkIikKICAgIHN0YXRlID0gc3RyKChiYXNlLmdldCgicG9saWN5Iikgb3Ige30pLmdldCgic3RhdGUiKSBvciAiIikKICAgIHNuYXAgPSBiYXNlCiAgICBpZiBzdGF0ZSBpbiB7IlJJU0tfT0ZGIiwgIkVYVFJFTUVfUklTS19PRkYifToKICAgICAgICBzbmFwID0gX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPTUsIGxpbWl0X2JhZD01LCB0aWVyPSJjb25zZXJ2YXRpdmUiKQogICAgcmV0dXJuIF93YWxsZXRfaGVhZGVyKCJXMiIpICsgIlxuXG4iICsgX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT1tb2RlKQoKCmRlZiBfZm9ybWF0X3dhbGxldDNfbWVzc2FnZShtb2RlOiBzdHIgPSAiYm90aCIpIC0+IHN0cjoKICAgIHNuYXAgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9NSwgbGltaXRfYmFkPTUsIHRpZXI9ImFnZ3Jlc3NpdmUiKQogICAgcm93cyA9IF9idWlsZF93YXRjaGxpc3Rfcm93cygpCiAgICBsaXZlX3Jvd3MgPSBbciBmb3IgciBpbiByb3dzIGlmIGJvb2woci5nZXQoImhhc19saXZlX2RhdGEiLCBGYWxzZSkpXQogICAgZ29vZF93YXRjaCA9IFsKICAgICAgICByIGZvciByIGluIGxpdmVfcm93cwogICAgICAgIGlmIHN0cihyLmdldCgic3RhdHVzIikgb3IgIiIpLnRpdGxlKCkgaW4geyJNb21lbnR1bSIsICJSZWNsYWltIn0KICAgICAgICBhbmQgc3RyKHIuZ2V0KCJmYWlsdXJlX3Jpc2siKSBvciAiIikudGl0bGUoKSAhPSAiSGlnaCIKICAgIF1bOjRdCiAgICBiYWRfd2F0Y2ggPSBbCiAgICAgICAgciBmb3IgciBpbiByb3dzCiAgICAgICAgaWYgc3RyKHIuZ2V0KCJzdGF0dXMiKSBvciAiIikudGl0bGUoKSBpbiB7IkJyZWFrZG93biIsICJJbGxpcXVpZCIsICJOb0RhdGEifQogICAgICAgIG9yIHN0cihyLmdldCgiZmFpbHVyZV9yaXNrIikgb3IgIiIpLnRpdGxlKCkgPT0gIkhpZ2giCiAgICBdWzo0XQoKICAgIGxpbmVzID0gW193YWxsZXRfaGVhZGVyKCJXMyIpLCAiIl0KICAgIGlmIG1vZGUgaW4geyJib3RoIiwgImdvb2QifToKICAgICAgICBsaW5lcy5hcHBlbmQoIlczIFdBVENITElTVCBPUFBPUlRVTklUSUVTIikKICAgICAgICBpZiBnb29kX3dhdGNoOgogICAgICAgICAgICBmb3IgaWR4LCByIGluIGVudW1lcmF0ZShnb29kX3dhdGNoLCBzdGFydD0xKToKICAgICAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICBmIntpZHh9LiAke3N0cihyLmdldCgnc3ltYm9sJykgb3IgJ1VOS05PV04nKS51cHBlcigpfSB8IHtyLmdldCgnc3RhdHVzJyl9IHwgIgogICAgICAgICAgICAgICAgICAgIGYidXBzaWRlIHtyLmdldCgndXBzaWRlX3BvdGVudGlhbCcsJ04vQScpfSB8IHJpc2sge3IuZ2V0KCdmYWlsdXJlX3Jpc2snLCdOL0EnKX0gfCAiCiAgICAgICAgICAgICAgICAgICAgZiIyNGgge2Zsb2F0KHIuZ2V0KCdjaGFuZ2VfMjRoJywwKSBvciAwKTorLjFmfSUiCiAgICAgICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGluZXMuYXBwZW5kKCJObyB3YXRjaGxpc3Qgc2V0dXBzIHdpdGggZmF2b3JhYmxlIGFzeW1tZXRyeSByaWdodCBub3cuIikKICAgICAgICBsaW5lcy5hcHBlbmQoIiIpCgogICAgaWYgbW9kZSBpbiB7ImJvdGgiLCAiYmFkIn06CiAgICAgICAgbGluZXMuYXBwZW5kKCJXMyBXQVRDSExJU1QgQVZPSUQvQ0FVVElPTiIpCiAgICAgICAgaWYgYmFkX3dhdGNoOgogICAgICAgICAgICBmb3IgaWR4LCByIGluIGVudW1lcmF0ZShiYWRfd2F0Y2gsIHN0YXJ0PTEpOgogICAgICAgICAgICAgICAgc3RhdHVzID0gc3RyKHIuZ2V0KCJzdGF0dXMiKSBvciAiVW5rbm93biIpCiAgICAgICAgICAgICAgICByZWFzb24gPSBzdHIoci5nZXQoInJlYXNvbiIpIG9yICIiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiByZWFzb246CiAgICAgICAgICAgICAgICAgICAgcmVhc29uID0gZiIgfCB7cmVhc29ufSIKICAgICAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICBmIntpZHh9LiAke3N0cihyLmdldCgnc3ltYm9sJykgb3IgJ1VOS05PV04nKS51cHBlcigpfSB8IHtzdGF0dXN9IHwgIgogICAgICAgICAgICAgICAgICAgIGYicmlzayB7ci5nZXQoJ2ZhaWx1cmVfcmlzaycsJ04vQScpfXtyZWFzb259IgogICAgICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxpbmVzLmFwcGVuZCgiTm8gbWFqb3Igd2F0Y2hsaXN0IGRhbmdlciBmbGFncyByaWdodCBub3cuIikKICAgICAgICBsaW5lcy5hcHBlbmQoIiIpCgogICAgaWYgbW9kZSBpbiB7ImJvdGgiLCAiZ29vZCJ9OgogICAgICAgIGxpbmVzLmFwcGVuZChfZm9ybWF0X21hcmtldF9ub3dfbWVzc2FnZShzbmFwLCBtb2RlPSJnb29kIikpCiAgICBlbGlmIG1vZGUgPT0gImJhZCI6CiAgICAgICAgbGluZXMuYXBwZW5kKF9mb3JtYXRfbWFya2V0X25vd19tZXNzYWdlKHNuYXAsIG1vZGU9ImJhZCIpKQogICAgZWxzZToKICAgICAgICBsaW5lcy5hcHBlbmQoX2Zvcm1hdF9tYXJrZXRfbm93X21lc3NhZ2Uoc25hcCwgbW9kZT0iYm90aCIpKQogICAgcmV0dXJuICJcbiIuam9pbihsaW5lcykKCgphc3luYyBkZWYgY21kX2hlbHAodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgIkNvbW1hbmRzOlxuIgogICAgICAgICIvc3RhdHVzIC0gRW5naW5lIGhlYWx0aCBzbmFwc2hvdFxuIgogICAgICAgICIvbW9kZSBbc3RyYXRlZ2ljfHRhY3RpY2FsXSAtIFN3aXRjaCBydW50aW1lICsgcGVyc2lzdCBwcmVzZXRcbiIKICAgICAgICAiL3Jpc2twcm9maWxlIFtjYXBpdGFsfGJhbGFuY2VkfHNuaXBlcl0gLSBTZXQgbWFya2V0IHNjYW4gcmlzayBzdHlsZVxuIgogICAgICAgICIvcmlzayAtIFJpc2sgZ292ZXJub3Igc3RhdGVcbiIKICAgICAgICAiL3BhdXNlIFtob3Vyc10gLSBQYXVzZSBhbGVydHNcbiIKICAgICAgICAiL3Jlc3VtZSAtIENsZWFyIHBhdXNlXG4iCiAgICAgICAgIi9wZXJmb3JtYW5jZSAtIDI0aC83ZCBwZXJmb3JtYW5jZSBwYW5lbFxuIgogICAgICAgICIvYnV5IDxzeW1ib2xfb3JfbWludD4gW2VudHJ5XSAtIFN0YXJ0IHRyYWNrZWQgcG9zaXRpb24gKGVuYWJsZXMgc2VsbCBhbGVydHMpXG4iCiAgICAgICAgIi9zb2xkIDxzeW1ib2xfb3JfbWludD4gW2V4aXRdIC0gQ2xvc2UgdHJhY2tlZCBwb3NpdGlvblxuIgogICAgICAgICIvcG9zaXRpb25zIC0gU2hvdyB0cmFja2VkIG9wZW4gcG9zaXRpb25zXG4iCiAgICAgICAgIi9kaWdlc3QgLSBTZW5kIGltbWVkaWF0ZSBzZXR1cCBkaWdlc3RcbiIKICAgICAgICAiL21hcmtldG5vdyBbY29uc2VydmF0aXZlfGJhbGFuY2VkfGFnZ3Jlc3NpdmV8YWxsXSAtIEdvb2QrYmFkIG5vd1xuIgogICAgICAgICIvZ29vZGJ1eSBbY29uc2VydmF0aXZlfGJhbGFuY2VkfGFnZ3Jlc3NpdmV8YWxsXSAtIEdvb2QgYnV5cyBub3dcbiIKICAgICAgICAiL2JhZGJ1eSBbY29uc2VydmF0aXZlfGJhbGFuY2VkfGFnZ3Jlc3NpdmV8YWxsXSAtIEJhZCBidXlzIG5vd1xuIgogICAgICAgICIvd2FsbGV0Mm5vdyAtIFdhbGxldCAyIGdvb2QgYnV5cyBub3dcbiIKICAgICAgICAiL3dhbGxldDJiYWQgLSBXYWxsZXQgMiBhdm9pZHMgbm93XG4iCiAgICAgICAgIi93YWxsZXQzbm93IC0gV2FsbGV0IDMgb3Bwb3J0dW5pdGllcyBub3dcbiIKICAgICAgICAiL3dhbGxldDNiYWQgLSBXYWxsZXQgMyBkYW5nZXIgbGlzdCBub3dcbiIKICAgICAgICAiL3dhbGxldHBsYW4gLSBXYWxsZXQgYWxsb2NhdGlvbi9yaXNrIHBsYXlib29rXG4iCiAgICAgICAgIi9ydW5uZXJ3YXRjaCAtIFJ1biBmaXJzdC1kYXkgcnVubmVyIHdhdGNoIHNjYW4gbm93XG4iCiAgICAgICAgIi93YXRjaGxpc3QgLSBSdW4gbWFudWFsIHdhdGNobGlzdCBzY2FuIG5vd1xuIgogICAgICAgICIvd2F0Y2hsaXN0c3VtbWFyeSAtIFNlbmQgZnVsbCBtYW51YWwgd2F0Y2hsaXN0IHN1bW1hcnkgbm93XG4iCiAgICAgICAgIkF1dG8gam9iczogMy10aWVyIGJvYXJkICg2aCkgKyBkYWlseSByZWNhcCArIHNlbGwvZXhpdCBzY2FubmVyIChvbmx5IHRyYWNrZWQgcG9zaXRpb25zKVxuIgogICAgICAgICIvaGVscCAtIFRoaXMgbWVudSIKICAgICkKCgphc3luYyBkZWYgY21kX3N0YXR1cyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBoZWFsdGggPSBnZXRfZW5naW5lX2hlYWx0aF9zbmFwc2hvdCgpCiAgICBwZXJmID0gZ2V0X3BlcmZvcm1hbmNlX3N1bW1hcnkobG9va2JhY2tfaG91cnM9MjQpCiAgICBwYXVzZSA9IGdldF9yaXNrX3BhdXNlX3N0YXRlKCkKICAgIGxhdGVzdCA9IGdldF9sYXRlc3RfZW5naW5lX2V2ZW50KCkgb3Ige30KICAgIGJsb2NrZXIgPSAoCiAgICAgICAgZiJ7bGF0ZXN0LmdldCgnZGVjaXNpb24nKX0gfCB7bGF0ZXN0LmdldCgnbm90ZXMnLCAnJyl9IgogICAgICAgIGlmIGxhdGVzdC5nZXQoImRlY2lzaW9uIikKICAgICAgICBlbHNlICJOL0EiCiAgICApCiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgbGVnYWN5X3N0YXR1cyA9ICJPTiIgaWYgTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQgZWxzZSAiT0ZGIgogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn6SWIFtTVEFUVVNdOiBFTkdJTkU8L2I+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57X2N1cnJlbnRfbW9kZV90ZXh0KCl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+VkCBMYXN0IHNjYW46ICAge19mbXRfZHQoaGVhbHRoLmdldCgnbGFzdF9zY2FuX3J1bicpKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk6IgTGFzdCBhbGVydDogIHtfZm10X2R0KGhlYWx0aC5nZXQoJ2xhc3RfYWxlcnQnKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OKIDI0aCBzdGF0czogICB7cGVyZlsnc2NhbnMnXX0gc2NhbnMgLyB7cGVyZlsnYWxlcnRzJ119IGFsZXJ0cyAoe3BlcmZbJ2FsZXJ0X3JhdGUnXTouMWZ9JSk8L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKPuCAgUGF1c2UgdW50aWw6IHtfZm10X2R0KHBhdXNlLmdldCgncGF1c2VfdW50aWwnKSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+UjiBMRUdBQ1kgUkVDT1ZFUlk6IHtsZWdhY3lfc3RhdHVzfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+ICAgQWdlIOKJpXtMRUdBQ1lfUkVDT1ZFUllfTUlOX0FHRV9EQVlTOi4wZn1kIHwgTGlxIOKJpSR7TEVHQUNZX1JFQ09WRVJZX01JTl9MSVFVSURJVFkvMWU2Oi4xZn1NIHwgVm9sIOKJpSR7TEVHQUNZX1JFQ09WRVJZX01JTl9WT0xVTUVfMjRILzFlMzouMGZ9SzwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPuKaoSBMYXRlc3QgZXZlbnQ6IHtodG1sLmVzY2FwZShzdHIoYmxvY2tlcikpfTwvY29kZT4iLAogICAgXQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgIlxuIi5qb2luKGxpbmVzKSwKICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICkKCgphc3luYyBkZWYgY21kX21vZGUodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgaWYgbm90IGNvbnRleHQuYXJnczoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIlVzYWdlOiAvbW9kZSBzdHJhdGVnaWMgb3IgL21vZGUgdGFjdGljYWxcblxuIgogICAgICAgICAgICBmIntfY3VycmVudF9tb2RlX3RleHQoKX0iCiAgICAgICAgKQogICAgICAgIHJldHVybgoKICAgIG1vZGUgPSBjb250ZXh0LmFyZ3NbMF0uc3RyaXAoKS5sb3dlcigpCiAgICBpZiBtb2RlIG5vdCBpbiBfTU9ERV9QUkVTRVRTOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJJbnZhbGlkIG1vZGUuIFVzZTogc3RyYXRlZ2ljIG9yIHRhY3RpY2FsIikKICAgICAgICByZXR1cm4KCiAgICBfYXBwbHlfbW9kZShtb2RlKQogICAgX3BlcnNpc3RfbW9kZShtb2RlKQogICAgX3Jlc2NoZWR1bGVfcnVuX2VuZ2luZV9qb2JzKGNvbnRleHQuYXBwbGljYXRpb24pCiAgICBsb2dfc2lnbmFsKAogICAgICAgIHsKICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAiZGVjaXNpb24iOiAiTU9ERV9TV0lUQ0giLAogICAgICAgICAgICAibm90ZXMiOiBmInRlbGVncmFtIG1vZGUgc3dpdGNoIC0+IHttb2RlfSIsCiAgICAgICAgfQogICAgKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgIk1vZGUgc3dpdGNoZWQgYW5kIHBlcnNpc3RlZC5cblxuIgogICAgICAgIGYie19jdXJyZW50X21vZGVfdGV4dCgpfSIKICAgICkKCgphc3luYyBkZWYgY21kX3Jpc2twcm9maWxlKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KCiAgICBjdXJyZW50ID0gX25vcm1hbGl6ZV9yaXNrX3N0eWxlKF9ydW50aW1lLmdldCgicmlza19zdHlsZSIpKQogICAgaWYgbm90IGNvbnRleHQuYXJnczoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIlVzYWdlOiAvcmlza3Byb2ZpbGUgY2FwaXRhbCB8IGJhbGFuY2VkIHwgc25pcGVyXG5cbiIKICAgICAgICAgICAgZiJDdXJyZW50OiB7X3Jpc2tfc3R5bGVfbGFiZWwoY3VycmVudCl9ICh7Y3VycmVudH0pXG4iCiAgICAgICAgICAgIGYie19yaXNrX3N0eWxlX2Rlc2NyaXB0aW9uKGN1cnJlbnQpfSIKICAgICAgICApCiAgICAgICAgcmV0dXJuCgogICAgcmF3ID0gc3RyKGNvbnRleHQuYXJnc1swXSkuc3RyaXAoKS5sb3dlcigpCiAgICByZXNvbHZlZCA9IF9SSVNLX1NUWUxFX0FMSUFTRVMuZ2V0KHJhdykKICAgIGlmIG5vdCByZXNvbHZlZDoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIkludmFsaWQgcmlzayBwcm9maWxlLiBVc2U6IGNhcGl0YWwsIGJhbGFuY2VkLCBvciBzbmlwZXIuIgogICAgICAgICkKICAgICAgICByZXR1cm4KCiAgICBfcnVudGltZVsicmlza19zdHlsZSJdID0gcmVzb2x2ZWQKICAgIF9zZXRfZW52X3ZhbHVlcyh7IlJJU0tfU1RZTEUiOiByZXNvbHZlZH0pCiAgICBsb2dfc2lnbmFsKAogICAgICAgIHsKICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAiZGVjaXNpb24iOiAiUklTS19TVFlMRV9TV0lUQ0giLAogICAgICAgICAgICAibm90ZXMiOiBmInRlbGVncmFtIHJpc2sgc3R5bGUgc3dpdGNoIC0+IHtyZXNvbHZlZH0iLAogICAgICAgIH0KICAgICkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJSaXNrIHByb2ZpbGUgdXBkYXRlZCBhbmQgcGVyc2lzdGVkLlxuXG4iCiAgICAgICAgZiJ7X2N1cnJlbnRfbW9kZV90ZXh0KCl9XG4iCiAgICAgICAgZiJTdHlsZSBkZXRhaWw6IHtfcmlza19zdHlsZV9kZXNjcmlwdGlvbihyZXNvbHZlZCl9IgogICAgKQoKCmFzeW5jIGRlZiBjbWRfcGF1c2UodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgaG91cnMgPSA2CiAgICBpZiBjb250ZXh0LmFyZ3M6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBob3VycyA9IG1heCgxLCBpbnQoY29udGV4dC5hcmdzWzBdKSkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgc2V0X3Jpc2tfcGF1c2UoaG91cnMsICJtYW51YWxfdGVsZWdyYW1fcGF1c2UiKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoZiJBbGVydHMgcGF1c2VkIGZvciB7aG91cnN9aC4iKQoKCmFzeW5jIGRlZiBjbWRfcmVzdW1lKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGNsZWFyX3Jpc2tfcGF1c2UoKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIkFsZXJ0cyByZXN1bWVkIChwYXVzZSBjbGVhcmVkKS4iKQoKCmFzeW5jIGRlZiBjbWRfcmlzayh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBwYXVzZSA9IGdldF9yaXNrX3BhdXNlX3N0YXRlKCkKICAgIHN0cmVhayA9IGdldF9jb25zZWN1dGl2ZV9sb3Npbmdfb3V0Y29tZXNfNGgobGltaXQ9MTAwKQogICAgYWxlcnRzXzI0aCA9IGNvdW50X2FsZXJ0c19zaW5jZShkYXRldGltZS51dGNub3coKSAtIHRpbWVkZWx0YShob3Vycz0yNCkpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAiUmlzayBQYW5lbFxuIgogICAgICAgIGYiR292ZXJub3I6IHsnT04nIGlmIEVOQUJMRV9SSVNLX0dPVkVSTk9SIGVsc2UgJ09GRid9XG4iCiAgICAgICAgZiJBbGVydHMgMjRoOiB7YWxlcnRzXzI0aH0ve01BWF9BTEVSVFNfUEVSX0RBWX1cbiIKICAgICAgICBmIkNvbnNlY3V0aXZlIGxvc2luZyA0aCBvdXRjb21lczoge3N0cmVha30ve01BWF9DT05TRUNVVElWRV80SF9MT1NTRVN9XG4iCiAgICAgICAgZiJQYXVzZSB1bnRpbDoge19mbXRfZHQocGF1c2UuZ2V0KCdwYXVzZV91bnRpbCcpKX1cbiIKICAgICAgICBmIlBhdXNlIHJlYXNvbjoge3BhdXNlLmdldCgncmVhc29uJykgb3IgJ04vQSd9IgogICAgKQoKCmFzeW5jIGRlZiBjbWRfcGVyZm9ybWFuY2UodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgcGVyZiA9IGdldF9wZXJmb3JtYW5jZV9zdW1tYXJ5KGxvb2tiYWNrX2hvdXJzPTI0KQogICAgc2ltID0gZ2V0X3BvcnRmb2xpb19zaW11bGF0aW9uX21ldHJpY3MobG9va2JhY2tfZGF5cz03LCBob3Jpem9uX2hvdXJzPTQpCiAgICBxdWV1ZSA9IGdldF9vdXRjb21lX3F1ZXVlX3N0YXRzKCkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJQZXJmb3JtYW5jZSBQYW5lbFxuIgogICAgICAgIGYiMjRoIHNjYW5zL2FsZXJ0czoge3BlcmZbJ3NjYW5zJ119L3twZXJmWydhbGVydHMnXX0gKHtwZXJmWydhbGVydF9yYXRlJ106LjFmfSUpXG4iCiAgICAgICAgZiJBdmcvTWF4IHNjb3JlOiB7cGVyZlsnYXZnX3Njb3JlJ106LjJmfS97cGVyZlsnbWF4X3Njb3JlJ106LjJmfVxuIgogICAgICAgIGYiU2ltIDdkQDRoOiB0cmFkZXM9e3NpbVsndHJhZGVzJ119IHdpbj17c2ltWyd3aW5fcmF0ZV9wY3QnXTouMWZ9JSAiCiAgICAgICAgZiJleHA9e3NpbVsnZXhwZWN0YW5jeV9wY3QnXTouMmZ9JSBkZD17c2ltWydtYXhfZHJhd2Rvd25fcGN0J106LjJmfSVcbiIKICAgICAgICBmIk91dGNvbWUgcXVldWU6IHBlbmRpbmc9e3F1ZXVlWydwZW5kaW5nJ119IGNvbXBsZXRlPXtxdWV1ZVsnY29tcGxldGUnXX0iCiAgICApCgoKYXN5bmMgZGVmIGNtZF9idXkodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgaWYgbm90IGNvbnRleHQuYXJnczoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIlVzYWdlOiAvYnV5IDxTWU1CT0xfb3JfTUlOVD4gW2VudHJ5X3ByaWNlXVxuIgogICAgICAgICAgICAiRXhhbXBsZTogL2J1eSBQVU1QIDAuMDA0MiIKICAgICAgICApCiAgICAgICAgcmV0dXJuCgogICAgc3ltYm9sLCBtaW50ID0gX3BhcnNlX3N5bWJvbF9vcl9taW50KGNvbnRleHQuYXJnc1swXSkKICAgIGlmIG5vdCBzeW1ib2wgYW5kIG5vdCBtaW50OgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJJbnZhbGlkIHN5bWJvbC9taW50LiBFeGFtcGxlOiAvYnV5IFBVTVAgb3IgL2J1eSA8bWludD4iKQogICAgICAgIHJldHVybgoKICAgIGVudHJ5X292ZXJyaWRlID0gTm9uZQogICAgaWYgbGVuKGNvbnRleHQuYXJncykgPj0gMjoKICAgICAgICBlbnRyeV9vdmVycmlkZSA9IF90cnlfZmxvYXQoY29udGV4dC5hcmdzWzFdKQogICAgICAgIGlmIGVudHJ5X292ZXJyaWRlIGlzIE5vbmUgb3IgZW50cnlfb3ZlcnJpZGUgPD0gMDoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIkludmFsaWQgZW50cnkgcHJpY2UuIEV4YW1wbGU6IC9idXkgUFVNUCAwLjAwNDIiKQogICAgICAgICAgICByZXR1cm4KCiAgICB0b2tlbiA9IF9yZXNvbHZlX3Rva2VuX2Zvcl90cmFja2luZyhzeW1ib2w9c3ltYm9sLCBtaW50PW1pbnQpCiAgICBpZiB0b2tlbjoKICAgICAgICBzeW1ib2wgPSBzeW1ib2wgb3Igc3RyKHRva2VuLmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkgb3IgTm9uZQogICAgICAgIG1pbnQgPSBtaW50IG9yIHRva2VuLmdldCgiYWRkcmVzcyIpCiAgICAgICAgcGFpcl9hZGRyZXNzID0gdG9rZW4uZ2V0KCJwYWlyX2FkZHJlc3MiKQogICAgICAgIGxpdmVfcHJpY2UgPSBfdHJ5X2Zsb2F0KHRva2VuLmdldCgicHJpY2UiKSkKICAgIGVsc2U6CiAgICAgICAgcGFpcl9hZGRyZXNzID0gTm9uZQogICAgICAgIGxpdmVfcHJpY2UgPSBOb25lCgogICAgaWYgbm90IHN5bWJvbCBhbmQgbWludDoKICAgICAgICBzeW1ib2wgPSBzdHIobWludClbOjEwXS51cHBlcigpCiAgICBpZiBub3Qgc3ltYm9sOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJDb3VsZCBub3QgcmVzb2x2ZSBzeW1ib2wgZm9yIHRyYWNraW5nLiBUcnkgL2J1eSA8U1lNQk9MPiA8ZW50cnlfcHJpY2U+LiIpCiAgICAgICAgcmV0dXJuCgogICAgZW50cnlfcHJpY2UgPSBlbnRyeV9vdmVycmlkZSBpZiBlbnRyeV9vdmVycmlkZSBpcyBub3QgTm9uZSBlbHNlIChsaXZlX3ByaWNlIGlmIGxpdmVfcHJpY2UgYW5kIGxpdmVfcHJpY2UgPiAwIGVsc2UgMC4wKQogICAgcmVzdWx0ID0gb3Blbl9tYW51YWxfcG9zaXRpb24oCiAgICAgICAgc3ltYm9sPXN5bWJvbCwKICAgICAgICBtaW50PW1pbnQsCiAgICAgICAgcGFpcl9hZGRyZXNzPXBhaXJfYWRkcmVzcywKICAgICAgICBlbnRyeV9wcmljZT1lbnRyeV9wcmljZSwKICAgICAgICBzdG9wX3ByaWNlPShlbnRyeV9wcmljZSAqIDAuOSBpZiBlbnRyeV9wcmljZSA+IDAgZWxzZSAwLjApLAogICAgICAgIG5vdGVzPSJtYW51YWxfdGVsZWdyYW1fYnV5IiwKICAgICkKICAgIHBvc2l0aW9uID0gcmVzdWx0LmdldCgicG9zaXRpb24iKSBvciB7fQogICAgZW50cnlfb3V0ID0gX3RyeV9mbG9hdChwb3NpdGlvbi5nZXQoImVudHJ5X3ByaWNlIikpCiAgICBtaW50X291dCA9IHN0cihwb3NpdGlvbi5nZXQoIm1pbnQiKSBvciBtaW50IG9yICIiKQoKICAgIGlmIHJlc3VsdC5nZXQoImNyZWF0ZWQiKToKICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgIm1pbnQiOiBtaW50X291dCBvciBOb25lLAogICAgICAgICAgICAgICAgInByaWNlIjogZW50cnlfb3V0LAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIlRSQUNLX1BPU0lUSU9OX09QRU5FRCIsCiAgICAgICAgICAgICAgICAibm90ZXMiOiAibWFudWFsX3RlbGVncmFtX2J1eSIsCiAgICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgZW50cnlfdGV4dCA9IGYie2VudHJ5X291dDouOGZ9IiBpZiBlbnRyeV9vdXQgYW5kIGVudHJ5X291dCA+IDAgZWxzZSAiTi9BIgogICAgICAgIGxpbmVzID0gWwogICAgICAgICAgICAiUG9zaXRpb24gdHJhY2tlZC4iLAogICAgICAgICAgICBmIlN5bWJvbDogJHtzeW1ib2x9IiwKICAgICAgICAgICAgZiJFbnRyeToge2VudHJ5X3RleHR9IiwKICAgICAgICBdCiAgICAgICAgaWYgbWludF9vdXQ6CiAgICAgICAgICAgIGxpbmVzLmFwcGVuZChmIk1pbnQ6IHttaW50X291dH0iKQogICAgICAgIGxpbmVzLmFwcGVuZCgiU2VsbCBhbGVydHMgYXJlIG5vdyBlbmFibGVkIGZvciB0aGlzIHBvc2l0aW9uIG9ubHkuIikKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiXG4iLmpvaW4obGluZXMpKQogICAgICAgIHJldHVybgoKICAgIGxvZ19zaWduYWwoCiAgICAgICAgewogICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAibWludCI6IG1pbnRfb3V0IG9yIE5vbmUsCiAgICAgICAgICAgICJwcmljZSI6IGVudHJ5X291dCwKICAgICAgICAgICAgImRlY2lzaW9uIjogIlRSQUNLX1BPU0lUSU9OX0FMUkVBRFlfT1BFTiIsCiAgICAgICAgICAgICJub3RlcyI6ICJtYW51YWxfdGVsZWdyYW1fYnV5X2R1cGxpY2F0ZSIsCiAgICAgICAgfQogICAgKQogICAgb3BlbmVkX3RzID0gcG9zaXRpb24uZ2V0KCJvcGVuZWRfdHNfdXRjIikgb3IgIk4vQSIKICAgIGVudHJ5X3RleHQgPSBmIntlbnRyeV9vdXQ6LjhmfSIgaWYgZW50cnlfb3V0IGFuZCBlbnRyeV9vdXQgPiAwIGVsc2UgIk4vQSIKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICJQb3NpdGlvbiBhbHJlYWR5IHRyYWNrZWQuXG4iCiAgICAgICAgZiJTeW1ib2w6ICR7c3ltYm9sfVxuIgogICAgICAgIGYiRW50cnk6IHtlbnRyeV90ZXh0fVxuIgogICAgICAgIGYiT3BlbmVkOiB7b3BlbmVkX3RzfVxuIgogICAgICAgICJVc2UgL3NvbGQgPFNZTUJPTD4gd2hlbiB5b3UgZXhpdC4iCiAgICApCgoKYXN5bmMgZGVmIGNtZF9zb2xkKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGlmIG5vdCBjb250ZXh0LmFyZ3M6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICJVc2FnZTogL3NvbGQgPFNZTUJPTF9vcl9NSU5UPiBbZXhpdF9wcmljZV1cbiIKICAgICAgICAgICAgIkV4YW1wbGU6IC9zb2xkIFBVTVAgMC4wMDUxIgogICAgICAgICkKICAgICAgICByZXR1cm4KCiAgICBzeW1ib2wsIG1pbnQgPSBfcGFyc2Vfc3ltYm9sX29yX21pbnQoY29udGV4dC5hcmdzWzBdKQogICAgaWYgbm90IHN5bWJvbCBhbmQgbm90IG1pbnQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIkludmFsaWQgc3ltYm9sL21pbnQuIEV4YW1wbGU6IC9zb2xkIFBVTVAiKQogICAgICAgIHJldHVybgoKICAgIGV4aXRfcHJpY2UgPSBOb25lCiAgICBpZiBsZW4oY29udGV4dC5hcmdzKSA+PSAyOgogICAgICAgIGV4aXRfcHJpY2UgPSBfdHJ5X2Zsb2F0KGNvbnRleHQuYXJnc1sxXSkKICAgICAgICBpZiBleGl0X3ByaWNlIGlzIE5vbmUgb3IgZXhpdF9wcmljZSA8PSAwOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiSW52YWxpZCBleGl0IHByaWNlLiBFeGFtcGxlOiAvc29sZCBQVU1QIDAuMDA1MSIpCiAgICAgICAgICAgIHJldHVybgoKICAgIGNsb3NlZCA9IGNsb3NlX21hbnVhbF9wb3NpdGlvbigKICAgICAgICBzeW1ib2w9c3ltYm9sLAogICAgICAgIG1pbnQ9bWludCwKICAgICAgICBleGl0X3ByaWNlPWV4aXRfcHJpY2UsCiAgICAgICAgbm90ZXM9Im1hbnVhbF90ZWxlZ3JhbV9zb2xkIiwKICAgICkKICAgIGxhYmVsID0gc3ltYm9sIG9yIChzdHIobWludClbOjEwXS51cHBlcigpIGlmIG1pbnQgZWxzZSAiVU5LTk9XTiIpCiAgICBpZiBjbG9zZWQgPD0gMDoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChmIk5vIG9wZW4gdHJhY2tlZCBwb3NpdGlvbiBmb3VuZCBmb3Ige2xhYmVsfS4iKQogICAgICAgIHJldHVybgoKICAgIGxvZ19zaWduYWwoCiAgICAgICAgewogICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sIG9yIGxhYmVsLAogICAgICAgICAgICAibWludCI6IG1pbnQsCiAgICAgICAgICAgICJwcmljZSI6IGV4aXRfcHJpY2UsCiAgICAgICAgICAgICJkZWNpc2lvbiI6ICJUUkFDS19QT1NJVElPTl9DTE9TRUQiLAogICAgICAgICAgICAibm90ZXMiOiBmIm1hbnVhbF90ZWxlZ3JhbV9zb2xkIGNvdW50PXtjbG9zZWR9IiwKICAgICAgICB9CiAgICApCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICBmIkNsb3NlZCB7Y2xvc2VkfSB0cmFja2VkIHBvc2l0aW9uKHMpIGZvciB7bGFiZWx9LlxuIgogICAgICAgICJTZWxsIGFsZXJ0cyBmb3IgdGhpcyB0b2tlbiBhcmUgbm93IGRpc2FibGVkIHVubGVzcyB5b3UgL2J1eSBpdCBhZ2Fpbi4iCiAgICApCgoKYXN5bmMgZGVmIGNtZF9wb3NpdGlvbnModXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgcm93cyA9IGdldF9vcGVuX3Bvc2l0aW9ucyhsaW1pdD0zMCkKICAgIGlmIG5vdCByb3dzOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAiTm8gb3BlbiB0cmFja2VkIHBvc2l0aW9ucy5cbiIKICAgICAgICAgICAgIlNlbGwgYWxlcnRzIGFyZSBjdXJyZW50bHkgcGF1c2VkIGJlY2F1c2Ugbm90aGluZyBpcyBtYXJrZWQgYXMgYm91Z2h0LlxuIgogICAgICAgICAgICAiVXNlIC9idXkgPFNZTUJPTD4gW2VudHJ5X3ByaWNlXS4iCiAgICAgICAgKQogICAgICAgIHJldHVybgoKICAgIGxpbmVzID0gWwogICAgICAgICJUcmFja2VkIE9wZW4gUG9zaXRpb25zIChzZWxsIGFsZXJ0cyBvbmx5IGZvciB0aGVzZSk6IiwKICAgIF0KICAgIGZvciBpZHgsIHJvdyBpbiBlbnVtZXJhdGUocm93cywgc3RhcnQ9MSk6CiAgICAgICAgc3ltYm9sID0gc3RyKHJvdy5nZXQoInN5bWJvbCIpIG9yICJVTktOT1dOIikudXBwZXIoKQogICAgICAgIGVudHJ5ID0gX3RyeV9mbG9hdChyb3cuZ2V0KCJlbnRyeV9wcmljZSIpKQogICAgICAgIGVudHJ5X3RleHQgPSBmIntlbnRyeTouOGZ9IiBpZiBlbnRyeSBhbmQgZW50cnkgPiAwIGVsc2UgIk4vQSIKICAgICAgICBvcGVuZWQgPSBzdHIocm93LmdldCgib3BlbmVkX3RzX3V0YyIpIG9yICJOL0EiKQogICAgICAgIGxpbmVzLmFwcGVuZChmIntpZHh9LiAke3N5bWJvbH0gfCBlbnRyeSB7ZW50cnlfdGV4dH0gfCBvcGVuZWQge29wZW5lZH0iKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIlxuIi5qb2luKGxpbmVzKSkKCgpkZWYgX2J1aWxkX2RpZ2VzdF9tZXNzYWdlKHJvd3M6IGxpc3RbZGljdF0pIC0+IHN0ciB8IE5vbmU6CiAgICBpZiBub3Qgcm93czoKICAgICAgICByZXR1cm4gTm9uZQogICAgdW5pcXVlID0gW10KICAgIHNlZW4gPSBzZXQoKQogICAgZm9yIHJvdyBpbiByb3dzOgogICAgICAgIHN5bWJvbCA9IHJvdy5nZXQoInN5bWJvbCIpCiAgICAgICAgaWYgbm90IHN5bWJvbCBvciBzeW1ib2wgaW4gc2VlbjoKICAgICAgICAgICAgY29udGludWUKICAgICAgICBzZWVuLmFkZChzeW1ib2wpCiAgICAgICAgdW5pcXVlLmFwcGVuZChyb3cpCiAgICAgICAgaWYgbGVuKHVuaXF1ZSkgPj0gU0lHTkFMX0RJR0VTVF9NQVhfSVRFTVM6CiAgICAgICAgICAgIGJyZWFrCiAgICBpZiBub3QgdW5pcXVlOgogICAgICAgIHJldHVybiBOb25lCgogICAgaW1wb3J0IGh0bWwgYXMgX2h0bWwKICAgIGRlZiBfZXNjKHYpOgogICAgICAgIHJldHVybiBfaHRtbC5lc2NhcGUoc3RyKHYpKQogICAgc2VwID0gIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIKICAgIGxpbmVzID0gWwogICAgICAgIGYiPGI+8J+ToSBbU0lHTkFMXTogRElHRVNUPC9iPiIsCiAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+VkCBMT09LQkFDSzoge1NJR05BTF9ESUdFU1RfTE9PS0JBQ0tfSE9VUlN9aDwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TiiBTRVRVUFM6IHtsZW4odW5pcXVlKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICBdCiAgICBmb3IgaWR4LCByb3cgaW4gZW51bWVyYXRlKHVuaXF1ZSwgc3RhcnQ9MSk6CiAgICAgICAgc2NvcmUgPSBmbG9hdChyb3cuZ2V0KCJzY29yZV90b3RhbCIpIG9yIDApCiAgICAgICAgY2hnID0gZmxvYXQocm93LmdldCgiY2hhbmdlXzI0aCIpIG9yIDApCiAgICAgICAgcmVnaW1lID0gcm93LmdldCgicmVnaW1lX2xhYmVsIikgb3IgIk4vQSIKICAgICAgICBjaGdfc3RyID0gZiJ7Y2hnOisuMWZ9JSIKICAgICAgICBzeW0gPSBzdHIocm93LmdldCgic3ltYm9sIikgb3IgIlVOS05PV04iKS51cHBlcigpCiAgICAgICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+e2lkeDowMmR9LiAke19lc2Moc3ltKTo8OX0ge3Njb3JlOi4wZn1wdHMge2NoZ19zdHI6Pjd9IHtfZXNjKHJlZ2ltZSl9PC9jb2RlPiIpCiAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKQoKCmRlZiBfZm9ybWF0X211bHRpX3RpZXJfZ29vZF9idXlfYnVsbGV0aW4ocGVyX3RpZXJfbGltaXQ6IGludCA9IDIpIC0+IHN0cjoKICAgIHRpZXJfb3JkZXIgPSAoImNvbnNlcnZhdGl2ZSIsICJiYWxhbmNlZCIsICJhZ2dyZXNzaXZlIikKICAgIHRpZXJfcHJpb3JpdHkgPSB7ImNvbnNlcnZhdGl2ZSI6IDAsICJiYWxhbmNlZCI6IDEsICJhZ2dyZXNzaXZlIjogMn0KICAgIHRpZXJfZGlzcGxheSA9IHsKICAgICAgICAiY29uc2VydmF0aXZlIjogIkxvbmctVGVybSIsCiAgICAgICAgImJhbGFuY2VkIjogIk1pZC1UZXJtIiwKICAgICAgICAiYWdncmVzc2l2ZSI6ICJTaG9ydC1UZXJtIiwKICAgIH0KCiAgICBzbmFwc2hvdHMgPSB7CiAgICAgICAgdGllcjogX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPW1heCg4LCBwZXJfdGllcl9saW1pdCAqIDMpLCBsaW1pdF9iYWQ9MCwgdGllcj10aWVyKQogICAgICAgIGZvciB0aWVyIGluIHRpZXJfb3JkZXIKICAgIH0KICAgIGJhc2Vfc25hcCA9IHNuYXBzaG90cy5nZXQoImJhbGFuY2VkIikgb3Igc25hcHNob3RzLmdldCgiY29uc2VydmF0aXZlIikgb3Igc25hcHNob3RzLmdldCgiYWdncmVzc2l2ZSIpIG9yIHt9CiAgICByZWdpbWUgPSBiYXNlX3NuYXAuZ2V0KCJyZWdpbWUiKSBvciB7fQogICAgcG9saWN5ID0gYmFzZV9zbmFwLmdldCgicG9saWN5Iikgb3Ige30KICAgIHJlZ2ltZV9zY29yZSA9IGZsb2F0KHJlZ2ltZS5nZXQoInNjb3JlIiwgMCkgb3IgMCkKICAgIHJlZ2ltZV9mbG9vciA9IGZsb2F0KHBvbGljeS5nZXQoInJlZ2ltZV9taW5fc2NvcmUiLCAwKSBvciAwKQogICAgc2lnbmFsX2FjdGlvbiA9ICJCVVkiIGlmIHJlZ2ltZV9zY29yZSA+PSByZWdpbWVfZmxvb3IgZWxzZSAiV0FJVCIKCiAgICBiZXN0X2ZpdF9ieV9zeW1ib2wgPSB7fQogICAgZm9yIHRpZXIgaW4gdGllcl9vcmRlcjoKICAgICAgICBzbmFwID0gc25hcHNob3RzLmdldCh0aWVyKSBvciB7fQogICAgICAgIGZvciB0b2tlbiBpbiBzbmFwLmdldCgiZ29vZCIpIG9yIFtdOgogICAgICAgICAgICBzeW1ib2wgPSBzdHIodG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIpLnVwcGVyKCkKICAgICAgICAgICAgc2NvcmUgPSBmbG9hdCh0b2tlbi5nZXQoInNjb3JlIiwgMCkgb3IgMCkKICAgICAgICAgICAgdm9sdW1lID0gZmxvYXQodG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgICAgICAgICAgZXhpc3RpbmcgPSBiZXN0X2ZpdF9ieV9zeW1ib2wuZ2V0KHN5bWJvbCkKICAgICAgICAgICAgaWYgbm90IGV4aXN0aW5nOgogICAgICAgICAgICAgICAgYmVzdF9maXRfYnlfc3ltYm9sW3N5bWJvbF0gPSB7InRpZXIiOiB0aWVyLCAidG9rZW4iOiB0b2tlbn0KICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBleGlzdGluZ190aWVyID0gc3RyKGV4aXN0aW5nLmdldCgidGllciIpIG9yICJhZ2dyZXNzaXZlIikKICAgICAgICAgICAgZXhpc3RpbmdfdG9rZW4gPSBleGlzdGluZy5nZXQoInRva2VuIikgb3Ige30KICAgICAgICAgICAgZXhpc3Rpbmdfc2NvcmUgPSBmbG9hdChleGlzdGluZ190b2tlbi5nZXQoInNjb3JlIiwgMCkgb3IgMCkKICAgICAgICAgICAgZXhpc3Rpbmdfdm9sdW1lID0gZmxvYXQoZXhpc3RpbmdfdG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiwgMCkgb3IgMCkKICAgICAgICAgICAgaWYgdGllcl9wcmlvcml0eS5nZXQodGllciwgOSkgPCB0aWVyX3ByaW9yaXR5LmdldChleGlzdGluZ190aWVyLCA5KToKICAgICAgICAgICAgICAgIGJlc3RfZml0X2J5X3N5bWJvbFtzeW1ib2xdID0geyJ0aWVyIjogdGllciwgInRva2VuIjogdG9rZW59CiAgICAgICAgICAgIGVsaWYgdGllcl9wcmlvcml0eS5nZXQodGllciwgOSkgPT0gdGllcl9wcmlvcml0eS5nZXQoZXhpc3RpbmdfdGllciwgOSk6CiAgICAgICAgICAgICAgICBpZiAoc2NvcmUsIHZvbHVtZSkgPiAoZXhpc3Rpbmdfc2NvcmUsIGV4aXN0aW5nX3ZvbHVtZSk6CiAgICAgICAgICAgICAgICAgICAgYmVzdF9maXRfYnlfc3ltYm9sW3N5bWJvbF0gPSB7InRpZXIiOiB0aWVyLCAidG9rZW4iOiB0b2tlbn0KCiAgICByYW5rZWQgPSBzb3J0ZWQoCiAgICAgICAgYmVzdF9maXRfYnlfc3ltYm9sLnZhbHVlcygpLAogICAgICAgIGtleT1sYW1iZGEgcm93OiAoCiAgICAgICAgICAgIGZsb2F0KChyb3cuZ2V0KCJ0b2tlbiIpIG9yIHt9KS5nZXQoInNjb3JlIiwgMCkgb3IgMCksCiAgICAgICAgICAgIGZsb2F0KChyb3cuZ2V0KCJ0b2tlbiIpIG9yIHt9KS5nZXQoInZvbHVtZV8yNGgiLCAwKSBvciAwKSwKICAgICAgICApLAogICAgICAgIHJldmVyc2U9VHJ1ZSwKICAgICkKCiAgICBzZXAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgogICAgIyBJZiByZWdpbWUgc2F5cyBCVVkgYnV0IG5vIHRva2VuIGNsZWFyZWQgdGhlIGdhdGVzLCBzaG93IFdBSVQg4oCUIG5vIGNvbnRyYWRpY3Rpb24KICAgIGlmIHNpZ25hbF9hY3Rpb24gPT0gIkJVWSIgYW5kIG5vdCByYW5rZWQ6CiAgICAgICAgc2lnbmFsX2FjdGlvbiA9ICJXQUlUIgogICAgYWN0aW9uX2Vtb2ppID0gIvCfn6IiIGlmIHNpZ25hbF9hY3Rpb24gPT0gIkJVWSIgZWxzZSAi8J+UtCIKICAgIHByb2ZpbGVfbGFiZWwgPSBmIntfbW9kZSgpLnVwcGVyKCl9IHwge19yaXNrX3N0eWxlX2xhYmVsKCl9IgoKICAgIGlmIG5vdCByYW5rZWQ6CiAgICAgICAgbGluZXMgPSBbCiAgICAgICAgICAgIGYiPGI+8J+TiiBbQU5BTFlTSVNdOiBNQVJLRVQ8L2I+IiwKICAgICAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfk4sgUFJPRklMRToge19lc2NfaHRtbF9tYWluKHByb2ZpbGVfbGFiZWwpfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPntzZXB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+e2FjdGlvbl9lbW9qaX0gU1RBVFVTOiB7X2VzY19odG1sX21haW4oc2lnbmFsX2FjdGlvbil9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+OryBCRVNUIEZJVDogV0FJVDwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfk50gUkVBU09OOiBObyBxdWFsaWZpZWQgc2V0dXAgcmlnaHQgbm93PC9jb2RlPiIsCiAgICAgICAgICAgIGYiIiwKICAgICAgICAgICAgZiI8aT5UaXA6IFVzZSAvZ29vZGJ1eSBhbGwgZm9yIGZ1bGwgdGllciBicmVha2Rvd24gb24gZGVtYW5kLjwvaT4iLAogICAgICAgIF0KICAgIGVsc2U6CiAgICAgICAgYmVzdCA9IHJhbmtlZFswXQogICAgICAgIHRva2VuID0gYmVzdC5nZXQoInRva2VuIikgb3Ige30KICAgICAgICB0aWVyID0gc3RyKGJlc3QuZ2V0KCJ0aWVyIikgb3IgImJhbGFuY2VkIikKICAgICAgICB0ZXJtID0gdGllcl9kaXNwbGF5LmdldCh0aWVyLCAiTWlkLVRlcm0iKQogICAgICAgIHRvcF9zeW1ib2wgPSBzdHIodG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiVU5LTk9XTiIpLnVwcGVyKCkKICAgICAgICBzbmFwX2Zvcl90aWVyID0gc25hcHNob3RzLmdldCh0aWVyKSBvciB7fQogICAgICAgIHBvbGljeV9mb3JfdGllciA9IHNuYXBfZm9yX3RpZXIuZ2V0KCJwb2xpY3kiKSBvciB7fQogICAgICAgIHRpZXJfcnVsZV9mb3JfdGllciA9IHNuYXBfZm9yX3RpZXIuZ2V0KCJ0aWVyX3J1bGUiKSBvciB7fQogICAgICAgIHNjb3JlID0gZmxvYXQodG9rZW4uZ2V0KCJzY29yZSIsIDApIG9yIDApCiAgICAgICAgY29uZiA9IHN0cih0b2tlbi5nZXQoImNvbmZpZGVuY2UiKSBvciAiQyIpLnVwcGVyKCkKICAgICAgICBjaGcgPSBmbG9hdCh0b2tlbi5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgICAgIGxpcSA9IF9mbXRfdXNkX2NvbXBhY3RfbWFpbih0b2tlbi5nZXQoImxpcXVpZGl0eSIpKQogICAgICAgIGNhcF92YWwgPSB0b2tlbi5nZXQoIm1hcmtldF9jYXAiKSBvciB0b2tlbi5nZXQoImZkdiIpCiAgICAgICAgY2FwX2Rpc3BsYXkgPSBfZm10X3VzZF9jb21wYWN0X21haW4oY2FwX3ZhbCkgaWYgY2FwX3ZhbCBlbHNlICJOL0EiCiAgICAgICAgcmVxdWlyZWRfY29uZiA9IF9zdHJpY3Rlcl9jb25maWRlbmNlKAogICAgICAgICAgICBzdHIocG9saWN5X2Zvcl90aWVyLmdldCgibWluX2NvbmZpZGVuY2VfdG9fYWxlcnQiLCAiQiIpKSwKICAgICAgICAgICAgc3RyKHRpZXJfcnVsZV9mb3JfdGllci5nZXQoIm1pbl9jb25maWRlbmNlIiwgIkIiKSksCiAgICAgICAgKQogICAgICAgIHJlcXVpcmVkX3Njb3JlID0gZmxvYXQocG9saWN5X2Zvcl90aWVyLmdldCgiYWxlcnRfdGhyZXNob2xkIiwgX3J1bnRpbWVbImFsZXJ0X3RocmVzaG9sZCJdKSBvciAwKSArIGZsb2F0KAogICAgICAgICAgICB0aWVyX3J1bGVfZm9yX3RpZXIuZ2V0KCJtaW5fc2NvcmVfZGVsdGEiLCAwKSBvciAwCiAgICAgICAgKQogICAgICAgIHJlcXVpcmVkX3Njb3JlID0gbWF4KDAuMCwgbWluKDEwMC4wLCByZXF1aXJlZF9zY29yZSkpCgogICAgICAgIGxpbmVzID0gWwogICAgICAgICAgICBmIjxiPvCfk4ogW0FOQUxZU0lTXTogTUFSS0VUPC9iPiIsCiAgICAgICAgICAgIGYiPGNvZGU+e3NlcH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OLIFBST0ZJTEU6IHtfZXNjX2h0bWxfbWFpbihwcm9maWxlX2xhYmVsKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT57c2VwfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPnthY3Rpb25fZW1vaml9IFNUQVRVUzoge19lc2NfaHRtbF9tYWluKHNpZ25hbF9hY3Rpb24pfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfjq8gQkVTVCBGSVQ6ICR7X2VzY19odG1sX21haW4odG9wX3N5bWJvbCl9IHwge19lc2NfaHRtbF9tYWluKHRlcm0pfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPuKtkCBRVUFMSVRZOiBzY29yZSB7c2NvcmU6LjBmfSAoe19lc2NfaHRtbF9tYWluKGNvbmYpfSkgfCAyNEgge2NoZzorLjFmfSUgfCBsaXEge19lc2NfaHRtbF9tYWluKGxpcSl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+SsCBNQVJLRVRDQVA6IHtfZXNjX2h0bWxfbWFpbihjYXBfZGlzcGxheSl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+TnSBSRUFTT046IFRvcC1yYW5rZWQgcXVhbGlmaWVkIHNldHVwIHJpZ2h0IG5vdzwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfk48gUlVMRTogc2NvcmUgJmd0Oz0ge3JlcXVpcmVkX3Njb3JlOi4wZn0gYW5kIGdyYWRlICZndDs9IHtfZXNjX2h0bWxfbWFpbihyZXF1aXJlZF9jb25mKX08L2NvZGU+IiwKICAgICAgICAgICAgZiIiLAogICAgICAgICAgICBmIjxpPlRpcDogVXNlIC9nb29kYnV5IGFsbCBmb3IgZnVsbCB0aWVyIGJyZWFrZG93biBvbiBkZW1hbmQuPC9pPiIsCiAgICAgICAgXQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpLnN0cmlwKCkKCgphc3luYyBkZWYgc2VuZF9zaWduYWxfZGlnZXN0KGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpIC0+IGJvb2w6CiAgICByb3dzID0gZ2V0X3JlY2VudF9zY2FuX2Jlc3RzKAogICAgICAgIGxvb2tiYWNrX2hvdXJzPVNJR05BTF9ESUdFU1RfTE9PS0JBQ0tfSE9VUlMsCiAgICAgICAgbGltaXQ9bWF4KDEwLCBTSUdOQUxfRElHRVNUX01BWF9JVEVNUyAqIDQpLAogICAgKQogICAgbXNnID0gX2J1aWxkX2RpZ2VzdF9tZXNzYWdlKHJvd3MpCiAgICBpZiBub3QgbXNnOgogICAgICAgIHJldHVybiBGYWxzZQogICAgbGF0ZXN0X3RzID0gcm93c1swXS5nZXQoInRzX3V0YyIpCiAgICBpZiBjb250ZXh0LmpvYiBhbmQgX2RpZ2VzdF9zdGF0ZS5nZXQoImxhc3Rfc2VudF90cyIpID09IGxhdGVzdF90czoKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBpZiBEUllfUlVOOgogICAgICAgIGxvZ2dpbmcuaW5mbygiRFJZX1JVTiBlbmFibGVkLiBEaWdlc3Qgbm90IHNlbnQuXG4lcyIsIG1zZykKICAgIGVsc2U6CiAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICBjaGF0X2lkPWludChURUxFR1JBTV9DSEFUX0lEKSwKICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICAgICApCiAgICBfZGlnZXN0X3N0YXRlWyJsYXN0X3NlbnRfdHMiXSA9IGxhdGVzdF90cwogICAgcmV0dXJuIFRydWUKCgphc3luYyBkZWYgc2VuZF9nb29kX2J1eV9idWxsZXRpbihjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKSAtPiBib29sOgogICAgIiIiVW5pZmllZCBtYXJrZXQgYW5hbHlzaXMgYnVsbGV0aW4g4oCUIGFsd2F5cyB1c2VzIG11bHRpLXRpZXIgYW5hbHlzaXMgZm9ybWF0LiIiIgogICAgcGVyX3RpZXJfbGltaXQgPSBtYXgoMSwgaW50KEdPT0RfQlVZX0JVTExFVElOX1BFUl9USUVSX01BWF9UT0tFTlMpKQogICAgbXNnID0gX2Zvcm1hdF9tdWx0aV90aWVyX2dvb2RfYnV5X2J1bGxldGluKHBlcl90aWVyX2xpbWl0PXBlcl90aWVyX2xpbWl0KQoKICAgICMgR3JhYiBhIHNuYXBzaG90IGp1c3QgZm9yIGxvZ2dpbmcgbWV0YWRhdGEuCiAgICB0aWVyID0gX25vcm1hbGl6ZV9tYXJrZXRfdGllcihHT09EX0JVWV9CVUxMRVRJTl9USUVSKQogICAgc25hcCA9IF9hbmFseXplX21hcmtldF9ub3cobGltaXRfZ29vZD0xLCBsaW1pdF9iYWQ9MCwgdGllcj10aWVyKQoKICAgIGRlY2lzaW9uID0gIkFOQUxZU0lTX0JVTExFVElOIgogICAgaWYgRFJZX1JVTjoKICAgICAgICBkZWNpc2lvbiA9ICJBTkFMWVNJU19CVUxMRVRJTl9EUllfUlVOIgogICAgICAgIGxvZ2dpbmcuaW5mbygiRFJZX1JVTiBlbmFibGVkLiBBbmFseXNpcyBidWxsZXRpbiBzdXBwcmVzc2VkLlxuJXMiLCBtc2cpCiAgICBlbHNlOgogICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICAgICAgY2hhdF9pZD1pbnQoVEVMRUdSQU1fQ0hBVF9JRCksCiAgICAgICAgICAgIHRleHQ9bXNnLAogICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICAgICAgKQoKICAgIGxvZ19zaWduYWwoCiAgICAgICAgewogICAgICAgICAgICAic3ltYm9sIjogIkVOR0lORSIsCiAgICAgICAgICAgICJkZWNpc2lvbiI6IGRlY2lzaW9uLAogICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogZmxvYXQoKHNuYXAuZ2V0KCJyZWdpbWUiKSBvciB7fSkuZ2V0KCJzY29yZSIpIG9yIDApLAogICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogc3RyKChzbmFwLmdldCgicmVnaW1lIikgb3Ige30pLmdldCgibGFiZWwiKSBvciAiIiksCiAgICAgICAgICAgICJub3RlcyI6IGYidGllcj17dGllcn0gZ29vZF9jb3VudD17bGVuKHNuYXAuZ2V0KCdnb29kJykgb3IgW10pfSB1bml2ZXJzZT17c25hcC5nZXQoJ3Rva2VucycsIDApfSIsCiAgICAgICAgfQogICAgKQogICAgcmV0dXJuIFRydWUKCgphc3luYyBkZWYgcnVuX3NlbGxfc2lnbmFsX3NjYW5uZXIoY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSwgdG9rZW5zOiBsaXN0W2RpY3RdIHwgTm9uZSA9IE5vbmUpOgogICAgaWYgbm90IFNFTExfQUxFUlRTX0VOQUJMRUQ6CiAgICAgICAgcmV0dXJuCgogICAgb3Blbl9wb3NpdGlvbnMgPSBnZXRfb3Blbl9wb3NpdGlvbnMobGltaXQ9MjAwKQogICAgaWYgbm90IG9wZW5fcG9zaXRpb25zOgogICAgICAgIHJldHVybgogICAgdHJhY2tlZF9zeW1ib2xzID0ge3N0cihwLmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkgZm9yIHAgaW4gb3Blbl9wb3NpdGlvbnMgaWYgcC5nZXQoInN5bWJvbCIpfQogICAgdHJhY2tlZF9taW50cyA9IHtzdHIocC5nZXQoIm1pbnQiKSBvciAiIikgZm9yIHAgaW4gb3Blbl9wb3NpdGlvbnMgaWYgcC5nZXQoIm1pbnQiKX0KCiAgICBtYXJrZXRfdG9rZW5zID0gdG9rZW5zIGlmIHRva2VucyBpcyBub3QgTm9uZSBlbHNlIChmZXRjaF9tYXJrZXRfZGF0YSgpIG9yIFtdKQogICAgaWYgbm90IG1hcmtldF90b2tlbnM6CiAgICAgICAgcmV0dXJuCgogICAgcnVsZXMgPSBfc2VsbF9zdHlsZV9ydWxlcygpCiAgICBzZW50ID0gMAogICAgZm9yIHJhd190b2tlbiBpbiBtYXJrZXRfdG9rZW5zOgogICAgICAgIGlmIHNlbnQgPj0gaW50KHJ1bGVzWyJtYXhfcGVyX2N5Y2xlIl0pOgogICAgICAgICAgICBicmVhawogICAgICAgIHRva2VuID0gZGljdChyYXdfdG9rZW4pCiAgICAgICAgc3ltYm9sID0gc3RyKHRva2VuLmdldCgic3ltYm9sIikgb3IgIiIpLnVwcGVyKCkKICAgICAgICBtaW50ID0gc3RyKHRva2VuLmdldCgiYWRkcmVzcyIpIG9yICIiKQogICAgICAgIGlmIHN5bWJvbCBub3QgaW4gdHJhY2tlZF9zeW1ib2xzIGFuZCBtaW50IG5vdCBpbiB0cmFja2VkX21pbnRzOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGlmIG5vdCBzeW1ib2wgb3IgX3NlbGxfc2lnbmFsX29uX2Nvb2xkb3duKHN5bWJvbCwgY29vbGRvd25faG91cnM9cnVsZXNbImNvb2xkb3duX2hvdXJzIl0pOgogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICByZWZyZXNoZWQgPSBfcmVmcmVzaF9hbGVydF9tYXJrZXRfc25hcHNob3QodG9rZW4pCiAgICAgICAgaWYgcmVmcmVzaGVkOgogICAgICAgICAgICB0b2tlbiA9IHJlZnJlc2hlZAoKICAgICAgICBzaWduYWwgPSBfZGV0ZWN0X3NlbGxfc2lnbmFsKHRva2VuLCBydWxlcz1ydWxlcykKICAgICAgICBpZiBub3Qgc2lnbmFsOgogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICBtc2cgPSBfZm9ybWF0X3NlbGxfYWxlcnRfbWVzc2FnZSh0b2tlbiwgc2lnbmFsLCBjb21wYWN0PVRydWUpCiAgICAgICAgZGVjaXNpb24gPSBmIlNFTExfQUxFUlRfe3NpZ25hbFsndHlwZSddfSIKICAgICAgICBpZiBEUllfUlVOOgogICAgICAgICAgICBkZWNpc2lvbiA9ICJTRUxMX0FMRVJUX0RSWV9SVU4iCiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiRFJZX1JVTiBlbmFibGVkLiBTZWxsIGFsZXJ0IHN1cHByZXNzZWQgZm9yICVzIiwgc3ltYm9sKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1fYnVpbGRfYWxlcnRfa2V5Ym9hcmQoCiAgICAgICAgICAgICAgICAgICAgc3ltYm9sLAogICAgICAgICAgICAgICAgICAgIHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgIHRva2VuLmdldCgicGFpcl9hZGRyZXNzIiksCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICAgICAgICAgICkKCiAgICAgICAgbG9nX3NpZ25hbCgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAic2NvcmUiOiB0b2tlbi5nZXQoInNjb3JlIiksCiAgICAgICAgICAgICAgICAibGlxdWlkaXR5IjogdG9rZW4uZ2V0KCJsaXF1aWRpdHkiKSwKICAgICAgICAgICAgICAgICJ2b2x1bWVfMjRoIjogdG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiksCiAgICAgICAgICAgICAgICAicHJpY2UiOiB0b2tlbi5nZXQoInByaWNlIiksCiAgICAgICAgICAgICAgICAiY2hhbmdlXzI0aCI6IHRva2VuLmdldCgiY2hhbmdlXzI0aCIpLAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogZGVjaXNpb24sCiAgICAgICAgICAgICAgICAibm90ZXMiOiBzaWduYWwuZ2V0KCJyZWFzb24iKSwKICAgICAgICAgICAgfQogICAgICAgICkKICAgICAgICBzZW50ICs9IDEKCgphc3luYyBkZWYgY21kX2RpZ2VzdCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBzZW50ID0gYXdhaXQgc2VuZF9zaWduYWxfZGlnZXN0KGNvbnRleHQpCiAgICBpZiBzZW50OgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJEaWdlc3Qgc2VudC4iKQogICAgZWxzZToKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgiTm8gbmV3IHNldHVwcyBmb3IgZGlnZXN0IHJpZ2h0IG5vdy4iKQoKCmFzeW5jIGRlZiBjbWRfcnVubmVyd2F0Y2godXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgcnVuX25ld19ydW5uZXJfd2F0Y2goY29udGV4dCkKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KCJSdW5uZXIgd2F0Y2ggc2NhbiBleGVjdXRlZC4iKQoKCmFzeW5jIGRlZiBjbWRfd2F0Y2hsaXN0KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IHJ1bl93YXRjaGxpc3RfbGFuZShjb250ZXh0KQogICAgcm93cyA9IF9idWlsZF93YXRjaGxpc3Rfcm93cygpCiAgICBsaXZlID0gc3VtKDEgZm9yIHIgaW4gcm93cyBpZiBib29sKHIuZ2V0KCJoYXNfbGl2ZV9kYXRhIiwgVHJ1ZSkpKQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgZiJXYXRjaGxpc3Qgc2NhbiBleGVjdXRlZC4gQ292ZXJhZ2U6IHtsaXZlfS97bGVuKHJvd3MpfSBsaXZlLiIKICAgICkKCgphc3luYyBkZWYgY21kX3dhdGNobGlzdHN1bW1hcnkodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgYXdhaXQgc2VuZF93YXRjaGxpc3Rfc3VtbWFyeShjb250ZXh0KQogICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIldhdGNobGlzdCBzdW1tYXJ5IHNlbnQuIikKCgphc3luYyBkZWYgY21kX21hcmtldG5vdyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICB0aWVyID0gX3RpZXJfYXJnX29yX2RlZmF1bHQoY29udGV4dC5hcmdzLCBkZWZhdWx0PSJiYWxhbmNlZCIpCiAgICBpZiB0aWVyID09ICJhbGwiOgogICAgICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfbWFya2V0X25vd19tdWx0aV90aWVyKG1vZGU9ImJvdGgiKSkKICAgICAgICByZXR1cm4KICAgIHNuYXAgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9NSwgbGltaXRfYmFkPTUsIHRpZXI9dGllcikKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfbWFya2V0X25vd19tZXNzYWdlKHNuYXAsIG1vZGU9ImJvdGgiKSkKCgphc3luYyBkZWYgY21kX2dvb2RidXkodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgdGllciA9IF90aWVyX2FyZ19vcl9kZWZhdWx0KGNvbnRleHQuYXJncywgZGVmYXVsdD0iYmFsYW5jZWQiKQogICAgaWYgdGllciA9PSAiYWxsIjoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X21hcmtldF9ub3dfbXVsdGlfdGllcihtb2RlPSJnb29kIikpCiAgICAgICAgcmV0dXJuCiAgICBzbmFwID0gX2FuYWx5emVfbWFya2V0X25vdyhsaW1pdF9nb29kPTYsIGxpbWl0X2JhZD0zLCB0aWVyPXRpZXIpCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X21hcmtldF9ub3dfbWVzc2FnZShzbmFwLCBtb2RlPSJnb29kIikpCgoKYXN5bmMgZGVmIGNtZF9iYWRidXkodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgYXdhaXQgX3JlamVjdF91bmF1dGhvcml6ZWQodXBkYXRlKQogICAgICAgIHJldHVybgogICAgdGllciA9IF90aWVyX2FyZ19vcl9kZWZhdWx0KGNvbnRleHQuYXJncywgZGVmYXVsdD0iYmFsYW5jZWQiKQogICAgaWYgdGllciA9PSAiYWxsIjoKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X21hcmtldF9ub3dfbXVsdGlfdGllcihtb2RlPSJiYWQiKSkKICAgICAgICByZXR1cm4KICAgIHNuYXAgPSBfYW5hbHl6ZV9tYXJrZXRfbm93KGxpbWl0X2dvb2Q9MywgbGltaXRfYmFkPTYsIHRpZXI9dGllcikKICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfbWFya2V0X25vd19tZXNzYWdlKHNuYXAsIG1vZGU9ImJhZCIpKQoKCmFzeW5jIGRlZiBjbWRfd2FsbGV0Mm5vdyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X3dhbGxldDJfbWVzc2FnZShtb2RlPSJnb29kIikpCgoKYXN5bmMgZGVmIGNtZF93YWxsZXQyYmFkKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfd2FsbGV0Ml9tZXNzYWdlKG1vZGU9ImJhZCIpKQoKCmFzeW5jIGRlZiBjbWRfd2FsbGV0M25vdyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChfZm9ybWF0X3dhbGxldDNfbWVzc2FnZShtb2RlPSJnb29kIikpCgoKYXN5bmMgZGVmIGNtZF93YWxsZXQzYmFkKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IF9yZWplY3RfdW5hdXRob3JpemVkKHVwZGF0ZSkKICAgICAgICByZXR1cm4KICAgIGF3YWl0IHVwZGF0ZS5lZmZlY3RpdmVfbWVzc2FnZS5yZXBseV90ZXh0KF9mb3JtYXRfd2FsbGV0M19tZXNzYWdlKG1vZGU9ImJhZCIpKQoKCmFzeW5jIGRlZiBjbWRfd2FsbGV0cGxhbih1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICBhd2FpdCBfcmVqZWN0X3VuYXV0aG9yaXplZCh1cGRhdGUpCiAgICAgICAgcmV0dXJuCiAgICB0ZXh0ID0gKAogICAgICAgICJXQUxMRVQgUExBWUJPT0tcblxuIgogICAgICAgIGYie193YWxsZXRfaGVhZGVyKCdXMScpfVxuXG4iCiAgICAgICAgZiJ7X3dhbGxldF9oZWFkZXIoJ1cyJyl9XG5cbiIKICAgICAgICBmIntfd2FsbGV0X2hlYWRlcignVzMnKX1cblxuIgogICAgICAgICJVc2UgL3dhbGxldDJub3cgL3dhbGxldDJiYWQgL3dhbGxldDNub3cgL3dhbGxldDNiYWQgZm9yIGxpdmUgcm91dGluZy4iCiAgICApCiAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCh0ZXh0KQoKCmFzeW5jIGRlZiBvbl9hbGVydF9hY3Rpb24odXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgcXVlcnkgPSB1cGRhdGUuY2FsbGJhY2tfcXVlcnkKICAgIGlmIG5vdCBxdWVyeToKICAgICAgICByZXR1cm4KICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIGF3YWl0IHF1ZXJ5LmFuc3dlcigiVW5hdXRob3JpemVkIiwgc2hvd19hbGVydD1UcnVlKQogICAgICAgIHJldHVybgoKICAgIGRhdGEgPSBxdWVyeS5kYXRhIG9yICIiCiAgICBpZiBkYXRhLnN0YXJ0c3dpdGgoIm11dGU6Iik6CiAgICAgICAgc3ltYm9sID0gZGF0YS5zcGxpdCgiOiIsIDEpWzFdLnN0cmlwKCkudXBwZXIoKVs6MTZdCiAgICAgICAgc2V0X3N5bWJvbF9jb250cm9sKHN5bWJvbD1zeW1ib2wsIGNvbnRyb2xfdHlwZT0iQ09PTERPV04iLCBob3Vycz0yNCwgcmVhc29uPSJtYW51YWxfdGVsZWdyYW1fbXV0ZSIpCiAgICAgICAgbG9nX3NpZ25hbCh7InN5bWJvbCI6IHN5bWJvbCwgImRlY2lzaW9uIjogIlRFTEVHUkFNX01VVEVfMjRIIiwgIm5vdGVzIjogIm1hbnVhbCBtdXRlIGZyb20gYnV0dG9uIn0pCiAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKGYie3N5bWJvbH0gbXV0ZWQgMjRoIiwgc2hvd19hbGVydD1GYWxzZSkKICAgIGVsaWYgZGF0YS5zdGFydHN3aXRoKCJhY2s6Iik6CiAgICAgICAgc3ltYm9sID0gZGF0YS5zcGxpdCgiOiIsIDEpWzFdLnN0cmlwKCkudXBwZXIoKVs6MTZdCiAgICAgICAgbG9nX3NpZ25hbCh7InN5bWJvbCI6IHN5bWJvbCwgImRlY2lzaW9uIjogIkFMRVJUX0FDSyIsICJub3RlcyI6ICJ0ZWxlZ3JhbSBhY2tub3dsZWRnZSJ9KQogICAgICAgIGF3YWl0IHF1ZXJ5LmFuc3dlcigiQWNrbm93bGVkZ2VkIiwgc2hvd19hbGVydD1GYWxzZSkKICAgIGVsc2U6CiAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKCkKCgphc3luYyBkZWYgcnVuX25ld19ydW5uZXJfd2F0Y2goY29udGV4dCk6CiAgICBpZiBub3QgTkVXX1JVTk5FUl9XQVRDSF9FTkFCTEVEOgogICAgICAgIHJldHVybgogICAgdHJ5OgogICAgICAgIHByaW50KCJSdW5uaW5nIG5ldy1ydW5uZXIgd2F0Y2guLi4iKQogICAgICAgIHRva2VucyA9IGZldGNoX3J1bm5lcl93YXRjaF9jYW5kaWRhdGVzKAogICAgICAgICAgICBxdWVyaWVzPU5FV19SVU5ORVJfU0VBUkNIX1FVRVJJRVMsCiAgICAgICAgICAgIHBhaXJzX3Blcl9xdWVyeT1ORVdfUlVOTkVSX1BBSVJTX1BFUl9RVUVSWSwKICAgICAgICAgICAgbGltaXQ9TkVXX1JVTk5FUl9NQVhfUkVTVUxUUywKICAgICAgICApCiAgICAgICAgaWYgbm90IHRva2VuczoKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJOZXctcnVubmVyIHdhdGNoOiBubyBjYW5kaWRhdGVzIGZyb20gRGV4U2NyZWVuZXIuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGNhbmRpZGF0ZXMgPSBbXQogICAgICAgIGZvciB0b2tlbiBpbiB0b2tlbnM6CiAgICAgICAgICAgIGVucmljaGVkID0gX3J1bm5lcl93YXRjaF9lbnJpY2godG9rZW4pCiAgICAgICAgICAgIGlmIG5vdCBlbnJpY2hlZDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHN5bWJvbCA9IHN0cihlbnJpY2hlZC5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpCiAgICAgICAgICAgIGlmIF9ydW5uZXJfd2F0Y2hfb25fY29vbGRvd24oc3ltYm9sKToKICAgICAgICAgICAgICAgIGxvZ19zaWduYWwoCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICAibWludCI6IGVucmljaGVkLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICAgICAic2NvcmUiOiBlbnJpY2hlZC5nZXQoIndhdGNoX3Njb3JlIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJSVU5ORVJfV0FUQ0hfQ09PTERPV05fU0tJUCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJub3RlcyI6IGYiY29vbGRvd25faG91cnM9e05FV19SVU5ORVJfQ09PTERPV05fSE9VUlN9IiwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBjYW5kaWRhdGVzLmFwcGVuZChlbnJpY2hlZCkKCiAgICAgICAgaWYgbm90IGNhbmRpZGF0ZXM6CiAgICAgICAgICAgIHByaW50KCJOZXctcnVubmVyIHdhdGNoOiBubyB0b2tlbnMgcGFzc2VkIGZpbHRlcnMuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGNhbmRpZGF0ZXMuc29ydChrZXk9bGFtYmRhIHQ6IHQuZ2V0KCJ3YXRjaF9zY29yZSIsIDApLCByZXZlcnNlPVRydWUpCiAgICAgICAgc2VudCA9IDAKICAgICAgICBzZWVuID0gc2V0KCkKICAgICAgICBtYXhfcGVyX2N5Y2xlID0gbWF4KDEsIE5FV19SVU5ORVJfTUFYX0FMRVJUU19QRVJfQ1lDTEUpCgogICAgICAgIGZvciB0b2tlbiBpbiBjYW5kaWRhdGVzOgogICAgICAgICAgICBpZiBzZW50ID49IG1heF9wZXJfY3ljbGU6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBzeW1ib2wgPSBzdHIodG9rZW4uZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgICAgICAgICBpZiBub3Qgc3ltYm9sIG9yIHN5bWJvbCBpbiBzZWVuOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc2Vlbi5hZGQoc3ltYm9sKQoKICAgICAgICAgICAgbXNnID0gZm9ybWF0X3J1bm5lcl93YXRjaCh0b2tlbiwgY29tcGFjdD1UcnVlKQogICAgICAgICAgICBkZWNpc2lvbiA9ICJSVU5ORVJfV0FUQ0hfQUxFUlQiCiAgICAgICAgICAgIGlmIERSWV9SVU46CiAgICAgICAgICAgICAgICBkZWNpc2lvbiA9ICJSVU5ORVJfV0FUQ0hfRFJZX1JVTiIKICAgICAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiRFJZX1JVTiBlbmFibGVkLiBSdW5uZXIgd2F0Y2ggYWxlcnQgc3VwcHJlc3NlZCBmb3IgJXMiLCBzeW1ib2wpCiAgICAgICAgICAgIGVsaWYgVEVMRUdSQU1fUVVJRVRfTU9ERSBhbmQgY29udGV4dC5qb2IgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBkZWNpc2lvbiA9ICJSVU5ORVJfV0FUQ0hfUVVJRVRfTU9ERSIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICAgICAgICAgICAgICBjaGF0X2lkPWludChURUxFR1JBTV9DSEFUX0lEKSwKICAgICAgICAgICAgICAgICAgICB0ZXh0PW1zZywKICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgICAgICAgICByZXBseV9tYXJrdXA9X2J1aWxkX2FsZXJ0X2tleWJvYXJkKAogICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbi5nZXQoInBhaXJfYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBsb2dfc2lnbmFsKAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAicGFpcl9hZGRyZXNzIjogdG9rZW4uZ2V0KCJwYWlyX2FkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAic2NvcmUiOiB0b2tlbi5nZXQoIndhdGNoX3Njb3JlIiksCiAgICAgICAgICAgICAgICAgICAgImxpcXVpZGl0eSI6IHRva2VuLmdldCgibGlxdWlkaXR5IiksCiAgICAgICAgICAgICAgICAgICAgInZvbHVtZV8yNGgiOiB0b2tlbi5nZXQoInZvbHVtZV8yNGgiKSwKICAgICAgICAgICAgICAgICAgICAicHJpY2UiOiB0b2tlbi5nZXQoInByaWNlIiksCiAgICAgICAgICAgICAgICAgICAgImNoYW5nZV8yNGgiOiB0b2tlbi5nZXQoImNoYW5nZV8yNGgiKSwKICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiBkZWNpc2lvbiwKICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiAoCiAgICAgICAgICAgICAgICAgICAgICAgIGYicnVubmVyX3dhdGNoIGFnZV9oPXt0b2tlbi5nZXQoJ2FnZV9ob3VycycpOi4yZn0gIgogICAgICAgICAgICAgICAgICAgICAgICBmInhfcHJveHk9e3Rva2VuLmdldCgneF9wcm94eV9sYWJlbCcpfSBuYXJyYXRpdmU9e3Rva2VuLmdldCgnbmFycmF0aXZlX2xhYmVsJyl9IgogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgc2VudCArPSAxCgogICAgICAgIGlmIHNlbnQgPT0gMDoKICAgICAgICAgICAgcHJpbnQoIk5ldy1ydW5uZXIgd2F0Y2g6IGNhbmRpZGF0ZXMgZm91bmQgYnV0IHNraXBwZWQgYnkgY29vbGRvd24vY2Fwcy4iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGM6CiAgICAgICAgcHJpbnQoIlJVTk5FUiBXQVRDSCBFUlJPUjoiLCByZXByKGV4YykpCgoKYXN5bmMgZGVmIHJ1bl9sZWdhY3lfcmVjb3Zlcnlfc2Nhbm5lcihjb250ZXh0KToKICAgICIiIlNjYW4gZXN0YWJsaXNoZWQgU29sYW5hIG1lbWVjb2lucyAoPjkwZCkgc2hvd2luZyBmcmVzaCByZXZlcnNhbCBwYXR0ZXJucy4iIiIKICAgIGlmIG5vdCBMRUdBQ1lfUkVDT1ZFUllfRU5BQkxFRDoKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBwcmludCgiUnVubmluZyBsZWdhY3kgcmVjb3Zlcnkgc2Nhbi4uLiIpCiAgICAgICAgIyBVc2UgYnJvYWQgZmV0Y2gg4oCUIHNjYW5zIGZ1bGwgZXN0YWJsaXNoZWQgU29sYW5hIHVuaXZlcnNlLCBub3QgYSBoYXJkY29kZWQgbGlzdC4KICAgICAgICAjIEN1c3RvbSBxdWVyaWVzIGZyb20gLmVudiBvdmVycmlkZSB0aGUgYnVpbHQtaW4gYnJvYWQgc3dlZXAgaWYgc2V0LgogICAgICAgIGN1c3RvbV9xdWVyaWVzID0gTEVHQUNZX1JFQ09WRVJZX1NFQVJDSF9RVUVSSUVTIGlmIExFR0FDWV9SRUNPVkVSWV9TRUFSQ0hfUVVFUklFUyBlbHNlIE5vbmUKICAgICAgICB0b2tlbnMgPSBmZXRjaF9sZWdhY3lfcmVjb3ZlcnlfY2FuZGlkYXRlcygKICAgICAgICAgICAgcXVlcmllcz1jdXN0b21fcXVlcmllcywKICAgICAgICAgICAgcGFpcnNfcGVyX3F1ZXJ5PUxFR0FDWV9SRUNPVkVSWV9QQUlSU19QRVJfUVVFUlksCiAgICAgICAgICAgIGxpbWl0PTMwMCwKICAgICAgICApCiAgICAgICAgaWYgbm90IHRva2VuczoKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJMZWdhY3kgcmVjb3Zlcnkgc2Nhbjogbm8gY2FuZGlkYXRlcyBmcm9tIERleFNjcmVlbmVyLiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICAjIEdldCBjdXJyZW50IFNPTCBzdGF0dXMgdG8gZW1iZWQgaW4gYWxlcnQKICAgICAgICBzb2xfcHJveHkgPSBfY29tcHV0ZV9zb2xfcmVnaW1lX3Byb3h5KCkKICAgICAgICBzb2xfY2hhbmdlXzI0aCA9IGZsb2F0KHNvbF9wcm94eS5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKQogICAgICAgIHNvbF9jaGFuZ2VfMWggPSBmbG9hdChzb2xfcHJveHkuZ2V0KCJjaGFuZ2VfMWgiLCAwKSBvciAwKQogICAgICAgIGlmIHNvbF9jaGFuZ2VfMjRoIDw9IFNPTF9FWFRSRU1FX09GRl9DSEFOR0VfMjRIIG9yIHNvbF9jaGFuZ2VfMWggPD0gU09MX0VYVFJFTUVfT0ZGX0NIQU5HRV8xSDoKICAgICAgICAgICAgc29sX3N0YXR1cyA9ICJFWFRSRU1FX1JJU0tfT0ZGIgogICAgICAgIGVsaWYgc29sX2NoYW5nZV8yNGggPD0gU09MX1JJU0tfT0ZGX0NIQU5HRV8yNEg6CiAgICAgICAgICAgIHNvbF9zdGF0dXMgPSAiUklTS19PRkYiCiAgICAgICAgZWxpZiBzb2xfY2hhbmdlXzI0aCA+PSBTT0xfUklTS19PTl9DSEFOR0VfMjRIOgogICAgICAgICAgICBzb2xfc3RhdHVzID0gIlJJU0tfT04iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc29sX3N0YXR1cyA9ICJORVVUUkFMIgoKICAgICAgICBjYW5kaWRhdGVzID0gW10KICAgICAgICBmb3IgdG9rZW4gaW4gdG9rZW5zOgogICAgICAgICAgICBlbnJpY2hlZCA9IF9kZXRlY3RfbGVnYWN5X3JlY292ZXJ5KHRva2VuKQogICAgICAgICAgICBpZiBub3QgZW5yaWNoZWQ6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzeW1ib2wgPSBzdHIoZW5yaWNoZWQuZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKQogICAgICAgICAgICBpZiBfbGVnYWN5X3JlY292ZXJ5X29uX2Nvb2xkb3duKHN5bWJvbCk6CiAgICAgICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICJtaW50IjogZW5yaWNoZWQuZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIkxFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9TS0lQIiwKICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiBmImNvb2xkb3duX2hvdXJzPXtMRUdBQ1lfUkVDT1ZFUllfQ09PTERPV05fSE9VUlN9IiwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbnJpY2hlZFsic29sX3N0YXR1cyJdID0gc29sX3N0YXR1cwogICAgICAgICAgICBjYW5kaWRhdGVzLmFwcGVuZChlbnJpY2hlZCkKCiAgICAgICAgaWYgbm90IGNhbmRpZGF0ZXM6CiAgICAgICAgICAgIHByaW50KCJMZWdhY3kgcmVjb3Zlcnkgc2Nhbjogbm8gdG9rZW5zIHBhc3NlZCBmaWx0ZXJzLiIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICAjIFNvcnQgYnkgdm9sdW1lXzI0aCBkZXNjZW5kaW5nIChtb3N0IGFjdGl2ZSBlc3RhYmxpc2hlZCBjb2lucyBmaXJzdCkKICAgICAgICBjYW5kaWRhdGVzLnNvcnQoa2V5PWxhbWJkYSB0OiBmbG9hdCh0LmdldCgidm9sdW1lXzI0aCIsIDApIG9yIDApLCByZXZlcnNlPVRydWUpCiAgICAgICAgc2VudCA9IDAKICAgICAgICBzZWVuID0gc2V0KCkKICAgICAgICBtYXhfcGVyX2N5Y2xlID0gbWF4KDEsIExFR0FDWV9SRUNPVkVSWV9NQVhfQUxFUlRTX1BFUl9DWUNMRSkKCiAgICAgICAgZm9yIHRva2VuIGluIGNhbmRpZGF0ZXM6CiAgICAgICAgICAgIGlmIHNlbnQgPj0gbWF4X3Blcl9jeWNsZToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIHN5bWJvbCA9IHN0cih0b2tlbi5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpCiAgICAgICAgICAgIGlmIG5vdCBzeW1ib2wgb3Igc3ltYm9sIGluIHNlZW46CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzZWVuLmFkZChzeW1ib2wpCgogICAgICAgICAgICBtc2cgPSBmb3JtYXRfbGVnYWN5X3JlY292ZXJ5KHRva2VuKQogICAgICAgICAgICBkZWNpc2lvbiA9ICJMRUdBQ1lfUkVDT1ZFUllfQUxFUlQiCiAgICAgICAgICAgIGlmIERSWV9SVU46CiAgICAgICAgICAgICAgICBkZWNpc2lvbiA9ICJMRUdBQ1lfUkVDT1ZFUllfRFJZX1JVTiIKICAgICAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiRFJZX1JVTiBlbmFibGVkLiBMZWdhY3kgcmVjb3ZlcnkgYWxlcnQgc3VwcHJlc3NlZCBmb3IgJXMiLCBzeW1ib2wpCiAgICAgICAgICAgIGVsaWYgVEVMRUdSQU1fUVVJRVRfTU9ERSBhbmQgY29udGV4dC5qb2IgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBkZWNpc2lvbiA9ICJMRUdBQ1lfUkVDT1ZFUllfUVVJRVRfTU9ERSIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICAgICAgICAgICAgICBjaGF0X2lkPWludChURUxFR1JBTV9DSEFUX0lEKSwKICAgICAgICAgICAgICAgICAgICB0ZXh0PW1zZywKICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgICAgICAgICByZXBseV9tYXJrdXA9X2J1aWxkX2FsZXJ0X2tleWJvYXJkKAogICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbi5nZXQoInBhaXJfYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUsCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgInBhaXJfYWRkcmVzcyI6IHRva2VuLmdldCgicGFpcl9hZGRyZXNzIiksCiAgICAgICAgICAgICAgICAic2NvcmUiOiAwLAogICAgICAgICAgICAgICAgImxpcXVpZGl0eSI6IHRva2VuLmdldCgibGlxdWlkaXR5IiksCiAgICAgICAgICAgICAgICAidm9sdW1lXzI0aCI6IHRva2VuLmdldCgidm9sdW1lXzI0aCIpLAogICAgICAgICAgICAgICAgInByaWNlIjogdG9rZW4uZ2V0KCJwcmljZSIpLAogICAgICAgICAgICAgICAgImNoYW5nZV8yNGgiOiB0b2tlbi5nZXQoImNoYW5nZV8yNGgiKSwKICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6IGRlY2lzaW9uLAogICAgICAgICAgICAgICAgIm5vdGVzIjogKAogICAgICAgICAgICAgICAgICAgIGYibGVnYWN5X3JlY292ZXJ5IGFnZV9kPXt0b2tlbi5nZXQoJ2FnZV9kYXlzJywgMCk6LjFmfSAiCiAgICAgICAgICAgICAgICAgICAgZiJwYXR0ZXJuPXt0b2tlbi5nZXQoJ3BhdHRlcm5fbGFiZWwnKX0gc29sPXtzb2xfc3RhdHVzfSIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbnQgKz0gMQoKICAgICAgICBpZiBzZW50ID09IDA6CiAgICAgICAgICAgIHByaW50KCJMZWdhY3kgcmVjb3Zlcnkgc2NhbjogY2FuZGlkYXRlcyBmb3VuZCBidXQgc2tpcHBlZCBieSBjb29sZG93bi9jYXBzLiIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICBwcmludCgiTEVHQUNZIFJFQ09WRVJZIFNDQU4gRVJST1I6IiwgcmVwcihleGMpKQoKCmFzeW5jIGRlZiBydW5fZW5naW5lKGNvbnRleHQpOgogICAgdHJ5OgogICAgICAgIHByaW50KGYiUnVubmluZyB7X21vZGUoKX0gc2Nhbi4uLiIpCiAgICAgICAgdG9rZW5zID0gZmV0Y2hfbWFya2V0X2RhdGEoKQogICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAic3ltYm9sIjogIkVOR0lORSIsCiAgICAgICAgICAgICJkZWNpc2lvbiI6ICJTQ0FOX1JVTiIsCiAgICAgICAgICAgICJub3RlcyI6IGYiZmV0Y2hlZF90b2tlbnM9e2xlbih0b2tlbnMpfSIsCiAgICAgICAgfSkKICAgICAgICBpZiBub3QgdG9rZW5zOgogICAgICAgICAgICBwcmludCgiTm8gdmFsaWQgdG9rZW5zIGZvdW5kIChmaWx0ZXJzIHJlbW92ZWQgZXZlcnl0aGluZykuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHJlZ2ltZSA9IF9jb21wdXRlX3JlZ2ltZSh0b2tlbnMpCiAgICAgICAgc29sX3Byb3h5ID0gX2NvbXB1dGVfc29sX3JlZ2ltZV9wcm94eSgpCiAgICAgICAgcG9saWN5ID0gX2J1aWxkX21hcmtldF9wb2xpY3kocmVnaW1lLCBzb2xfcHJveHkpCgogICAgICAgICMgRXhpdC1yaXNrIGFsZXJ0cyBydW4gaW5kZXBlbmRlbnRseSBvZiBidXktZ2F0ZSBjb25kaXRpb25zLgogICAgICAgIGF3YWl0IHJ1bl9zZWxsX3NpZ25hbF9zY2FubmVyKGNvbnRleHQsIHRva2Vucz10b2tlbnMpCgogICAgICAgIGlmIHBvbGljeVsiaGFyZF9ibG9jayJdOgogICAgICAgICAgICBsb2dfc2lnbmFsKHsKICAgICAgICAgICAgICAgICJzeW1ib2wiOiAiRU5HSU5FIiwKICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJNQVJLRVRfSEFSRF9CTE9DSyIsCiAgICAgICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICJub3RlcyI6IHBvbGljeVsiaGFyZF9ibG9ja19yZWFzb24iXSwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcHJpbnQoZiJNYXJrZXQgaGFyZCBibG9jazoge3BvbGljeVsnaGFyZF9ibG9ja19yZWFzb24nXX0iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY2FuX3RyYWRlLCBibG9ja19yZWFzb24gPSBfcmlza19nb3Zlcm5vcl9zdGF0dXMoKQogICAgICAgIGlmIG5vdCBjYW5fdHJhZGU6CiAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIlJJU0tfR09WRVJOT1JfQkxPQ0siLAogICAgICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAibm90ZXMiOiBibG9ja19yZWFzb24sCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHByaW50KGYiUmlzayBnb3Zlcm5vciBibG9ja2VkIGFsZXJ0czoge2Jsb2NrX3JlYXNvbn0iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgbG9nZ2luZy5pbmZvKAogICAgICAgICAgICAiTWFya2V0IHBvbGljeTogc3RhdGU9JXMgc29sMjRoPSUuMmYlJSBzb2wxaD0lLjJmJSUgdGhyPSUuMWYgY29uZj49JXMgcmVnaW1lX21pbj0lLjFmICIKICAgICAgICAgICAgImN5Y2xlX2NhcD0lcyBkYXlfY2FwPSVzIGNvb2xkb3duX2g9JXMiLAogICAgICAgICAgICBwb2xpY3lbInN0YXRlIl0sCiAgICAgICAgICAgIGZsb2F0KHNvbF9wcm94eS5nZXQoImNoYW5nZV8yNGgiLCAwKSBvciAwKSwKICAgICAgICAgICAgZmxvYXQoc29sX3Byb3h5LmdldCgiY2hhbmdlXzFoIiwgMCkgb3IgMCksCiAgICAgICAgICAgIGZsb2F0KHBvbGljeVsiYWxlcnRfdGhyZXNob2xkIl0pLAogICAgICAgICAgICBwb2xpY3lbIm1pbl9jb25maWRlbmNlX3RvX2FsZXJ0Il0sCiAgICAgICAgICAgIGZsb2F0KHBvbGljeVsicmVnaW1lX21pbl9zY29yZSJdKSwKICAgICAgICAgICAgcG9saWN5WyJtYXhfYWxlcnRzX3Blcl9jeWNsZSJdLAogICAgICAgICAgICBwb2xpY3lbIm1heF9hbGVydHNfcGVyX2RheSJdLAogICAgICAgICAgICBwb2xpY3lbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0sCiAgICAgICAgKQoKICAgICAgICBhbGVydHNfMjRoID0gY291bnRfYWxlcnRzX3NpbmNlKGRhdGV0aW1lLnV0Y25vdygpIC0gdGltZWRlbHRhKGhvdXJzPTI0KSkKICAgICAgICBwb2xpY3lfZGF5X2NhcCA9IGludChwb2xpY3lbIm1heF9hbGVydHNfcGVyX2RheSJdKQogICAgICAgIGlmIHBvbGljeV9kYXlfY2FwID4gMCBhbmQgYWxlcnRzXzI0aCA+PSBwb2xpY3lfZGF5X2NhcDoKICAgICAgICAgICAgcmVhc29uID0gZiJQb2xpY3kgZGFpbHkgY2FwIHJlYWNoZWQgKHthbGVydHNfMjRofS97cG9saWN5X2RheV9jYXB9KSBzdGF0ZT17cG9saWN5WydzdGF0ZSddfSIKICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAic3ltYm9sIjogIkVOR0lORSIsCiAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiUE9MSUNZX0RBSUxZX0NBUF9CTE9DSyIsCiAgICAgICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICJub3RlcyI6IHJlYXNvbiwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcHJpbnQoZiJQb2xpY3kgYmxvY2tlZCBhbGVydHM6IHtyZWFzb259IikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGNhbmRpZGF0ZXMgPSBbXQogICAgICAgIGZvciB0b2tlbiBpbiB0b2tlbnM6CiAgICAgICAgICAgIGlmIG5vdCB0b2tlbi5nZXQoImFkZHJlc3MiKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIG5vdCBfcGFzc2VzX3F1YWxpdHlfZmlsdGVycyh0b2tlbik6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBub3QgX3Bhc3Nlc19leGVjdXRpb25fcXVhbGl0eV9maWx0ZXJzKHRva2VuKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIG5vdCBfcGFzc2VzX3RhY3RpY2FsX2ZpbHRlcnModG9rZW4pOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc3ltYm9sID0gdG9rZW4uZ2V0KCJzeW1ib2wiLCAiIikKICAgICAgICAgICAgY29udHJvbCA9IF9hcHBseV9zeW1ib2xfY29udHJvbHMoc3ltYm9sKQogICAgICAgICAgICBpZiBjb250cm9sOgogICAgICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJkZWNpc2lvbiI6ICJTWU1CT0xfQ09OVFJPTF9TS0lQIiwKICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiBmIntjb250cm9sWyd0eXBlJ119IHVudGlsIHtjb250cm9sWyd1bnRpbCddLmlzb2Zvcm1hdCgpfSIsCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICMgRW5yaWNoIHdpdGggQmlyZEV5ZSBvdmVydmlldyBkYXRhICh1bmlxdWUgd2FsbGV0cywgc29jaWFsLCBldGMuKQogICAgICAgICAgICB0b2tlbiA9IF9lbnJpY2hfdG9rZW5fZm9yX3Njb3JpbmcodG9rZW4pCiAgICAgICAgICAgIHRva2VuWyJlbmdpbmVfcHJvZmlsZSJdID0gX21vZGUoKQogICAgICAgICAgICBzY29yZSA9IGNhbGN1bGF0ZV90b2tlbl9zY29yZSh0b2tlbikKICAgICAgICAgICAgdG9rZW5bInNjb3JlIl0gPSBzY29yZQogICAgICAgICAgICB0b2tlblsiY29uZmlkZW5jZSJdID0gX2NvbmZpZGVuY2VfZnJvbV9zY29yZShzY29yZSkKICAgICAgICAgICAgbG9nZ2luZy5kZWJ1ZygiVG9rZW4gJXMgc2NvcmVkICUuMmYiLCB0b2tlbi5nZXQoInN5bWJvbCIsICJVTktOT1dOIiksIHNjb3JlKQoKICAgICAgICAgICAgaWYgc2NvcmUgPj0gZmxvYXQocG9saWN5WyJhbGVydF90aHJlc2hvbGQiXSkgYW5kIF9jb25maWRlbmNlX21lZXRzX3J1bGUoCiAgICAgICAgICAgICAgICB0b2tlblsiY29uZmlkZW5jZSJdLAogICAgICAgICAgICAgICAgcG9saWN5WyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdLAogICAgICAgICAgICApOgogICAgICAgICAgICAgICAgY2FuZGlkYXRlcy5hcHBlbmQodG9rZW4pCgogICAgICAgIHJlZ2ltZV9taW4gPSBmbG9hdChwb2xpY3lbInJlZ2ltZV9taW5fc2NvcmUiXSkKICAgICAgICBpZiBFTkFCTEVfUkVHSU1FX0dBVEUgYW5kIHJlZ2ltZVsic2NvcmUiXSA8IHJlZ2ltZV9taW46CiAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgInN5bWJvbCI6ICJFTkdJTkUiLAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIlJFR0lNRV9CTE9DSyIsCiAgICAgICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICJub3RlcyI6ICgKICAgICAgICAgICAgICAgICAgICBmIkdhdGUgYWN0aXZlLiBtaW49e3JlZ2ltZV9taW59LCBicmVhZHRoPXtyZWdpbWVbJ2JyZWFkdGhfcGN0J106LjJmfSwgIgogICAgICAgICAgICAgICAgICAgIGYibWFya2V0X3N0YXRlPXtwb2xpY3lbJ3N0YXRlJ119IgogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcHJpbnQoCiAgICAgICAgICAgICAgICBmIlJlZ2ltZSBnYXRlIGJsb2NrZWQgYWxlcnRzOiB7cmVnaW1lWydsYWJlbCddfSAiCiAgICAgICAgICAgICAgICBmIih7cmVnaW1lWydzY29yZSddOi4xZn0gPCB7cmVnaW1lX21pbn0pLiIKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYgbm90IGNhbmRpZGF0ZXM6CiAgICAgICAgICAgIHByaW50KGYiTm8gdG9rZW5zIG1lZXQgdGhlIHNjb3JlIHRocmVzaG9sZCAoe3BvbGljeVsnYWxlcnRfdGhyZXNob2xkJ119KS4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY2FuZGlkYXRlcy5zb3J0KGtleT1sYW1iZGEgeDogeFsic2NvcmUiXSwgcmV2ZXJzZT1UcnVlKQogICAgICAgIGJlc3RfdG9rZW4gPSBjYW5kaWRhdGVzWzBdCgogICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAic3ltYm9sIjogYmVzdF90b2tlbi5nZXQoInN5bWJvbCIpLAogICAgICAgICAgICAibWludCI6IGJlc3RfdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICJzY29yZSI6IGJlc3RfdG9rZW4uZ2V0KCJzY29yZSIpLAogICAgICAgICAgICAibGlxdWlkaXR5IjogYmVzdF90b2tlbi5nZXQoImxpcXVpZGl0eSIpLAogICAgICAgICAgICAidm9sdW1lXzI0aCI6IGJlc3RfdG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiksCiAgICAgICAgICAgICJwcmljZSI6IGJlc3RfdG9rZW4uZ2V0KCJwcmljZSIpLAogICAgICAgICAgICAiY2hhbmdlXzI0aCI6IGJlc3RfdG9rZW4uZ2V0KCJjaGFuZ2VfMjRoIiksCiAgICAgICAgICAgICJyZWdpbWVfc2NvcmUiOiByZWdpbWVbInNjb3JlIl0sCiAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICJjb252aWN0aW9uIjogX0NPTkZJREVOQ0VfT1JERVIuZ2V0KGJlc3RfdG9rZW4uZ2V0KCJjb25maWRlbmNlIiwgIkMiKSwgMSksCiAgICAgICAgICAgICJkZWNpc2lvbiI6ICJTQ0FOX0JFU1QiLAogICAgICAgIH0pCiAgICAgICAgcG9saWN5X2N5Y2xlX2NhcCA9IG1heCgxLCBpbnQocG9saWN5WyJtYXhfYWxlcnRzX3Blcl9jeWNsZSJdKSkKICAgICAgICBtYXhfY3ljbGVfYWxlcnRzID0gbWF4KDEsIG1pbihNQVhfQUxFUlRTX1BFUl9DWUNMRSwgcG9saWN5X2N5Y2xlX2NhcCkpCiAgICAgICAgbWF4X3JhbmtlZCA9IG1heCgxLCBtaW4oQUxFUlRfVE9QX04sIHBvbGljeV9jeWNsZV9jYXApKQogICAgICAgIGFsZXJ0c19zZW50ID0gMAogICAgICAgIHNlZW5fc3ltYm9scyA9IHNldCgpCgogICAgICAgIGZvciB0b2tlbiBpbiBjYW5kaWRhdGVzOgogICAgICAgICAgICBpZiBhbGVydHNfc2VudCA+PSBtYXhfY3ljbGVfYWxlcnRzIG9yIGFsZXJ0c19zZW50ID49IG1heF9yYW5rZWQ6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgcmVmcmVzaGVkID0gX3JlZnJlc2hfYWxlcnRfbWFya2V0X3NuYXBzaG90KHRva2VuKQogICAgICAgICAgICBpZiByZWZyZXNoZWQgaXMgTm9uZToKICAgICAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiB0b2tlbi5nZXQoInN5bWJvbCIsICJVTktOT1dOIiksCiAgICAgICAgICAgICAgICAgICAgIm1pbnQiOiB0b2tlbi5nZXQoImFkZHJlc3MiKSwKICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiQUxFUlRfU0tJUF9OT19MSVZFX0RBVEEiLAogICAgICAgICAgICAgICAgICAgICJub3RlcyI6ICJsaXZlIHJlZnJlc2ggcmVxdWlyZWQgYnV0IHVuYXZhaWxhYmxlIiwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB0b2tlbiA9IHJlZnJlc2hlZAoKICAgICAgICAgICAgc3ltYm9sID0gdG9rZW4uZ2V0KCJzeW1ib2wiLCAiVU5LTk9XTiIpCiAgICAgICAgICAgIGlmIHN5bWJvbCBpbiBzZWVuX3N5bWJvbHM6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzZWVuX3N5bWJvbHMuYWRkKHN5bWJvbCkKCiAgICAgICAgICAgIGlmIF9pc19zeW1ib2xfb25fY29vbGRvd24oc3ltYm9sLCBjb29sZG93bl9ob3Vycz1wb2xpY3lbImFsZXJ0X2Nvb2xkb3duX2hvdXJzIl0pOgogICAgICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJzY29yZSI6IHRva2VuLmdldCgic2NvcmUiKSwKICAgICAgICAgICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAgICAgImNvbnZpY3Rpb24iOiBfQ09ORklERU5DRV9PUkRFUi5nZXQodG9rZW4uZ2V0KCJjb25maWRlbmNlIiwgIkMiKSwgMSksCiAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIkNPT0xET1dOX1NLSVAiLAogICAgICAgICAgICAgICAgICAgICJub3RlcyI6IGYiY29vbGRvd25faG91cnM9e3BvbGljeVsnYWxlcnRfY29vbGRvd25faG91cnMnXX0gc3RhdGU9e3BvbGljeVsnc3RhdGUnXX0iLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHN5bWJvbF9kYWlseV9hbGVydHMgPSBjb3VudF9hbGVydHNfc2luY2UoCiAgICAgICAgICAgICAgICBkYXRldGltZS51dGNub3coKSAtIHRpbWVkZWx0YShob3Vycz0yNCksCiAgICAgICAgICAgICAgICBzeW1ib2w9c3ltYm9sLAogICAgICAgICAgICApCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIEVOQUJMRV9SSVNLX0dPVkVSTk9SCiAgICAgICAgICAgICAgICBhbmQgTUFYX0FMRVJUU19QRVJfU1lNQk9MX1BFUl9EQVkgPiAwCiAgICAgICAgICAgICAgICBhbmQgc3ltYm9sX2RhaWx5X2FsZXJ0cyA+PSBNQVhfQUxFUlRTX1BFUl9TWU1CT0xfUEVSX0RBWQogICAgICAgICAgICApOgogICAgICAgICAgICAgICAgbG9nX3NpZ25hbCh7CiAgICAgICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICJzY29yZSI6IHRva2VuLmdldCgic2NvcmUiKSwKICAgICAgICAgICAgICAgICAgICAiZGVjaXNpb24iOiAiU1lNQk9MX0RBSUxZX0NBUF9TS0lQIiwKICAgICAgICAgICAgICAgICAgICAibm90ZXMiOiBmImRhaWx5X2NhcD17TUFYX0FMRVJUU19QRVJfU1lNQk9MX1BFUl9EQVl9IiwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgY2hhbmdlXzI0aCA9IGZsb2F0KHRva2VuLmdldCgiY2hhbmdlXzI0aCIsIDApIG9yIDApCiAgICAgICAgICAgIHRyZW5kID0gIlVwdHJlbmQiIGlmIGNoYW5nZV8yNGggPj0gMCBlbHNlICJQdWxsYmFjayIKICAgICAgICAgICAgZW50cnlfdHlwZSA9ICJNb21lbnR1bSBjb250aW51YXRpb24iIGlmIGNoYW5nZV8yNGggPj0gMCBlbHNlICJEaXAgcmVjb3Zlcnkgc2V0dXAiCiAgICAgICAgICAgIHdhbGxldF9maXQgPSBfd2FsbGV0X2ZpdF9mb3JfbWFpbl90b2tlbih0b2tlbiwgcmVnaW1lLCBwb2xpY3kpCiAgICAgICAgICAgIHJpc2tfcGxhbiwgcm90YXRpb25fcGxhbiA9IF93YWxsZXRfZ3VpZGFuY2Uod2FsbGV0X2ZpdCkKICAgICAgICAgICAgdG9rZW5fZGF0YSA9IHsKICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAic2NvcmUiOiB0b2tlbi5nZXQoInNjb3JlIiksCiAgICAgICAgICAgICAgICAicHJpY2UiOiB0b2tlbi5nZXQoInByaWNlIiksCiAgICAgICAgICAgICAgICAibGlxdWlkaXR5IjogdG9rZW4uZ2V0KCJsaXF1aWRpdHkiKSwKICAgICAgICAgICAgICAgICJ2b2x1bWVfMjRoIjogdG9rZW4uZ2V0KCJ2b2x1bWVfMjRoIiksCiAgICAgICAgICAgICAgICAibWFya2V0X2NhcCI6IHRva2VuLmdldCgibWFya2V0X2NhcCIpLAogICAgICAgICAgICAgICAgImZkdiI6IHRva2VuLmdldCgiZmR2IiksCiAgICAgICAgICAgICAgICAiaG9sZGVycyI6IF9ob2xkZXJzX2Zvcl9hbGVydCh0b2tlbiksCiAgICAgICAgICAgICAgICAidHJlbmQiOiB0cmVuZCwKICAgICAgICAgICAgICAgICJlbnRyeV90eXBlIjogZW50cnlfdHlwZSwKICAgICAgICAgICAgICAgICJjb25maWRlbmNlIjogdG9rZW4uZ2V0KCJjb25maWRlbmNlIiwgIkMiKSwKICAgICAgICAgICAgICAgICJyZWdpbWVfbGFiZWwiOiByZWdpbWVbImxhYmVsIl0sCiAgICAgICAgICAgICAgICAicHJvZmlsZSI6IF9tb2RlKCksCiAgICAgICAgICAgICAgICAiY2hhbmdlXzI0aCI6IGNoYW5nZV8yNGgsCiAgICAgICAgICAgICAgICAicnNpIjogdG9rZW4uZ2V0KCJyc2kiKSwKICAgICAgICAgICAgICAgICJtYWNkX2hpc3QiOiB0b2tlbi5nZXQoIm1hY2RfaGlzdCIpLAogICAgICAgICAgICAgICAgIndhbGxldF9maXQiOiB3YWxsZXRfZml0LAogICAgICAgICAgICAgICAgInJpc2tfcGxhbiI6IHJpc2tfcGxhbiwKICAgICAgICAgICAgICAgICJyb3RhdGlvbl9wbGFuIjogcm90YXRpb25fcGxhbiwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgbm90IF9wYXNzZXNfbGl2ZV9wdXNoX2dhdGUodG9rZW4sIHBvbGljeSk6CiAgICAgICAgICAgICAgICByZXF1aXJlZF9zY29yZSA9IGZsb2F0KHBvbGljeS5nZXQoImFsZXJ0X3RocmVzaG9sZCIsIF9ydW50aW1lWyJhbGVydF90aHJlc2hvbGQiXSkgb3IgMCkgKyBtYXgoCiAgICAgICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICAgICBpbnQoVEVMRUdSQU1fUFVTSF9NSU5fU0NPUkVfREVMVEEpLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgbG9nX3NpZ25hbCgKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJzeW1ib2wiOiBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgICJzY29yZSI6IHRva2VuLmdldCgic2NvcmUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgInJlZ2ltZV9zY29yZSI6IHJlZ2ltZVsic2NvcmUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICAgICAgICAgImRlY2lzaW9uIjogIkFMRVJUX1NVUFBSRVNTRURfTk9JU0VfR0FURSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJub3RlcyI6ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYic2NvcmU+PXtyZXF1aXJlZF9zY29yZTouMWZ9IGNvbmY+PXtURUxFR1JBTV9QVVNIX01JTl9DT05GSURFTkNFfSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmImdvdCBzY29yZT17ZmxvYXQodG9rZW4uZ2V0KCdzY29yZScsIDApIG9yIDApOi4xZn0gY29uZj17dG9rZW4uZ2V0KCdjb25maWRlbmNlJywgJ0MnKX0iCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIG1zZyA9IGZvcm1hdF9zaWduYWwodG9rZW5fZGF0YSwgY29tcGFjdD1UcnVlKQoKICAgICAgICAgICAgZGVjaXNpb24gPSAiQUxFUlQiCiAgICAgICAgICAgIGlmIERSWV9SVU46CiAgICAgICAgICAgICAgICBkZWNpc2lvbiA9ICJBTEVSVF9EUllfUlVOIgogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJEUllfUlVOIGVuYWJsZWQuIFRlbGVncmFtIGFsZXJ0IHN1cHByZXNzZWQgZm9yICVzIiwgc3ltYm9sKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKAogICAgICAgICAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICAgICAgICAgIHRleHQ9bXNnLAogICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1fYnVpbGRfYWxlcnRfa2V5Ym9hcmQoCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLmdldCgicGFpcl9hZGRyZXNzIiksCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSwKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGxvZ19zaWduYWwoewogICAgICAgICAgICAgICAgInN5bWJvbCI6IHN5bWJvbCwKICAgICAgICAgICAgICAgICJtaW50IjogdG9rZW4uZ2V0KCJhZGRyZXNzIiksCiAgICAgICAgICAgICAgICAic2NvcmUiOiB0b2tlbi5nZXQoInNjb3JlIiksCiAgICAgICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAgICAgInJlZ2ltZV9sYWJlbCI6IHJlZ2ltZVsibGFiZWwiXSwKICAgICAgICAgICAgICAgICJjb252aWN0aW9uIjogX0NPTkZJREVOQ0VfT1JERVIuZ2V0KHRva2VuLmdldCgiY29uZmlkZW5jZSIsICJDIiksIDEpLAogICAgICAgICAgICAgICAgImRlY2lzaW9uIjogZGVjaXNpb24sCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBpZiBPVVRDT01FX1RSQUNLSU5HX0VOQUJMRUQ6CiAgICAgICAgICAgICAgICBlbnRyeV9wcmljZSA9IGZsb2F0KHRva2VuLmdldCgicHJpY2UiKSBvciAwKQogICAgICAgICAgICAgICAgaWYgZW50cnlfcHJpY2UgPiAwOgogICAgICAgICAgICAgICAgICAgIHF1ZXVlX2FsZXJ0X291dGNvbWUoewogICAgICAgICAgICAgICAgICAgICAgICAic3ltYm9sIjogc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICAibWludCI6IHRva2VuLmdldCgiYWRkcmVzcyIpLAogICAgICAgICAgICAgICAgICAgICAgICAiZW50cnlfcHJpY2UiOiBlbnRyeV9wcmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgInNjb3JlIjogdG9rZW4uZ2V0KCJzY29yZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAicmVnaW1lX3Njb3JlIjogcmVnaW1lWyJzY29yZSJdLAogICAgICAgICAgICAgICAgICAgICAgICAicmVnaW1lX2xhYmVsIjogcmVnaW1lWyJsYWJlbCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiY29uZmlkZW5jZSI6IHRva2VuLmdldCgiY29uZmlkZW5jZSIsICJDIiksCiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGFsZXJ0c19zZW50ICs9IDEKCiAgICAgICAgaWYgYWxlcnRzX3NlbnQgPT0gMDoKICAgICAgICAgICAgcHJpbnQoIkNhbmRpZGF0ZXMgZm91bmQgYnV0IHNraXBwZWQgYnkgY29vbGRvd24vY2Fwcy4iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGM6CiAgICAgICAgcHJpbnQoIkVOR0lORSBFUlJPUjoiLCByZXByKGV4YykpCgoKIyDilIDilIAgSnVwaXRlciBQZXJwcyBMZXZlcmFnZSBBc3Npc3RhbnQg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACgphc3luYyBkZWYgY21kX2xldih1cGRhdGUsIGNvbnRleHQpOgogICAgIiIiSGFuZGxlciBmb3IgL2xldiDigJQgZnVsbCBwb3NpdGlvbiBkYXNoYm9hcmQuIiIiCiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBwb3NpdGlvbiA9IGZldGNoX2p1cGl0ZXJfcG9zaXRpb24oKQogICAgICAgIHNvbF9wcmljZSA9IGZldGNoX3NvbF9wcmljZSgpIGlmIG5vdCBwb3NpdGlvbiBlbHNlIE5vbmUKICAgICAgICBtc2cgPSBmb3JtYXRfbGV2X2Rhc2hib2FyZChwb3NpdGlvbiwgc29sX3ByaWNlPXNvbF9wcmljZSkKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dChtc2csIHBhcnNlX21vZGU9IkhUTUwiLCBkaXNhYmxlX3dlYl9wYWdlX3ByZXZpZXc9VHJ1ZSkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjOgogICAgICAgIGxvZ2dpbmcud2FybmluZygiY21kX2xldiBlcnJvcjogJXMiLCBleGMpCiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIuKdjCBFcnJvciBmZXRjaGluZyBwb3NpdGlvbiBkYXRhLiIpCgoKYXN5bmMgZGVmIGNtZF9sZXZfc3RhdHVzKHVwZGF0ZSwgY29udGV4dCk6CiAgICAiIiJIYW5kbGVyIGZvciAvbGV2c3RhdHVzIOKAlCBxdWljayBvbmUtbGluZXIgc3RhdHVzLiIiIgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgcmV0dXJuCiAgICB0cnk6CiAgICAgICAgcG9zaXRpb24gPSBmZXRjaF9qdXBpdGVyX3Bvc2l0aW9uKCkKICAgICAgICBzb2xfcHJpY2UgPSBmZXRjaF9zb2xfcHJpY2UoKSBpZiBub3QgcG9zaXRpb24gZWxzZSBOb25lCiAgICAgICAgbXNnID0gZm9ybWF0X2xldl9zdGF0dXMocG9zaXRpb24sIHNvbF9wcmljZT1zb2xfcHJpY2UpCiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQobXNnLCBwYXJzZV9tb2RlPSJIVE1MIiwgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICBsb2dnaW5nLndhcm5pbmcoImNtZF9sZXZfc3RhdHVzIGVycm9yOiAlcyIsIGV4YykKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgi4p2MIEVycm9yIGZldGNoaW5nIHBvc2l0aW9uIGRhdGEuIikKCgphc3luYyBkZWYgY21kX3doYXRfaWYodXBkYXRlLCBjb250ZXh0KToKICAgICIiIkhhbmRsZXIgZm9yIC93aGF0aWYg4oCUIHdoYXQtaWYgY2FsY3VsYXRvciBhdCBwcmljZSB0YXJnZXRzLiIiIgogICAgaWYgbm90IF9pc19hdXRob3JpemVkKHVwZGF0ZSk6CiAgICAgICAgcmV0dXJuCiAgICB0cnk6CiAgICAgICAgcG9zaXRpb24gPSBmZXRjaF9qdXBpdGVyX3Bvc2l0aW9uKCkKICAgICAgICAjIENoZWNrIGlmIGEgY3VzdG9tIHByaWNlIHdhcyBwYXNzZWQgZS5nLiAvd2hhdGlmIDE1MAogICAgICAgIGN1c3RvbV90YXJnZXRzID0gTm9uZQogICAgICAgIGlmIGNvbnRleHQuYXJnczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY3VzdG9tX3RhcmdldHMgPSBbZmxvYXQoYSkgZm9yIGEgaW4gY29udGV4dC5hcmdzIGlmIGEucmVwbGFjZSgiLiIsICIiKS5pc2RpZ2l0KCldCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIG1zZyA9IGZvcm1hdF93aGF0X2lmKHBvc2l0aW9uLCB0YXJnZXRzPWN1c3RvbV90YXJnZXRzIG9yIFBSSUNFX1RBUkdFVFMpCiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQobXNnLCBwYXJzZV9tb2RlPSJIVE1MIiwgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICBsb2dnaW5nLndhcm5pbmcoImNtZF93aGF0X2lmIGVycm9yOiAlcyIsIGV4YykKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgi4p2MIEVycm9yIHJ1bm5pbmcgd2hhdC1pZiBjYWxjdWxhdGlvbi4iKQoKCmFzeW5jIGRlZiBjbWRfbGV2X3JlYyh1cGRhdGUsIGNvbnRleHQpOgogICAgIiIiSGFuZGxlciBmb3IgL2xldnJlYyDigJQgbGV2ZXJhZ2UgcmVjb21tZW5kYXRpb24gZm9yIG5leHQgJDI1MCBhZGQuIiIiCiAgICBpZiBub3QgX2lzX2F1dGhvcml6ZWQodXBkYXRlKToKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIjxjb2RlPuKPsyBGZXRjaGluZyBwb3NpdGlvbiwgU09MIHByaWNlIGFuZCB2b2xhdGlsaXR5Li4uPC9jb2RlPiIsCiAgICAgICAgICAgIHBhcnNlX21vZGU9IkhUTUwiLAogICAgICAgICkKICAgICAgICBwb3NpdGlvbiA9IGZldGNoX2p1cGl0ZXJfcG9zaXRpb24oKQogICAgICAgIHNvbF9wcmljZSA9IGZldGNoX3NvbF9wcmljZSgpIG9yIChwb3NpdGlvbiBvciB7fSkuZ2V0KCJtYXJrX3ByaWNlIikKICAgICAgICB2b2wgPSBmZXRjaF9zb2xfdm9sYXRpbGl0eV8zMGQoKQogICAgICAgIGZ1bmRpbmcgPSAocG9zaXRpb24gb3Ige30pLmdldCgiZnVuZGluZ19yYXRlIikKICAgICAgICAjIEFsbG93IGN1c3RvbSBhZGQgYW1vdW50IGUuZy4gL2xldnJlYyA1MDAKICAgICAgICBhZGRfdXNkID0gTU9OVEhMWV9BRERfVVNECiAgICAgICAgaWYgY29udGV4dC5hcmdzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhZGRfdXNkID0gZmxvYXQoY29udGV4dC5hcmdzWzBdKQogICAgICAgICAgICBleGNlcHQgKFZhbHVlRXJyb3IsIEluZGV4RXJyb3IpOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIHJlYyA9IGNhbGNfbGV2ZXJhZ2VfcmVjb21tZW5kYXRpb24ocG9zaXRpb24sIHNvbF9wcmljZSwgYWRkX3VzZD1hZGRfdXNkLCB2b2w9dm9sLCBmdW5kaW5nPWZ1bmRpbmcpCiAgICAgICAgbXNnID0gZm9ybWF0X2xldmVyYWdlX3JlYyhyZWMpCiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQobXNnLCBwYXJzZV9tb2RlPSJIVE1MIiwgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICBsb2dnaW5nLndhcm5pbmcoImNtZF9sZXZfcmVjIGVycm9yOiAlcyIsIGV4YykKICAgICAgICBhd2FpdCB1cGRhdGUuZWZmZWN0aXZlX21lc3NhZ2UucmVwbHlfdGV4dCgi4p2MIEVycm9yIGNhbGN1bGF0aW5nIGxldmVyYWdlIHJlY29tbWVuZGF0aW9uLiIpCgoKYXN5bmMgZGVmIGNtZF9wcmljZV96b25lcyh1cGRhdGUsIGNvbnRleHQpOgogICAgIiIiSGFuZGxlciBmb3IgL3ByaWNlem9uZXMg4oCUIGxpcXVpZGF0aW9uIHJpc2sgYXQga2V5IHByaWNlIGxldmVscy4iIiIKICAgIGlmIG5vdCBfaXNfYXV0aG9yaXplZCh1cGRhdGUpOgogICAgICAgIHJldHVybgogICAgdHJ5OgogICAgICAgIHBvc2l0aW9uID0gZmV0Y2hfanVwaXRlcl9wb3NpdGlvbigpCiAgICAgICAgc29sX3ByaWNlID0gZmV0Y2hfc29sX3ByaWNlKCkgb3IgKHBvc2l0aW9uIG9yIHt9KS5nZXQoIm1hcmtfcHJpY2UiKQogICAgICAgICMgQWxsb3cgY3VzdG9tIHByaWNlcyBlLmcuIC9wcmljZXpvbmVzIDkwIDcwIDU1CiAgICAgICAgem9uZV9wcmljZXMgPSBOb25lCiAgICAgICAgaWYgY29udGV4dC5hcmdzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB6b25lX3ByaWNlcyA9IFtmbG9hdChhKSBmb3IgYSBpbiBjb250ZXh0LmFyZ3NdCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIHB6ID0gY2FsY19wcmljZV96b25lcyhwb3NpdGlvbiwgc29sX3ByaWNlLCB6b25lX3ByaWNlcz16b25lX3ByaWNlcyBvciBQUklDRV9aT05FX0xFVkVMUykKICAgICAgICBtc2cgPSBmb3JtYXRfcHJpY2Vfem9uZXMocHopCiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQobXNnLCBwYXJzZV9tb2RlPSJIVE1MIiwgZGlzYWJsZV93ZWJfcGFnZV9wcmV2aWV3PVRydWUpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICBsb2dnaW5nLndhcm5pbmcoImNtZF9wcmljZV96b25lcyBlcnJvcjogJXMiLCBleGMpCiAgICAgICAgYXdhaXQgdXBkYXRlLmVmZmVjdGl2ZV9tZXNzYWdlLnJlcGx5X3RleHQoIuKdjCBFcnJvciBjYWxjdWxhdGluZyBwcmljZSB6b25lcy4iKQoKCmFzeW5jIGRlZiBydW5fbGV2X21vbml0b3IoY29udGV4dCk6CiAgICAiIiJTY2hlZHVsZWQgam9iIOKAlCBjaGVja3MgYWxlcnRzIGV2ZXJ5IENIRUNLX0lOVEVSVkFMX1NFQ09ORFMuIiIiCiAgICB0cnk6CiAgICAgICAgcG9zaXRpb24gPSBmZXRjaF9qdXBpdGVyX3Bvc2l0aW9uKCkKICAgICAgICBzb2xfcHJpY2UgPSBmZXRjaF9zb2xfcHJpY2UoKSBpZiBub3QgcG9zaXRpb24gZWxzZSBOb25lCgogICAgICAgICMgQ2hlY2sgcHJpY2UvbGlxL2Z1bmRpbmcgYWxlcnRzCiAgICAgICAgYWxlcnRzID0gY2hlY2tfYWxlcnRzKHBvc2l0aW9uKSBpZiBwb3NpdGlvbiBlbHNlIFtdCiAgICAgICAgZm9yIF8sIG1zZyBpbiBhbGVydHM6CiAgICAgICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICAgICApCgogICAgICAgICMgTW9udGhseSByZW1pbmRlcgogICAgICAgIGlmIGNoZWNrX21vbnRobHlfcmVtaW5kZXIoKToKICAgICAgICAgICAgbXNnID0gZm9ybWF0X21vbnRobHlfcmVtaW5kZXIocG9zaXRpb24pCiAgICAgICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZSgKICAgICAgICAgICAgICAgIGNoYXRfaWQ9aW50KFRFTEVHUkFNX0NIQVRfSUQpLAogICAgICAgICAgICAgICAgdGV4dD1tc2csCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSJIVE1MIiwKICAgICAgICAgICAgICAgIGRpc2FibGVfd2ViX3BhZ2VfcHJldmlldz1UcnVlLAogICAgICAgICAgICApCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4YzoKICAgICAgICBsb2dnaW5nLndhcm5pbmcoInJ1bl9sZXZfbW9uaXRvciBlcnJvcjogJXMiLCBleGMpCgoKZGVmIG1haW4oKToKICAgIF9yZXF1aXJlX2VudigpCiAgICBpbml0X2RiKCkKICAgIF9sb2FkX3dhdGNobGlzdF9zdGF0ZSgpCiAgICBsb2NrID0gU2luZ2xldG9uUHJvY2Vzc0xvY2soUFJPQ0VTU19MT0NLX0ZJTEUpCiAgICBpZiBub3QgbG9jay5hY3F1aXJlKCk6CiAgICAgICAgbG9nZ2luZy5lcnJvcigiQW5vdGhlciBlbmdpbmUgaW5zdGFuY2UgaXMgcnVubmluZy4gRXhpdGluZyAobG9jazogJXMpLiIsIFBST0NFU1NfTE9DS19GSUxFKQogICAgICAgIHJldHVybgoKICAgIHNlbGxfcnVsZXMgPSBfc2VsbF9zdHlsZV9ydWxlcygpCiAgICBsb2dnaW5nLmluZm8oCiAgICAgICAgIlN0YXJ0dXAgY29uZmlnOiBFTkdJTkVfUFJPRklMRT0lcyBSSVNLX1NUWUxFPSVzIEFMRVJUX1RIUkVTSE9MRD0lcyBNSU5fQ09ORklERU5DRV9UT19BTEVSVD0lcyAiCiAgICAgICAgIkVOQUJMRV9SRUdJTUVfR0FURT0lcyBSRUdJTUVfTUlOX1NDT1JFPSVzIERSWV9SVU49JXMgIgogICAgICAgICJXRUVLTFlfVFVOSU5HX0VOQUJMRUQ9JXMgV0VFS0xZX1RVTklOR19EQVlfVVRDPSVzIFdFRUtMWV9UVU5JTkdfSE9VUl9VVEM9JXMgIgogICAgICAgICJPVVRDT01FX1RSQUNLSU5HX0VOQUJMRUQ9JXMgT1VUQ09NRV9FVkFMX0lOVEVSVkFMX1NFQ09ORFM9JXMgIgogICAgICAgICJBTEVSVF9UT1BfTj0lcyBNQVhfQUxFUlRTX1BFUl9DWUNMRT0lcyBBTEVSVF9DT09MRE9XTl9IT1VSUz0lcyAiCiAgICAgICAgIkVOQUJMRV9SSVNLX0dPVkVSTk9SPSVzIEdMT0JBTF9UUkFESU5HX1BBVVNFPSVzIE1BWF9BTEVSVFNfUEVSX0RBWT0lcyAiCiAgICAgICAgIk1BWF9BTEVSVFNfUEVSX1NZTUJPTF9QRVJfREFZPSVzIE1BWF9DT05TRUNVVElWRV80SF9MT1NTRVM9JXMgIgogICAgICAgICJMT1NTX1NUUkVBS19MT09LQkFDS19IT1VSUz0lcyBFTkFCTEVfRVhFQ1VUSU9OX1FVQUxJVFlfRklMVEVSUz0lcyAiCiAgICAgICAgIlRBQ1RJQ0FMX0VOQUJMRV9SRUFMX1RFQ0hOSUNBTFM9JXMgVEFDVElDQUxfUkVRVUlSRV9URUNITklDQUxfQ09ORklSTUFUSU9OPSVzICIKICAgICAgICAiVEFDVElDQUxfT0hMQ1ZfVFlQRT0lcyBUQUNUSUNBTF9SU0lfUkFOR0U9JXMtJXMgVEFDVElDQUxfTUFDRF9ISVNUX01JTj0lcyAiCiAgICAgICAgIkFMRVJUX0RBVEFfUkVGUkVTSF9FTkFCTEVEPSVzIEFMRVJUX1JFUVVJUkVfUkVGUkVTSF9TVUNDRVNTPSVzIEFMRVJUX0RBVEFfRFJJRlRfV0FSTl9QQ1Q9JXMgIgogICAgICAgICJBTEVSVF9ISURFX1VOVkVSSUZJRURfSE9MREVSUz0lcyBFTkFCTEVfU09MX1JFR0lNRV9MQVlFUj0lcyAiCiAgICAgICAgIkJFQVJJU0hfQUxFUlRfVEhSRVNIT0xEPSVzIEJFQVJJU0hfTUlOX0NPTkZJREVOQ0VfVE9fQUxFUlQ9JXMgIgogICAgICAgICJCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0NZQ0xFPSVzIEJFQVJJU0hfTUFYX0FMRVJUU19QRVJfREFZPSVzICIKICAgICAgICAiQkVBUklTSF9BTEVSVF9DT09MRE9XTl9IT1VSUz0lcyBFTkFCTEVfRVhUUkVNRV9SSVNLX0hBUkRfQkxPQ0s9JXMgIgogICAgICAgICJORVdfUlVOTkVSX1dBVENIX0VOQUJMRUQ9JXMgTkVXX1JVTk5FUl9TQ0FOX0lOVEVSVkFMX1NFQ09ORFM9JXMgIgogICAgICAgICJORVdfUlVOTkVSX01JTl9NQVJLRVRfQ0FQPSVzIE5FV19SVU5ORVJfTUFYX0FHRV9IT1VSUz0lcyAiCiAgICAgICAgIk5FV19SVU5ORVJfTUlOX1ZPTFVNRV8yNEg9JXMgTkVXX1JVTk5FUl9NSU5fTElRVUlESVRZPSVzICIKICAgICAgICAiTkVXX1JVTk5FUl9NSU5fQUxFUlRfU0NPUkU9JXMgTkVXX1JVTk5FUl9DT09MRE9XTl9IT1VSUz0lcyAiCiAgICAgICAgIldBVENITElTVF9MQU5FX0VOQUJMRUQ9JXMgV0FUQ0hMSVNUX0VOVFJJRVM9JXMgV0FUQ0hMSVNUX1NDQU5fSU5URVJWQUxfU0VDT05EUz0lcyAiCiAgICAgICAgIldBVENITElTVF9NQVhfQUxFUlRTX1BFUl9DWUNMRT0lcyBXQVRDSExJU1RfQUxFUlRfQ09PTERPV05fSE9VUlM9JXMgIgogICAgICAgICJXQVRDSExJU1RfQUxFUlRfT05fU1RBVFVTX0NIQU5HRT0lcyBXQVRDSExJU1RfQUxFUlRfU1RBVFVTRVM9JXMgIgogICAgICAgICJXQVRDSExJU1RfU1VNTUFSWV9FTkFCTEVEPSVzIFdBVENITElTVF9TVU1NQVJZX0hPVVJfVVRDPSVzICIKICAgICAgICAiQU5BTFlTSVNfQlVMTEVUSU5fRU5BQkxFRD0lcyBBTkFMWVNJU19CVUxMRVRJTl9JTlRFUlZBTD0lcyAiCiAgICAgICAgIlNFTExfQUxFUlRTX0VOQUJMRUQ9JXMgU0VMTF9BTEVSVF9NQVhfUEVSX0NZQ0xFPSVzIFNFTExfQUxFUlRfQ09PTERPV05fSE9VUlM9JXMgIgogICAgICAgICJTRUxMX0VGRkVDVElWRV9NQVhfUEVSX0NZQ0xFPSVzIFNFTExfRUZGRUNUSVZFX0NPT0xET1dOX0hPVVJTPSVzICIKICAgICAgICAiTEVHQUNZX1JFQ09WRVJZX0VOQUJMRUQ9JXMgTEVHQUNZX1JFQ09WRVJZX1NDQU5fSU5URVJWQUxfU0VDT05EUz0lcyAiCiAgICAgICAgIkxFR0FDWV9SRUNPVkVSWV9NSU5fQUdFX0RBWVM9JXMgTEVHQUNZX1JFQ09WRVJZX01JTl9MSVFVSURJVFk9JXMgIgogICAgICAgICJMRUdBQ1lfUkVDT1ZFUllfTUlOX1ZPTFVNRV8yNEg9JXMgTEVHQUNZX1JFQ09WRVJZX01BWF9BTEVSVFNfUEVSX0NZQ0xFPSVzICIKICAgICAgICAiTEVHQUNZX1JFQ09WRVJZX0NPT0xET1dOX0hPVVJTPSVzIiwKICAgICAgICBfbW9kZSgpLAogICAgICAgIF9ub3JtYWxpemVfcmlza19zdHlsZShfcnVudGltZS5nZXQoInJpc2tfc3R5bGUiKSksCiAgICAgICAgX3J1bnRpbWVbImFsZXJ0X3RocmVzaG9sZCJdLAogICAgICAgIF9ydW50aW1lWyJtaW5fY29uZmlkZW5jZV90b19hbGVydCJdLAogICAgICAgIEVOQUJMRV9SRUdJTUVfR0FURSwKICAgICAgICBfcnVudGltZVsicmVnaW1lX21pbl9zY29yZSJdLAogICAgICAgIERSWV9SVU4sCiAgICAgICAgV0VFS0xZX1RVTklOR19FTkFCTEVELAogICAgICAgIFdFRUtMWV9UVU5JTkdfREFZX1VUQywKICAgICAgICBXRUVLTFlfVFVOSU5HX0hPVVJfVVRDLAogICAgICAgIE9VVENPTUVfVFJBQ0tJTkdfRU5BQkxFRCwKICAgICAgICBPVVRDT01FX0VWQUxfSU5URVJWQUxfU0VDT05EUywKICAgICAgICBBTEVSVF9UT1BfTiwKICAgICAgICBNQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgICAgICBfcnVudGltZVsiYWxlcnRfY29vbGRvd25faG91cnMiXSwKICAgICAgICBFTkFCTEVfUklTS19HT1ZFUk5PUiwKICAgICAgICBHTE9CQUxfVFJBRElOR19QQVVTRSwKICAgICAgICBNQVhfQUxFUlRTX1BFUl9EQVksCiAgICAgICAgTUFYX0FMRVJUU19QRVJfU1lNQk9MX1BFUl9EQVksCiAgICAgICAgTUFYX0NPTlNFQ1VUSVZFXzRIX0xPU1NFUywKICAgICAgICBMT1NTX1NUUkVBS19MT09LQkFDS19IT1VSUywKICAgICAgICBFTkFCTEVfRVhFQ1VUSU9OX1FVQUxJVFlfRklMVEVSUywKICAgICAgICBUQUNUSUNBTF9FTkFCTEVfUkVBTF9URUNITklDQUxTLAogICAgICAgIFRBQ1RJQ0FMX1JFUVVJUkVfVEVDSE5JQ0FMX0NPTkZJUk1BVElPTiwKICAgICAgICBUQUNUSUNBTF9PSExDVl9UWVBFLAogICAgICAgIFRBQ1RJQ0FMX1JTSV9NSU4sCiAgICAgICAgVEFDVElDQUxfUlNJX01BWCwKICAgICAgICBUQUNUSUNBTF9NQUNEX0hJU1RfTUlOLAogICAgICAgIEFMRVJUX0RBVEFfUkVGUkVTSF9FTkFCTEVELAogICAgICAgIEFMRVJUX1JFUVVJUkVfUkVGUkVTSF9TVUNDRVNTLAogICAgICAgIEFMRVJUX0RBVEFfRFJJRlRfV0FSTl9QQ1QsCiAgICAgICAgQUxFUlRfSElERV9VTlZFUklGSUVEX0hPTERFUlMsCiAgICAgICAgRU5BQkxFX1NPTF9SRUdJTUVfTEFZRVIsCiAgICAgICAgQkVBUklTSF9BTEVSVF9USFJFU0hPTEQsCiAgICAgICAgQkVBUklTSF9NSU5fQ09ORklERU5DRV9UT19BTEVSVCwKICAgICAgICBCRUFSSVNIX01BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgICAgIEJFQVJJU0hfTUFYX0FMRVJUU19QRVJfREFZLAogICAgICAgIEJFQVJJU0hfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICAgICAgRU5BQkxFX0VYVFJFTUVfUklTS19IQVJEX0JMT0NLLAogICAgICAgIE5FV19SVU5ORVJfV0FUQ0hfRU5BQkxFRCwKICAgICAgICBORVdfUlVOTkVSX1NDQU5fSU5URVJWQUxfU0VDT05EUywKICAgICAgICBORVdfUlVOTkVSX01JTl9NQVJLRVRfQ0FQLAogICAgICAgIE5FV19SVU5ORVJfTUFYX0FHRV9IT1VSUywKICAgICAgICBORVdfUlVOTkVSX01JTl9WT0xVTUVfMjRILAogICAgICAgIE5FV19SVU5ORVJfTUlOX0xJUVVJRElUWSwKICAgICAgICBORVdfUlVOTkVSX01JTl9BTEVSVF9TQ09SRSwKICAgICAgICBORVdfUlVOTkVSX0NPT0xET1dOX0hPVVJTLAogICAgICAgIFdBVENITElTVF9MQU5FX0VOQUJMRUQsCiAgICAgICAgbGVuKFdBVENITElTVF9FTlRSSUVTKSwKICAgICAgICBXQVRDSExJU1RfU0NBTl9JTlRFUlZBTF9TRUNPTkRTLAogICAgICAgIFdBVENITElTVF9NQVhfQUxFUlRTX1BFUl9DWUNMRSwKICAgICAgICBXQVRDSExJU1RfQUxFUlRfQ09PTERPV05fSE9VUlMsCiAgICAgICAgV0FUQ0hMSVNUX0FMRVJUX09OX1NUQVRVU19DSEFOR0UsCiAgICAgICAgIiwiLmpvaW4oV0FUQ0hMSVNUX0FMRVJUX1NUQVRVU0VTKSwKICAgICAgICBXQVRDSExJU1RfU1VNTUFSWV9FTkFCTEVELAogICAgICAgIFdBVENITElTVF9TVU1NQVJZX0hPVVJfVVRDLAogICAgICAgIEdPT0RfQlVZX0JVTExFVElOX0VOQUJMRUQsCiAgICAgICAgR09PRF9CVVlfQlVMTEVUSU5fSU5URVJWQUxfU0VDT05EUywKICAgICAgICBTRUxMX0FMRVJUU19FTkFCTEVELAogICAgICAgIFNFTExfQUxFUlRfTUFYX1BFUl9DWUNMRSwKICAgICAgICBTRUxMX0FMRVJUX0NPT0xET1dOX0hPVVJTLAogICAgICAgIHNlbGxfcnVsZXNbIm1heF9wZXJfY3ljbGUiXSwKICAgICAgICBzZWxsX3J1bGVzWyJjb29sZG93bl9ob3VycyJdLAogICAgICAgIExFR0FDWV9SRUNPVkVSWV9FTkFCTEVELAogICAgICAgIExFR0FDWV9SRUNPVkVSWV9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMsCiAgICAgICAgTEVHQUNZX1JFQ09WRVJZX01JTl9BR0VfREFZUywKICAgICAgICBMRUdBQ1lfUkVDT1ZFUllfTUlOX0xJUVVJRElUWSwKICAgICAgICBMRUdBQ1lfUkVDT1ZFUllfTUlOX1ZPTFVNRV8yNEgsCiAgICAgICAgTEVHQUNZX1JFQ09WRVJZX01BWF9BTEVSVFNfUEVSX0NZQ0xFLAogICAgICAgIExFR0FDWV9SRUNPVkVSWV9DT09MRE9XTl9IT1VSUywKICAgICkKICAgIHRyeToKICAgICAgICBnbG9iYWwgX2FwcF9yZWYKICAgICAgICBhcHAgPSBBcHBsaWNhdGlvbkJ1aWxkZXIoKS50b2tlbihURUxFR1JBTV9UT0tFTikuYnVpbGQoKQogICAgICAgIF9hcHBfcmVmID0gYXBwCgogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiaGVscCIsIGNtZF9oZWxwKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInN0YXR1cyIsIGNtZF9zdGF0dXMpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigibW9kZSIsIGNtZF9tb2RlKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInJpc2twcm9maWxlIiwgY21kX3Jpc2twcm9maWxlKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInJpc2siLCBjbWRfcmlzaykpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJwYXVzZSIsIGNtZF9wYXVzZSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJyZXN1bWUiLCBjbWRfcmVzdW1lKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInBlcmZvcm1hbmNlIiwgY21kX3BlcmZvcm1hbmNlKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImJ1eSIsIGNtZF9idXkpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic29sZCIsIGNtZF9zb2xkKSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInBvc2l0aW9ucyIsIGNtZF9wb3NpdGlvbnMpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiZGlnZXN0IiwgY21kX2RpZ2VzdCkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJtYXJrZXRub3ciLCBjbWRfbWFya2V0bm93KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImdvb2RidXkiLCBjbWRfZ29vZGJ1eSkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJiYWRidXkiLCBjbWRfYmFkYnV5KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIndhbGxldDJub3ciLCBjbWRfd2FsbGV0Mm5vdykpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ3YWxsZXQyYmFkIiwgY21kX3dhbGxldDJiYWQpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigid2FsbGV0M25vdyIsIGNtZF93YWxsZXQzbm93KSkKICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoIndhbGxldDNiYWQiLCBjbWRfd2FsbGV0M2JhZCkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ3YWxsZXRwbGFuIiwgY21kX3dhbGxldHBsYW4pKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigicnVubmVyd2F0Y2giLCBjbWRfcnVubmVyd2F0Y2gpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigid2F0Y2hsaXN0IiwgY21kX3dhdGNobGlzdCkpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ3YXRjaGxpc3RzdW1tYXJ5IiwgY21kX3dhdGNobGlzdHN1bW1hcnkpKQogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDYWxsYmFja1F1ZXJ5SGFuZGxlcihvbl9hbGVydF9hY3Rpb24sIHBhdHRlcm49ciJeKG11dGV8YWNrKToiKSkKCiAgICAgICAgIyBKdXBpdGVyIFBlcnBzIExldmVyYWdlIEFzc2lzdGFudAogICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigibGV2IiwgY21kX2xldikpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJsZXZzdGF0dXMiLCBjbWRfbGV2X3N0YXR1cykpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ3aGF0aWYiLCBjbWRfd2hhdF9pZikpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJsZXZyZWMiLCBjbWRfbGV2X3JlYykpCiAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJwcmljZXpvbmVzIiwgY21kX3ByaWNlX3pvbmVzKSkKICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgICAgIHJ1bl9sZXZfbW9uaXRvciwKICAgICAgICAgICAgaW50ZXJ2YWw9Q0hFQ0tfSU5URVJWQUxfU0VDT05EUywKICAgICAgICAgICAgZmlyc3Q9NjAsCiAgICAgICAgICAgIG5hbWU9Imxldl9tb25pdG9yIiwKICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDYwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICAgICApCgogICAgICAgIGFwcC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgICAgIHJ1bl9lbmdpbmUsCiAgICAgICAgICAgIHdoZW49MSwKICAgICAgICAgICAgbmFtZT0icnVuX2VuZ2luZV9ib290IiwKICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDMwfSwKICAgICAgICApCiAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKAogICAgICAgICAgICBydW5fZW5naW5lLAogICAgICAgICAgICBpbnRlcnZhbD1pbnQoX3J1bnRpbWVbInNjYW5faW50ZXJ2YWxfc2Vjb25kcyJdKSwKICAgICAgICAgICAgZmlyc3Q9aW50KF9ydW50aW1lWyJzY2FuX2ludGVydmFsX3NlY29uZHMiXSksCiAgICAgICAgICAgIG5hbWU9InJ1bl9lbmdpbmVfY3ljbGUiLAogICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMzAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICkKICAgICAgICBpZiBORVdfUlVOTkVSX1dBVENIX0VOQUJMRUQ6CiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgICAgICAgICBydW5fbmV3X3J1bm5lcl93YXRjaCwKICAgICAgICAgICAgICAgIHdoZW49MTUsCiAgICAgICAgICAgICAgICBuYW1lPSJydW5uZXJfd2F0Y2hfYm9vdCIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogNjB9LAogICAgICAgICAgICApCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX3JlcGVhdGluZygKICAgICAgICAgICAgICAgIHJ1bl9uZXdfcnVubmVyX3dhdGNoLAogICAgICAgICAgICAgICAgaW50ZXJ2YWw9bWF4KDMwMCwgaW50KE5FV19SVU5ORVJfU0NBTl9JTlRFUlZBTF9TRUNPTkRTKSksCiAgICAgICAgICAgICAgICBmaXJzdD1tYXgoMzAwLCBpbnQoTkVXX1JVTk5FUl9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMpKSwKICAgICAgICAgICAgICAgIG5hbWU9InJ1bm5lcl93YXRjaF9jeWNsZSIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMTIwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICAgICAgICAgKQogICAgICAgIGlmIExFR0FDWV9SRUNPVkVSWV9FTkFCTEVEOgogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgICAgICAgICAgcnVuX2xlZ2FjeV9yZWNvdmVyeV9zY2FubmVyLAogICAgICAgICAgICAgICAgd2hlbj0zNSwKICAgICAgICAgICAgICAgIG5hbWU9ImxlZ2FjeV9yZWNvdmVyeV9ib290IiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiA2MH0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKAogICAgICAgICAgICAgICAgcnVuX2xlZ2FjeV9yZWNvdmVyeV9zY2FubmVyLAogICAgICAgICAgICAgICAgaW50ZXJ2YWw9bWF4KDMwMCwgaW50KExFR0FDWV9SRUNPVkVSWV9TQ0FOX0lOVEVSVkFMX1NFQ09ORFMpKSwKICAgICAgICAgICAgICAgIGZpcnN0PW1heCgzMDAsIGludChMRUdBQ1lfUkVDT1ZFUllfU0NBTl9JTlRFUlZBTF9TRUNPTkRTKSksCiAgICAgICAgICAgICAgICBuYW1lPSJsZWdhY3lfcmVjb3ZlcnlfY3ljbGUiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDEyMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBXQVRDSExJU1RfTEFORV9FTkFCTEVEIGFuZCBXQVRDSExJU1RfRU5UUklFUzoKICAgICAgICAgICAgYXBwLmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICAgICAgICAgIHJ1bl93YXRjaGxpc3RfbGFuZSwKICAgICAgICAgICAgICAgIHdoZW49MjUsCiAgICAgICAgICAgICAgICBuYW1lPSJ3YXRjaGxpc3RfYm9vdCIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogNjB9LAogICAgICAgICAgICApCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX3JlcGVhdGluZygKICAgICAgICAgICAgICAgIHJ1bl93YXRjaGxpc3RfbGFuZSwKICAgICAgICAgICAgICAgIGludGVydmFsPW1heCgzMDAsIGludChXQVRDSExJU1RfU0NBTl9JTlRFUlZBTF9TRUNPTkRTKSksCiAgICAgICAgICAgICAgICBmaXJzdD1tYXgoMzAwLCBpbnQoV0FUQ0hMSVNUX1NDQU5fSU5URVJWQUxfU0VDT05EUykpLAogICAgICAgICAgICAgICAgbmFtZT0id2F0Y2hsaXN0X2N5Y2xlIiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAxMjAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCiAgICAgICAgaWYgT1VUQ09NRV9UUkFDS0lOR19FTkFCTEVEOgogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgICAgICAgICBydW5fb3V0Y29tZV9ldmFsdWF0b3IsCiAgICAgICAgICAgICAgICBpbnRlcnZhbD1PVVRDT01FX0VWQUxfSU5URVJWQUxfU0VDT05EUywKICAgICAgICAgICAgICAgIGZpcnN0PU9VVENPTUVfRVZBTF9JTlRFUlZBTF9TRUNPTkRTLAogICAgICAgICAgICAgICAgbmFtZT0ib3V0Y29tZV9ldmFsdWF0b3IiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDEyMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBTSUdOQUxfRElHRVNUX0VOQUJMRUQ6CiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX3JlcGVhdGluZygKICAgICAgICAgICAgICAgIHNlbmRfc2lnbmFsX2RpZ2VzdCwKICAgICAgICAgICAgICAgIGludGVydmFsPVNJR05BTF9ESUdFU1RfSU5URVJWQUxfU0VDT05EUywKICAgICAgICAgICAgICAgIGZpcnN0PVNJR05BTF9ESUdFU1RfSU5URVJWQUxfU0VDT05EUywKICAgICAgICAgICAgICAgIG5hbWU9InNpZ25hbF9kaWdlc3QiLAogICAgICAgICAgICAgICAgam9iX2t3YXJncz17Im1pc2ZpcmVfZ3JhY2VfdGltZSI6IDEyMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBHT09EX0JVWV9CVUxMRVRJTl9FTkFCTEVEOgogICAgICAgICAgICBidWxsZXRpbl9pbnRlcnZhbCA9IG1heCg5MDAsIGludChHT09EX0JVWV9CVUxMRVRJTl9JTlRFUlZBTF9TRUNPTkRTKSkKICAgICAgICAgICAgYnVsbGV0aW5fYm9vdCA9IG1heCgxNSwgbWluKGludChHT09EX0JVWV9CVUxMRVRJTl9CT09UX1NFQ09ORFMpLCBidWxsZXRpbl9pbnRlcnZhbCkpCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgICAgICAgICBzZW5kX2dvb2RfYnV5X2J1bGxldGluLAogICAgICAgICAgICAgICAgd2hlbj1idWxsZXRpbl9ib290LAogICAgICAgICAgICAgICAgbmFtZT0iZ29vZF9idXlfYnVsbGV0aW5fYm9vdCIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMTIwfSwKICAgICAgICAgICAgKQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9yZXBlYXRpbmcoCiAgICAgICAgICAgICAgICBzZW5kX2dvb2RfYnV5X2J1bGxldGluLAogICAgICAgICAgICAgICAgaW50ZXJ2YWw9YnVsbGV0aW5faW50ZXJ2YWwsCiAgICAgICAgICAgICAgICBmaXJzdD1idWxsZXRpbl9pbnRlcnZhbCwKICAgICAgICAgICAgICAgIG5hbWU9Imdvb2RfYnV5X2J1bGxldGluIiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAzMDAsICJjb2FsZXNjZSI6IFRydWV9LAogICAgICAgICAgICApCgogICAgICAgIGlmIERBSUxZX1NVTU1BUllfRU5BQkxFRDoKICAgICAgICAgICAgc3VtbWFyeV9ob3VyID0gbWF4KDAsIG1pbigyMywgREFJTFlfU1VNTUFSWV9IT1VSX1VUQykpCiAgICAgICAgICAgIGFwcC5qb2JfcXVldWUucnVuX2RhaWx5KAogICAgICAgICAgICAgICAgc2VuZF9kYWlseV9zdW1tYXJ5LAogICAgICAgICAgICAgICAgdGltZT10aW1lKGhvdXI9c3VtbWFyeV9ob3VyLCBtaW51dGU9MCwgdHppbmZvPXRpbWV6b25lLnV0YyksCiAgICAgICAgICAgICAgICBuYW1lPSJkYWlseV9zdW1tYXJ5IiwKICAgICAgICAgICAgICAgIGpvYl9rd2FyZ3M9eyJtaXNmaXJlX2dyYWNlX3RpbWUiOiAxODAwLCAiY29hbGVzY2UiOiBUcnVlfSwKICAgICAgICAgICAgKQogICAgICAgIGlmIFdFRUtMWV9UVU5JTkdfRU5BQkxFRDoKICAgICAgICAgICAgd2Vla2x5X2hvdXIgPSBtYXgoMCwgbWluKDIzLCBXRUVLTFlfVFVOSU5HX0hPVVJfVVRDKSkKICAgICAgICAgICAgd2Vla2x5X2RheSA9IF9EQVlfVE9fV0VFS0RBWS5nZXQoV0VFS0xZX1RVTklOR19EQVlfVVRDLCA2KQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9kYWlseSgKICAgICAgICAgICAgICAgIHNlbmRfd2Vla2x5X3R1bmluZ19yZXBvcnQsCiAgICAgICAgICAgICAgICB0aW1lPXRpbWUoaG91cj13ZWVrbHlfaG91ciwgbWludXRlPTUsIHR6aW5mbz10aW1lem9uZS51dGMpLAogICAgICAgICAgICAgICAgZGF5cz0od2Vla2x5X2RheSwpLAogICAgICAgICAgICAgICAgbmFtZT0id2Vla2x5X3R1bmluZyIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMzYwMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKICAgICAgICBpZiBXQVRDSExJU1RfU1VNTUFSWV9FTkFCTEVEIGFuZCBXQVRDSExJU1RfTEFORV9FTkFCTEVEIGFuZCBXQVRDSExJU1RfRU5UUklFUzoKICAgICAgICAgICAgd2F0Y2hfc3VtbWFyeV9ob3VyID0gbWF4KDAsIG1pbigyMywgV0FUQ0hMSVNUX1NVTU1BUllfSE9VUl9VVEMpKQogICAgICAgICAgICBhcHAuam9iX3F1ZXVlLnJ1bl9kYWlseSgKICAgICAgICAgICAgICAgIHNlbmRfd2F0Y2hsaXN0X3N1bW1hcnksCiAgICAgICAgICAgICAgICB0aW1lPXRpbWUoaG91cj13YXRjaF9zdW1tYXJ5X2hvdXIsIG1pbnV0ZT0xMCwgdHppbmZvPXRpbWV6b25lLnV0YyksCiAgICAgICAgICAgICAgICBuYW1lPSJ3YXRjaGxpc3Rfc3VtbWFyeSIsCiAgICAgICAgICAgICAgICBqb2Jfa3dhcmdzPXsibWlzZmlyZV9ncmFjZV90aW1lIjogMTgwMCwgImNvYWxlc2NlIjogVHJ1ZX0sCiAgICAgICAgICAgICkKCiAgICAgICAgcHJpbnQoIkVuZ2luZSBzdGFydGVkLi4uIikKICAgICAgICBhcHAucnVuX3BvbGxpbmcoKQogICAgZmluYWxseToKICAgICAgICBsb2NrLnJlbGVhc2UoKQoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCkK',
    '/root/memecoin_engine/jupiter_perps.py': 'IiIiCkp1cGl0ZXIgUGVycHMgU09MIExldmVyYWdlIEFzc2lzdGFudApSZWFkLW9ubHkgcG9zaXRpb24gdHJhY2tlciBmb3IgSnVwaXRlciBwZXJwZXR1YWxzIG9uIFNvbGFuYS4KRmV0Y2hlcyBwb3NpdGlvbiBkYXRhIHZpYSBKdXBpdGVyIFBlcnBzIEFQSSBhbmQgb24tY2hhaW4gUlBDLgoiIiIKCmltcG9ydCBsb2dnaW5nCmltcG9ydCBtYXRoCmltcG9ydCB0aW1lCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lem9uZQoKaW1wb3J0IHJlcXVlc3RzCgojIOKUgOKUgCBDb25zdGFudHMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACgpXQUxMRVRfQUREUkVTUyA9ICI2WWVBVEI3NUF5SktNOHVqdjNxUVh0ekNLckFDbVFnenBnZjRFbWppaGhGNCIKU09MQU5BX1JQQyA9ICJodHRwczovL2FwaS5tYWlubmV0LWJldGEuc29sYW5hLmNvbSIKCiMgSnVwaXRlciBQZXJwcyBBUEkKSlVQSVRFUl9QRVJQU19BUEkgPSAiaHR0cHM6Ly9wZXJwcy1hcGkuanVwLmFnL3YxIgoKIyBBbGVydCB0aHJlc2hvbGRzCkxJUV9XQVJOX1BDVCA9IDE1LjAgICAgICAgICAgIyB3YXJuIGlmIDwgMTUlIGF3YXkgZnJvbSBsaXF1aWRhdGlvbgpQUklDRV9UQVJHRVRTID0gWzEwMC4wLCAxMjAuMCwgMTYwLjBdCkZVTkRJTkdfV0FSTl9QQ1QgPSAwLjA1ICAgICAgIyB3YXJuIGlmIGZ1bmRpbmcgcmF0ZSA+IDAuMDUlCkZVTkRJTkdfSElHSF9QQ1QgPSAwLjA2ICAgICAgIyBzaG93IGNvc3QgaW1wYWN0IGFib3ZlIHRoaXMKTU9OVEhMWV9BRERfVVNEID0gMjUwLjAKTU9OVEhMWV9MRVZFUkFHRSA9IDMuMApDSEVDS19JTlRFUlZBTF9TRUNPTkRTID0gNjAKTU9OVEhMWV9SRU1JTkRFUl9EQVlTID0gMzAKCiMgUmlzayB6b25lIHRocmVzaG9sZHMgKGxpcSBkaXN0YW5jZSAlKQpTQUZFX0xJUV9ESVNUQU5DRSA9IDQwLjAgICAgICAgIyA+IDQwJSA9IHNhZmUKTkVVVFJBTF9MSVFfRElTVEFOQ0UgPSAyNS4wICAgICMgMjUtNDAlID0gbmV1dHJhbApXQVJOX0xJUV9ESVNUQU5DRSA9IDE1LjAgICAgICAgIyAxNS0yNSUgPSBhZ2dyZXNzaXZlCkRBTkdFUl9MSVFfRElTVEFOQ0UgPSAxNS4wICAgICAjIDwgMTUlID0gYmxvY2tlZAoKIyBMZXZlcmFnZSBvcHRpb25zClNBRkVfTEVWRVJBR0UgPSAyLjAKTkVVVFJBTF9MRVZFUkFHRSA9IDMuMApBR0dSRVNTSVZFX0xFVkVSQUdFID0gNC41Ck1BWF9MRVZFUkFHRSA9IDUuMAoKIyBWb2xhdGlsaXR5IHRocmVzaG9sZHMKVk9MX1dBUk5JTkdfVEhSRVNIT0xEID0gMTIuMCAgICMgJSDigJQgd2FybiBpZiBhYm92ZQpWT0xfSElHSF9USFJFU0hPTEQgPSAxMC4wICAgICAgIyAlIOKAlCBzdWdnZXN0IGxvd2VyIGxldmVyYWdlCgojIFByaWNlIHpvbmVzIHRvIGFuYWx5c2UgaW4gL3ByaWNlem9uZXMKUFJJQ0VfWk9ORV9MRVZFTFMgPSBbMTAwLjAsIDc1LjAsIDYwLjBdCgojIOKUgOKUgCBTZXBhcmF0b3Ig4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACgpTRVAgPSAi4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBIgoKIyDilIDilIAgU3RhdGUg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACgpfc3RhdGUgPSB7CiAgICAibGFzdF9tb250aGx5X3JlbWluZGVyX3RzIjogMC4wLAogICAgInRhcmdldHNfaGl0Ijogc2V0KCksICAgICAgICAgICMgcHJpY2UgdGFyZ2V0cyBhbHJlYWR5IGFsZXJ0ZWQKICAgICJsYXN0X2xpcV9hbGVydF90cyI6IDAuMCwKICAgICJsYXN0X2Z1bmRpbmdfYWxlcnRfdHMiOiAwLjAsCn0KCgojIOKUgOKUgCBGZXRjaCBwb3NpdGlvbiBmcm9tIEp1cGl0ZXIgUGVycHMgQVBJIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAoKZGVmIGZldGNoX2p1cGl0ZXJfcG9zaXRpb24oKToKICAgICIiIgogICAgRmV0Y2ggb3BlbiBTT0wtTE9ORyBwb3NpdGlvbiBmb3Igd2FsbGV0IGZyb20gSnVwaXRlciBQZXJwcyBBUEkuCiAgICBSZXR1cm5zIG5vcm1hbGl6ZWQgZGljdCBvciBOb25lLgogICAgIiIiCiAgICB0cnk6CiAgICAgICAgdXJsID0gZiJ7SlVQSVRFUl9QRVJQU19BUEl9L3Bvc2l0aW9ucyIKICAgICAgICBwYXJhbXMgPSB7IndhbGxldEFkZHJlc3MiOiBXQUxMRVRfQUREUkVTU30KICAgICAgICByID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zPXBhcmFtcywgdGltZW91dD0xMCkKICAgICAgICBpZiByLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBkYXRhID0gci5qc29uKCkgb3Ige30KICAgICAgICBwb3NpdGlvbnMgPSBkYXRhLmdldCgiZGF0YUxpc3QiKSBvciBkYXRhLmdldCgicG9zaXRpb25zIikgb3IgW10KICAgICAgICAjIEZpbmQgb3BlbiBTT0wgbG9uZwogICAgICAgIGZvciBwb3MgaW4gcG9zaXRpb25zOgogICAgICAgICAgICBtYXJrZXQgPSBzdHIocG9zLmdldCgibWFya2V0Iikgb3IgcG9zLmdldCgibWFya2V0U3ltYm9sIikgb3IgIiIpLnVwcGVyKCkKICAgICAgICAgICAgc2lkZSA9IHN0cihwb3MuZ2V0KCJzaWRlIikgb3IgIiIpLnVwcGVyKCkKICAgICAgICAgICAgaWYgIlNPTCIgaW4gbWFya2V0IGFuZCBzaWRlIGluICgiTE9ORyIsICJCVVkiKToKICAgICAgICAgICAgICAgIHJldHVybiBfbm9ybWFsaXplX3Bvc2l0aW9uKHBvcykKICAgICAgICAjIElmIG5vIG1hdGNoLCByZXR1cm4gZmlyc3Qgb3BlbiBwb3NpdGlvbgogICAgICAgIGlmIHBvc2l0aW9uczoKICAgICAgICAgICAgcmV0dXJuIF9ub3JtYWxpemVfcG9zaXRpb24ocG9zaXRpb25zWzBdKQogICAgICAgIHJldHVybiBOb25lCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2luZy53YXJuaW5nKCJqdXBpdGVyX3BlcnBzOiBmZXRjaCBlcnJvcjogJXMiLCBlKQogICAgICAgIHJldHVybiBOb25lCgoKZGVmIF9ub3JtYWxpemVfcG9zaXRpb24ocG9zKToKICAgICIiIgogICAgTm9ybWFsaXplIHJhdyBKdXBpdGVyIFBlcnBzIHBvc2l0aW9uIGRpY3QgdG8gc3RhbmRhcmQgZmllbGRzLgogICAgSnVwaXRlciBBUEkgcmV0dXJucyBhbGwgbnVtZXJpYyB2YWx1ZXMgYXMgc3RyaW5ncy4KICAgIEFjdHVhbCBmaWVsZHM6IGVudHJ5UHJpY2UsIG1hcmtQcmljZSwgbGlxdWlkYXRpb25QcmljZSwgbGV2ZXJhZ2UsCiAgICBzaXplIChTT0wpLCBjb2xsYXRlcmFsVXNkLCBwbmxBZnRlckZlZXNVc2QsIGJvcnJvd0ZlZXNVc2QsIHNpZGUsIGNyZWF0ZWRUaW1lCiAgICAiIiIKICAgIGRlZiBfZihrZXksIGZhbGxiYWNrPTAuMCk6CiAgICAgICAgdiA9IHBvcy5nZXQoa2V5KQogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIGZsb2F0KHYpIGlmIHYgaXMgbm90IE5vbmUgZWxzZSBmYWxsYmFjawogICAgICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICAgICAgcmV0dXJuIGZhbGxiYWNrCgogICAgZW50cnlfcHJpY2UgID0gX2YoImVudHJ5UHJpY2UiKQogICAgbWFya19wcmljZSAgID0gX2YoIm1hcmtQcmljZSIpCiAgICBsaXFfcHJpY2UgICAgPSBfZigibGlxdWlkYXRpb25QcmljZSIpCiAgICBsZXZlcmFnZSAgICAgPSBfZigibGV2ZXJhZ2UiKQoKICAgICMgc2l6ZVVzZERlbHRhIGlzIHRoZSBVU0QgcG9zaXRpb24gc2l6ZSAoaW4gbWljcm8tdW5pdHMsIGRpdmlkZSBieSAxZTYpCiAgICBzaXplX3VzZF9yYXcgPSBfZigic2l6ZVVzZERlbHRhIikKICAgIHNpemVfdXNkID0gc2l6ZV91c2RfcmF3IC8gMV8wMDBfMDAwIGlmIHNpemVfdXNkX3JhdyA+IDEwMDAgZWxzZSBfZigic2l6ZSIpCgogICAgIyBjb2xsYXRlcmFsVXNkIGlzIGluIG1pY3JvLXVuaXRzIHRvbwogICAgY29sbGF0ZXJhbF9yYXcgPSBfZigiY29sbGF0ZXJhbFVzZCIpCiAgICBjb2xsYXRlcmFsID0gY29sbGF0ZXJhbF9yYXcgLyAxXzAwMF8wMDAgaWYgY29sbGF0ZXJhbF9yYXcgPiAxMDAwIGVsc2UgX2YoImNvbGxhdGVyYWwiKQoKICAgICMgUG5MOiB1c2UgcG5sQWZ0ZXJGZWVzVXNkIChtaWNyby11bml0cykgb3IgcG5sQWZ0ZXJGZWVzCiAgICBwbmxfcmF3ID0gX2YoInBubEFmdGVyRmVlc1VzZCIpCiAgICBwbmwgPSBwbmxfcmF3IGlmIGFicyhwbmxfcmF3KSA8IDFfMDAwXzAwMCBlbHNlIHBubF9yYXcgLyAxXzAwMF8wMDAKCiAgICAjIEZ1bmRpbmcgcmF0ZTogZGVyaXZlIGZyb20gYm9ycm93IGZlZXMgLyBwb3NpdGlvbiBhZ2UgaW4gZGF5cwogICAgYm9ycm93X2ZlZXNfdXNkID0gX2YoImJvcnJvd0ZlZXNVc2QiKQogICAgY3JlYXRlZF90aW1lID0gX2YoImNyZWF0ZWRUaW1lIikKICAgIGZ1bmRpbmdfcmF0ZSA9IDAuMAogICAgaWYgYm9ycm93X2ZlZXNfdXNkIGFuZCBjcmVhdGVkX3RpbWUgYW5kIHNpemVfdXNkID4gMDoKICAgICAgICBpbXBvcnQgdGltZSBhcyBfdGltZQogICAgICAgIGRheXNfb3BlbiA9IG1heCgxLCAoX3RpbWUudGltZSgpIC0gY3JlYXRlZF90aW1lKSAvIDg2NDAwKQogICAgICAgICMgRGFpbHkgcmF0ZSBhcyAlIG9mIHBvc2l0aW9uIHNpemUKICAgICAgICBmdW5kaW5nX3JhdGUgPSAoYm9ycm93X2ZlZXNfdXNkIC8gZGF5c19vcGVuKSAvIHNpemVfdXNkICogMTAwCgogICAgIyBGYWxsYmFjayBsZXZlcmFnZSBjYWxjCiAgICBpZiBsZXZlcmFnZSA9PSAwIGFuZCBjb2xsYXRlcmFsID4gMCBhbmQgc2l6ZV91c2QgPiAwOgogICAgICAgIGxldmVyYWdlID0gc2l6ZV91c2QgLyBjb2xsYXRlcmFsCgogICAgc2lkZSA9IHN0cihwb3MuZ2V0KCJzaWRlIikgb3IgImxvbmciKS51cHBlcigpCgogICAgcmV0dXJuIHsKICAgICAgICAiZW50cnlfcHJpY2UiOiAgZW50cnlfcHJpY2UsCiAgICAgICAgIm1hcmtfcHJpY2UiOiAgIG1hcmtfcHJpY2UsCiAgICAgICAgInNpemVfdXNkIjogICAgIHNpemVfdXNkLAogICAgICAgICJjb2xsYXRlcmFsIjogICBjb2xsYXRlcmFsLAogICAgICAgICJsaXFfcHJpY2UiOiAgICBsaXFfcHJpY2UsCiAgICAgICAgInBubCI6ICAgICAgICAgIHBubCwKICAgICAgICAiZnVuZGluZ19yYXRlIjogZnVuZGluZ19yYXRlLAogICAgICAgICJsZXZlcmFnZSI6ICAgICBsZXZlcmFnZSwKICAgICAgICAibWFya2V0IjogICAgICAgIlNPTC1QRVJQIiwKICAgICAgICAic2lkZSI6ICAgICAgICAgc2lkZSwKICAgICAgICAiYm9ycm93X2ZlZXNfdXNkIjogYm9ycm93X2ZlZXNfdXNkLAogICAgICAgICJyYXciOiAgICAgICAgICBwb3MsCiAgICB9CgoKIyDilIDilIAgRmFsbGJhY2s6IGZldGNoIFNPTCBwcmljZSBmcm9tIERleFNjcmVlbmVyIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAoKZGVmIGZldGNoX3NvbF9wcmljZSgpOgogICAgIiIiRmV0Y2ggY3VycmVudCBTT0wgcHJpY2UgZnJvbSBEZXhTY3JlZW5lciBhcyBmYWxsYmFjayBtYXJrIHByaWNlLiIiIgogICAgdHJ5OgogICAgICAgIHIgPSByZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICJodHRwczovL2FwaS5kZXhzY3JlZW5lci5jb20vbGF0ZXN0L2RleC9zZWFyY2giLAogICAgICAgICAgICBwYXJhbXM9eyJxIjogIlNPTCJ9LAogICAgICAgICAgICB0aW1lb3V0PTEwLAogICAgICAgICkKICAgICAgICBkYXRhID0gci5qc29uKCkgb3Ige30KICAgICAgICBwYWlycyA9IGRhdGEuZ2V0KCJwYWlycyIpIG9yIFtdCiAgICAgICAgc29sX3N0YWJsZSA9IFsKICAgICAgICAgICAgcCBmb3IgcCBpbiBwYWlycwogICAgICAgICAgICBpZiBwLmdldCgiY2hhaW5JZCIpID09ICJzb2xhbmEiCiAgICAgICAgICAgIGFuZCBzdHIocC5nZXQoImJhc2VUb2tlbiIsIHt9KS5nZXQoInN5bWJvbCIpIG9yICIiKS51cHBlcigpID09ICJTT0wiCiAgICAgICAgICAgIGFuZCBzdHIocC5nZXQoInF1b3RlVG9rZW4iLCB7fSkuZ2V0KCJzeW1ib2wiKSBvciAiIikudXBwZXIoKSBpbiAoIlVTREMiLCAiVVNEVCIpCiAgICAgICAgXQogICAgICAgIGlmIHNvbF9zdGFibGU6CiAgICAgICAgICAgIGJlc3QgPSBzb3J0ZWQoc29sX3N0YWJsZSwga2V5PWxhbWJkYSBwOiBmbG9hdCgocC5nZXQoImxpcXVpZGl0eSIpIG9yIHt9KS5nZXQoInVzZCIpIG9yIDApLCByZXZlcnNlPVRydWUpWzBdCiAgICAgICAgICAgIHJldHVybiBmbG9hdChiZXN0LmdldCgicHJpY2VVc2QiKSBvciAwKQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBwYXNzCiAgICByZXR1cm4gTm9uZQoKCiMg4pSA4pSAIENhbGN1bGF0aW9ucyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKCmRlZiBjYWxjX2xpcV9kaXN0YW5jZV9wY3QobWFya19wcmljZSwgbGlxX3ByaWNlKToKICAgICIiIlJldHVybnMgJSBkaXN0YW5jZSBmcm9tIG1hcmsgdG8gbGlxdWlkYXRpb24gKHBvc2l0aXZlID0gc2FmZSkuIiIiCiAgICBpZiBub3QgbWFya19wcmljZSBvciBub3QgbGlxX3ByaWNlIG9yIGxpcV9wcmljZSA8PSAwOgogICAgICAgIHJldHVybiBOb25lCiAgICByZXR1cm4gYWJzKG1hcmtfcHJpY2UgLSBsaXFfcHJpY2UpIC8gbWFya19wcmljZSAqIDEwMAoKCmRlZiBjYWxjX3doYXRfaWYocG9zaXRpb24sIHRhcmdldF9wcmljZSk6CiAgICAiIiJDYWxjdWxhdGUgUG5MIGFuZCBuZXcgcG9zaXRpb24gc3RhdGUgYXQgYSB0YXJnZXQgcHJpY2UuIiIiCiAgICBpZiBub3QgcG9zaXRpb246CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGVudHJ5ID0gcG9zaXRpb25bImVudHJ5X3ByaWNlIl0KICAgIHNpemUgPSBwb3NpdGlvblsic2l6ZV91c2QiXQogICAgY29sbGF0ZXJhbCA9IHBvc2l0aW9uWyJjb2xsYXRlcmFsIl0KICAgIGxpcSA9IHBvc2l0aW9uWyJsaXFfcHJpY2UiXQogICAgaWYgbm90IGVudHJ5IG9yIGVudHJ5IDw9IDAgb3Igbm90IHNpemUgb3Igbm90IGNvbGxhdGVyYWw6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHByaWNlX2NoYW5nZV9wY3QgPSAodGFyZ2V0X3ByaWNlIC0gZW50cnkpIC8gZW50cnkgKiAxMDAKICAgIHBubCA9IHNpemUgKiAocHJpY2VfY2hhbmdlX3BjdCAvIDEwMCkKICAgIG5ld19jb2xsYXRlcmFsID0gY29sbGF0ZXJhbCArIHBubAogICAgbGlxX2Rpc3RhbmNlID0gY2FsY19saXFfZGlzdGFuY2VfcGN0KHRhcmdldF9wcmljZSwgbGlxKQogICAgcmV0dXJuIHsKICAgICAgICAidGFyZ2V0X3ByaWNlIjogdGFyZ2V0X3ByaWNlLAogICAgICAgICJwcmljZV9jaGFuZ2VfcGN0IjogcHJpY2VfY2hhbmdlX3BjdCwKICAgICAgICAicG5sIjogcG5sLAogICAgICAgICJuZXdfY29sbGF0ZXJhbCI6IG5ld19jb2xsYXRlcmFsLAogICAgICAgICJsaXFfZGlzdGFuY2VfcGN0IjogbGlxX2Rpc3RhbmNlLAogICAgfQoKCmRlZiBjYWxjX21vbnRobHlfYWRkX2ltcGFjdChwb3NpdGlvbiwgYWRkX3VzZD1NT05USExZX0FERF9VU0QsIGxldmVyYWdlPU1PTlRITFlfTEVWRVJBR0UpOgogICAgIiIiQ2FsY3VsYXRlIHdoYXQgYWRkaW5nICQyNTAgYXQgM3ggbGV2ZXJhZ2UgZG9lcyB0byBwb3NpdGlvbi4iIiIKICAgIGlmIG5vdCBwb3NpdGlvbjoKICAgICAgICByZXR1cm4gTm9uZQogICAgbmV3X3NpemUgPSBhZGRfdXNkICogbGV2ZXJhZ2UKICAgIGN1cnJlbnRfc2l6ZSA9IHBvc2l0aW9uWyJzaXplX3VzZCJdCiAgICBjdXJyZW50X2NvbGxhdGVyYWwgPSBwb3NpdGlvblsiY29sbGF0ZXJhbCJdCiAgICBuZXdfdG90YWxfc2l6ZSA9IGN1cnJlbnRfc2l6ZSArIG5ld19zaXplCiAgICBuZXdfdG90YWxfY29sbGF0ZXJhbCA9IGN1cnJlbnRfY29sbGF0ZXJhbCArIGFkZF91c2QKICAgIG5ld19sZXZlcmFnZSA9IG5ld190b3RhbF9zaXplIC8gbmV3X3RvdGFsX2NvbGxhdGVyYWwgaWYgbmV3X3RvdGFsX2NvbGxhdGVyYWwgPiAwIGVsc2UgMAogICAgcmV0dXJuIHsKICAgICAgICAiYWRkX3VzZCI6IGFkZF91c2QsCiAgICAgICAgImFkZF9sZXZlcmFnZSI6IGxldmVyYWdlLAogICAgICAgICJuZXdfc2l6ZV9hZGRlZCI6IG5ld19zaXplLAogICAgICAgICJuZXdfdG90YWxfc2l6ZSI6IG5ld190b3RhbF9zaXplLAogICAgICAgICJuZXdfdG90YWxfY29sbGF0ZXJhbCI6IG5ld190b3RhbF9jb2xsYXRlcmFsLAogICAgICAgICJuZXdfbGV2ZXJhZ2UiOiBuZXdfbGV2ZXJhZ2UsCiAgICB9CgoKIyDilIDilIAgU09MIFZvbGF0aWxpdHkgKDMwZCkg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACgpfdm9sX2NhY2hlID0geyJ2YWx1ZSI6IE5vbmUsICJ0cyI6IDAuMH0KX1ZPTF9DQUNIRV9UVEwgPSAzNjAwICAjIHJlZnJlc2ggaG91cmx5CgoKZGVmIGZldGNoX3NvbF92b2xhdGlsaXR5XzMwZCgpOgogICAgIiIiCiAgICBFc3RpbWF0ZSAzMC1kYXkgU09MIHZvbGF0aWxpdHkgdXNpbmcgQ29pbkdlY2tvIGRhaWx5IE9ITEMuCiAgICBSZXR1cm5zIGFubnVhbGlzZWQgZGFpbHkgdm9sICUgKGUuZy4gOC4zIG1lYW5zIDguMyUpLgogICAgQ2FjaGVzIHJlc3VsdCBmb3IgMSBob3VyLgogICAgIiIiCiAgICBub3cgPSB0aW1lLnRpbWUoKQogICAgaWYgX3ZvbF9jYWNoZVsidmFsdWUiXSBpcyBub3QgTm9uZSBhbmQgbm93IC0gX3ZvbF9jYWNoZVsidHMiXSA8IF9WT0xfQ0FDSEVfVFRMOgogICAgICAgIHJldHVybiBfdm9sX2NhY2hlWyJ2YWx1ZSJdCiAgICB0cnk6CiAgICAgICAgIyBDb2luR2Vja28gZnJlZSBlbmRwb2ludCDigJQgbm8ga2V5IG5lZWRlZAogICAgICAgIHVybCA9ICJodHRwczovL2FwaS5jb2luZ2Vja28uY29tL2FwaS92My9jb2lucy9zb2xhbmEvbWFya2V0X2NoYXJ0IgogICAgICAgIHBhcmFtcyA9IHsidnNfY3VycmVuY3kiOiAidXNkIiwgImRheXMiOiAiMzAiLCAiaW50ZXJ2YWwiOiAiZGFpbHkifQogICAgICAgIHIgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9cGFyYW1zLCB0aW1lb3V0PTEyKQogICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgIT0gMjAwOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGRhdGEgPSByLmpzb24oKSBvciB7fQogICAgICAgIHByaWNlcyA9IFtwWzFdIGZvciBwIGluIChkYXRhLmdldCgicHJpY2VzIikgb3IgW10pIGlmIHAgYW5kIGxlbihwKSA+IDFdCiAgICAgICAgaWYgbGVuKHByaWNlcykgPCA1OgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICMgRGFpbHkgbG9nIHJldHVybnMKICAgICAgICByZXR1cm5zID0gW21hdGgubG9nKHByaWNlc1tpXSAvIHByaWNlc1tpIC0gMV0pIGZvciBpIGluIHJhbmdlKDEsIGxlbihwcmljZXMpKV0KICAgICAgICBtZWFuID0gc3VtKHJldHVybnMpIC8gbGVuKHJldHVybnMpCiAgICAgICAgdmFyaWFuY2UgPSBzdW0oKHIgLSBtZWFuKSAqKiAyIGZvciByIGluIHJldHVybnMpIC8gbGVuKHJldHVybnMpCiAgICAgICAgZGFpbHlfdm9sID0gbWF0aC5zcXJ0KHZhcmlhbmNlKSAqIDEwMCAgIyBhcyAlCiAgICAgICAgX3ZvbF9jYWNoZVsidmFsdWUiXSA9IGRhaWx5X3ZvbAogICAgICAgIF92b2xfY2FjaGVbInRzIl0gPSBub3cKICAgICAgICByZXR1cm4gZGFpbHlfdm9sCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2luZy53YXJuaW5nKCJzb2xfdm9sYXRpbGl0eSBmZXRjaCBlcnJvcjogJXMiLCBlKQogICAgICAgIHJldHVybiBOb25lCgoKIyDilIDilIAgTGlxdWlkYXRpb24gcHJpY2UgZXN0aW1hdGlvbiDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKCmRlZiBlc3RpbWF0ZV9saXFfcHJpY2UoZW50cnlfcHJpY2UsIGNvbGxhdGVyYWwsIHNpemVfdXNkLCBzaWRlPSJMT05HIiwgbWFpbnRlbmFuY2VfbWFyZ2luPTAuMDEpOgogICAgIiIiCiAgICBFc3RpbWF0ZSBsaXF1aWRhdGlvbiBwcmljZSBmb3IgYSBsZXZlcmFnZWQgcG9zaXRpb24uCiAgICBVc2VzIHNpbXBsaWZpZWQgZm9ybXVsYTogbGlxID0gZW50cnkgKiAoMSAtIChjb2xsYXRlcmFsL3NpemUpICsgbWFpbnRlbmFuY2VfbWFyZ2luKQogICAgRm9yIExPTkc6IGxpcSA9IGVudHJ5ICogKDEgLSAoY29sbGF0ZXJhbCAtIG1haW50ZW5hbmNlKnNpemUpIC8gc2l6ZSkKICAgICIiIgogICAgaWYgbm90IGVudHJ5X3ByaWNlIG9yIG5vdCBjb2xsYXRlcmFsIG9yIG5vdCBzaXplX3VzZCBvciBzaXplX3VzZCA8PSAwOgogICAgICAgIHJldHVybiBOb25lCiAgICB0cnk6CiAgICAgICAgIyBjb2xsYXRlcmFsIHJhdGlvCiAgICAgICAgY29sX3JhdGlvID0gY29sbGF0ZXJhbCAvIHNpemVfdXNkCiAgICAgICAgaWYgc2lkZSA9PSAiTE9ORyI6CiAgICAgICAgICAgIGxpcSA9IGVudHJ5X3ByaWNlICogKDEgLSBjb2xfcmF0aW8gKyBtYWludGVuYW5jZV9tYXJnaW4pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGlxID0gZW50cnlfcHJpY2UgKiAoMSArIGNvbF9yYXRpbyAtIG1haW50ZW5hbmNlX21hcmdpbikKICAgICAgICByZXR1cm4gbWF4KDAuMCwgbGlxKQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gTm9uZQoKCiMg4pSA4pSAIExldmVyYWdlIFJlY29tbWVuZGF0aW9uIEVuZ2luZSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKCmRlZiBjYWxjX2xldmVyYWdlX3JlY29tbWVuZGF0aW9uKHBvc2l0aW9uLCBzb2xfcHJpY2UsIGFkZF91c2Q9TU9OVEhMWV9BRERfVVNELCB2b2w9Tm9uZSwgZnVuZGluZz1Ob25lKToKICAgICIiIgogICAgRm9yIGEgZ2l2ZW4gJGFkZF91c2QsIGNhbGN1bGF0ZSBTQUZFIC8gTkVVVFJBTCAvIEFHR1JFU1NJVkUgbGV2ZXJhZ2Ugb3B0aW9ucy4KICAgIFJldHVybnMgZGljdCB3aXRoIHJlY29tbWVuZGF0aW9ucyBhbmQgY29udGV4dC4KICAgICIiIgogICAgaWYgbm90IHNvbF9wcmljZSBvciBzb2xfcHJpY2UgPD0gMDoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGN1cnJlbnRfc2l6ZSA9IGZsb2F0KChwb3NpdGlvbiBvciB7fSkuZ2V0KCJzaXplX3VzZCIpIG9yIDApCiAgICBjdXJyZW50X2NvbGxhdGVyYWwgPSBmbG9hdCgocG9zaXRpb24gb3Ige30pLmdldCgiY29sbGF0ZXJhbCIpIG9yIDApCiAgICBjdXJyZW50X2xpcSA9IGZsb2F0KChwb3NpdGlvbiBvciB7fSkuZ2V0KCJsaXFfcHJpY2UiKSBvciAwKQogICAgZW50cnlfcHJpY2UgPSBmbG9hdCgocG9zaXRpb24gb3Ige30pLmdldCgiZW50cnlfcHJpY2UiKSBvciBzb2xfcHJpY2UpCiAgICBmdW5kaW5nID0gZnVuZGluZyBvciBmbG9hdCgocG9zaXRpb24gb3Ige30pLmdldCgiZnVuZGluZ19yYXRlIikgb3IgMCkKCiAgICB2b2wgPSB2b2wgICMgbWF5IGJlIE5vbmUKCiAgICAjIFZvbGF0aWxpdHkgYWRqdXN0bWVudDogaWYgdm9sID4gMTAlLCBudWRnZSBsZXZlcmFnZSBkb3duIGJ5IDAuNXgKICAgIHZvbF9hZGp1c3RtZW50ID0gMC4wCiAgICBpZiB2b2wgYW5kIHZvbCA+IFZPTF9ISUdIX1RIUkVTSE9MRDoKICAgICAgICB2b2xfYWRqdXN0bWVudCA9IC0wLjUKCiAgICBsZXZlcmFnZV9vcHRpb25zID0gWwogICAgICAgICgic2FmZSIsICAgICAgICLwn5+iIFNBRkUgWk9ORSIsICAgICAgIFNBRkVfTEVWRVJBR0UgICAgICAgKyB2b2xfYWRqdXN0bWVudCwgIlNsZWVwIHdlbGwgYXQgbmlnaHQiLCAgICAgICAgICJWZXJ5IGxvdywgc2xvdyBjb21wb3VuZGluZyIpLAogICAgICAgICgibmV1dHJhbCIsICAgICLwn5+hIE5FVVRSQUwgWk9ORSIsICAgICBORVVUUkFMX0xFVkVSQUdFICAgICsgdm9sX2FkanVzdG1lbnQsICJTdGFuZGFyZCBEQ0Egc3RyYXRlZ3kiLCAgICAgICAiTW9kZXJhdGUsIGJhbGFuY2VkIHJldHVybnMiKSwKICAgICAgICAoImFnZ3Jlc3NpdmUiLCAi8J+UtCBBR0dSRVNTSVZFIFpPTkUiLCAgQUdHUkVTU0lWRV9MRVZFUkFHRSArIHZvbF9hZGp1c3RtZW50LCAiT25seSBpZiBhY3RpdmVseSBtb25pdG9yaW5nIiwgIkhpZ2hlciwgZmFzdGVyIGxpcXVpZGF0aW9uIiksCiAgICBdCgogICAgIyBDYXAgZWFjaCBhdCBNQVhfTEVWRVJBR0UgYW5kIGZsb29yIGF0IDEuMAogICAgbGV2ZXJhZ2Vfb3B0aW9ucyA9IFsKICAgICAgICAoaywgbGFiZWwsIG1heCgxLjAsIG1pbihNQVhfTEVWRVJBR0UsIGxldikpLCBkZXNjLCByaXNrKQogICAgICAgIGZvciBrLCBsYWJlbCwgbGV2LCBkZXNjLCByaXNrIGluIGxldmVyYWdlX29wdGlvbnMKICAgIF0KCiAgICByZXN1bHRzID0gW10KICAgIGZvciBrZXksIGxhYmVsLCBsZXYsIGJlc3RfZm9yLCByaXNrIGluIGxldmVyYWdlX29wdGlvbnM6CiAgICAgICAgbmV3X3NpemVfYWRkZWQgPSBhZGRfdXNkICogbGV2CiAgICAgICAgbmV3X3RvdGFsX3NpemUgPSBjdXJyZW50X3NpemUgKyBuZXdfc2l6ZV9hZGRlZAogICAgICAgIG5ld190b3RhbF9jb2xsYXRlcmFsID0gY3VycmVudF9jb2xsYXRlcmFsICsgYWRkX3VzZAogICAgICAgIG5ld19lZmZlY3RpdmVfbGV2ZXJhZ2UgPSBuZXdfdG90YWxfc2l6ZSAvIG5ld190b3RhbF9jb2xsYXRlcmFsIGlmIG5ld190b3RhbF9jb2xsYXRlcmFsID4gMCBlbHNlIGxldgoKICAgICAgICAjIEVzdGltYXRlIG5ldyBsaXEgcHJpY2UgZm9yIHRoZSBjb21iaW5lZCBwb3NpdGlvbgogICAgICAgIG5ld19saXEgPSBlc3RpbWF0ZV9saXFfcHJpY2UoZW50cnlfcHJpY2UsIG5ld190b3RhbF9jb2xsYXRlcmFsLCBuZXdfdG90YWxfc2l6ZSkKICAgICAgICBsaXFfZGlzdCA9IGNhbGNfbGlxX2Rpc3RhbmNlX3BjdChzb2xfcHJpY2UsIG5ld19saXEpCgogICAgICAgICMgRnVuZGluZyBjb3N0IGVzdGltYXRlIChkYWlseSwgZm9yIGRpc3BsYXkpCiAgICAgICAgZGFpbHlfZnVuZGluZ19jb3N0ID0gbmV3X3RvdGFsX3NpemUgKiBhYnMoZnVuZGluZykgLyAxMDAgaWYgZnVuZGluZyBlbHNlIDAKCiAgICAgICAgIyBCbG9ja2VkIGlmIHdvdWxkIGJlIDwgZGFuZ2VyIHRocmVzaG9sZAogICAgICAgIGJsb2NrZWQgPSBsaXFfZGlzdCBpcyBub3QgTm9uZSBhbmQgbGlxX2Rpc3QgPCBEQU5HRVJfTElRX0RJU1RBTkNFCgogICAgICAgICMgWm9uZSBjbGFzc2lmaWNhdGlvbgogICAgICAgIGlmIGxpcV9kaXN0IGlzIE5vbmU6CiAgICAgICAgICAgIHpvbmUgPSAidW5rbm93biIKICAgICAgICBlbGlmIGxpcV9kaXN0ID49IFNBRkVfTElRX0RJU1RBTkNFOgogICAgICAgICAgICB6b25lID0gInNhZmUiCiAgICAgICAgZWxpZiBsaXFfZGlzdCA+PSBORVVUUkFMX0xJUV9ESVNUQU5DRToKICAgICAgICAgICAgem9uZSA9ICJuZXV0cmFsIgogICAgICAgIGVsaWYgbGlxX2Rpc3QgPj0gV0FSTl9MSVFfRElTVEFOQ0U6CiAgICAgICAgICAgIHpvbmUgPSAiYWdncmVzc2l2ZSIKICAgICAgICBlbHNlOgogICAgICAgICAgICB6b25lID0gImRhbmdlciIKCiAgICAgICAgcmVzdWx0cy5hcHBlbmQoewogICAgICAgICAgICAia2V5Ijoga2V5LAogICAgICAgICAgICAibGFiZWwiOiBsYWJlbCwKICAgICAgICAgICAgImxldmVyYWdlIjogbGV2LAogICAgICAgICAgICAiZWZmZWN0aXZlX2xldmVyYWdlIjogbmV3X2VmZmVjdGl2ZV9sZXZlcmFnZSwKICAgICAgICAgICAgIm5ld19zaXplX2FkZGVkIjogbmV3X3NpemVfYWRkZWQsCiAgICAgICAgICAgICJuZXdfdG90YWxfc2l6ZSI6IG5ld190b3RhbF9zaXplLAogICAgICAgICAgICAibmV3X3RvdGFsX2NvbGxhdGVyYWwiOiBuZXdfdG90YWxfY29sbGF0ZXJhbCwKICAgICAgICAgICAgIm5ld19saXFfcHJpY2UiOiBuZXdfbGlxLAogICAgICAgICAgICAibGlxX2Rpc3RhbmNlX3BjdCI6IGxpcV9kaXN0LAogICAgICAgICAgICAiem9uZSI6IHpvbmUsCiAgICAgICAgICAgICJibG9ja2VkIjogYmxvY2tlZCwKICAgICAgICAgICAgImRhaWx5X2Z1bmRpbmdfY29zdCI6IGRhaWx5X2Z1bmRpbmdfY29zdCwKICAgICAgICAgICAgImJlc3RfZm9yIjogYmVzdF9mb3IsCiAgICAgICAgICAgICJyaXNrIjogcmlzaywKICAgICAgICB9KQoKICAgICMgV29yc3QtY2FzZTogU09MIGRyb3BzIDIwJQogICAgd29yc3RfY2FzZV9wcmljZSA9IHNvbF9wcmljZSAqIDAuODAKICAgIHdvcnN0X2xpcV9kaXN0ID0gY2FsY19saXFfZGlzdGFuY2VfcGN0KHdvcnN0X2Nhc2VfcHJpY2UsIGN1cnJlbnRfbGlxKSBpZiBjdXJyZW50X2xpcSBlbHNlIE5vbmUKCiAgICAjIFJlY29tbWVuZGVkID0gZmlyc3Qgbm9uLWJsb2NrZWQgb3B0aW9uIG1hdGNoaW5nIHJpc2sgdG9sZXJhbmNlCiAgICByZWNvbW1lbmRlZCA9IG5leHQoKHIgZm9yIHIgaW4gcmVzdWx0cyBpZiBub3QgclsiYmxvY2tlZCJdKSwgTm9uZSkKCiAgICByZXR1cm4gewogICAgICAgICJyZXN1bHRzIjogcmVzdWx0cywKICAgICAgICAicmVjb21tZW5kZWQiOiByZWNvbW1lbmRlZCwKICAgICAgICAiYWRkX3VzZCI6IGFkZF91c2QsCiAgICAgICAgInNvbF9wcmljZSI6IHNvbF9wcmljZSwKICAgICAgICAidm9sIjogdm9sLAogICAgICAgICJmdW5kaW5nIjogZnVuZGluZywKICAgICAgICAidm9sX2FkanVzdG1lbnQiOiB2b2xfYWRqdXN0bWVudCwKICAgICAgICAid29yc3RfY2FzZV9wcmljZSI6IHdvcnN0X2Nhc2VfcHJpY2UsCiAgICAgICAgIndvcnN0X2Nhc2VfbGlxX2Rpc3QiOiB3b3JzdF9saXFfZGlzdCwKICAgICAgICAiY3VycmVudF9wb3NpdGlvbiI6IHBvc2l0aW9uLAogICAgfQoKCmRlZiBjYWxjX3ByaWNlX3pvbmVzKHBvc2l0aW9uLCBzb2xfcHJpY2UsIHpvbmVfcHJpY2VzPU5vbmUpOgogICAgIiIiCiAgICBGb3IgZWFjaCBwcmljZSBsZXZlbCwgc2hvdyBQbkwsIGxpcSBkaXN0YW5jZSwgYW5kIGFjdGlvbi4KICAgIEFsc28gc2hvd3MgbGlxIHByaWNlIGF0IHNhZmUvbmV1dHJhbC9hZ2dyZXNzaXZlIGxldmVyYWdlLgogICAgIiIiCiAgICBpZiBub3QgcG9zaXRpb246CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHpvbmVfcHJpY2VzID0gem9uZV9wcmljZXMgb3IgUFJJQ0VfWk9ORV9MRVZFTFMKICAgIGVudHJ5ID0gZmxvYXQocG9zaXRpb24uZ2V0KCJlbnRyeV9wcmljZSIpIG9yIHNvbF9wcmljZSkKICAgIHNpemUgPSBmbG9hdChwb3NpdGlvbi5nZXQoInNpemVfdXNkIikgb3IgMCkKICAgIGNvbGxhdGVyYWwgPSBmbG9hdChwb3NpdGlvbi5nZXQoImNvbGxhdGVyYWwiKSBvciAwKQogICAgbGlxID0gZmxvYXQocG9zaXRpb24uZ2V0KCJsaXFfcHJpY2UiKSBvciAwKQoKICAgIHpvbmVzID0gW10KICAgIGZvciBwcmljZSBpbiBzb3J0ZWQoem9uZV9wcmljZXMsIHJldmVyc2U9VHJ1ZSk6CiAgICAgICAgcHJpY2VfY2hnX3BjdCA9IChwcmljZSAtIGVudHJ5KSAvIGVudHJ5ICogMTAwIGlmIGVudHJ5ID4gMCBlbHNlIDAKICAgICAgICBwbmwgPSBzaXplICogKHByaWNlX2NoZ19wY3QgLyAxMDApCiAgICAgICAgbGlxX2Rpc3QgPSBjYWxjX2xpcV9kaXN0YW5jZV9wY3QocHJpY2UsIGxpcSkKCiAgICAgICAgaWYgbGlxX2Rpc3QgaXMgTm9uZToKICAgICAgICAgICAgc3RhdHVzID0gIuKdkyBVTktOT1dOIgogICAgICAgICAgICBhY3Rpb24gPSAiQ2hlY2sgcG9zaXRpb24gZGF0YSIKICAgICAgICBlbGlmIHByaWNlIDw9IGxpcToKICAgICAgICAgICAgc3RhdHVzID0gIuKdjCBMSVFVSURBVEVEIgogICAgICAgICAgICBhY3Rpb24gPSAiUG9zaXRpb24gY2xvc2VkIgogICAgICAgIGVsaWYgbGlxX2Rpc3QgPCBXQVJOX0xJUV9ESVNUQU5DRToKICAgICAgICAgICAgc3RhdHVzID0gIvCflLQgV0FSTklORyIKICAgICAgICAgICAgYWN0aW9uID0gIlRvcC11cCBjb2xsYXRlcmFsIE5PVyBvciBjbG9zZSIKICAgICAgICBlbGlmIGxpcV9kaXN0IDwgTkVVVFJBTF9MSVFfRElTVEFOQ0U6CiAgICAgICAgICAgIHN0YXR1cyA9ICLwn5+hIENBVVRJT04iCiAgICAgICAgICAgIGFjdGlvbiA9ICJDb25zaWRlciBhZGRpbmcgY29sbGF0ZXJhbCIKICAgICAgICBlbHNlOgogICAgICAgICAgICBzdGF0dXMgPSAi4pyFIFNBRkUiCiAgICAgICAgICAgIGFjdGlvbiA9ICJIb2xkIG9yIHRyaW0iCgogICAgICAgIHpvbmVzLmFwcGVuZCh7CiAgICAgICAgICAgICJwcmljZSI6IHByaWNlLAogICAgICAgICAgICAicG5sIjogcG5sLAogICAgICAgICAgICAibGlxX2Rpc3QiOiBsaXFfZGlzdCwKICAgICAgICAgICAgInN0YXR1cyI6IHN0YXR1cywKICAgICAgICAgICAgImFjdGlvbiI6IGFjdGlvbiwKICAgICAgICB9KQoKICAgICMgU2FmZSBwcmljZSBmbG9vcnMgYXQgZGlmZmVyZW50IGxldmVyYWdlcyAoZm9yIGN1cnJlbnQgYWRkIGFtb3VudCkKICAgIGRlZiBmbG9vcl9hdF9sZXYobGV2KToKICAgICAgICBzeiA9IHNpemUgKyBNT05USExZX0FERF9VU0QgKiBsZXYKICAgICAgICBjb2wgPSBjb2xsYXRlcmFsICsgTU9OVEhMWV9BRERfVVNECiAgICAgICAgcmV0dXJuIGVzdGltYXRlX2xpcV9wcmljZShlbnRyeSwgY29sLCBzeikKCiAgICBmbG9vcnMgPSB7CiAgICAgICAgZiJ7U0FGRV9MRVZFUkFHRTouMWZ9eCI6IGZsb29yX2F0X2xldihTQUZFX0xFVkVSQUdFKSwKICAgICAgICBmIntORVVUUkFMX0xFVkVSQUdFOi4xZn14IjogZmxvb3JfYXRfbGV2KE5FVVRSQUxfTEVWRVJBR0UpLAogICAgICAgIGYie0FHR1JFU1NJVkVfTEVWRVJBR0U6LjFmfXgiOiBmbG9vcl9hdF9sZXYoQUdHUkVTU0lWRV9MRVZFUkFHRSksCiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICAiem9uZXMiOiB6b25lcywKICAgICAgICAiZmxvb3JzIjogZmxvb3JzLAogICAgICAgICJjdXJyZW50X2xpcSI6IGxpcSwKICAgICAgICAiZW50cnkiOiBlbnRyeSwKICAgICAgICAibGV2ZXJhZ2UiOiBmbG9hdChwb3NpdGlvbi5nZXQoImxldmVyYWdlIikgb3IgMCksCiAgICAgICAgInNvbF9wcmljZSI6IHNvbF9wcmljZSwKICAgIH0KCgojIOKUgOKUgCBGb3JtYXR0ZXJzIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAoKZGVmIF9mcCh2LCBkZWNpbWFscz0yKToKICAgICIiIkZvcm1hdCBwcmljZS4iIiIKICAgIGlmIHYgaXMgTm9uZToKICAgICAgICByZXR1cm4gIk4vQSIKICAgIHRyeToKICAgICAgICByZXR1cm4gZiIke2Zsb2F0KHYpOiwue2RlY2ltYWxzfWZ9IgogICAgZXhjZXB0IChUeXBlRXJyb3IsIFZhbHVlRXJyb3IpOgogICAgICAgIHJldHVybiAiTi9BIgoKCmRlZiBfZnYodiwgZGVjaW1hbHM9Mik6CiAgICAiIiJGb3JtYXQgVVNEIHZhbHVlIGNvbXBhY3QuIiIiCiAgICBpZiB2IGlzIE5vbmU6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICB0cnk6CiAgICAgICAgdiA9IGZsb2F0KHYpCiAgICAgICAgaWYgYWJzKHYpID49IDFfMDAwXzAwMDoKICAgICAgICAgICAgcmV0dXJuIGYiJHt2LzFfMDAwXzAwMDouMmZ9TSIKICAgICAgICBpZiBhYnModikgPj0gMV8wMDA6CiAgICAgICAgICAgIHJldHVybiBmIiR7di8xXzAwMDouMWZ9SyIKICAgICAgICByZXR1cm4gZiIke3Y6LC57ZGVjaW1hbHN9Zn0iCiAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgcmV0dXJuICJOL0EiCgoKZGVmIF9mcGN0KHYsIGRlY2ltYWxzPTIpOgogICAgIiIiRm9ybWF0IHBlcmNlbnRhZ2UuIiIiCiAgICBpZiB2IGlzIE5vbmU6CiAgICAgICAgcmV0dXJuICJOL0EiCiAgICB0cnk6CiAgICAgICAgcmV0dXJuIGYie2Zsb2F0KHYpOisue2RlY2ltYWxzfWZ9JSIKICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICByZXR1cm4gIk4vQSIKCgpkZWYgZm9ybWF0X2xldl9kYXNoYm9hcmQocG9zaXRpb24sIHNvbF9wcmljZT1Ob25lKToKICAgICIiIkZvcm1hdCAvbGV2IGRhc2hib2FyZCBtZXNzYWdlLiIiIgogICAgbm93ID0gZGF0ZXRpbWUubm93KHRpbWV6b25lLnV0Yykuc3RyZnRpbWUoIiVZLSVtLSVkICVIOiVNIFVUQyIpCgogICAgaWYgbm90IHBvc2l0aW9uOgogICAgICAgICMgTm8gcG9zaXRpb24gZm91bmQg4oCUIHNob3cgU09MIHByaWNlIG9ubHkKICAgICAgICBwcmljZV9saW5lID0gX2ZwKHNvbF9wcmljZSkgaWYgc29sX3ByaWNlIGVsc2UgIk4vQSIKICAgICAgICByZXR1cm4gIlxuIi5qb2luKFsKICAgICAgICAgICAgZiI8Yj7wn5OKIFtMRVZdOiBTT0wgUE9TSVRJT048L2I+IiwKICAgICAgICAgICAgZiI8Y29kZT57U0VQfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPuKdjCBOTyBPUEVOIFBPU0lUSU9OIEZPVU5EPC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+SsCBTT0wgUFJJQ0U6IHtwcmljZV9saW5lfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCflZAgQ0hFQ0tFRDoge25vd308L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT57U0VQfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfkqEgT3BlbiBhIHBvc2l0aW9uIG9uIEp1cGl0ZXIgUGVycHM8L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT4gICB0byBzdGFydCB0cmFja2luZy48L2NvZGU+IiwKICAgICAgICBdKQoKICAgIG1hcmsgPSBwb3NpdGlvblsibWFya19wcmljZSJdIG9yIHNvbF9wcmljZQogICAgZW50cnkgPSBwb3NpdGlvblsiZW50cnlfcHJpY2UiXQogICAgc2l6ZSA9IHBvc2l0aW9uWyJzaXplX3VzZCJdCiAgICBjb2xsYXRlcmFsID0gcG9zaXRpb25bImNvbGxhdGVyYWwiXQogICAgbGlxID0gcG9zaXRpb25bImxpcV9wcmljZSJdCiAgICBwbmwgPSBwb3NpdGlvblsicG5sIl0KICAgIGZ1bmRpbmcgPSBwb3NpdGlvblsiZnVuZGluZ19yYXRlIl0KICAgIGxldmVyYWdlID0gcG9zaXRpb25bImxldmVyYWdlIl0KICAgIG1hcmtldCA9IHBvc2l0aW9uWyJtYXJrZXQiXQogICAgc2lkZSA9IHBvc2l0aW9uWyJzaWRlIl0KCiAgICBsaXFfZGlzdCA9IGNhbGNfbGlxX2Rpc3RhbmNlX3BjdChtYXJrLCBsaXEpCiAgICBsaXFfZGlzdF9zdHIgPSBmIntsaXFfZGlzdDouMWZ9JSIgaWYgbGlxX2Rpc3QgaXMgbm90IE5vbmUgZWxzZSAiTi9BIgogICAgbGlxX2Vtb2ppID0gIvCflLQiIGlmIChsaXFfZGlzdCBpcyBub3QgTm9uZSBhbmQgbGlxX2Rpc3QgPCBMSVFfV0FSTl9QQ1QpIGVsc2UgIvCfn6IiCgogICAgcG5sX2Vtb2ppID0gIvCfn6IiIGlmIHBubCA+PSAwIGVsc2UgIvCflLQiCiAgICBzaWRlX2Vtb2ppID0gIvCfk4giIGlmIHNpZGUgPT0gIkxPTkciIGVsc2UgIvCfk4kiCgogICAgZnVuZGluZ19zdHIgPSBmIntmdW5kaW5nOi40Zn0lIiBpZiBmdW5kaW5nIGVsc2UgIk4vQSIKICAgIGZ1bmRpbmdfZW1vamkgPSAi4pqg77iPIiBpZiAoZnVuZGluZyBhbmQgYWJzKGZ1bmRpbmcpID4gRlVORElOR19XQVJOX1BDVCkgZWxzZSAi8J+SpCIKCiAgICBsZXZfc3RyID0gZiJ7bGV2ZXJhZ2U6LjFmfXgiIGlmIGxldmVyYWdlIGVsc2UgIk4vQSIKCiAgICByZXR1cm4gIlxuIi5qb2luKFsKICAgICAgICBmIjxiPvCfk4ogW0xFVl06IFNPTCBQT1NJVElPTjwvYj4iLAogICAgICAgIGYiPGNvZGU+e1NFUH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntzaWRlX2Vtb2ppfSBNQVJLRVQ6IHttYXJrZXR9IHtzaWRlfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SsCBNQVJLOiAgIHtfZnAobWFyayl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIEVOVFJZOiAge19mcChlbnRyeSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OQIExFVkVSQUdFOiB7bGV2X3N0cn08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5K8IFNJWkU6ICAgICAge19mdihzaXplKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfj6YgQ09MTEFURVJBTDp7X2Z2KGNvbGxhdGVyYWwpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3BubF9lbW9qaX0gUG5MOiAgICAgICB7X2Z2KHBubCl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57U0VQfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e2xpcV9lbW9qaX0gTElRIFBSSUNFOiB7X2ZwKGxpcSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OPIExJUSBESVNUOiAge2xpcV9kaXN0X3N0cn08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntmdW5kaW5nX2Vtb2ppfSBGVU5ESU5HOiAgIHtmdW5kaW5nX3N0cn08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5WQIHtub3d9PC9jb2RlPiIsCiAgICBdKQoKCmRlZiBmb3JtYXRfbGV2X3N0YXR1cyhwb3NpdGlvbiwgc29sX3ByaWNlPU5vbmUpOgogICAgIiIiRm9ybWF0IC9sZXYtc3RhdHVzIHF1aWNrIG9uZS1saW5lci4iIiIKICAgIG1hcmsgPSAocG9zaXRpb24gb3Ige30pLmdldCgibWFya19wcmljZSIpIG9yIHNvbF9wcmljZQogICAgcG5sID0gKHBvc2l0aW9uIG9yIHt9KS5nZXQoInBubCIsIDApCiAgICBsaXEgPSAocG9zaXRpb24gb3Ige30pLmdldCgibGlxX3ByaWNlIikKICAgIGxpcV9kaXN0ID0gY2FsY19saXFfZGlzdGFuY2VfcGN0KG1hcmssIGxpcSkKCiAgICBpZiBub3QgcG9zaXRpb246CiAgICAgICAgcmV0dXJuIGYiPGI+8J+TiiBMRVYgU1RBVFVTPC9iPlxuPGNvZGU+4p2MIE5vIG9wZW4gcG9zaXRpb24gfCBTT0wge19mcChzb2xfcHJpY2UpfTwvY29kZT4iCgogICAgcG5sX2Vtb2ppID0gIvCfn6IiIGlmIHBubCA+PSAwIGVsc2UgIvCflLQiCiAgICBsaXFfZW1vamkgPSAi8J+UtCIgaWYgKGxpcV9kaXN0IGlzIG5vdCBOb25lIGFuZCBsaXFfZGlzdCA8IExJUV9XQVJOX1BDVCkgZWxzZSAi8J+foiIKICAgIGxpcV9zdHIgPSBmIntsaXFfZGlzdDouMWZ9JSB0byBsaXEiIGlmIGxpcV9kaXN0IGlzIG5vdCBOb25lIGVsc2UgImxpcSBOL0EiCgogICAgcmV0dXJuICJcbiIuam9pbihbCiAgICAgICAgZiI8Yj7wn5OKIFtMRVZdOiBRVUlDSyBTVEFUVVM8L2I+IiwKICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KwIFNPTDoge19mcChtYXJrKX0gIHwgIHtwbmxfZW1vaml9IFBuTDoge19mdihwbmwpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e2xpcV9lbW9qaX0ge2xpcV9zdHJ9ICB8ICBFbnRyeToge19mcChwb3NpdGlvblsnZW50cnlfcHJpY2UnXSl9PC9jb2RlPiIsCiAgICBdKQoKCmRlZiBmb3JtYXRfd2hhdF9pZihwb3NpdGlvbiwgdGFyZ2V0cz1Ob25lKToKICAgICIiIkZvcm1hdCAvd2hhdC1pZiBjYWxjdWxhdG9yIGZvciBtdWx0aXBsZSBwcmljZSB0YXJnZXRzLiIiIgogICAgaWYgbm90IHBvc2l0aW9uOgogICAgICAgIHJldHVybiAiPGI+8J+TiiBXSEFULUlGPC9iPlxuPGNvZGU+4p2MIE5vIG9wZW4gcG9zaXRpb24gdG8gY2FsY3VsYXRlLjwvY29kZT4iCgogICAgdGFyZ2V0cyA9IHRhcmdldHMgb3IgUFJJQ0VfVEFSR0VUUwogICAgbGluZXMgPSBbCiAgICAgICAgZiI8Yj7wn5SuIFtMRVZdOiBXSEFULUlGIENBTENVTEFUT1I8L2I+IiwKICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn46vIEVOVFJZOiB7X2ZwKHBvc2l0aW9uWydlbnRyeV9wcmljZSddKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkrwgU0laRTogIHtfZnYocG9zaXRpb25bJ3NpemVfdXNkJ10pfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e1NFUH08L2NvZGU+IiwKICAgIF0KCiAgICBmb3IgdCBpbiBzb3J0ZWQodGFyZ2V0cyk6CiAgICAgICAgdyA9IGNhbGNfd2hhdF9pZihwb3NpdGlvbiwgdCkKICAgICAgICBpZiBub3QgdzoKICAgICAgICAgICAgY29udGludWUKICAgICAgICBwbmxfZW1vamkgPSAi8J+foiIgaWYgd1sicG5sIl0gPj0gMCBlbHNlICLwn5S0IgogICAgICAgIGxpcV9zdHIgPSBmInt3WydsaXFfZGlzdGFuY2VfcGN0J106LjFmfSUgdG8gbGlxIiBpZiB3WyJsaXFfZGlzdGFuY2VfcGN0Il0gaXMgbm90IE5vbmUgZWxzZSAiTi9BIgogICAgICAgIGxpbmVzLmFwcGVuZCgKICAgICAgICAgICAgZiI8Y29kZT57cG5sX2Vtb2ppfSAke3Q6LjBmfSDihpIgUG5MIHtfZnYod1sncG5sJ10pfSAoe19mcGN0KHdbJ3ByaWNlX2NoYW5nZV9wY3QnXSl9KSB8IHtsaXFfc3RyfTwvY29kZT4iCiAgICAgICAgKQoKICAgIG1vbnRobHkgPSBjYWxjX21vbnRobHlfYWRkX2ltcGFjdChwb3NpdGlvbikKICAgIGlmIG1vbnRobHk6CiAgICAgICAgbGluZXMgKz0gWwogICAgICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGI+8J+StSArJHtNT05USExZX0FERF9VU0Q6LjBmfSBAIHtNT05USExZX0xFVkVSQUdFOi4wZn14IEFERDo8L2I+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OQIE5ldyBsZXZlcmFnZToge21vbnRobHlbJ25ld19sZXZlcmFnZSddOi4yZn14PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+SvCBOZXcgc2l6ZTogICAgIHtfZnYobW9udGhseVsnbmV3X3RvdGFsX3NpemUnXSl9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+PpiBOZXcgY29sbGF0OiAgIHtfZnYobW9udGhseVsnbmV3X3RvdGFsX2NvbGxhdGVyYWwnXSl9PC9jb2RlPiIsCiAgICAgICAgXQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIGZvcm1hdF9saXFfYWxlcnQocG9zaXRpb24pOgogICAgIiIiRm9ybWF0IGxpcXVpZGF0aW9uIHJpc2sgYWxlcnQuIiIiCiAgICBtYXJrID0gcG9zaXRpb25bIm1hcmtfcHJpY2UiXQogICAgbGlxID0gcG9zaXRpb25bImxpcV9wcmljZSJdCiAgICBsaXFfZGlzdCA9IGNhbGNfbGlxX2Rpc3RhbmNlX3BjdChtYXJrLCBsaXEpCiAgICByZXR1cm4gIlxuIi5qb2luKFsKICAgICAgICBmIjxiPvCfmqggW0xFVl06IExJUVVJREFUSU9OIFdBUk5JTkc8L2I+IiwKICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7imqDvuI8gIE9ubHkge2xpcV9kaXN0Oi4xZn0lIGZyb20gbGlxdWlkYXRpb24hPC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KwIE1BUks6ICAgICAge19mcChtYXJrKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkoAgTElRIFBSSUNFOiB7X2ZwKGxpcSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5OdIENvbnNpZGVyIGFkZGluZyBjb2xsYXRlcmFsIG9yIHJlZHVjaW5nIHNpemUuPC9jb2RlPiIsCiAgICBdKQoKCmRlZiBmb3JtYXRfdGFyZ2V0X2FsZXJ0KHBvc2l0aW9uLCB0YXJnZXQpOgogICAgIiIiRm9ybWF0IHByaWNlIHRhcmdldCBoaXQgYWxlcnQuIiIiCiAgICBtYXJrID0gcG9zaXRpb25bIm1hcmtfcHJpY2UiXQogICAgcG5sID0gcG9zaXRpb25bInBubCJdCiAgICBwbmxfZW1vamkgPSAi8J+foiIgaWYgcG5sID49IDAgZWxzZSAi8J+UtCIKICAgIHJldHVybiAiXG4iLmpvaW4oWwogICAgICAgIGYiPGI+8J+OryBbTEVWXTogVEFSR0VUIEhJVCDigJQgJHt0YXJnZXQ6LjBmfTwvYj4iLAogICAgICAgIGYiPGNvZGU+e1NFUH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkrAgU09MIFBSSUNFOiB7X2ZwKG1hcmspfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+e3BubF9lbW9qaX0gQ1VSUkVOVCBQbkw6IHtfZnYocG5sKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfjq8gVEFSR0VUOiAke3RhcmdldDouMGZ9IOKchTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TnSBDb25zaWRlciB0YWtpbmcgcGFydGlhbCBwcm9maXRzLjwvY29kZT4iLAogICAgXSkKCgpkZWYgZm9ybWF0X2Z1bmRpbmdfYWxlcnQocG9zaXRpb24pOgogICAgIiIiRm9ybWF0IGhpZ2ggZnVuZGluZyByYXRlIGFsZXJ0LiIiIgogICAgcmF0ZSA9IHBvc2l0aW9uWyJmdW5kaW5nX3JhdGUiXQogICAgcmV0dXJuICJcbiIuam9pbihbCiAgICAgICAgZiI8Yj7imqDvuI8gW0xFVl06IEhJR0ggRlVORElORyBSQVRFPC9iPiIsCiAgICAgICAgZiI8Y29kZT57U0VQfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TiCBGVU5ESU5HOiB7cmF0ZTouNGZ9JSAodGhyZXNob2xkOiB7RlVORElOR19XQVJOX1BDVH0lKTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+SsCBNQVJLOiB7X2ZwKHBvc2l0aW9uWydtYXJrX3ByaWNlJ10pfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+TnSBIaWdoIGZ1bmRpbmcgaXMgY29zdGluZyB5b3UuIE1vbml0b3IgY2xvc2VseS48L2NvZGU+IiwKICAgIF0pCgoKZGVmIGZvcm1hdF9tb250aGx5X3JlbWluZGVyKHBvc2l0aW9uKToKICAgICIiIkZvcm1hdCBtb250aGx5ICQyNTAgYWRkIHJlbWluZGVyLiIiIgogICAgbW9udGhseSA9IGNhbGNfbW9udGhseV9hZGRfaW1wYWN0KHBvc2l0aW9uKSBpZiBwb3NpdGlvbiBlbHNlIE5vbmUKICAgIGxpbmVzID0gWwogICAgICAgIGYiPGI+8J+ThSBbTEVWXTogTU9OVEhMWSBBREQgUkVNSU5ERVI8L2I+IiwKICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5K1IFRpbWUgdG8gYWRkICR7TU9OVEhMWV9BRERfVVNEOi4wZn0gQCB7TU9OVEhMWV9MRVZFUkFHRTouMGZ9eCBsZXZlcmFnZTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+UlyBodHRwczovL2p1cC5hZy9wZXJwczwvY29kZT4iLAogICAgXQogICAgaWYgbW9udGhseToKICAgICAgICBsaW5lcyArPSBbCiAgICAgICAgICAgIGYiPGNvZGU+e1NFUH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OQIEFmdGVyIGFkZCDigJQgbmV3IGxldmVyYWdlOiB7bW9udGhseVsnbmV3X2xldmVyYWdlJ106LjJmfXg8L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5K8IE5ldyBzaXplOiAgICAge19mdihtb250aGx5WyduZXdfdG90YWxfc2l6ZSddKX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn4+mIE5ldyBjb2xsYXQ6ICAge19mdihtb250aGx5WyduZXdfdG90YWxfY29sbGF0ZXJhbCddKX08L2NvZGU+IiwKICAgICAgICBdCiAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKQoKCmRlZiBmb3JtYXRfbGV2ZXJhZ2VfcmVjKHJlYyk6CiAgICAiIiJGb3JtYXQgL2xldnJlYyBsZXZlcmFnZSByZWNvbW1lbmRhdGlvbiBtZXNzYWdlLiIiIgogICAgaWYgbm90IHJlYzoKICAgICAgICByZXR1cm4gIjxiPvCfk4ogTEVWIFJFQzwvYj5cbjxjb2RlPuKdjCBDb3VsZCBub3QgZmV0Y2ggcG9zaXRpb24gb3IgcHJpY2UgZGF0YS48L2NvZGU+IgoKICAgIHNvbF9wcmljZSA9IHJlY1sic29sX3ByaWNlIl0KICAgIGFkZF91c2QgPSByZWNbImFkZF91c2QiXQogICAgdm9sID0gcmVjWyJ2b2wiXQogICAgZnVuZGluZyA9IHJlY1siZnVuZGluZyJdCiAgICB2b2xfYWRqID0gcmVjWyJ2b2xfYWRqdXN0bWVudCJdCiAgICB3b3JzdF9wcmljZSA9IHJlY1sid29yc3RfY2FzZV9wcmljZSJdCiAgICB3b3JzdF9kaXN0ID0gcmVjWyJ3b3JzdF9jYXNlX2xpcV9kaXN0Il0KCiAgICAjIFZvbCBkaXNwbGF5CiAgICBpZiB2b2wgaXMgTm9uZToKICAgICAgICB2b2xfc3RyID0gIk4vQSIKICAgICAgICB2b2xfZW1vamkgPSAi4p2TIgogICAgZWxpZiB2b2wgPiBWT0xfV0FSTklOR19USFJFU0hPTEQ6CiAgICAgICAgdm9sX3N0ciA9IGYie3ZvbDouMWZ9JSAoSElHSCDimqDvuI8pIgogICAgICAgIHZvbF9lbW9qaSA9ICLwn5S0IgogICAgZWxpZiB2b2wgPiBWT0xfSElHSF9USFJFU0hPTEQ6CiAgICAgICAgdm9sX3N0ciA9IGYie3ZvbDouMWZ9JSAobW9kZXJhdGUpIgogICAgICAgIHZvbF9lbW9qaSA9ICLwn5+hIgogICAgZWxzZToKICAgICAgICB2b2xfc3RyID0gZiJ7dm9sOi4xZn0lIChsb3cpIgogICAgICAgIHZvbF9lbW9qaSA9ICLwn5+iIgoKICAgIGZ1bmRpbmdfc3RyID0gZiJ7ZnVuZGluZzorLjRmfSUiIGlmIGZ1bmRpbmcgZWxzZSAiTi9BIgogICAgZnVuZGluZ19lbW9qaSA9ICLinIUiIGlmIGZ1bmRpbmcgYW5kIGZ1bmRpbmcgPj0gMCBlbHNlICgi4pqg77iPIiBpZiBmdW5kaW5nIGFuZCBhYnMoZnVuZGluZykgPiBGVU5ESU5HX0hJR0hfUENUIGVsc2UgIvCfkqQiKQoKICAgIGxpbmVzID0gWwogICAgICAgIGYiPGI+8J+TiiBbTEVWXTogTEVWRVJBR0UgUkVDT01NRU5EQVRJT048L2I+IiwKICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT7wn5KwIFNPTCBQUklDRToge19mcChzb2xfcHJpY2UpfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+8J+StSBZT1VSIEFERDogICR7YWRkX3VzZDouMGZ9PC9jb2RlPiIsCiAgICBdCgogICAgaWYgdm9sX2FkaiA8IDA6CiAgICAgICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+4pqg77iPICBIaWdoIHZvbCDigJQgbGV2ZXJhZ2UgcmVkdWNlZCBieSB7YWJzKHZvbF9hZGopOi4xZn14PC9jb2RlPiIpCgogICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+e1NFUH08L2NvZGU+IikKCiAgICBmb3IgciBpbiByZWNbInJlc3VsdHMiXToKICAgICAgICBpZiByWyJibG9ja2VkIl06CiAgICAgICAgICAgIGxpbmVzICs9IFsKICAgICAgICAgICAgICAgIGYiPGI+e3JbJ2xhYmVsJ119PC9iPiIsCiAgICAgICAgICAgICAgICBmIjxjb2RlPvCfmqsgQkxPQ0tFRCDigJQgbGlxIHRvbyBjbG9zZSAoe3JbJ2xpcV9kaXN0YW5jZV9wY3QnXTouMWZ9JSA8IHtEQU5HRVJfTElRX0RJU1RBTkNFOi4wZn0lKTwvY29kZT4iLAogICAgICAgICAgICAgICAgZiI8Y29kZT57U0VQfTwvY29kZT4iLAogICAgICAgICAgICBdCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGxpcV9zdHIgPSBmIntfZnAoclsnbmV3X2xpcV9wcmljZSddKX0iIGlmIHJbIm5ld19saXFfcHJpY2UiXSBlbHNlICJOL0EiCiAgICAgICAgZGlzdF9zdHIgPSBmIntyWydsaXFfZGlzdGFuY2VfcGN0J106LjFmfSUiIGlmIHJbImxpcV9kaXN0YW5jZV9wY3QiXSBpcyBub3QgTm9uZSBlbHNlICJOL0EiCiAgICAgICAgZnVuZGluZ19jb3N0X3N0ciA9IGYifiR7clsnZGFpbHlfZnVuZGluZ19jb3N0J106LjJmfS9kYXkiIGlmIHJbImRhaWx5X2Z1bmRpbmdfY29zdCJdIGVsc2UgIk4vQSIKICAgICAgICBlZmZfbGV2X3N0ciA9IGYie3JbJ2VmZmVjdGl2ZV9sZXZlcmFnZSddOi4yZn14IiBpZiByWyJlZmZlY3RpdmVfbGV2ZXJhZ2UiXSBlbHNlIGYie3JbJ2xldmVyYWdlJ106LjFmfXgiCgogICAgICAgIGxpbmVzICs9IFsKICAgICAgICAgICAgZiI8Yj57clsnbGFiZWwnXX08L2I+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OQIExldmVyYWdlOiAgICB7clsnbGV2ZXJhZ2UnXTouMWZ9eCAoZWZmLiB7ZWZmX2xldl9zdHJ9KTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfkrwgTmV3IHBvc2l0aW9uOiB7X2Z2KHJbJ25ld190b3RhbF9zaXplJ10pfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfkoAgRXN0LiBsaXE6ICAgICB7bGlxX3N0cn08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn5OPIExpcSBkaXN0YW5jZToge2Rpc3Rfc3RyfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPvCfkrggRnVuZGluZyBjb3N0OiB7ZnVuZGluZ19jb3N0X3N0cn08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7imqDvuI8gIFJpc2s6IHtyWydyaXNrJ119PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+4pyFIEJlc3QgZm9yOiB7clsnYmVzdF9mb3InXX08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT57U0VQfTwvY29kZT4iLAogICAgICAgIF0KCiAgICAjIFJlY29tbWVuZGVkCiAgICByZWNfb3B0ID0gcmVjWyJyZWNvbW1lbmRlZCJdCiAgICBpZiByZWNfb3B0OgogICAgICAgIGxpbmVzLmFwcGVuZChmIjxiPuKchSBSRUNPTU1FTkRBVElPTjoge3JlY19vcHRbJ2xldmVyYWdlJ106LjFmfXggKHtyZWNfb3B0WydrZXknXS51cHBlcigpfSk8L2I+IikKICAgIGVsc2U6CiAgICAgICAgbGluZXMuYXBwZW5kKGYiPGI+8J+aqyBBTEwgT1BUSU9OUyBCTE9DS0VEIOKAlCBtYXJrZXQgdG9vIHJpc2t5IHRvIGFkZCBub3c8L2I+IikKCiAgICAjIENvbnRleHQKICAgIGxpbmVzICs9IFsKICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57dm9sX2Vtb2ppfSBTT0wgVk9MICgzMGQpOiB7dm9sX3N0cn08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPntmdW5kaW5nX2Vtb2ppfSBGVU5ESU5HIFJBVEU6IHtmdW5kaW5nX3N0cn0gKGdvb2QgZm9yIGxvbmdzKTwvY29kZT4iLAogICAgXQoKICAgICMgV29yc3QtY2FzZSB3YXJuaW5nCiAgICBpZiB3b3JzdF9kaXN0IGlzIG5vdCBOb25lIGFuZCB3b3JzdF9kaXN0IDwgV0FSTl9MSVFfRElTVEFOQ0U6CiAgICAgICAgbGluZXMgKz0gWwogICAgICAgICAgICBmIjxjb2RlPntTRVB9PC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+8J+aqCBXT1JTVC1DQVNFOiBTT0wgYXQge19mcCh3b3JzdF9wcmljZSl9ICgtMjAlKTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPiAgIOKGkiBPbmx5IHt3b3JzdF9kaXN0Oi4xZn0lIGZyb20gbGlxIOKAlCBISUdIIERBTkdFUjwvY29kZT4iLAogICAgICAgIF0KICAgIGVsaWYgd29yc3RfZGlzdCBpcyBub3QgTm9uZToKICAgICAgICBsaW5lcyArPSBbCiAgICAgICAgICAgIGYiPGNvZGU+e1NFUH08L2NvZGU+IiwKICAgICAgICAgICAgZiI8Y29kZT7wn6evIFdPUlNULUNBU0U6IFNPTCBhdCB7X2ZwKHdvcnN0X3ByaWNlKX0gKC0yMCUpPC9jb2RlPiIsCiAgICAgICAgICAgIGYiPGNvZGU+ICAg4oaSIHt3b3JzdF9kaXN0Oi4xZn0lIGZyb20gbGlxIOKAlCBtYW5hZ2VhYmxlPC9jb2RlPiIsCiAgICAgICAgXQoKICAgIHJldHVybiAiXG4iLmpvaW4obGluZXMpCgoKZGVmIGZvcm1hdF9wcmljZV96b25lcyhweik6CiAgICAiIiJGb3JtYXQgL3ByaWNlem9uZXMgb3V0cHV0LiIiIgogICAgaWYgbm90IHB6OgogICAgICAgIHJldHVybiAiPGI+8J+TjSBQUklDRSBaT05FUzwvYj5cbjxjb2RlPuKdjCBObyBwb3NpdGlvbiBkYXRhIGF2YWlsYWJsZS48L2NvZGU+IgoKICAgIHNvbF9wcmljZSA9IHB6WyJzb2xfcHJpY2UiXQogICAgZW50cnkgPSBwelsiZW50cnkiXQogICAgbGlxID0gcHpbImN1cnJlbnRfbGlxIl0KICAgIGxldmVyYWdlID0gcHpbImxldmVyYWdlIl0KCiAgICBsaW5lcyA9IFsKICAgICAgICBmIjxiPvCfk40gW0xFVl06IFNPTCBQUklDRSBaT05FUzwvYj4iLAogICAgICAgIGYiPGNvZGU+e1NFUH08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfk5AgUG9zaXRpb246IHtsZXZlcmFnZTouMmZ9eCBhdCB7X2ZwKGVudHJ5KX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkrAgQ3VycmVudDogIHtfZnAoc29sX3ByaWNlKX08L2NvZGU+IiwKICAgICAgICBmIjxjb2RlPvCfkoAgTGlxIHByaWNlOiB7X2ZwKGxpcSl9PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57U0VQfTwvY29kZT4iLAogICAgICAgIGYiPGNvZGU+SWYgU09MIGdvZXMgdG86PC9jb2RlPiIsCiAgICAgICAgZiI8Y29kZT57U0VQfTwvY29kZT4iLAogICAgXQoKICAgIGZvciB6IGluIHB6WyJ6b25lcyJdOgogICAgICAgIHBubF9zdHIgPSBfZnYoelsicG5sIl0pCiAgICAgICAgZGlzdF9zdHIgPSBmInt6WydsaXFfZGlzdCddOi4xZn0lIHRvIGxpcSIgaWYgelsibGlxX2Rpc3QiXSBpcyBub3QgTm9uZSBlbHNlICJOL0EiCiAgICAgICAgbGluZXMgKz0gWwogICAgICAgICAgICBmIjxiPnt6WydzdGF0dXMnXX0g4oCUIHtfZnAoelsncHJpY2UnXSl9PC9iPiIsCiAgICAgICAgICAgIGYiPGNvZGU+ICBQbkw6IHtwbmxfc3RyfSAgfCAge2Rpc3Rfc3RyfTwvY29kZT4iLAogICAgICAgICAgICBmIjxjb2RlPiAg4oaSIHt6WydhY3Rpb24nXX08L2NvZGU+IiwKICAgICAgICBdCgogICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+e1NFUH08L2NvZGU+IikKICAgIGxpbmVzLmFwcGVuZChmIjxjb2RlPlNhZmUgcHJpY2UgZmxvb3JzIChhZnRlciArJHtNT05USExZX0FERF9VU0Q6LjBmfSBhZGQpOjwvY29kZT4iKQogICAgZm9yIGxldl9sYWJlbCwgZmxvb3IgaW4gcHpbImZsb29ycyJdLml0ZW1zKCk6CiAgICAgICAgZmxvb3Jfc3RyID0gX2ZwKGZsb29yKSBpZiBmbG9vciBlbHNlICJOL0EiCiAgICAgICAgbGluZXMuYXBwZW5kKGYiPGNvZGU+ICBAIHtsZXZfbGFiZWx9IGxldmVyYWdlIOKGkiBsaXEge2Zsb29yX3N0cn08L2NvZGU+IikKCiAgICByZXR1cm4gIlxuIi5qb2luKGxpbmVzKQoKCiMg4pSA4pSAIEFsZXJ0IGNoZWNrZXIgKGNhbGxlZCBieSBzY2hlZHVsZXIpIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAoKZGVmIGNoZWNrX2FsZXJ0cyhwb3NpdGlvbik6CiAgICAiIiIKICAgIENoZWNrIGFsbCBhbGVydCBjb25kaXRpb25zLiBSZXR1cm5zIGxpc3Qgb2YgKGFsZXJ0X3R5cGUsIG1lc3NhZ2UpIHR1cGxlcy4KICAgIE9ubHkgZmlyZXMgZWFjaCBhbGVydCBvbmNlIHBlciBjb29sZG93biBwZXJpb2QuCiAgICAiIiIKICAgIGFsZXJ0cyA9IFtdCiAgICBpZiBub3QgcG9zaXRpb246CiAgICAgICAgcmV0dXJuIGFsZXJ0cwoKICAgIG5vdyA9IHRpbWUudGltZSgpCiAgICBtYXJrID0gcG9zaXRpb25bIm1hcmtfcHJpY2UiXQogICAgbGlxID0gcG9zaXRpb25bImxpcV9wcmljZSJdCiAgICBmdW5kaW5nID0gcG9zaXRpb25bImZ1bmRpbmdfcmF0ZSJdCgogICAgIyBMaXF1aWRhdGlvbiByaXNrIGFsZXJ0IChjb29sZG93biAxaCkKICAgIGxpcV9kaXN0ID0gY2FsY19saXFfZGlzdGFuY2VfcGN0KG1hcmssIGxpcSkKICAgIGlmIGxpcV9kaXN0IGlzIG5vdCBOb25lIGFuZCBsaXFfZGlzdCA8IExJUV9XQVJOX1BDVDoKICAgICAgICBpZiBub3cgLSBfc3RhdGVbImxhc3RfbGlxX2FsZXJ0X3RzIl0gPiAzNjAwOgogICAgICAgICAgICBfc3RhdGVbImxhc3RfbGlxX2FsZXJ0X3RzIl0gPSBub3cKICAgICAgICAgICAgYWxlcnRzLmFwcGVuZCgoImxpcSIsIGZvcm1hdF9saXFfYWxlcnQocG9zaXRpb24pKSkKCiAgICAjIFByaWNlIHRhcmdldCBhbGVydHMgKG9uZS10aW1lIHBlciB0YXJnZXQpCiAgICBpZiBtYXJrOgogICAgICAgIGZvciB0YXJnZXQgaW4gUFJJQ0VfVEFSR0VUUzoKICAgICAgICAgICAga2V5ID0gZiJ0YXJnZXRfe3RhcmdldH0iCiAgICAgICAgICAgIGlmIGtleSBub3QgaW4gX3N0YXRlWyJ0YXJnZXRzX2hpdCJdIGFuZCBtYXJrID49IHRhcmdldDoKICAgICAgICAgICAgICAgIF9zdGF0ZVsidGFyZ2V0c19oaXQiXS5hZGQoa2V5KQogICAgICAgICAgICAgICAgYWxlcnRzLmFwcGVuZCgoInRhcmdldCIsIGZvcm1hdF90YXJnZXRfYWxlcnQocG9zaXRpb24sIHRhcmdldCkpKQogICAgICAgICAgICBlbGlmIGtleSBpbiBfc3RhdGVbInRhcmdldHNfaGl0Il0gYW5kIG1hcmsgPCB0YXJnZXQgKiAwLjk3OgogICAgICAgICAgICAgICAgIyBSZXNldCBpZiBwcmljZSBkcm9wcyA+MyUgYmVsb3cgdGFyZ2V0CiAgICAgICAgICAgICAgICBfc3RhdGVbInRhcmdldHNfaGl0Il0uZGlzY2FyZChrZXkpCgogICAgIyBGdW5kaW5nIHJhdGUgYWxlcnQgKGNvb2xkb3duIDRoKQogICAgaWYgZnVuZGluZyBhbmQgYWJzKGZ1bmRpbmcpID4gRlVORElOR19XQVJOX1BDVDoKICAgICAgICBpZiBub3cgLSBfc3RhdGVbImxhc3RfZnVuZGluZ19hbGVydF90cyJdID4gMTQ0MDA6CiAgICAgICAgICAgIF9zdGF0ZVsibGFzdF9mdW5kaW5nX2FsZXJ0X3RzIl0gPSBub3cKICAgICAgICAgICAgYWxlcnRzLmFwcGVuZCgoImZ1bmRpbmciLCBmb3JtYXRfZnVuZGluZ19hbGVydChwb3NpdGlvbikpKQoKICAgIHJldHVybiBhbGVydHMKCgpkZWYgY2hlY2tfbW9udGhseV9yZW1pbmRlcigpOgogICAgIiIiUmV0dXJucyBtb250aGx5IHJlbWluZGVyIG1lc3NhZ2UgaWYgMzAgZGF5cyBoYXZlIHBhc3NlZCwgZWxzZSBOb25lLiIiIgogICAgbm93ID0gdGltZS50aW1lKCkKICAgIGRheXNfZWxhcHNlZCA9IChub3cgLSBfc3RhdGVbImxhc3RfbW9udGhseV9yZW1pbmRlcl90cyJdKSAvIDg2NDAwCiAgICBpZiBkYXlzX2VsYXBzZWQgPj0gTU9OVEhMWV9SRU1JTkRFUl9EQVlTOgogICAgICAgIF9zdGF0ZVsibGFzdF9tb250aGx5X3JlbWluZGVyX3RzIl0gPSBub3cKICAgICAgICByZXR1cm4gVHJ1ZQogICAgcmV0dXJuIEZhbHNlCg==',
}
for path, b64 in FILES.items():
    content = base64.b64decode(b64)
    try:
        ast.parse(content)
        print(f"  {path} syntax OK - {len(content):,} chars")
    except SyntaxError as e:
        print(f"  SYNTAX ERROR in {path}: {e}")
        sys.exit(1)
    with open(path, "wb") as f:
        f.write(content)
    print(f"  Written: {path}")
print("")
print("Deploy complete.")
